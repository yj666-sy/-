
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>EVE Chat</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ’¬</text></svg>">
    <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ’¬</text></svg>">
    <script src="https://unpkg.com/dexie@3.2.4/dist/dexie.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;500;600;700&family=Comic+Neue:wght@400;700&family=Fredoka+One&family=Nunito:wght@400;500;600;700&family=Montserrat:wght@400;500;600&family=Inter:wght@400;500;600&family=Roboto:wght@400;500&family=Raleway:wght@400;500;600&family=Lato:wght@400;700&family=Poppins:wght@400;500;600&family=Quicksand:wght@400;500;600&family=Varela+Round&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css?v=20250805-duration-spacing">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- ğŸ”¥ã€æ–°å¢ã€‘çŠ¶æ€æŒ‡ç¤ºå™¨æ ·å¼ -->
    <style>
        /* è§’è‰²åˆ—è¡¨çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .contact-status-indicator {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            z-index: 10;
        }

        /* å·²æ‹‰é»‘çŠ¶æ€ - çº¢è‰² */
        .contact-status-indicator.blocked {
            background-color: #ff4444;
            color: white;
        }

        /* è¢«æ‹‰é»‘çŠ¶æ€ - æ·±æ©™è‰² */
        .contact-status-indicator.blocked-by {
            background-color: #ff8800;
            color: white;
        }

        /* å·²å±è”½ç¾¤èŠçŠ¶æ€ - æ©™è‰² */
        .contact-status-indicator.muted {
            background-color: #ff9500;
            color: white;
        }

        /* ç¡®ä¿è§’è‰²é¡¹æœ‰ç›¸å¯¹å®šä½ */
        .contact-item {
            position: relative;
        }

        /* ğŸ”¥ã€æ–°å¢ã€‘è¶³è¿¹æ–°å¢é«˜äº®æ ·å¼ */
        .footprint-item.new-footprint {
            animation: slideInFromTop 0.5s ease-out;
        }

        .footprint-item.highlight-new {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            border-left: 4px solid #2196f3;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.2);
            transform: scale(1.02);
            transition: all 0.3s ease;
        }

        .footprint-mood {
            color: #e91e63;
            font-size: 0.9em;
            margin-top: 5px;
        }

        @keyframes slideInFromTop {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ğŸ”¥ã€æ–°å¢ã€‘æ¶ˆæ¯åˆ—è¡¨çŠ¶æ€æŒ‡ç¤ºå™¨æ ·å¼ */
        .message-avatar-container {
            position: relative;
            display: inline-block;
        }

        .message-status-indicator {
            position: absolute;
            right: 2px;
            bottom: 1px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            z-index: 10;
        }

        /* å·²æ‹‰é»‘çŠ¶æ€ - çº¢è‰² */
        .message-status-indicator.blocked {
            background-color: #ff4444;
            color: white;
        }

        /* è¢«æ‹‰é»‘çŠ¶æ€ - æ·±æ©™è‰² */
        .message-status-indicator.blocked-by {
            background-color: #ff8800;
            color: white;
        }

        /* å·²å±è”½ç¾¤èŠçŠ¶æ€ - æ©™è‰² */
        .message-status-indicator.muted {
            background-color: #ff9500;
            color: white;
        }

        /* ğŸ”¥ã€æ–°å¢ã€‘æœªè¯»æ¶ˆæ¯æç¤ºæ ·å¼ */
        .unread-badge {
            position: absolute;
            right: -2px;
            top: -2px;
            min-width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: #ff4444;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            z-index: 15;
            padding: 0 4px;
            box-sizing: border-box;
        }

        /* å½“æ•°å­—è¶…è¿‡99æ—¶ï¼Œæ˜¾ç¤º99+ */
        .unread-badge.large-count {
            font-size: 8px;
            min-width: 20px;
            border-radius: 10px;
        }

        /* ğŸ”¥ã€æ–°å¢ã€‘å±é™©æ“ä½œæ ·å¼ */
        .danger-item {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .danger-item:hover {
            background-color: rgba(255, 59, 48, 0.05);
        }

        .danger-color {
            color: #ff3b30 !important;
        }

        .danger-section-title {
            color: #ff3b30 !important;
        }

        .danger-section-icon {
            color: #ff3b30 !important;
        }

        /* ğŸ”¥ã€é‡æ–°è®¾è®¡ã€‘æ¶ˆæ¯åˆ—è¡¨å¤šé€‰æ¨¡å¼æŒ‰é’® - æ”¾åœ¨app-headerä¸­ */
        .chat-header-multiselect-actions {
            display: flex;
            gap: 6px;
            align-items: center;
        }







        /* ğŸ”¥ã€é‡æ–°è®¾è®¡ã€‘ç½®é¡¶å¯¹è¯çš„è§†è§‰æ ‡è¯† - ä¸»é¢˜åŒ–é¢œè‰² */
        .message-item.pinned {
            background: rgba(74, 132, 193, 0.08);
            border-left: 3px solid rgba(74, 132, 193, 0.3);
        }

        /* å¯çˆ±ä¸»é¢˜ä¸‹çš„ç½®é¡¶å¯¹è¯æ ·å¼ */
        body[data-theme="cute"] .message-item.pinned {
            background: rgba(255, 182, 193, 0.08);
            border-left: 3px solid rgba(255, 182, 193, 0.3);
        }

        .pin-indicator {
            position: absolute;
            top: 5px;
            right: 5px;
            color: #ffd700;
            font-size: 12px;
            z-index: 5;
        }

        /* ğŸ®ã€æ–°å¢ã€‘æ¸¸æˆé€‰æ‹©æ¨¡æ€æ¡†æ ·å¼ - æ¯›ç»ç’ƒé£æ ¼è«å…°è¿ªè‰²ç³» */
        .game-modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            max-width: 450px;
            width: 85%;
            max-height: 70vh;
        }

        /* ç­‰å¾…æ¨¡æ€æ¡†æ ·å¼ */
        .waiting-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .waiting-modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 40px 30px;
            text-align: center;
            max-width: 300px;
            width: 80%;
        }

        .waiting-spinner {
            width: 40px;
            height: 40px;
            margin: 0 auto 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            border-style: dashed;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .waiting-text {
            color: #666;
            font-size: 16px;
            margin: 0;
        }

        .game-modal-header {
            padding: 20px 20px 10px 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .game-modal-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 600;
            color: #5a5a5a;
        }

        .game-modal-title i {
            color: #8b9dc3;
        }

        .game-modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .game-modal-close:hover {
            background: rgba(0, 0, 0, 0.05);
            color: #666;
        }

        .game-modal-body {
            padding: 15px 20px 25px 20px;
        }

        .game-buttons-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .game-button {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            width: 100%;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .game-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .game-button:active {
            transform: translateY(0);
        }

        /* è«å…°è¿ªè‰²ç³»æ¸¸æˆæŒ‰é’® */
        .game-button.gomoku {
            background: linear-gradient(135deg, rgba(139, 157, 195, 0.3), rgba(139, 157, 195, 0.1));
            color: #4a5568;
        }

        .game-button.turtle-soup {
            background: linear-gradient(135deg, rgba(168, 162, 158, 0.3), rgba(168, 162, 158, 0.1));
            color: #4a5568;
        }

        .game-button.werewolf {
            background: linear-gradient(135deg, rgba(147, 125, 135, 0.3), rgba(147, 125, 135, 0.1));
            color: #4a5568;
        }

        .game-button.monopoly {
            background: linear-gradient(135deg, rgba(162, 152, 140, 0.3), rgba(162, 152, 140, 0.1));
            color: #4a5568;
        }

        .game-button.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .game-button.disabled:hover {
            transform: none;
            box-shadow: none;
        }

        .game-button-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 18px;
            background: rgba(255, 255, 255, 0.4);
            color: inherit;
        }

        .game-button-content {
            flex: 1;
        }

        .game-button-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
            color: inherit;
        }

        .game-button-desc {
            font-size: 13px;
            opacity: 0.8;
            color: inherit;
        }

        .game-button-badge {
            position: absolute;
            top: 8px;
            right: 12px;
            background: rgba(255, 255, 255, 0.8);
            color: #666;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 500;
        }

        .game-button-badge.recommended {
            background: rgba(255, 193, 7, 0.8);
            color: #856404;
        }

        .game-button-badge.coming-soon {
            background: rgba(108, 117, 125, 0.8);
            color: white;
        }

        /* ğŸ®ã€åˆ é™¤ã€‘æ¸¸æˆä¿¡æ¯æŒ‰é’®æ ·å¼å·²ç§»é™¤ */

        /* ğŸ”¥ã€æ–°å¢ã€‘çº¦å®šå®ŒæˆæŒ‰é’®æ ·å¼ */
        .appointment-action-btn.appointment-complete-btn.completed {
            background-color: #e0e0e0 !important;
            color: #999 !important;
            cursor: not-allowed !important;
            opacity: 0.6 !important;
        }

        .appointment-action-btn.appointment-complete-btn.completed:hover {
            background-color: #e0e0e0 !important;
            color: #999 !important;
        }

        /* ğŸ”¥ã€æ–°å¢ã€‘çº¦å®šå€’è®¡æ—¶æ ·å¼ */
        .appointment-countdown {
            font-size: 14px;
            font-weight: 500;
            padding: 4px 8px;
            border-radius: 12px;
            background-color: #f0f0f0;
            color: #666;
        }

        .appointment-countdown.pending {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .appointment-countdown.completed {
            background-color: #e8f5e8;
            color: #4caf50;
        }

        .appointment-countdown.overdue {
            background-color: #ffebee;
            color: #f44336;
        }

        /* ğŸ”¥ã€æ–°å¢ã€‘çº¦å®šè¯¦æƒ…å¤´éƒ¨æ ·å¼ */
        .appointment-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .appointment-detail-left {
            flex: 1;
        }

        .appointment-detail-name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .appointment-detail-time {
            font-size: 14px;
            color: #666;
        }

        .appointment-detail-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .appointment-type-tag {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            background-color: #ff9800;
            color: white;
            white-space: nowrap;
        }

        /* ğŸ›’ã€æ–°å¢ã€‘è´­ç‰©å°ç¥¨æ ·å¼ */
        .order-receipt-container {
            margin: 8px 0;
            display: flex;
            justify-content: flex-end;
        }

        .receipt-card {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
            max-width: 280px;
            width: 100%;
            overflow: hidden;
            border: 1px solid #e8e8e8;
        }



        .receipt-header {
            background: #ffffff;
            padding: 16px;
            text-align: center;
            border-bottom: 1px solid #e8e8e8;
        }

        .receipt-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .receipt-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .receipt-divider {
            height: 1px;
            background: linear-gradient(to right, transparent, #e8e8e8, transparent);
            margin: 0 16px;
        }

        .receipt-info {
            padding: 16px;
        }

        .receipt-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            padding: 2px 0;
            font-size: 12px;
            line-height: 1.2;
        }

        .receipt-row:last-child {
            margin-bottom: 0;
        }

        .receipt-row .label {
            color: #666;
            font-weight: 400;
            font-size: 12px;
        }

        .receipt-row .value {
            color: #333;
            font-weight: 400;
            font-size: 12px;
        }

        .receipt-items {
            padding: 0 16px 16px;
        }

        .items-header {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #e8e8e8;
        }

        .receipt-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .receipt-item:last-child {
            margin-bottom: 0;
        }

        .item-name {
            flex: 1;
            color: #333;
            margin-right: 8px;
        }

        .item-quantity {
            color: #666;
            margin-right: 8px;
            min-width: 30px;
            text-align: center;
        }

        .item-price {
            color: #333;
            font-weight: 600;
            min-width: 60px;
            text-align: right;
        }

        .receipt-total {
            padding: 16px;
            background: #f8f9fa;
            border-top: 1px solid #e8e8e8;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .total-row:last-child {
            margin-bottom: 0;
        }

        .total-row.final {
            border-top: 1px solid #e8e8e8;
            padding-top: 8px;
            font-size: 16px;
            font-weight: 700;
        }

        .total-label {
            color: #666;
        }

        .total-row.final .total-label {
            color: #333;
        }

        .total-amount {
            color: #ff6b6b;
            font-weight: 700;
        }

        .receipt-footer {
            padding: 12px 16px;
            text-align: center;
            background: #f8f9fa;
            border-top: 1px solid #e8e8e8;
        }

        .thank-you {
            font-size: 12px;
            color: #999;
            font-style: italic;
        }

        /* ğŸ›’ã€æ–°å¢ã€‘è´­ç‰©å°ç¥¨åŠ¨ç”»æ•ˆæœ */
        .receipt-card {
            animation: receiptSlideIn 0.3s ease-out;
        }

        @keyframes receiptSlideIn {
            from {
                opacity: 0;
                transform: translateX(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }















    </style>

</head>
<bodyâˆ½
    <div id="notification-container"></div>
        <!-- æ¨é€é€šçŸ¥å®¹å™¨ -->
        <div id="notification-container"></div>
   <div id="phone-screen" class="phone-screen">
        <div class="wallpaper" id="wallpaper-element">
            <!-- ä¸»å±å¹•çŠ¶æ€æ  -->
            <div id="status-bar">
                <span id="status-bar-time">14:25</span>
                <div class="status-bar-right">
                    <div id="status-bar-signal" class="signal-icon">
                        <div class="signal-row">
                            <div class="signal-bar"></div>
                            <div class="signal-bar"></div>
                            <div class="signal-bar"></div>
                            <div class="signal-bar"></div>
                        </div>
                    </div>
                    <div id="status-bar-battery" class="battery-container">
                        <div class="battery-icon">
                            <div class="battery-level"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- éŸ³ä¹æ˜¾ç¤ºåŒºåŸŸï¼ˆç±»ä¼¼çµåŠ¨å²›ï¼‰ - ç‹¬ç«‹äºçŠ¶æ€æ  -->
            <div id="music-status-display" class="music-status-display" style="display: none;" onclick="openMusicModal()">
                <i class="fas fa-headphones music-icon"></i>
                <div class="music-lyrics-scroll">
                    <span id="current-lyric">â™ª ç‚¹å‡»å¼€å§‹å¬æ­Œ</span>
                </div>
            </div>

            <!-- ğŸ”¥ã€æ–°å¢ã€‘é˜…è¯»çŠ¶æ€æ˜¾ç¤ºåŒºåŸŸï¼ˆç±»ä¼¼éŸ³ä¹æ’­æ”¾å™¨ï¼‰ -->
            <div id="reading-status-display" class="reading-status-display" style="display: none;">
                <i class="fas fa-book-open reading-icon"></i>
                <div class="reading-info" onclick="toggleBookReaderModal()" style="cursor: pointer;" title="ç‚¹å‡»å±•å¼€é˜…è¯»å™¨">
                    <span id="reading-book-title">æ­£åœ¨é˜…è¯»...</span>
                    <span id="reading-progress">ç¬¬1é¡µ</span>
                </div>
                <div class="reading-controls">
                    <!-- ğŸ”¥ã€æ–°å¢ã€‘æ’­æ”¾/æš‚åœæŒ‰é’®ï¼ˆä»…å¬ä¹¦æ¨¡å¼æ˜¾ç¤ºï¼‰ -->
                    <button id="reading-play-pause-btn" class="reading-control-btn" onclick="toggleListeningPlayPause()" title="æš‚åœ" style="display: none;">
                        <i class="fas fa-pause"></i>
                    </button>
                    <button class="reading-control-btn" onclick="toggleBookReaderModal()" title="å±•å¼€é˜…è¯»å™¨">
                        <i class="fas fa-expand-alt"></i>
                    </button>
                    <button class="reading-control-btn reading-power-off-btn" onclick="closeReadingSession()" title="é€€å‡ºé˜…è¯»">
                        <i class="fas fa-power-off"></i>
                    </button>
                </div>
            </div>

            <!-- æ—¶é’Ÿå®¹å™¨ -->
            <div id="clock-container">
                <div id="main-date">12æœˆ18æ—¥ æ˜ŸæœŸä¸€</div>
                <div id="main-time">14:25</div>
            </div>

            <div id="worldbook-screen" class="app-screen">
                <div class="app-top-container">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('worldbook-screen')">â€¹</button>
                        <div class="app-title">ä¸–ç•Œä¹¦</div>
                        <div class="app-header-actions">
                            <button class="manage-categories-btn" onclick="showManageCategoriesModal()">
                                <i class="fas fa-tags"></i>
                            </button>
                            <div class="add-worldbook-btn worldbook-add-btn" onclick="onWorldbookAddClick()">
                                <i class="fas fa-plus"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘åˆ†ç±»æ ‡ç­¾æ  -->
                <div class="worldbook-category-tabs" id="worldbook-category-tabs">
                    <!-- åˆ†ç±»æ ‡ç­¾å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>

                <div class="app-content">
                    <div id="global-worldbooks-content" class="worldbook-content-pane">
                        </div>
                    <div id="local-worldbooks-content" class="worldbook-content-pane" style="display: none;">
                        </div>

                </div>



                <div class="worldbook-tabs">
                    <div class="worldbook-tab active" onclick="switchWorldbookTab('global')">
                        <i class="fas fa-globe-asia"></i>
                        <span>å…¨å±€è®¾å®š</span>
                    </div>
                    <div class="worldbook-tab" onclick="switchWorldbookTab('local')">
                        <i class="fas fa-comment-dots"></i>
                        <span>å±€éƒ¨è®¾å®š</span>
                    </div>

                </div>
            </div>

                <!-- ä¸»å±å¹•å››å—å¸ƒå±€ -->
                <div id="home-grid">
                    <!-- å·¦ä¸Šè§’ï¼šå›¾ç‰‡å°ç»„ä»¶ -->
                    <div class="home-section top-left">
                        <div class="widget photo-widget" onclick="showPhotoWidgetOptions()">
                            <div class="photo-widget-content" id="photo-widget-content">
                                <div class="photo-placeholder" id="photo-placeholder">
                                    <i class="fas fa-image"></i>
                                    <span>ç‚¹å‡»æ·»åŠ å›¾ç‰‡</span>
                                </div>
                                <img class="photo-widget-image" id="photo-widget-image" style="display: none;">
                            </div>
                        </div>
                    </div>

                    <!-- å³ä¸Šè§’ï¼šä¸¤ä¸ªåº”ç”¨ -->
                    <div class="home-section top-right">
                        <div class="apps-grid-2">
                            <a href="#" class="mini-app" onclick="showApp('chat-screen')">
                                <div class="mini-app-icon">
                                    <i class="fas fa-comment-dots"></i>
                                </div>
                                <span>Chat</span>
                            </a>
                            <a href="#" class="mini-app" onclick="showApp('worldbook-screen'); switchWorldbookTab('global');">
                                <div class="mini-app-icon">
                                    <i class="fas fa-globe-americas"></i>
                                </div>
                                <span>ä¸–ç•Œä¹¦</span>
                            </a>
                        </div>
                    </div>

                    <!-- å·¦ä¸‹è§’ï¼šä¸¤ä¸ªåº”ç”¨ -->
                    <div class="home-section bottom-left">
                        <div class="apps-grid-2">
                            <a href="#" class="mini-app" onclick="showApp('anniversary-screen')">
                                <div class="mini-app-icon">
                                    <i class="fas fa-heart"></i>
                                </div>
                                <span>çºªå¿µæ—¥</span>
                            </a>
                            <a href="#" class="mini-app" onclick="showApp('forum-screen')">
                                <div class="mini-app-icon">
                                    <i class="fas fa-comments"></i>
                                </div>
                                <span>è®ºå›</span>
                            </a>
                        </div>
                    </div>

                    <!-- å³ä¸‹è§’ï¼šçºªå¿µæ—¥å°ç»„ä»¶ -->
                    <div class="home-section bottom-right">
                        <div class="widget anniversary-widget">
                            <div class="anniversary-widget-content" id="anniversary-widget-content">
                                <div class="anniversary-placeholder" id="anniversary-placeholder">
                                    <i class="fas fa-heart"></i>
                                    <span>æš‚æ— çºªå¿µæ—¥</span>
                                </div>
                                <div class="anniversary-display" id="anniversary-display" style="display: none;">
                                    <div class="anniversary-name" id="widget-anniversary-name"></div>
                                    <div class="anniversary-countdown" id="widget-anniversary-countdown"></div>
                                    <div class="anniversary-date" id="widget-anniversary-date"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- iPhoneé£æ ¼Dockæ  -->
                <div id="dock-bar">
                    <div class="dock-container">
                        <a href="#" class="dock-app" onclick="showApp('messages-screen')">
                            <div class="dock-app-icon">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <span>çŸ­ä¿¡</span>
                        </a>
                        <a href="#" class="dock-app" onclick="showApp('settings-screen')">
                            <div class="dock-app-icon">
                                <i class="fas fa-cog"></i>
                            </div>
                            <span>è®¾ç½®</span>
                        </a>
                        <a href="#" class="dock-app" onclick="showApp('memory-viewer-screen')">
                            <div class="dock-app-icon">
                                <i class="fas fa-brain"></i>
                            </div>
                            <span>è®°å¿†</span>
                        </a>
                    </div>
                </div>


                <!-- çºªå¿µæ—¥ç•Œé¢ -->
                <div id="anniversary-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                                <div class="app-battery-container">
                                    <div class="app-battery-icon">
                                        <div class="app-battery-level"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="app-header">
                            <button class="back-button" onclick="hideApp('anniversary-screen')">â€¹</button>
                            <div class="app-title">çºªå¿µæ—¥</div>
                        <div class="add-anniversary-btn" onclick="showAnniversaryForm()">
                            <i class="fas fa-plus"></i>
                        </div>
                    </div>
                    </div>
                    <div class="app-content">
                        <!-- çºªå¿µæ—¥å†…å®¹åŒºåŸŸ -->
                        <div id="anniversary-content" class="anniversary-content-pane">
                            <!-- ç½®é¡¶çºªå¿µæ—¥æ˜¾ç¤ºåŒºåŸŸ -->
                            <div id="pinned-anniversary-section" class="pinned-anniversary-section" style="display: none;">
                                <div id="pinned-anniversary-card" class="pinned-anniversary-card">
                                    <!-- ç½®é¡¶çºªå¿µæ—¥å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>

                            <div id="anniversary-list" class="anniversary-list">
                                <!-- çºªå¿µæ—¥åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                <div class="anniversary-empty-state">
                                    <i class="fas fa-heart"></i>
                                    <p>è¿˜æ²¡æœ‰çºªå¿µæ—¥</p>
                                    <p>ç‚¹å‡»å³ä¸Šè§’ + æ·»åŠ é‡è¦çš„æ—¥å­</p>
                                </div>
                            </div>
                        </div>

                        <!-- çº¦å®šå†…å®¹åŒºåŸŸ -->
                        <div id="appointment-content" class="anniversary-content-pane" style="display: none;">
                            <!-- ç½®é¡¶çº¦å®šæ˜¾ç¤ºåŒºåŸŸ -->
                            <div id="pinned-appointment-section" class="pinned-appointment-section" style="display: none;">
                                <div id="pinned-appointment-card" class="pinned-appointment-card">
                                    <!-- ç½®é¡¶çº¦å®šå†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>

                            <div id="appointment-list" class="appointment-list">
                                <!-- çº¦å®šåˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                <div class="appointment-empty-state">
                                    <i class="fas fa-calendar-check"></i>
                                    <p>è¿˜æ²¡æœ‰çº¦å®š</p>
                                    <p>ç‚¹å‡»å³ä¸Šè§’ + æ·»åŠ æ–°çº¦å®š</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- åº•éƒ¨åˆ†æ  -->
                    <div class="anniversary-tabs">
                        <div class="anniversary-tab active" onclick="switchAnniversaryTab('anniversary')">
                            <i class="fas fa-heart"></i>
                            <span>çºªå¿µæ—¥</span>
                        </div>
                        <div class="anniversary-tab" onclick="switchAnniversaryTab('appointment')">
                            <i class="fas fa-calendar-check"></i>
                            <span>çº¦å®š</span>
                        </div>
                    </div>
                </div>

                <!-- è´­ç‰©ç•Œé¢ -->
                <div id="shopping-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="handleShoppingBack()" id="shopping-back-btn">â€¹</button>
                        <div class="app-title">è´­ç‰©</div>
                        <div class="shopping-header-actions">
                            <div class="shopping-cart-btn" onclick="openShoppingCart()" title="è´­ç‰©è½¦">
                                <i class="fas fa-shopping-cart"></i>
                                <span class="cart-badge" id="cart-badge" style="display: none;">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="app-content shopping-content">
                        <!-- æœç´¢æ¡† -->
                        <div class="shopping-search-container">
                            <div class="shopping-search-box">
                                <i class="fas fa-search shopping-search-icon"></i>
                                <input type="text" id="shopping-search-input" class="shopping-search-input" placeholder="æœç´¢å•†å“..." maxlength="100">
                            </div>
                        </div>

                        <!-- åˆ†ç±»åŒºåŸŸ -->
                        <div class="shopping-categories" id="shopping-categories">
                            <!-- å¤–å–åˆ†ç±» -->
                            <div class="category-list" id="takeout-categories">
                                <div class="category-item" onclick="showCategoryProducts('ç¾é£Ÿ')">
                                    <i class="fas fa-utensils"></i>
                                    <span>ç¾é£Ÿ</span>
                                </div>
                                <div class="category-item" onclick="showCategoryProducts('ç”œç‚¹é¥®å“')">
                                    <i class="fas fa-coffee"></i>
                                    <span>ç”œç‚¹é¥®å“</span>
                                </div>
                                <div class="category-item" onclick="showCategoryProducts('è”¬èœæ°´æœ')">
                                    <i class="fas fa-apple-alt"></i>
                                    <span>è”¬èœæ°´æœ</span>
                                </div>
                                <div class="category-item" onclick="showCategoryProducts('çœ‹ç—…ä¹°è¯')">
                                    <i class="fas fa-pills"></i>
                                    <span>çœ‹ç—…ä¹°è¯</span>
                                </div>
                                <div class="category-item custom-item" onclick="addCustomItem()">
                                    <i class="fas fa-plus"></i>
                                    <span>æ·»åŠ è‡ªå®šä¹‰å•†å“</span>
                                </div>
                            </div>

                            <!-- è´­ç‰©åˆ†ç±» -->
                            <div class="category-list" id="shopping-categories-list" style="display: none;">
                                <div class="category-item" onclick="showCategoryProducts('æ•°ç äº§å“')">
                                    <i class="fas fa-laptop"></i>
                                    <span>æ•°ç äº§å“</span>
                                </div>
                                <div class="category-item" onclick="showCategoryProducts('å®¶å±…ç™¾è´§')">
                                    <i class="fas fa-home"></i>
                                    <span>å®¶å±…ç™¾è´§</span>
                                </div>
                                <div class="category-item" onclick="showCategoryProducts('å¥³è£…ç”·è£…')">
                                    <i class="fas fa-tshirt"></i>
                                    <span>å¥³è£…ç”·è£…</span>
                                </div>
                                <div class="category-item" onclick="showCategoryProducts('é¥°å“ç®±åŒ…')">
                                    <i class="fas fa-gem"></i>
                                    <span>é¥°å“ç®±åŒ…</span>
                                </div>
                                <div class="category-item custom-item" onclick="addCustomItem()">
                                    <i class="fas fa-plus"></i>
                                    <span>æ·»åŠ è‡ªå®šä¹‰å•†å“</span>
                                </div>
                            </div>
                        </div>

                        <!-- å•†å“å±•ç¤ºåŒºåŸŸ -->
                        <div class="products-container" id="products-container" style="display: none;">
                            <div class="products-grid" id="products-grid">
                                <!-- å•†å“å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>

                    <!-- åº•éƒ¨å¯¼èˆªæ  -->
                    <div class="shopping-tabs">
                        <div class="shopping-tab active" onclick="switchShoppingTab('takeout')">
                            <i class="fas fa-utensils"></i>
                            <span>å¤–å–</span>
                        </div>
                        <div class="shopping-tab" onclick="switchShoppingTab('shopping')">
                            <i class="fas fa-shopping-cart"></i>
                            <span>è´­ç‰©</span>
                        </div>
                    </div>
                </div>

                <!-- è´­ç‰©è½¦ç•Œé¢ -->
                <div id="shopping-cart-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="handleShoppingCartBack()">â€¹</button>
                        <div class="app-title">è´­ç‰©è½¦</div>
                        <div class="cart-header-actions">
                            <div class="clear-cart-btn" onclick="clearShoppingCart()" title="æ¸…ç©ºè´­ç‰©è½¦">
                                <i class="fas fa-trash"></i>
                            </div>
                        </div>
                    </div>
                    <div class="app-content cart-content">
                        <!-- è´­ç‰©è½¦å•†å“åˆ—è¡¨ -->
                        <div class="cart-items-container" id="cart-items-container">
                            <!-- è´­ç‰©è½¦å•†å“å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>

                        <!-- è´­ç‰©è½¦ä¸ºç©ºæ—¶çš„æç¤º -->
                        <div class="cart-empty-state" id="cart-empty-state">
                            <i class="fas fa-shopping-cart"></i>
                            <p>è´­ç‰©è½¦æ˜¯ç©ºçš„</p>
                            <p>å»æ·»åŠ ä¸€äº›å•†å“å§</p>
                            <button class="go-shopping-btn" onclick="hideApp('shopping-cart-screen'); openShoppingScreen();">
                                å»è´­ç‰©
                            </button>
                        </div>
                    </div>

                    <!-- è´­ç‰©è½¦åº•éƒ¨ç»“ç®—åŒºåŸŸ -->
                    <div class="cart-footer" id="cart-footer" style="display: none;">
                        <div class="cart-summary">
                            <div class="cart-total">
                                <span class="total-label">æ€»è®¡ï¼š</span>
                                <span class="total-price" id="cart-total-price">Â¥0</span>
                            </div>
                            <div class="cart-actions">
                                <button class="pay-for-me-btn" onclick="requestPayment()">
                                    è¯·Taä»£ä»˜
                                </button>
                                <button class="checkout-btn" onclick="proceedToCheckout()">
                                    ç»“ç®— (<span id="cart-items-count">0</span>)
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- çŸ­ä¿¡ç•Œé¢ -->
                <div id="messages-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                                <div class="app-battery-container">
                                    <div class="app-battery-icon">
                                        <div class="app-battery-level"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="app-header">
                            <button class="back-button" onclick="hideApp('messages-screen')">â€¹</button>
                            <div class="app-title">çŸ­ä¿¡</div>
                        <div class="messages-header-actions" id="sms-normal-actions">
                            <div class="sms-manage-btn" onclick="showSMSManageOptions()" title="ç®¡ç†çŸ­ä¿¡">
                                <i class="fas fa-ellipsis-h"></i>
                            </div>
                            <div class="add-message-btn" onclick="showNewMessageForm()">
                                <i class="fas fa-edit"></i>
                            </div>
                        </div>
                        <!-- ğŸ”¥ã€æ–°å¢ã€‘çŸ­ä¿¡åˆ—è¡¨å¤šé€‰æ¨¡å¼æŒ‰é’® -->
                        <div class="messages-multiselect-actions" id="sms-list-multiselect-actions" style="display: none;">
                            <button class="multiselect-btn cancel-btn" onclick="exitSMSListMultiSelectMode()">
                                <span>å–æ¶ˆ</span>
                            </button>
                            <button class="multiselect-btn delete-btn" onclick="deleteSelectedSMSConversations()">
                                <span>åˆ é™¤</span>
                            </button>
                        </div>
                    </div>
                    </div>
                    <div class="app-content">
                        <div id="messages-list" class="messages-list">
                            <!-- çŸ­ä¿¡åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            <div class="messages-empty-state">
                                <i class="fas fa-comment-dots"></i>
                                <p>æš‚æ— çŸ­ä¿¡</p>
                                <p>ç‚¹å‡»å³ä¸Šè§’ç¼–è¾‘æŒ‰é’®åˆ›å»ºæ–°ä¿¡æ¯</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘æœç´¢è®°å½•è¯¦æƒ…é¡µé¢ -->
                <div id="search-record-detail-screen" class="app-screen" style="display: none;">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="app-header">
                        <button class="back-button" onclick="hideSearchRecordDetail();">â€¹</button>
                        <div class="app-title">æœç´¢ç»“æœ</div>
                    </div>

                    <div class="app-content search-record-detail-content">
                        <!-- æœç´¢è®°å½•è¯¦æƒ…å†…å®¹ -->
                        <div class="search-record-detail" id="search-record-detail">
                            <div style="text-align: center; padding: 40px; color: #999;">
                                <i class="fas fa-search" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
                                <p>åŠ è½½ä¸­...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- çŸ­ä¿¡èŠå¤©ç•Œé¢ -->
                <div id="sms-chat-screen" class="app-screen" style="display: none;">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                                <div class="app-battery-container">
                                    <div class="app-battery-icon">
                                        <div class="app-battery-level"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="app-header">
                            <button class="back-button" onclick="hideSMSChat()">â€¹</button>
                        <div class="sms-chat-header-center">
                            <div class="sms-chat-avatar" id="sms-chat-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="sms-chat-name" id="sms-chat-name"></div>
                        </div>
                        <div class="sms-chat-actions" id="sms-chat-normal-actions">
                            <button class="sms-action-btn" onclick="showSMSChatInfo()">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                        <!-- ğŸ”¥ã€é‡æ–°è®¾è®¡ã€‘çŸ­ä¿¡å¤šé€‰æ¨¡å¼æŒ‰é’® - ç®€æ´æ ·å¼ -->
                        <div class="sms-chat-multiselect-actions" id="sms-chat-multiselect-actions" style="display: none;">
                            <button class="multiselect-btn cancel-btn" onclick="exitSMSMultiSelectMode()">
                                <span>å–æ¶ˆ</span>
                            </button>
                            <button class="multiselect-btn delete-btn" onclick="deleteSelectedSMSMessages()">
                                <span>åˆ é™¤</span>
                            </button>
                        </div>
                    </div>
                    </div>
                    <div class="app-content sms-chat-content">
                        <div id="sms-messages-container" class="sms-messages-container">
                            <!-- çŸ­ä¿¡æ¶ˆæ¯å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    <div class="sms-input-section">
                        <div class="sms-input-container">
                            <button class="sms-attachment-btn" onclick="openSMSImagePicker()">
                                <i class="fas fa-plus"></i>
                            </button>
                            <div class="sms-input-wrapper">
                                <input type="text" id="sms-message-input" class="sms-message-input" placeholder="çŸ­ä¿¡" onkeydown="handleSMSInputKeydown(event)">
                                <button class="sms-wait-reply-btn" onclick="triggerSMSReply()" id="sms-wait-reply-btn" title="ç­‰å¾…è§’è‰²å›å¤">
                                    <i class="fas fa-comment-dots"></i>
                                </button>
                            </div>
                            <button class="sms-send-btn" onclick="sendSMSMessage()" id="sms-send-button" style="display: none;">
                                <i class="fas fa-arrow-up"></i>
                            </button>
                        </div>
                    </div>
                </div>



                <!-- ğŸ”¥ã€æ–°å¢ã€‘çŸ­ä¿¡å›¾ç‰‡é€‰æ‹©å™¨ -->
                <input type="file" id="sms-image-input" accept="image/*" style="display: none;" onchange="handleSMSImageSelect(event)">

                <!-- ğŸ¨ã€æ–°å¢ã€‘è‡ªå®šä¹‰ä¸»é¢˜å›¾ç‰‡ä¸Šä¼ è¾“å…¥æ¡† -->
                <input type="file" id="chat-top-bg-input" accept="image/*" style="display: none;" onchange="handleChatTopBgUpload(event)">
                <input type="file" id="chat-bottom-bg-input" accept="image/*" style="display: none;" onchange="handleChatBottomBgUpload(event)">
                <input type="file" id="button-icon-input" accept="image/*" style="display: none;" onchange="handleButtonIconUpload(event)">
                <input type="file" id="global-top-app-bar-input" accept="image/*" style="display: none;" onchange="handleGlobalTopAppBarUpload(event)">
                <input type="file" id="global-bottom-app-bar-input" accept="image/*" style="display: none;" onchange="handleGlobalBottomAppBarUpload(event)">
                <input type="file" id="global-back-button-input" accept="image/*" style="display: none;" onchange="handleGlobalBackButtonUpload(event)">
                <input type="file" id="global-add-button-input" accept="image/*" style="display: none;" onchange="handleGlobalAddButtonUpload(event)">
                <input type="file" id="global-bg-input" accept="image/*" style="display: none;" onchange="handleGlobalBgUpload(event)">

                <!-- ğŸ”¥ã€ä¿®å¤ã€‘çŸ­ä¿¡ç®¡ç†é€‰é¡¹æ¨¡æ€æ¡† -->
                <div id="sms-manage-modal" class="sms-manage-modal" style="display: none;" onclick="hideSMSManageOptions(event)">
                    <div class="sms-manage-modal-content" onclick="event.stopPropagation()">
                        <div class="sms-manage-option" onclick="enterSMSListMultiSelectMode()">
                            <i class="fas fa-trash"></i>
                            <span>å¤šé€‰åˆ é™¤</span>
                        </div>
                        <div class="sms-manage-option" onclick="enterSMSPinMode()">
                            <i class="fas fa-thumbtack"></i>
                            <span>ç½®é¡¶å¯¹è¯</span>
                        </div>
                    </div>
                </div>

                <!-- çŸ­ä¿¡èº«ä»½é€‰æ‹©æ¨¡æ€æ¡† -->
                <div id="sms-persona-selector-modal" class="modal-overlay" style="display: none;" onclick="hideSMSPersonaSelector(event)">
                    <div class="modal-content sms-selector-modal" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3>é€‰æ‹©ä½ çš„èº«ä»½</h3>
                            <button class="modal-close-btn" onclick="hideSMSPersonaSelector()">Ã—</button>
                        </div>
                        <div class="modal-body" id="sms-persona-selector-body">
                            <!-- èº«ä»½åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <!-- çŸ­ä¿¡è§’è‰²é€‰æ‹©æ¨¡æ€æ¡† -->
                <div id="sms-character-selector-modal" class="modal-overlay" style="display: none;" onclick="hideSMSCharacterSelector(event)">
                    <div class="modal-content sms-selector-modal" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3>é€‰æ‹©èŠå¤©è§’è‰²</h3>
                            <button class="modal-close-btn" onclick="hideSMSCharacterSelector()">Ã—</button>
                        </div>
                        <div class="modal-body" id="sms-character-selector-body">
                            <!-- è§’è‰²åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <!-- è‡ªå®šä¹‰å•†å“æ·»åŠ æ¨¡æ€æ¡† -->
                <div id="custom-item-modal" class="modal-overlay" style="display: none;" onclick="hideCustomItemModal(event)">
                    <div class="modal-content custom-item-modal" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3>æ·»åŠ è‡ªå®šä¹‰å•†å“</h3>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="custom-item-name">å•†å“åç§°</label>
                                <input type="text" id="custom-item-name" class="form-input" placeholder="è¯·è¾“å…¥å•†å“åç§°" maxlength="50" onkeydown="handleCustomItemKeydown(event)">
                            </div>

                            <div class="form-group">
                                <label for="custom-item-description">å•†å“ä»‹ç» <span style="color: #999; font-size: 12px;">(å¯é€‰)</span></label>
                                <input type="text" id="custom-item-description" class="form-input" placeholder="è¯·è¾“å…¥å•†å“ä»‹ç»" maxlength="100" onkeydown="handleCustomItemKeydown(event)">
                            </div>

                            <div class="form-group">
                                <label for="custom-item-price">å•†å“ä»·æ ¼</label>
                                <div class="price-input-container">
                                    <span class="price-symbol">Â¥</span>
                                    <input type="number" id="custom-item-price" class="form-input price-input" placeholder="0.00" min="0" step="0.01" onkeydown="handleCustomItemKeydown(event)">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="hideCustomItemModal()">å–æ¶ˆ</button>
                            <button class="btn btn-primary" onclick="confirmAddCustomItem()">æ·»åŠ åˆ°è´­ç‰©è½¦</button>
                        </div>
                    </div>
                </div>

                <!-- ä»£ä»˜é€‰æ‹©æ¨¡æ€æ¡† -->
                <div id="payment-request-modal" class="modal-overlay" style="display: none;" onclick="hidePaymentRequestModal(event)">
                    <div class="modal-content payment-request-modal" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3>è¯·Taä»£ä»˜</h3>
                            <button class="modal-close-btn" onclick="hidePaymentRequestModal()">Ã—</button>
                        </div>
                        <div class="modal-body">
                            <div class="payment-summary">
                                <div class="payment-total">
                                    <span class="total-label">æ€»è®¡ï¼š</span>
                                    <span class="total-price" id="payment-modal-total">Â¥0</span>
                                </div>
                                <div class="payment-items-count">
                                    å…± <span id="payment-modal-items-count">0</span> ä»¶å•†å“
                                </div>
                            </div>

                            <div class="payment-options">
                                <h4>ä¸ºè°ä¸‹å•ï¼Ÿ</h4>
                                <div class="payment-option-buttons">
                                    <button class="payment-option-btn" onclick="processOrder('for_self')">
                                        <i class="fas fa-user"></i>
                                        <span>ä¸ºè‡ªå·±ä¸‹å•</span>
                                    </button>
                                    <button class="payment-option-btn" onclick="processOrder('for_ta')">
                                        <i class="fas fa-gift"></i>
                                        <span>ä¸ºTaä¸‹å•</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- çŸ­ä¿¡èŠå¤©è®¾ç½®ç•Œé¢ -->
                <div id="sms-chat-settings-screen" class="app-screen" style="display: none;">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                                <div class="app-battery-container">
                                    <div class="app-battery-icon">
                                        <div class="app-battery-level"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="app-header">
                            <button class="back-button" onclick="hideSMSChatSettings()">â€¹</button>
                            <div class="app-title">èŠå¤©è®¾ç½®</div>
                        </div>
                    </div>
                    <div class="app-content sms-settings-content">
                        <div class="setting-group">
                            <h4><i class="fas fa-history"></i> å†å²æ¶ˆæ¯</h4>
                            <div class="setting-item">
                                <label>é™„å¸¦å†å²æ¶ˆæ¯å›åˆæ•°</label>
                                <div class="slider-container">
                                    <input type="range" id="sms-history-rounds-slider" min="0" max="500" value="50" onchange="updateSMSHistoryRounds()">
                                    <span id="sms-history-rounds-value">50è½®</span>
                                </div>
                            </div>
                        </div>

                        <div class="setting-group">
                            <h4><i class="fas fa-palette"></i> æ°”æ³¡é¢œè‰²</h4>
                            <div class="setting-item">
                                <label>æˆ‘çš„æ¶ˆæ¯æ°”æ³¡é¢œè‰²</label>
                                <div class="bubble-color-selector">
                                    <div class="color-option-text" data-color="blue" onclick="setSMSBubbleColor('blue')">
                                        è“è‰²
                                    </div>
                                    <div class="color-option-text" data-color="green" onclick="setSMSBubbleColor('green')">
                                        ç»¿è‰²
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="setting-group">
                            <h4><i class="fas fa-trash-alt"></i> æ•°æ®ç®¡ç†</h4>
                            <div class="setting-item" onclick="clearSMSChatHistory()">
                                <label style="white-space: nowrap;">æ¸…ç©ºè®°å½•</label>
                                <div class="setting-desc">åˆ é™¤æ‰€æœ‰çŸ­ä¿¡è®°å½•å’Œç›¸å…³è®°å¿†ï¼Œä¸å¯æ¢å¤</div>
                            </div>
                        </div>


                    </div>
                </div>

                <!-- èŠå¤©ç•Œé¢ -->
                <div id="chat-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                                <div class="app-battery-container">
                                    <div class="app-battery-icon">
                                        <div class="app-battery-level"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="app-header">
                            <button class="back-button" onclick="hideApp('chat-screen')">â€¹</button>
                            <div class="app-title">ğŸ’¬</div>
                        <div class="chat-header-actions">
                            <div id="group-manage-btn" class="header-action-btn" onclick="enterGroupManageMode()" title="ç®¡ç†åˆ†ç»„">
                                <i class="fas fa-cog"></i>
                            </div>
                            <div id="add-contact-btn" class="add-btn" onclick="showCharacterForm()">
                                <i class="fas fa-plus"></i>
                            </div>
                            <div id="add-chat-btn" class="add-btn" onclick="showChatOptions()">
                                <i class="fas fa-plus"></i>
                            </div>
                        </div>
                    </div>
                    </div>

                    <div class="app-content" id="chat-content">
                        <!-- é»˜è®¤æ˜¾ç¤ºæ¶ˆæ¯åˆ—è¡¨ -->
                        <div class="message-list" id="message-list">
                            <!-- æ¶ˆæ¯åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>

                        <!-- é€šè®¯å½• -->
                        <div class="contact-list hide" id="contact-list">
                            <div class="contact-section">

                                <!-- è§’è‰²åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            </div>

                        </div>

                        <!-- åŠ¨æ€é¡µé¢ -->
                        <div class="moments-page hide moments-page-no-padding" id="moments-page">
                            <div class="moments-header">
                                <div class="moments-cover" onclick="changeCoverImage()">
                                    <div class="cover-image-placeholder" id="cover-placeholder">
                                        <div class="cover-placeholder-text">ç‚¹å‡»æ›´æ¢å°é¢</div>
                                        </div>
                                    <img class="cover-image hide" id="cover-image" src="">
                                    </div>

                                <!-- ç”¨æˆ·åï¼Œç‹¬ç«‹æ”¾ç½®åœ¨å¤´åƒå·¦ä¸Šè§’ -->
                                <div class="moments-username" onclick="changeUsername(event)" id="moments-username">ç”¨æˆ·</div>

                                <!-- ç‹¬ç«‹çš„å¤´åƒï¼Œè·¨è¶ŠèƒŒæ™¯å’ŒåŠ¨æ€åˆ—è¡¨åŒºåŸŸï¼Œæ”¾åœ¨headerå¤–é¢ -->
                                <div class="moments-avatar" onclick="changeAvatarImage(event)" id="moments-avatar">
                                    <i class="fas fa-user moments-avatar-icon"></i>
                                </div>
                            </div>

                            <div class="moments-list" id="moments-list">
                                <!-- åŠ¨æ€åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            </div>


                        </div>


                        <!-- é¢å…·åŒºåŸŸ -->
                        <div class="profile-page hide" id="profile-page">
                            <div class="persona-section">
                                <div class="persona-header" onclick="togglePersonaSection()">
                                    <div class="persona-title">
                                        <h2>æˆ‘çš„é¢å…·</h2>
                                        <p>ç®¡ç†ä½ çš„å¤šé‡èº«ä»½è®¾å®š</p>
                                    </div>
                                    <div class="persona-header-actions">
                                        <button class="add-persona-btn-header" onclick="event.stopPropagation(); showPersonaForm()" title="æ·»åŠ é¢å…·">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                        <div class="persona-toggle" onclick="event.stopPropagation(); togglePersonaSection()">
                                            <i class="fas fa-chevron-down expanded" id="persona-chevron"></i>
                                        </div>
                                    </div>
                                </div>

                                <div class="persona-content" id="persona-content">
                                    <div class="persona-list" id="persona-list">
                                        <!-- é¢å…·åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                    </div>
                                </div>
                            </div>

                            <!-- è¡¨æƒ…åŒ…åº“åŒºåŸŸ -->
                            <div class="emoji-library-section">
                                <div class="emoji-library-header" onclick="toggleEmojiLibrarySection()">
                                    <div class="emoji-library-title">
                                        <h3>è§’è‰²è¡¨æƒ…åŒ…åº“</h3>
                                        <p>ç®¡ç†è§’è‰²çš„è¡¨æƒ…åŒ…åˆ†ç±»</p>
                                    </div>
                                    <div class="emoji-library-header-actions">
                                        <button class="create-library-btn-header" onclick="event.stopPropagation(); showImportEmojiLibraryDialog()" title="å¯¼å…¥è¡¨æƒ…åŒ…åº“">
                                            <i class="fas fa-upload"></i>
                                        </button>
                                        <button class="create-library-btn-header" onclick="event.stopPropagation(); showCreateLibraryForm()" title="æ–°å»ºè¡¨æƒ…åŒ…åº“">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                        <div class="emoji-library-toggle" onclick="event.stopPropagation(); toggleEmojiLibrarySection()">
                                            <i class="fas fa-chevron-down" id="emoji-library-chevron"></i>
                                        </div>
                                    </div>
                                </div>

                                <div class="emoji-library-content" id="emoji-library-content" style="display: none;">
                                    <div class="emoji-library-list" id="emoji-library-list">
                                        <!-- è¡¨æƒ…åŒ…åº“åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                    </div>
                                </div>
                            </div>

                            <!-- ğŸ”¥ã€æ–°å¢ã€‘æˆ‘çš„ä¹¦æ¶åŒºåŸŸ -->
                            <div class="bookshelf-section">
                                <div class="bookshelf-header" onclick="openMyBookshelf()">
                                    <div class="bookshelf-title">
                                        <h3>æˆ‘çš„ä¹¦æ¶</h3>
                                        <p>ç®¡ç†å’Œé˜…è¯»ä½ çš„ç”µå­ä¹¦</p>
                                    </div>
                                    <div class="bookshelf-header-actions">
                                        <div class="bookshelf-toggle">
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ğŸ”¥ã€æ–°å¢ã€‘æˆ‘çš„æ”¶è—åŒºåŸŸ -->
                            <div class="favorites-section">
                                <div class="favorites-header" onclick="openMyFavorites()">
                                    <div class="favorites-title">
                                        <h3>æˆ‘çš„æ”¶è—</h3>
                                        <p>æŸ¥çœ‹æ”¶è—çš„ç²¾å½©æ¶ˆæ¯</p>
                                    </div>
                                    <div class="favorites-header-actions">
                                        <div class="favorites-toggle">
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ğŸ”¥ã€æ–°å¢ã€‘æˆ‘çš„é’±åŒ…åŒºåŸŸ -->
                            <div class="wallet-section">
                                <div class="wallet-header" onclick="openMyWallet()">
                                    <div class="wallet-title">
                                        <h3>æˆ‘çš„é’±åŒ…</h3>
                                        <p>ç®¡ç†ä½ çš„è™šæ‹Ÿèµ„äº§</p>
                                    </div>
                                    <div class="wallet-header-actions">
                                        <div class="wallet-toggle">
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>

                             <!-- ğŸ”¥ã€æ–°å¢ã€‘Taçš„é™ªä¼´åŒºåŸŸ -->
                            <div class="companion-stats-section">
                                <div class="companion-stats-header" onclick="openCompanionStats()">
                                    <div class="companion-stats-title">
                                        <h3>Taçš„é™ªä¼´</h3>
                                        <p>æŸ¥çœ‹é™ªä¼´æ•°æ®ç»Ÿè®¡</p>
                                    </div>
                                    <div class="companion-stats-header-actions">
                                        <div class="companion-stats-toggle">
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="chat-tabs">
                        <div class="chat-tab active" onclick="switchChatTab('message-list')" id="message-tab">
                            <i class="fas fa-comments"></i>
                            <span>æ¶ˆæ¯</span>
                        </div>
                        <div class="chat-tab" onclick="switchChatTab('contact-list')">
                            <i class="fas fa-user-friends"></i>
                            <span>è§’è‰²</span>
                        </div>
                        <div class="chat-tab" onclick="switchChatTab('moments-page')">
                            <i class="fas fa-globe-americas"></i>
                            <span>åŠ¨æ€</span>
                        </div>
                        <div class="chat-tab" onclick="switchChatTab('profile-page')">
                            <i class="fas fa-user-circle"></i>
                            <span>æˆ‘</span>
                        </div>
                    </div>
                </div>

                <!-- å‘å¸ƒåŠ¨æ€ç•Œé¢ -->
                <div id="publish-moment-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="hidePublishMoment()">â€¹</button>
                        <div class="app-title">å‘è¡¨åŠ¨æ€</div>
                        <button class="publish-btn" onclick="publishMoment()">å‘è¡¨</button>
                    </div>
                    <div class="app-content">
                        <div class="publish-moment-form">
                            <!-- æ–‡å­—è¾“å…¥åŒºåŸŸ -->
                            <div class="moment-text-input">
                                <textarea
                                    id="moment-text"
                                    placeholder="æ­¤åˆ»æƒ³æ³•..."
                                    class="moment-textarea"
                                    maxlength="500"
                                    oninput="updateTextCount()"></textarea>
                                <div class="text-count" id="text-count">0/500</div>
                            </div>

                            <!-- å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
                            <div class="moment-images-section">
                                <div class="moment-images-grid" id="moment-images-grid">
                                    <!-- åŠ¨æ€æ·»åŠ çš„å›¾ç‰‡é¢„è§ˆ -->
                                </div>
                                <div class="add-image-btn" onclick="addMomentImage()">
                                    <i class="fas fa-plus"></i>
                                    <span>æ·»åŠ å›¾ç‰‡</span>
                                </div>
                            </div>

                            <!-- å‘å¸ƒé€‰é¡¹ -->
                            <div class="publish-options">
                                <div class="option-item" onclick="showLocationModal()">
                                    <i class="fas fa-map-marker-alt location-icon"></i>
                                    <span>æ‰€åœ¨ä½ç½®</span>
                                    <span class="option-value" id="selected-location"></span>
                                    <i class="fas fa-chevron-right"></i>
                                </div>
                                <div class="option-item" onclick="showMomentMentionModal()">
                                    <i class="fas fa-at mention-icon"></i>
                                    <span>æé†’è°çœ‹</span>
                                    <div class="selected-mentions" id="selected-mentions">
                                        <!-- å·²é€‰æ‹©çš„è§’è‰²å¤´åƒå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                                    </div>
                                    <i class="fas fa-chevron-right"></i>
                                </div>
                                <div class="option-item" onclick="showVisibilityModal()">
                                    <i class="fas fa-eye visibility-icon"></i>
                                    <span>è°å¯ä»¥çœ‹</span>
                                    <span class="option-value" id="selected-visibility">å…¬å¼€</span>
                                    <i class="fas fa-chevron-right"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ä½ç½®é€‰æ‹©æ¨¡æ€æ¡† -->
                <div id="location-modal" class="modal-overlay" style="display: none;" onclick="hideLocationModal(event)">
                    <div class="modal-content location-modal-content" onclick="event.stopPropagation()">
                        <div class="location-modal-header">
                            <button class="location-cancel-btn" onclick="hideLocationModal()">å–æ¶ˆ</button>
                            <h3 class="location-modal-title">æ‰€åœ¨ä½ç½®</h3>
                            <button class="location-confirm-btn" onclick="confirmLocation()">å®Œæˆ</button>
                        </div>
                        <div class="location-modal-body">
                            <div class="location-search-section">
                                <div class="location-search-box">
                                    <i class="fas fa-search location-search-icon"></i>
                                    <input type="text" id="location-input" class="location-search-input" placeholder="æœç´¢é™„è¿‘ä½ç½®" maxlength="50">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æé†’è°çœ‹æ¨¡æ€æ¡† -->
                <div id="mention-modal" class="modal-overlay" style="display: none;" onclick="hideMomentMentionModal(event)">
                    <div class="modal-content mention-modal-content" onclick="event.stopPropagation()">
                        <div class="mention-modal-header">
                            <button class="mention-cancel-btn" onclick="hideMomentMentionModal()">å–æ¶ˆ</button>
                            <h3 class="mention-modal-title">æé†’è°çœ‹</h3>
                            <button class="mention-confirm-btn" onclick="confirmMomentMention()">å®Œæˆ</button>
                        </div>
                        <div class="mention-modal-body">
                            <div class="mention-characters-list" id="mention-characters-list">
                                <!-- è§’è‰²åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è°å¯ä»¥çœ‹æ¨¡æ€æ¡† -->
                <div id="visibility-modal" class="modal-overlay" style="display: none;" onclick="hideVisibilityModal(event)">
                    <div class="modal-content visibility-modal-content" onclick="event.stopPropagation()">
                        <div class="visibility-modal-header">
                            <button class="visibility-cancel-btn" onclick="hideVisibilityModal()">å–æ¶ˆ</button>
                            <h3 class="visibility-modal-title">è°å¯ä»¥çœ‹</h3>
                            <button class="visibility-confirm-btn" onclick="confirmVisibility()">å®Œæˆ</button>
                        </div>
                        <div class="visibility-modal-body">
                            <div class="visibility-options" id="visibility-options">
                                <div class="visibility-option" data-value="public">
                                    <div class="visibility-option-icon">
                                        <i class="fas fa-globe"></i>
                                    </div>
                                    <div class="visibility-option-content">
                                        <div class="visibility-option-title">å…¬å¼€</div>
                                        <div class="visibility-option-desc">æ‰€æœ‰äººéƒ½å¯ä»¥çœ‹åˆ°</div>
                                    </div>
                                    <div class="visibility-option-radio">
                                        <i class="fas fa-check"></i>
                                    </div>
                                </div>
                                <div class="visibility-option" data-value="private">
                                    <div class="visibility-option-icon">
                                        <i class="fas fa-lock"></i>
                                    </div>
                                    <div class="visibility-option-content">
                                        <div class="visibility-option-title">ç§å¯†</div>
                                        <div class="visibility-option-desc">åªæœ‰è‡ªå·±å¯ä»¥çœ‹åˆ°</div>
                                    </div>
                                    <div class="visibility-option-radio">
                                        <i class="fas fa-check"></i>
                                    </div>
                                </div>
                                <div class="visibility-option" data-value="partial">
                                    <div class="visibility-option-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="visibility-option-content">
                                        <div class="visibility-option-title">éƒ¨åˆ†å¯è§</div>
                                        <div class="visibility-option-desc">é€‰æ‹©ç‰¹å®šåˆ†ç»„å¯è§</div>
                                    </div>
                                    <div class="visibility-option-radio">
                                        <i class="fas fa-check"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="visibility-groups-section" id="visibility-groups-section" style="display: none;">
                                <div class="visibility-groups-title">é€‰æ‹©å¯è§åˆ†ç»„</div>
                                <div class="visibility-groups-list" id="visibility-groups-list">
                                    <!-- åˆ†ç»„åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è®ºå›ç•Œé¢ -->
                <div id="forum-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                                <div class="app-battery-container">
                                    <div class="app-battery-icon"><div class="app-battery-level"></div></div>
                                </div>
                            </div>
                        </div>
                        <div class="app-header">
                            <button class="back-button" onclick="hideApp('forum-screen')">â€¹</button>
                            <div class="app-title">è®ºå›</div>
                        <div class="add-forum-btn" onclick="showCreateForumScreen()">
                            <i class="fas fa-plus"></i>
                        </div>
                    </div>
                    </div>
                    <div class="app-content">
                        <div id="forum-archive-list" class="forum-archive-list">
                            <div class="forum-empty-state">
                                <i class="fas fa-comments"></i>
                                <p>è¿˜æ²¡æœ‰åˆ›å»ºä»»ä½•è®ºå›</p>
                                <p>ç‚¹å‡»å³ä¸Šè§’ + åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªè®ºå›</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- åˆ›å»ºè®ºå›ç•Œé¢ -->
                <div id="create-forum-screen" class="app-screen">
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('create-forum-screen'); renderForumArchives(); showApp('forum-screen');">â€¹</button>
                        <div class="app-title" id="forum-form-title">åˆ›å»ºæ–°è®ºå›</div>
                    </div>
                    <div class="app-content">
                        <input type="hidden" id="forum-form-id">
                        <div class="form-group">
                            <label class="form-label">è®ºå›åç§°</label>
                            <input type="text" id="forum-name-input" class="form-input" placeholder="ç»™è¿™ä¸ªä¸–ç•Œçº¿èµ·ä¸ªåå­—å§">
                        </div>
                        <div class="form-group">
                            <label class="form-label">é€‰æ‹©è§’è‰² (å¯å¤šé€‰)</label>
                            <div id="forum-character-selection" class="selection-grid"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">é€‰æ‹©ä½ çš„èº«ä»½</label>
                            <div id="forum-persona-selection" class="selection-grid single-selection"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">è¡¥å……ä¸–ç•Œè§‚ (å¡«å†™åè®ºå›å°†æŒ‰æ­¤å¤„å†…å®¹ç”Ÿæˆå¸–å­ä¸è¯„è®º)</label>
                            <textarea id="forum-worldview-input" class="form-textarea" rows="4" placeholder="è¡¥å……ä¸€äº›èƒŒæ™¯æ•…äº‹æˆ–è®¾å®š..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">æŒ‚è½½å±€éƒ¨ä¸–ç•Œä¹¦ (å¯å¤šé€‰)</label>
                            <div id="forum-worldbook-selection" class="selection-grid"></div>
                        </div>
                        <button class="form-submit" id="forum-form-submit-btn" onclick="handleForumFormSubmit()">è¿›å…¥è®ºå›</button>
                    </div>
                </div>

                <!-- å¸–å­åˆ—è¡¨ç•Œé¢ -->
                <div id="forum-view-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                                <div class="app-battery-container">
                                    <div class="app-battery-icon"><div class="app-battery-level"></div></div>
                                </div>
                            </div>
                        </div>
                        <div class="app-header">
                            <button class="back-button" onclick="backToForumArchives()">â€¹</button>
                            <div class="app-title" id="forum-view-title">è®ºå›</div>
                        <div class="header-actions">
                            <span class="action-btn" onclick="toggleForumPostsMultiSelectMode()" title="å¤šé€‰åˆ é™¤å¸–å­" id="forum-multi-select-btn">
                                <i class="fas fa-trash"></i>
                            </span>
                            <span class="action-btn" onclick="showForumProfile()" title="ä¸ªäººä¸»é¡µ">
                                <i class="fas fa-user"></i>
                            </span>
                            <!-- å¤šé€‰æ¨¡å¼æŒ‰é’® -->
                            <div class="forum-multiselect-actions" id="forum-multiselect-actions" style="display: none;">
                                <button class="multiselect-btn cancel-btn" onclick="toggleForumPostsMultiSelectMode()">å–æ¶ˆ</button>
                                <button class="multiselect-btn delete-btn" onclick="confirmDeleteSelectedForumPosts()">åˆ é™¤</button>
                            </div>
                        </div>
                    </div>
                    </div>
                    <div class="app-content">
                        <div id="forum-posts-list" class="post-list">
                        </div>
                    </div>

                    <!-- æ‚¬æµ®æŒ‰é’®ç»„ -->
                    <div class="floating-action-buttons">
                        <div class="floating-btn refresh-btn" onclick="refreshPosts()" title="åˆ·æ–°å¸–å­">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <div class="floating-btn post-btn" onclick="showPostTypeModal()" title="å‘å¸–">
                            <i class="fas fa-plus"></i>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘å‘å¸–ç±»å‹é€‰æ‹©æ¨¡æ€æ¡† -->
                <div id="post-type-modal" class="modal-overlay" style="display: none;" onclick="hidePostTypeModal(event)">
                    <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 320px;">
                        <div class="modal-header">
                            <h3>é€‰æ‹©å‘å¸–ç±»å‹</h3>
                            <button class="modal-close-btn" onclick="hidePostTypeModal()">Ã—</button>
                        </div>
                        <div class="modal-body" style="padding: 20px;">
                            <div class="post-type-options">
                                <div class="post-type-option" onclick="selectPostType('normal')">
                                    <div class="option-icon">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                    <div class="option-content">
                                        <h4>æ™®é€šå‘å¸–</h4>
                                        <p>å‘å¸ƒæ—¥å¸¸è®¨è®ºã€åˆ†äº«å†…å®¹</p>
                                    </div>
                                </div>
                                <div class="post-type-option" onclick="selectPostType('news')">
                                    <div class="option-icon">
                                        <i class="fas fa-newspaper"></i>
                                    </div>
                                    <div class="option-content">
                                        <h4>æä¸ªå¤§æ–°é—»</h4>
                                        <p>åˆ›å»ºä¸–ç•Œäº‹ä»¶ï¼ŒAIç”Ÿæˆç›¸å…³å¸–å­</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç”¨æˆ·å‘å¸–æ¨¡æ€æ¡† -->
                <div id="create-post-modal" class="modal-overlay" style="display: none;" onclick="hideCreatePostModal(event)">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3>å‘å¸ƒæ–°å¸–</h3>
                            <button class="modal-close-btn" onclick="hideCreatePostModal()">Ã—</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>æ ‡é¢˜</label>
                                <input type="text" id="post-title-input" placeholder="è¯·è¾“å…¥å¸–å­æ ‡é¢˜..." maxlength="100">
                            </div>
                            <div class="form-group">
                                <label>å†…å®¹</label>
                                <textarea id="post-content-input" placeholder="åˆ†äº«ä½ çš„æƒ³æ³•..." rows="6" maxlength="7000"></textarea>
                            </div>
                            <div class="form-group">
                                <label>å›¾ç‰‡ (å¯é€‰)</label>
                                <div id="post-image-preview-container" style="display:none; margin-bottom: 10px; position: relative;">
                                    <img id="post-image-preview" src="" alt="å›¾ç‰‡é¢„è§ˆ" style="max-width: 100%; max-height: 150px; border-radius: 8px;">
                                    <button id="post-remove-image-btn" style="position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.5); color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer;">Ã—</button>
                                </div>
                                <button class="form-upload-btn" id="post-upload-image-btn">
                                    <i class="fas fa-image"></i> é€‰æ‹©å›¾ç‰‡
                                </button>
                                <input type="file" id="post-image-upload" accept="image/*" style="display: none;">
                            </div>
                            <div class="char-count">
                                <span id="title-count">0/100</span> | <span id="content-count">0/7000</span>
                            </div>
                            <div class="form-group" style="margin-top: 15px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="checkbox" id="anonymous-post-checkbox" style="margin-right: 8px;">
                                    åŒ¿åå‘å¸–ï¼ˆå…¶ä»–ç”¨æˆ·æ— æ³•è¯†åˆ«ä½ çš„èº«ä»½ï¼‰
                                </label>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn-secondary" onclick="hideCreatePostModal()">å–æ¶ˆ</button>
                            <button class="btn-primary" onclick="submitUserPost()">å‘å¸ƒ</button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘è§†é¢‘é€šè¯å½¢è±¡è®¾ç½®æ¨¡æ€æ¡† -->
                <div id="video-avatar-modal" class="modal-overlay" style="display: none;" onclick="hideVideoAvatarModal(event)">
                    <div class="modal-content video-avatar-modal-content" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3>é€šè¯å½¢è±¡è®¾ç½®</h3>
                            <button class="modal-close-btn" onclick="hideVideoAvatarModal()">Ã—</button>
                        </div>
                        <div class="modal-body">
                            <div class="video-avatar-preview">
                                <div class="avatar-preview-container">
                                    <div class="avatar-preview-item">
                                        <div class="avatar-preview-label">è§’è‰²é€šè¯å½¢è±¡</div>
                                        <div class="avatar-preview-image-container">
                                            <img id="character-video-avatar-preview" src="" alt="è§’è‰²é€šè¯å½¢è±¡" class="avatar-preview-image">
                                            <div class="avatar-preview-placeholder" id="character-avatar-placeholder">
                                                <i class="fas fa-user"></i>
                                                <span>ç‚¹å‡»è®¾ç½®</span>
                                            </div>
                                        </div>
                                        <button class="avatar-change-btn" onclick="changeCharacterVideoAvatar()">
                                            <i class="fas fa-camera"></i>
                                            æ›´æ¢å½¢è±¡
                                        </button>
                                    </div>

                                    <div class="avatar-preview-item">
                                        <div class="avatar-preview-label">ç”¨æˆ·é€šè¯å½¢è±¡</div>
                                        <div class="avatar-preview-image-container">
                                            <img id="user-video-avatar-preview" src="" alt="ç”¨æˆ·é€šè¯å½¢è±¡" class="avatar-preview-image">
                                            <div class="avatar-preview-placeholder" id="user-avatar-placeholder">
                                                <i class="fas fa-user"></i>
                                                <span>ç‚¹å‡»è®¾ç½®</span>
                                            </div>
                                        </div>
                                        <button class="avatar-change-btn" onclick="changeUserVideoAvatar()">
                                            <i class="fas fa-camera"></i>
                                            æ›´æ¢å½¢è±¡
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="video-avatar-tips">
                                <div class="tips-title">
                                    <i class="fas fa-lightbulb"></i>
                                    è®¾ç½®è¯´æ˜
                                </div>
                                <div class="tips-content">
                                    â€¢ è§’è‰²é€šè¯å½¢è±¡ï¼šè§†é¢‘é€šè¯æ—¶è§’è‰²æ˜¾ç¤ºçš„å½¢è±¡<br>
                                    â€¢ ç”¨æˆ·é€šè¯å½¢è±¡ï¼šè§†é¢‘é€šè¯æ—¶ä½ æ˜¾ç¤ºçš„å½¢è±¡<br>
                                    â€¢ å¦‚ä¸è®¾ç½®å°†ä½¿ç”¨é»˜è®¤å¤´åƒ
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn-secondary" onclick="hideVideoAvatarModal()">å–æ¶ˆ</button>
                            <button class="btn-primary" onclick="saveVideoAvatarSettings()">ä¿å­˜è®¾ç½®</button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘å¯¼å‡ºé€‰é¡¹æ¨¡æ€æ¡† -->
                <div id="export-options-modal" class="modal-overlay" style="display: none;" onclick="hideExportOptions(event)">
                    <div class="modal-content export-options-modal" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3>å¯¼å‡ºèŠå¤©è®°å½•</h3>
                            <button class="modal-close-btn" onclick="hideExportOptions()">Ã—</button>
                        </div>
                        <div class="modal-body">
                            <div class="export-format-section">
                                <h4>é€‰æ‹©å¯¼å‡ºæ ¼å¼</h4>
                                <div class="export-format-options">
                                    <div class="export-format-option" onclick="selectExportFormat('html')">
                                        <div class="format-icon">
                                            <i class="fas fa-file-code"></i>
                                        </div>
                                        <div class="format-info">
                                            <div class="format-title">HTMLæ ¼å¼</div>
                                            <div class="format-desc">é€‚åˆé˜…è¯»å’Œåˆ†äº«çš„ç½‘é¡µæ ¼å¼</div>
                                        </div>
                                        <div class="format-radio">
                                            <input type="radio" name="exportFormat" value="html" id="format-html" checked>
                                            <label for="format-html"></label>
                                        </div>
                                    </div>
                                    <div class="export-format-option" onclick="selectExportFormat('json')">
                                        <div class="format-icon">
                                            <i class="fas fa-database"></i>
                                        </div>
                                        <div class="format-info">
                                            <div class="format-title">JSONæ ¼å¼</div>
                                            <div class="format-desc">å®Œæ•´æ•°æ®å¤‡ä»½ï¼ŒåŒ…å«èŠå¤©è®°å½•å’Œè®°å¿†ç³»ç»Ÿ</div>
                                        </div>
                                        <div class="format-radio">
                                            <input type="radio" name="exportFormat" value="json" id="format-json">
                                            <label for="format-json"></label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideExportOptions()">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="executeExport()">å¯¼å‡º</button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘å¯¼å…¥é€‰é¡¹æ¨¡æ€æ¡† -->
                <div id="import-options-modal" class="modal-overlay" style="display: none;" onclick="hideImportOptions(event)">
                    <div class="modal-content import-options-modal" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3>å¯¼å…¥èŠå¤©è®°å½•</h3>
                            <button class="modal-close-btn" onclick="hideImportOptions()">Ã—</button>
                        </div>
                        <div class="modal-body">
                            <div class="import-warning">
                                <div class="warning-icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="warning-text">
                                    <strong>æ³¨æ„ï¼š</strong>å¯¼å…¥æ“ä½œå°†å®Œå…¨è¦†ç›–å½“å‰è§’è‰²çš„æ‰€æœ‰æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š
                                    <ul>
                                        <li>èŠå¤©è®°å½•</li>
                                        <li>çŸ­ä¿¡è®°å½•</li>
                                        <li>è®°å¿†ç³»ç»Ÿ</li>
                                    </ul>
                                    æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼Œè¯·ç¡®ä¿å·²å¤‡ä»½é‡è¦æ•°æ®ï¼
                                </div>
                            </div>
                            <div class="import-file-section">
                                <input type="file" id="import-file-input" accept="*/*" style="display: none;" onchange="handleImportFileSelect(event)">
                                <button class="import-file-btn" onclick="document.getElementById('import-file-input').click()">
                                    <i class="fas fa-upload"></i>
                                    é€‰æ‹©JSONæ–‡ä»¶
                                </button>
                                <div class="import-file-info" id="import-file-info" style="display: none;">
                                    <div class="file-name" id="import-file-name"></div>
                                    <div class="file-preview" id="import-file-preview"></div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideImportOptions()">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary modal-danger" onclick="executeImport()" id="import-execute-btn" disabled>å¯¼å…¥å¹¶è¦†ç›–</button>
                        </div>
                    </div>
                </div>

                <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
                <input type="file" id="character-video-avatar-input" accept="image/*" style="display: none;" onchange="handleCharacterVideoAvatarChange(event)">
                <input type="file" id="user-video-avatar-input" accept="image/*" style="display: none;" onchange="handleUserVideoAvatarChange(event)">

                <!-- å¸–å­è¯¦æƒ…å’Œå›å¤ç•Œé¢ -->
                <div id="post-view-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                                <div class="app-battery-container">
                                    <div class="app-battery-icon"><div class="app-battery-level"></div></div>
                                </div>
                            </div>
                        </div>
                        <div class="app-header">
                            <button class="back-button" onclick="backToForum()">â€¹ </button>
                            <div class="app-title">å¸–å­è¯¦æƒ…</div>
                        <div class="header-actions">
                            <span id="favorite-btn" class="action-btn" onclick="toggleFavoritePost()" title="æ”¶è—">
                                <i class="far fa-star"></i>
                            </span>
                            <span id="share-btn" class="action-btn" onclick="showSharePostModal()" title="åˆ†äº«">
                                <i class="fas fa-share-square"></i>
                            </span>
                        </div>
                    </div>
                    </div>
                    <div class="app-content" id="post-view-content">
                    </div>
                    <div class="reply-input-area">
                        <button id="anonymous-toggle" class="anonymous-toggle-btn" onclick="toggleAnonymousMode()" title="åŒ¿åå›å¤">
                            <i class="fas fa-user-secret"></i>
                        </button>
                        <input type="text" id="reply-input" placeholder="è¾“å…¥ä½ çš„å›å¤...">
                        <button onclick="sendReply()">å‘é€</button>
                    </div>
                </div>

                <!-- è®ºå›ä¸ªäººä¸»é¡µ/æ”¶è—å¤¹ -->
                <div id="forum-profile-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                                <div class="app-battery-container">
                                    <div class="app-battery-icon"><div class="app-battery-level"></div></div>
                                </div>
                            </div>
                        </div>
                        <div class="app-header">
                            <button class="back-button" onclick="backToCurrentForum()">â€¹</button>
                            <div class="app-title">ä¸ªäººä¸»é¡µ</div>
                        <div class="header-actions">
                            <span class="action-btn multi-select-toggle-btn" onclick="toggleMultiSelectMode()" title="å¤šé€‰åˆ é™¤" id="multi-select-btn">
                                <i class="fas fa-trash"></i>
                            </span>
                            <span class="action-btn" onclick="showVoteHistory()" title="æŠ•ç¥¨å†å²">
                                <i class="fas fa-vote-yea"></i>
                            </span>
                        </div>
                    </div>
                    </div>
                    <div class="app-content" style="padding: 0;">
                        <div class="profile-tabs">
                            <div class="profile-tab active" onclick="switchProfileTab('my-posts')">æˆ‘çš„å¸–å­</div>
                            <div class="profile-tab" onclick="switchProfileTab('my-favorites')">æˆ‘çš„æ”¶è—</div>
                        </div>

                        <div id="my-posts-list" class="post-list profile-post-list">
                        </div>
                        <div id="favorite-posts-list" class="post-list profile-post-list" style="display: none;">
                        </div>
                    </div>
                </div>

                <!-- ğŸ®ã€æ–°å¢ã€‘äº”å­æ£‹æ¸¸æˆç•Œé¢ -->
                <div id="gomoku-game-screen" class="app-screen" style="display: none;">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon"><div class="app-battery-level"></div></div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="exitGomokuGame()">â€¹</button>
                        <div class="app-title">äº”å­æ£‹</div>
                        <!-- ğŸ®ã€åˆ é™¤ã€‘æœºå™¨äººæ ‡å¿—å·²ç§»é™¤ -->
                    </div>

                    <!-- ğŸ®ã€æ–°å¢ã€‘æ¸¸æˆå†…å®¹å®¹å™¨ -->
                    <div class="app-content">
                        <!-- æ¸¸æˆåŒºåŸŸ (70%) -->
                        <div class="gomoku-game-area">
                        <div class="gomoku-board-container">
                            <div class="gomoku-board" id="gomoku-board">
                                <!-- æ£‹ç›˜å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>

                        <!-- ğŸ®ã€ä¿®æ”¹ã€‘æ‹†å¼€çš„ç©å®¶ä¿¡æ¯ - AIåœ¨å·¦ä¸‹è§’ -->
                        <div class="gomoku-player-left">
                            <div class="player-avatar" id="ai-player-avatar">
                                <i class="fas fa-robot"></i>
                                <span class="piece-indicator ai-piece"></span>
                            </div>
                            <div class="player-name" id="ai-player-name" style="display: none;">AI</div>
                        </div>

                        <!-- ğŸ®ã€ä¿®æ”¹ã€‘æ‹†å¼€çš„ç©å®¶ä¿¡æ¯ - ç”¨æˆ·åœ¨å³ä¸‹è§’ -->
                        <div class="gomoku-player-right">
                            <div class="player-avatar" id="user-player-avatar">
                                <i class="fas fa-user"></i>
                                <span class="piece-indicator user-piece"></span>
                            </div>
                            <div class="player-name" style="display: none;">ä½ </div>
                        </div>
                    </div>

                    <!-- èŠå¤©åŒºåŸŸ (30%) -->
                    <div class="gomoku-chat-area">
                        <div class="gomoku-chat-header">
                            <div class="chat-header-left">
                                <button class="next-game-main-btn" onclick="startNextGomokuGame()" title="å¼€å§‹ä¸‹ä¸€å±€">
                                    <i class="fas fa-play"></i>
                                    <span>ä¸‹ä¸€å±€</span>
                                </button>
                            </div>
                            <div class="chat-header-center">
                                <!-- AIå¤´åƒåœ¨è®¡æ—¶å™¨å·¦ä¾§ -->
                                <div class="player-avatar" id="ai-player-avatar-header">
                                    <i class="fas fa-robot"></i>
                                    <span class="piece-indicator ai-piece"></span>
                                </div>
                                <div class="game-status" id="gomoku-status">
                                    <div class="current-turn" id="current-turn">ä½ çš„å›åˆ</div>
                                    <div class="game-timer" id="game-timer">00:00</div>
                                </div>
                                <!-- ç”¨æˆ·å¤´åƒåœ¨è®¡æ—¶å™¨å³ä¾§ -->
                                <div class="player-avatar" id="user-player-avatar-header">
                                    <i class="fas fa-user"></i>
                                    <span class="piece-indicator user-piece"></span>
                                </div>
                            </div>
                            <div class="chat-header-right">
                                <div class="chat-actions">
                                    <button class="chat-action-btn undo-btn" onclick="undoGomokuMove()" title="æ‚”æ£‹">
                                        <i class="fas fa-undo"></i>
                                    </button>
                                    <button class="chat-action-btn surrender-btn" onclick="surrenderGomokuGame()" title="è®¤è¾“">
                                        <i class="fas fa-flag"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="gomoku-chat-messages" id="gomoku-chat-messages">
                            <!-- æ¸¸æˆèŠå¤©æ¶ˆæ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                        <div class="gomoku-chat-input">
                            <input type="text" id="gomoku-chat-input" placeholder="åœ¨æ¸¸æˆä¸­èŠå¤©..." maxlength="200">
                            <button onclick="sendGameChatMessage()" id="send-game-chat-btn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                    <!-- ğŸ®ã€ç»“æŸã€‘æ¸¸æˆå†…å®¹å®¹å™¨ -->
                    </div>
                </div>

                <!-- ğŸ®ã€æ–°å¢ã€‘æµ·é¾Ÿæ±¤æ¸¸æˆç•Œé¢ -->
                <div id="turtle-soup-game-screen" class="app-screen turtle-soup-game-container" style="display: none;">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon"><div class="app-battery-level"></div></div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="exitTurtleSoupGame()">â€¹</button>
                        <div class="app-title">æµ·é¾Ÿæ±¤</div>
                        <button class="game-settings-button" onclick="showTurtleSoupSettings()">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>

                    <!-- æ¸¸æˆåŒºåŸŸ (60%) -->
                    <div class="turtle-soup-game-area">
                        <!-- DMåŒºåŸŸ -->
                        <div class="turtle-soup-dm-section">
                            <div class="turtle-soup-dm-header">
                                <div class="turtle-soup-dm-avatar">
                                    <i class="fas fa-gamepad"></i>
                                </div>
                                <div>
                                    <div class="turtle-soup-dm-name">æ¸¸æˆä¸»æŒäºº</div>
                                    <div class="turtle-soup-dm-role">(DM)</div>
                                </div>
                            </div>
                            <div class="turtle-soup-dm-message" id="turtle-soup-dm-message">
                                æ¬¢è¿æ¥åˆ°æµ·é¾Ÿæ±¤æ¨ç†æ¸¸æˆï¼æˆ‘å°†ä¸ºå¤§å®¶ä¸»æŒè¿™åœºæ¨ç†ä¹‹æ—…...
                            </div>
                        </div>

                        <!-- æ±¤é¢å±•ç¤ºåŒºåŸŸ -->
                        <div class="turtle-soup-story-section">
                            <div class="turtle-soup-story-title">ğŸ¢ æ±¤é¢</div>
                            <div class="turtle-soup-story-content" id="turtle-soup-story-content">
                                è¯·ç¨ç­‰ï¼Œæˆ‘æ­£åœ¨ä¸ºä½ å‡†å¤‡ä¸€ä¸ªæœ‰è¶£çš„æ¨ç†æ•…äº‹...
                            </div>
                            <div class="turtle-soup-game-status">
                                <div class="turtle-soup-question-count" id="turtle-soup-question-count">
                                    æé—®æ¬¡æ•°: 0
                                </div>
                                <div class="turtle-soup-game-timer" id="turtle-soup-game-timer">
                                    00:00
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- èŠå¤©åŒºåŸŸ (40%) -->
                    <div class="turtle-soup-chat-area">
                        <div class="turtle-soup-chat-header">
                            <span class="turtle-soup-chat-title">æ¨ç†è®¨è®º</span>
                            <!-- ğŸ”¥ã€æ–°å¢ã€‘å‘è¨€ç»“æŸæŒ‰é’® -->
                            <button class="finish-speaking-btn" onclick="finishSpeakingAndTriggerDM()" title="å‘è¨€ç»“æŸï¼Œè®©DMå›åº”">
                                <i class="fas fa-check-circle"></i>
                                <span>å‘è¨€ç»“æŸ</span>
                            </button>
                            <div class="turtle-soup-chat-actions">
                                <button class="chat-action-btn hint-btn" onclick="requestTurtleSoupHint()" title="è¯·æ±‚æç¤º">
                                    <i class="fas fa-lightbulb"></i>
                                </button>
                                <button class="chat-action-btn give-up-btn" onclick="giveTurtleSoupAnswer()" title="å…¬å¸ƒç­”æ¡ˆ">
                                    <i class="fas fa-flag"></i>
                                </button>
                                <button class="chat-action-btn new-game-btn" onclick="startNewTurtleSoupGame()" title="æ–°æ¸¸æˆ">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="turtle-soup-chat-messages" id="turtle-soup-chat-messages">
                            <!-- æ¨ç†èŠå¤©æ¶ˆæ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                        <div class="turtle-soup-chat-input">
                            <input type="text" id="turtle-soup-chat-input" placeholder="æå‡ºä½ çš„æ¨ç†é—®é¢˜ï¼ˆåªèƒ½é—®æ˜¯/å¦é—®é¢˜ï¼‰..." maxlength="200">
                            <button onclick="sendTurtleSoupQuestion()" id="send-turtle-soup-btn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- æ—¥è®°åŠŸèƒ½ç•Œé¢ - ä»¿çº¿ä¸‹æ¨¡å¼æ ·å¼ -->
                <div id="diary-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- æ—¥è®°æ¨¡å¼è¦†ç›–å±‚ - ä»¿çº¿ä¸‹æ¨¡å¼ -->
                    <div id="diary-mode-overlay" class="diary-mode-overlay">
                        <div class="diary-mode-header">
                            <button class="back-btn" onclick="backFromDiary()">â€¹</button>
                            <span class="header-title" id="diary-mode-title">ä»Šæ—¥æ—¥è®°</span>
                            <div class="header-actions">
                                <!-- ä»Šæ—¥æ—¥è®°é¡µé¢çš„æŒ‰é’® -->
                                <span class="action-btn" onclick="switchDiaryTab('past')" id="past-diary-btn" title="è¿‡å¾€æ—¥è®°">
                                    <i class="fas fa-history"></i>
                                </span>
                                <span class="action-btn" onclick="openDiarySettings()" id="diary-settings-btn" title="æ—¥è®°è®¾ç½®">
                                    <i class="fas fa-cog"></i>
                                </span>

                                <!-- è¿‡å¾€æ—¥è®°é¡µé¢çš„åƒåœ¾æ¡¶æŒ‰é’® -->
                                <span class="action-btn delete-btn" onclick="toggleDiaryDeleteMode()" id="diary-delete-btn" title="åˆ é™¤æ—¥è®°" style="display: none;">
                                    <i class="fas fa-trash"></i>
                                </span>
                            </div>
                        </div>

                        <div class="diary-mode-content">
                            <!-- ä»Šæ—¥æ—¥è®°å†…å®¹ -->
                            <div id="today-diary-view" class="diary-view active">
                                <div id="today-diary-content" class="diary-paper-background">
                                    <!-- æ—¥è®°å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                                </div>
                            </div>

                            <!-- è¿‡å¾€æ—¥è®°åˆ—è¡¨ -->
                            <div id="past-diaries-view" class="diary-view">
                                <div id="past-diaries-list" class="past-diaries-list">
                                    <!-- è¿‡å¾€æ—¥è®°åˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                                </div>
                            </div>

                            <!-- å•ä¸ªè¿‡å¾€æ—¥è®°å…¨å±æŸ¥çœ‹ -->
                            <div id="single-diary-view" class="diary-view">
                                <div id="single-diary-content" class="diary-paper-background">
                                    <!-- å•ä¸ªæ—¥è®°å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ—¥è®°è®¾ç½®å…¨å±ç•Œé¢ -->
                <div id="diary-settings-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- æ—¥è®°è®¾ç½®è¦†ç›–å±‚ -->
                    <div id="diary-settings-overlay" class="diary-settings-overlay">
                        <div class="diary-settings-header">
                            <button class="back-btn" onclick="backFromDiarySettings()">â€¹</button>
                            <span class="header-title">æ—¥è®°è®¾ç½®</span>
                            <div class="header-actions">
                                <span class="action-btn" onclick="resetDiarySettings()" title="é‡ç½®è®¾ç½®">
                                    <i class="fas fa-undo"></i>
                                </span>
                            </div>
                        </div>

                        <div class="diary-settings-content">
                            <!-- å®æ—¶é¢„è§ˆåŒºåŸŸ -->
                            <div class="settings-preview-section">
                                <h3>é¢„è§ˆæ•ˆæœ</h3>
                                <div class="diary-preview-container">
                                    <div id="diary-preview-content" class="diary-preview-paper">
                                        <div class="preview-text">
                                            2024å¹´8æœˆ2æ—¥ æ˜ŸæœŸäº”ï¼Œå¤©æ°”ï¼šæ™´æœ—

                                            ä»Šå¤©æ˜¯ç¾å¥½çš„ä¸€å¤©ï¼Œé˜³å…‰æ˜åªšã€‚æˆ‘åœ¨è¿™é‡Œå†™ä¸‹æˆ‘çš„å¿ƒæƒ…å’Œæƒ³æ³•ã€‚
                                            <mark>è¿™æ˜¯ä¸€æ®µé‡è¦çš„å†…å®¹</mark>ï¼Œéœ€è¦ç‰¹åˆ«æ ‡è®°ã€‚
                                            <strike>è¿™æ˜¯ä¸€æ®µåæ‚”å†™ä¸‹çš„è¯</strike>ã€‚
                                            å¸Œæœ›æ¯ä¸€å¤©éƒ½èƒ½è®°å½•ä¸‹ç¾å¥½çš„å›å¿†ã€‚
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- è®¾ç½®é€‰é¡¹åŒºåŸŸ -->
                            <div class="settings-options-section">
                                <!-- å­—ä½“è®¾ç½® -->
                                <div class="setting-group">
                                    <h4><i class="fas fa-font"></i> å­—ä½“è®¾ç½®</h4>

                                    <!-- ğŸ”¥ã€æ–°å¢ã€‘æ—¥è®°ä¸“ç”¨å­—ä½“URLè®¾ç½® -->
                                    <div class="setting-item">
                                        <label>æ—¥è®°ä¸“ç”¨å­—ä½“</label>
                                        <div class="diary-font-setting">
                                            <select id="diary-font-select" class="form-input" onchange="handleDiaryFontChange()">
                                                <option value="">ä½¿ç”¨å…¨å±€å­—ä½“</option>
                                                <option value="custom">è‡ªå®šä¹‰å­—ä½“URL...</option>
                                            </select>
                                            <div id="diary-custom-font-input" style="display: none; margin-top: 10px;">
                                                <input type="url" id="diary-font-url" placeholder="ä¾‹å¦‚ï¼šhttps://fonts.googleapis.com/css2?family=Noto+Sans+SC æˆ–ç›´æ¥å­—ä½“æ–‡ä»¶URL" class="form-input">
                                                <div class="diary-font-actions" style="margin-top: 8px; display: flex; gap: 8px;">
                                                    <button type="button" class="theme-button theme-button-secondary" onclick="previewDiaryFont()">é¢„è§ˆ</button>
                                                    <button type="button" class="theme-button theme-button-primary" onclick="applyDiaryFont()">åº”ç”¨</button>
                                                    <button type="button" class="theme-button theme-button-danger" onclick="clearDiaryFont()">æ¸…é™¤</button>
                                                </div>
                                                <div class="diary-font-status" id="diary-font-status" style="margin-top: 8px; font-size: 12px;"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="setting-item">
                                        <label>å­—ä½“å¤§å°</label>
                                        <div class="slider-container">
                                            <input type="range" id="font-size-slider" min="12" max="24" value="16" onchange="updateDiarySettings()">
                                            <span id="font-size-value">16px</span>
                                        </div>
                                    </div>

                                    <div class="setting-item">
                                        <label>å­—ä½“ç²—ç»†</label>
                                        <select id="fontWeightSelect" onchange="setFontWeight(this.value)">
                                            <option value="300">ç»†ä½“</option>
                                            <option value="400">æ­£å¸¸</option>
                                            <option value="500" selected>ä¸­ç­‰</option>
                                            <option value="600">åŠç²—</option>
                                            <option value="700">ç²—ä½“</option>
                                        </select>
                                    </div>

                                    <!-- ğŸ”¥ã€æ–°å¢ã€‘å­—ä½“é¢œè‰²è®¾ç½® -->
                                    <div class="setting-item">
                                        <label>å­—ä½“é¢œè‰²</label>
                                        <div class="custom-color-input">
                                            <input type="color" id="font-color-picker" value="#000000" onchange="setFontColor(this.value)">
                                            <label for="font-color-picker">é€‰æ‹©é¢œè‰²</label>
                                        </div>
                                    </div>
                                </div>

                                <!-- æ’ç‰ˆè®¾ç½® -->
                                <div class="setting-group">
                                    <h4><i class="fas fa-align-left"></i> æ’ç‰ˆè®¾ç½®</h4>

                                    <div class="setting-item">
                                        <label>è¡Œè·</label>
                                        <div class="slider-container">
                                            <input type="range" id="line-height-slider" min="1.2" max="2.5" step="0.1" value="1.6" onchange="updateDiarySettings()">
                                            <span id="line-height-value">1.6</span>
                                        </div>
                                    </div>

                                    <div class="setting-item">
                                        <label>æ®µè½é—´è·</label>
                                        <div class="slider-container">
                                            <input type="range" id="paragraph-spacing-slider" min="0" max="30" value="15" onchange="updateDiarySettings()">
                                            <span id="paragraph-spacing-value">15px</span>
                                        </div>
                                    </div>

                                    <div class="setting-item">
                                        <label>æ–‡æœ¬å¯¹é½</label>
                                        <select id="textAlignSelect" onchange="setTextAlign(this.value)">
                                            <option value="left" selected>å·¦å¯¹é½</option>
                                            <option value="center">å±…ä¸­</option>
                                            <option value="right">å³å¯¹é½</option>
                                            <option value="justify">ä¸¤ç«¯å¯¹é½</option>
                                        </select>
                                    </div>

                                    <div class="setting-item">
                                        <label>æ–‡æœ¬è£…é¥°</label>
                                        <select id="textDecorationSelect" onchange="setTextDecoration(this.value)">
                                            <option value="none" selected>æ— è£…é¥°</option>
                                            <option value="underline">ä¸‹åˆ’çº¿</option>
                                        </select>
                                    </div>

                                    <div class="setting-item">
                                        <label>é¦–è¡Œç¼©è¿›</label>
                                        <div class="slider-container">
                                            <input type="range" id="text-indent-slider" min="0" max="60" value="0" onchange="updateDiarySettings()">
                                            <span id="text-indent-value">0px</span>
                                        </div>
                                    </div>

                                    <!-- ğŸ”¥ã€æ–°å¢ã€‘é‡ç‚¹è‰²è‡ªå®šä¹‰ -->
                                    <div class="setting-item">
                                        <label>é‡ç‚¹è‰²ï¼ˆmarkæ ‡ç­¾ï¼‰</label>
                                        <div class="color-picker-container">
                                            <input type="color" id="mark-color-picker" value="#FFFF00" onchange="setMarkColor(this.value)">
                                            <label for="mark-color-picker">é€‰æ‹©é¢œè‰²</label>
                                        </div>
                                    </div>

                                    <!-- ğŸ”¥ã€æ–°å¢ã€‘åˆ é™¤çº¿é¢œè‰²è‡ªå®šä¹‰ -->
                                    <div class="setting-item">
                                        <label>åˆ é™¤çº¿é¢œè‰²ï¼ˆstrikeæ ‡ç­¾ï¼‰</label>
                                        <div class="color-picker-container">
                                            <input type="color" id="strike-color-picker" value="#FF0000" onchange="setStrikeColor(this.value)">
                                            <label for="strike-color-picker">é€‰æ‹©é¢œè‰²</label>
                                        </div>
                                    </div>

                                    <!-- ğŸ”¥ã€æ–°å¢ã€‘ä¸‹åˆ’çº¿é¢œè‰²è‡ªå®šä¹‰ -->
                                    <div class="setting-item">
                                        <label>ä¸‹åˆ’çº¿é¢œè‰²</label>
                                        <div class="color-picker-container">
                                            <input type="color" id="underline-color-picker" value="#0000FF" onchange="setUnderlineColor(this.value)">
                                            <label for="underline-color-picker">é€‰æ‹©é¢œè‰²</label>
                                        </div>
                                    </div>
                                </div>

                                <!-- å†…å®¹å®½åº¦è®¾ç½® -->
                                <div class="setting-group">
                                    <h4><i class="fas fa-arrows-alt-h"></i> å†…å®¹å®½åº¦</h4>

                                    <div class="setting-item">
                                        <label>æ–‡æœ¬å®½åº¦</label>
                                        <div class="slider-container">
                                            <input type="range" id="content-width-slider" min="60" max="100" value="100" onchange="updateDiarySettings()">
                                            <span id="content-width-value">100%</span>
                                        </div>
                                    </div>

                                    <div class="setting-item">
                                        <label>å·¦å³è¾¹è·</label>
                                        <div class="slider-container">
                                            <input type="range" id="content-padding-slider" min="10" max="60" value="40" onchange="updateDiarySettings()">
                                            <span id="content-padding-value">40px</span>
                                        </div>
                                    </div>

                                    <div class="setting-item">
                                        <label>ä¸Šè¾¹è·</label>
                                        <div class="slider-container">
                                            <input type="range" id="content-top-margin-slider" min="0" max="120" value="20" onchange="updateDiarySettings()">
                                            <span id="content-top-margin-value">20px</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- èƒŒæ™¯çº¸å¼ è®¾ç½® -->
                                <div class="setting-group">
                                    <h4><i class="fas fa-image"></i> èƒŒæ™¯çº¸å¼ </h4>
                                    <div class="paper-options">
                                        <div class="paper-option active" onclick="setDiaryPaper('plain')" data-paper="plain">
                                            <div class="paper-preview plain-paper"></div>
                                            <span>ç™½çº¸</span>
                                        </div>
                                        <div class="paper-option" onclick="setDiaryPaper('vintage')" data-paper="vintage">
                                            <div class="paper-preview vintage-paper"></div>
                                            <span>å¤å¤çº¸</span>
                                        </div>
                                        <div class="paper-option custom-paper" onclick="uploadCustomPaper()">
                                            <div class="paper-preview custom-preview">
                                                <i class="fas fa-plus"></i>
                                            </div>
                                            <span>è‡ªå®šä¹‰</span>
                                        </div>
                                    </div>
                                    <input type="file" id="paperImageInput" accept="image/*" style="display: none;" onchange="handlePaperUpload(event)">
                                </div>

                                <!-- ç¼–è¾‘åŠŸèƒ½ -->
                                <div class="setting-group">
                                    <h4><i class="fas fa-edit"></i> ç¼–è¾‘åŠŸèƒ½</h4>
                                    <div class="edit-actions">
                                        <button class="btn btn-primary" onclick="editTodayDiary(); backFromDiarySettings();">
                                            <i class="fas fa-pencil-alt"></i> ç¼–è¾‘æ—¥è®°
                                        </button>
                                        <button class="btn btn-secondary" onclick="generateTodayDiary(); backFromDiarySettings();">
                                            <i class="fas fa-sync-alt"></i> é‡æ–°ç”Ÿæˆ
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è®°å¿†è®¾ç½®æ¨¡æ€æ¡† -->
                <div id="memorySettingsModal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>è®°å¿†ç³»ç»Ÿè®¾ç½®</h3>
                            <button class="modal-close" onclick="closeMemorySettings()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="setting-group">
                                <label for="aiExtractInterval">AIè®°å¿†æå–é—´éš”ï¼ˆå›åˆæ•°ï¼‰</label>
                                <input type="number" id="aiExtractInterval" min="10" max="200" step="10" value="30">
                                <small>æ¯å¤šå°‘å›åˆå¯¹è¯è¿›è¡Œä¸€æ¬¡AIè®°å¿†æå–ï¼ˆå»ºè®®20-50å›åˆï¼‰</small>
                            </div>

                            <div class="setting-group">
                                <label for="coreMemoryThreshold">æ ¸å¿ƒè®°å¿†é‡è¦æ€§é˜ˆå€¼</label>
                                <input type="range" id="coreMemoryThreshold" min="0.7" max="1.0" step="0.05" value="0.9">
                                <span id="coreThresholdValue">90%</span>
                                <small>åªæœ‰é‡è¦æ€§è¶…è¿‡æ­¤é˜ˆå€¼çš„è®°å¿†æ‰ä¼šæˆä¸ºæ ¸å¿ƒè®°å¿†</small>
                            </div>

                            <div class="setting-group">
                                <label for="episodicMemoryThreshold">æƒ…æ™¯è®°å¿†é‡è¦æ€§é˜ˆå€¼</label>
                                <input type="range" id="episodicMemoryThreshold" min="0.4" max="0.8" step="0.05" value="0.6">
                                <span id="episodicThresholdValue">60%</span>
                                <small>é‡è¦æ€§åœ¨æ­¤èŒƒå›´å†…çš„è®°å¿†ä¼šæˆä¸ºæƒ…æ™¯è®°å¿†</small>
                            </div>

                            <!-- ğŸ”¥ã€æ–°å¢ã€‘è®°å¿†è¯Šæ–­å’Œæ¢å¤åŠŸèƒ½ -->
                            <div class="setting-group">
                                <label>è®°å¿†æ•°æ®è¯Šæ–­</label>
                                <button class="btn btn-info" onclick="diagnoseMemoryData()" style="width: 100%; margin-bottom: 10px;">
                                    <i class="fas fa-search"></i> è¯Šæ–­è®°å¿†æ•°æ®
                                </button>
                                <small>æ£€æŸ¥å½“å‰è§’è‰²çš„è®°å¿†æ•°æ®å®Œæ•´æ€§ï¼ŒæŸ¥æ‰¾å¯èƒ½ä¸¢å¤±çš„è®°å¿†</small>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeMemorySettings()">å–æ¶ˆ</button>
                            <button class="btn btn-primary" onclick="saveMemorySettings()">ä¿å­˜è®¾ç½®</button>
                        </div>
                    </div>
                </div>

                <!-- çº¿ä¸‹é¢„è®¾è®¾ç½®æ¨¡æ€æ¡† -->
                <div id="offline-preset-modal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>çº¿ä¸‹å‰§æƒ…é¢„è®¾</h3>
                            <button class="modal-close" onclick="closeOfflinePresetSettings()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <!-- å·²ä¿å­˜çš„é¢„è®¾åˆ—è¡¨ -->
                            <div class="form-group">
                                <label>å·²ä¿å­˜çš„é¢„è®¾</label>
                                <div id="saved-presets-list" class="saved-presets-list">
                                    <!-- é¢„è®¾åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>

                            <!-- æ–°å»º/ç¼–è¾‘é¢„è®¾è¡¨å• -->
                            <div class="form-group">
                                <label for="offline-preset-name">é¢„è®¾åç§°</label>
                                <input type="text" id="offline-preset-name" placeholder="ä¸ºè¿™ä¸ªé¢„è®¾èµ·ä¸ªåå­—..." maxlength="50">
                            </div>
                            <div class="form-group">
                                <label for="offline-preset-content">å‰§æƒ…é¢„è®¾å†…å®¹</label>
                                <textarea id="offline-preset-content" rows="6" placeholder="è¯·è¾“å…¥çº¿ä¸‹å‰§æƒ…æ¨¡å¼çš„é¢„è®¾å†…å®¹ï¼Œè¿™å°†å†³å®šAIçš„æ–‡é£ã€å­—æ•°ã€è§†è§’ç­‰...&#10;&#10;ä¾‹å¦‚ï¼š&#10;- ä»¥ç¬¬ä¸‰äººç§°è§†è§’æè¿°&#10;- æ¯æ¬¡å›å¤200-400å­—&#10;- æ³¨é‡ç¯å¢ƒæå†™å’Œå¿ƒç†æ´»åŠ¨&#10;- è¥é€ æµªæ¼«/æ‚¬ç–‘/å†’é™©ç­‰æ°›å›´"></textarea>
                            </div>
                            <div class="form-group">
                                <label>é¢„è®¾è¯´æ˜</label>
                                <div class="preset-help-text">
                                    <p>â€¢ é¢„è®¾å†…å®¹å°†ä½œä¸ºAIå›å¤çš„é‡è¦æŒ‡å¯¼</p>
                                    <p>â€¢ å¯ä»¥æŒ‡å®šæ–‡é£ã€å­—æ•°ã€è§†è§’ã€æ°›å›´ç­‰</p>
                                    <p>â€¢ æ”¯æŒæƒ…æ™¯æå†™ã€åŠ¨ä½œæå†™ã€å¿ƒç†æå†™</p>
                                    <p>â€¢ é¢„è®¾æƒé‡å¾ˆé«˜ï¼Œä¼šæ˜¾è‘—å½±å“AIçš„å›å¤é£æ ¼</p>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeOfflinePresetSettings()">å–æ¶ˆ</button>
                            <button class="btn btn-secondary" onclick="clearPresetForm()">æ¸…ç©ºè¡¨å•</button>
                            <button class="btn btn-primary" onclick="saveOfflinePreset()">ä¿å­˜é¢„è®¾</button>
                        </div>
                    </div>
                </div>

                <!-- çº¿ä¸‹æ¨¡å¼èŠå¤©è®°å½•æ¨¡æ€æ¡† -->
                <div id="offline-history-modal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>çº¿ä¸‹æ¨¡å¼èŠå¤©è®°å½•</h3>
                            <button class="modal-close" onclick="closeOfflineHistoryModal()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div id="offline-history-list" class="offline-history-list">
                                <!-- èŠå¤©è®°å½•åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeOfflineHistoryModal()">å…³é—­</button>
                            <button class="btn btn-warning" onclick="fixOfflineHistoryMessages()">ä¿®å¤é—æ¼è®°å½•</button>
                            <button class="btn btn-danger" onclick="clearAllOfflineHistory()">æ¸…ç©ºæ‰€æœ‰è®°å½•</button>
                        </div>
                    </div>
                </div>

                <!-- çºªå¿µæ—¥è¡¨å•æ¨¡æ€æ¡† -->
                <div id="anniversary-form-modal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 id="anniversary-form-title">æ·»åŠ çºªå¿µæ—¥</h3>
                            <button class="modal-close" onclick="closeAnniversaryForm()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="anniversary-name">çºªå¿µæ—¥åç§°</label>
                                <input type="text" id="anniversary-name" placeholder="ä¾‹å¦‚ï¼šå°é›ªçš„ç”Ÿæ—¥" maxlength="50">
                            </div>
                            <div class="form-group">
                                <label for="anniversary-date">æ—¥æœŸ</label>
                                <input type="date" id="anniversary-date">
                            </div>
                            <div class="form-group">
                                <label for="anniversary-type">ç±»å‹</label>
                                <select id="anniversary-type" onchange="toggleCustomTypeInput('anniversary')">
                                    <option value="birthday">ç”Ÿæ—¥</option>
                                    <option value="relationship">ç¡®å®šå…³ç³»</option>
                                    <option value="anniversary">çºªå¿µæ—¥</option>
                                    <option value="holiday">èŠ‚æ—¥</option>
                                    <option value="family">å®¶äººç”Ÿæ—¥</option>
                                    <option value="other">å…¶ä»–</option>
                                </select>
                            </div>
                            <div class="form-group" id="anniversary-custom-type-group" style="display: none;">
                                <label for="anniversary-custom-type">è‡ªå®šä¹‰ç±»å‹</label>
                                <input type="text" id="anniversary-custom-type" placeholder="è¯·è¾“å…¥è‡ªå®šä¹‰ç±»å‹..." maxlength="20">
                            </div>
                            <div class="form-group">
                                <label for="anniversary-character">ç›¸å…³è§’è‰²</label>
                                <select id="anniversary-character" onchange="toggleCharacterQuoteGroup('anniversary', this.value)">
                                    <option value="">é€‰æ‹©è§’è‰²ï¼ˆå¯é€‰ï¼‰</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="anniversary-description">æè¿°ï¼ˆå¯é€‰ï¼‰</label>
                                <textarea id="anniversary-description" rows="3" placeholder="æ·»åŠ ä¸€äº›å¤‡æ³¨..." maxlength="200"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="anniversary-user-quote">æˆ‘çš„è¯­å½•</label>
                                <textarea id="anniversary-user-quote" rows="2" placeholder="ä½ å¯¹è¿™ä¸ªçºªå¿µæ—¥çš„æ„Ÿæƒ³..." maxlength="150"></textarea>
                            </div>
                            <div class="form-group" id="anniversary-character-quote-group" style="display: none;">
                                <label for="anniversary-character-quote" id="anniversary-quote-label">è§’è‰²è¯­å½•</label>
                                <textarea id="anniversary-character-quote" rows="2" placeholder="è§’è‰²å¯¹è¿™ä¸ªçºªå¿µæ—¥çš„æ„Ÿæƒ³..." maxlength="150"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="anniversary-count-type">å¤©æ•°è®¡ç®—æ–¹å¼</label>
                                <select id="anniversary-count-type">
                                    <option value="countdown">å€’æ•°</option>
                                    <option value="countup">æ­£æ•°</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="anniversary-yearly" checked>
                                    æ¯å¹´é‡å¤
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="anniversary-shared">
                                    ä¸è§’è‰²å…±äº«ï¼ˆè§’è‰²ä¹Ÿèƒ½çœ‹åˆ°è¿™ä¸ªçºªå¿µæ—¥ï¼‰
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="anniversary-pinned">
                                    ç½®é¡¶æ˜¾ç¤ºï¼ˆåœ¨çºªå¿µæ—¥åˆ—è¡¨é¡¶éƒ¨å¤§å¡ç‰‡æ˜¾ç¤ºï¼‰
                                </label>
                            </div>
                            <div class="form-group" id="anniversary-background-group">
                                <label for="anniversary-background-upload">èƒŒæ™¯å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰</label>
                                <input type="file" id="anniversary-background-upload" accept="image/*" onchange="handleAnniversaryBackgroundUpload(this)">
                                <small class="form-hint">ç”¨äºç½®é¡¶æ˜¾ç¤ºå’Œä¸»å±å¹•å°ç»„ä»¶èƒŒæ™¯</small>
                                <div id="anniversary-background-preview" class="background-preview" style="display: none;">
                                    <img id="anniversary-background-img" src="" alt="èƒŒæ™¯é¢„è§ˆ">
                                    <button type="button" class="remove-background-btn" onclick="removeAnniversaryBackground()">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group" id="anniversary-user-avatar-group">
                                <label for="anniversary-user-avatar-upload">ä½ çš„å¤´åƒï¼ˆå¯é€‰ï¼‰</label>
                                <input type="file" id="anniversary-user-avatar-upload" accept="image/*" onchange="handleAnniversaryUserAvatarUpload(this)">
                                <small class="form-hint">ç”¨äºç½®é¡¶æ˜¾ç¤ºæ—¶æ˜¾ç¤ºä½ çš„èº«ä»½</small>
                                <div id="anniversary-user-avatar-preview" class="avatar-preview" style="display: none;">
                                    <img id="anniversary-user-avatar-img" src="" alt="å¤´åƒé¢„è§ˆ">
                                    <button type="button" class="remove-avatar-btn" onclick="removeAnniversaryUserAvatar()">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeAnniversaryForm()">å–æ¶ˆ</button>
                            <button class="btn btn-primary" onclick="saveAnniversary()">ä¿å­˜</button>
                        </div>
                    </div>
                </div>

                <!-- çº¦å®šè¡¨å•æ¨¡æ€æ¡† -->
                <div id="appointment-form-modal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 id="appointment-form-title">æ·»åŠ çº¦å®š</h3>
                            <button class="modal-close" onclick="closeAppointmentForm()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="appointment-name">çº¦å®šåç§°</label>
                                <input type="text" id="appointment-name" placeholder="ä¾‹å¦‚ï¼šå’Œå°é›ªå»çœ‹ç”µå½±" maxlength="50">
                            </div>
                            <div class="form-group">
                                <label for="appointment-date">æ—¥æœŸ</label>
                                <input type="date" id="appointment-date">
                            </div>
                            <div class="form-group">
                                <label for="appointment-time">æ—¶é—´</label>
                                <input type="time" id="appointment-time">
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="appointment-never-expires" onchange="toggleNeverExpires('appointment')">
                                    æ°¸ä¸è¿‡æœŸ
                                </label>
                                <small class="form-hint">å‹¾é€‰åï¼Œæ­¤çº¦å®šå°†ä¸ä¼šæ˜¾ç¤ºå‰©ä½™å¤©æ•°ï¼Œé€‚åˆé•¿æœŸæ‰¿è¯º</small>
                            </div>
                            <div class="form-group">
                                <label for="appointment-type">ç±»å‹</label>
                                <select id="appointment-type" onchange="toggleCustomTypeInput('appointment')">
                                    <option value="date">çº¦ä¼š</option>
                                    <option value="promise">æ‰¿è¯º</option>
                                    <option value="activity">æ´»åŠ¨</option>
                                    <option value="meeting">è§é¢</option>
                                    <option value="task">ä»»åŠ¡</option>
                                    <option value="other">å…¶ä»–</option>
                                </select>
                            </div>
                            <div class="form-group" id="appointment-custom-type-group" style="display: none;">
                                <label for="appointment-custom-type">è‡ªå®šä¹‰ç±»å‹</label>
                                <input type="text" id="appointment-custom-type" placeholder="è¯·è¾“å…¥è‡ªå®šä¹‰ç±»å‹..." maxlength="20">
                            </div>
                            <div class="form-group">
                                <label for="appointment-character">ç›¸å…³è§’è‰²</label>
                                <select id="appointment-character" onchange="toggleCharacterQuoteGroup('appointment', this.value)">
                                    <option value="">é€‰æ‹©è§’è‰²ï¼ˆå¯é€‰ï¼‰</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="appointment-priority">é‡è¦ç¨‹åº¦</label>
                                <select id="appointment-priority">
                                    <option value="low">ä¸€èˆ¬</option>
                                    <option value="medium" selected>é‡è¦</option>
                                    <option value="high">å¾ˆé‡è¦</option>
                                    <option value="urgent">éå¸¸é‡è¦</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="appointment-description">æè¿°ï¼ˆå¯é€‰ï¼‰</label>
                                <textarea id="appointment-description" rows="3" placeholder="æ·»åŠ ä¸€äº›å¤‡æ³¨..." maxlength="200"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="appointment-user-quote">æˆ‘çš„è¯­å½•</label>
                                <textarea id="appointment-user-quote" rows="2" placeholder="ä½ å¯¹è¿™ä¸ªçº¦å®šçš„æ„Ÿæƒ³..." maxlength="150"></textarea>
                            </div>
                            <div class="form-group" id="appointment-character-quote-group" style="display: none;">
                                <label for="appointment-character-quote" id="appointment-quote-label">è§’è‰²è¯­å½•</label>
                                <textarea id="appointment-character-quote" rows="2" placeholder="è§’è‰²å¯¹è¿™ä¸ªçº¦å®šçš„æ„Ÿæƒ³..." maxlength="150"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="appointment-count-type">å¤©æ•°è®¡ç®—æ–¹å¼</label>
                                <select id="appointment-count-type">
                                    <option value="countdown">å€’æ•°</option>
                                    <option value="countup">æ­£æ•°</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="appointment-shared">
                                    ä¸è§’è‰²å…±äº«ï¼ˆè§’è‰²ä¹Ÿèƒ½çœ‹åˆ°è¿™ä¸ªçº¦å®šï¼‰
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="appointment-pinned">
                                    ç½®é¡¶æ˜¾ç¤ºï¼ˆç½®é¡¶åä¼šå‡ºç°åœ¨ä¸»å±å¹•çºªå¿µæ—¥å°ç»„ä»¶ä¸Šï¼‰
                                </label>
                            </div>
                            <div class="form-group" id="appointment-background-group">
                                <label for="appointment-background-upload">èƒŒæ™¯å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰</label>
                                <input type="file" id="appointment-background-upload" accept="image/*" onchange="handleAppointmentBackgroundUpload(this)">
                                <small class="form-hint">ç”¨äºç½®é¡¶æ˜¾ç¤ºèƒŒæ™¯</small>
                                <div id="appointment-background-preview" class="background-preview" style="display: none;">
                                    <img id="appointment-background-img" src="" alt="èƒŒæ™¯é¢„è§ˆ">
                                    <button type="button" class="remove-background-btn" onclick="removeAppointmentBackground()">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group" id="appointment-user-avatar-group">
                                <label for="appointment-user-avatar-upload">ä½ çš„å¤´åƒï¼ˆå¯é€‰ï¼‰</label>
                                <input type="file" id="appointment-user-avatar-upload" accept="image/*" onchange="handleAppointmentUserAvatarUpload(this)">
                                <div id="appointment-user-avatar-preview" class="avatar-preview" style="display: none;">
                                    <img id="appointment-user-avatar-img" src="" alt="å¤´åƒé¢„è§ˆ">
                                    <button type="button" class="remove-avatar-btn" onclick="removeAppointmentUserAvatar()">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeAppointmentForm()">å–æ¶ˆ</button>
                            <button class="btn btn-primary" onclick="saveAppointment()">ä¿å­˜</button>
                        </div>
                    </div>
                </div>

                <!-- å›¾ç‰‡å°ç»„ä»¶è®¾ç½®æ¨¡æ€æ¡† -->
                <div id="photo-widget-modal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>å›¾ç‰‡å°ç»„ä»¶</h3>
                            <button class="modal-close" onclick="closePhotoWidgetModal()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="widget-photo-upload">é€‰æ‹©å›¾ç‰‡</label>
                                <input type="file" id="widget-photo-upload" accept="image/*" onchange="handlePhotoWidgetUpload(this)">
                            </div>
                            <div class="form-group">
                                <button class="btn btn-secondary" onclick="clearPhotoWidget()">æ¸…é™¤å›¾ç‰‡</button>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closePhotoWidgetModal()">å…³é—­</button>
                        </div>
                    </div>
                </div>

                <!-- çºªå¿µæ—¥å°ç»„ä»¶è®¾ç½®æ¨¡æ€æ¡† -->
                <div id="anniversary-widget-modal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>çºªå¿µæ—¥å°ç»„ä»¶</h3>
                            <button class="modal-close" onclick="closeAnniversaryWidgetModal()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="widget-anniversary-select">é€‰æ‹©è¦æ˜¾ç¤ºçš„çºªå¿µæ—¥</label>
                                <select id="widget-anniversary-select" onchange="updateAnniversaryWidget()">
                                    <option value="">è¯·é€‰æ‹©çºªå¿µæ—¥</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <button class="btn btn-secondary" onclick="clearAnniversaryWidget()">æ¸…é™¤æ˜¾ç¤º</button>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeAnniversaryWidgetModal()">å…³é—­</button>
                        </div>
                    </div>
                </div>

                <!-- çº¿ä¸‹æ¨¡å¼ç•Œé¢è®¾ç½®æ¨¡æ€æ¡† -->
                <div id="offline-ui-settings-modal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>çº¿ä¸‹æ¨¡å¼ç•Œé¢è®¾ç½®</h3>
                            <button class="modal-close" onclick="closeOfflineUISettings()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <!-- æ°”æ³¡é¢œè‰²è®¾ç½® -->
                            <div class="form-group">
                                <label>æ°”æ³¡é¢œè‰²è®¾ç½®</label>
                                <div class="color-setting-group">
                                    <div class="color-picker-container">
                                        <div class="flex-gap-15">
                                            <div class="flex-1">
                                                <label class="label-small">æˆ‘çš„æ°”æ³¡</label>
                                                <input type="color" id="offline-my-bubble-color" class="color-input" value="#007AFF">
                                            </div>
                                            <div class="flex-1">
                                                <label class="label-small">è§’è‰²æ°”æ³¡</label>
                                                <input type="color" id="offline-ai-bubble-color" class="color-input" value="#f0f0f0">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- é€æ˜åº¦è®¾ç½® -->
                            <div class="form-group">
                                <label>æ°”æ³¡é€æ˜åº¦</label>
                                <div class="opacity-setting">
                                    <input type="range" id="offline-bubble-opacity" class="theme-range" min="0" max="1" step="0.01" value="0.9">
                                    <span id="offline-opacity-value">90%</span>
                                </div>
                            </div>



                            <!-- ğŸ”¥ã€æ–°å¢ã€‘å­—ä½“å¤§å°è®¾ç½® -->
                            <div class="form-group">
                                <label>å­—ä½“å¤§å°</label>
                                <div class="opacity-setting">
                                    <input type="range" id="offline-font-size" class="theme-range" min="12" max="24" step="1" value="15">
                                    <span id="offline-font-size-value">15px</span>
                                </div>
                            </div>

                            <!-- å£çº¸è®¾ç½® -->
                            <div class="form-group">
                                <label>èƒŒæ™¯å£çº¸</label>
                                <div class="wallpaper-setting">
                                    <input type="file" id="offline-wallpaper-file" accept="image/*" class="form-input" onchange="handleOfflineWallpaperUpload(this)">
                                    <button type="button" class="theme-button theme-button-secondary" onclick="clearOfflineWallpaper()">æ¸…é™¤</button>
                                </div>
                            </div>

                            <!-- å­—ä½“è®¾ç½® -->
                            <div class="form-group">
                                <label>å­—ä½“è®¾ç½®</label>
                                <div class="font-setting">
                                    <select id="offline-font-select" class="form-input" onchange="handleOfflineFontChange()">
                                        <option value="">ç³»ç»Ÿé»˜è®¤å­—ä½“</option>
                                        <option value="custom">è‡ªå®šä¹‰å­—ä½“URL...</option>
                                    </select>
                                    <div id="custom-font-input" style="display: none; margin-top: 10px;">
                                        <input type="url" id="offline-font-url" placeholder="ä¾‹å¦‚ï¼šhttps://fonts.googleapis.com/css2?family=Noto+Sans+SC æˆ–ç›´æ¥å­—ä½“æ–‡ä»¶URL" class="form-input">
                                        <button type="button" class="theme-button theme-button-secondary" onclick="previewOfflineFont()">é¢„è§ˆ</button>
                                    </div>
                                </div>
                            </div>

                            <!-- æ–‡å­—é¢œè‰²è®¾ç½® -->
                            <div class="form-group">
                                <label>æ–‡å­—é¢œè‰²è®¾ç½®</label>
                                <div class="text-color-setting">
                                    <!-- ç”¨æˆ·æ¶ˆæ¯æ–‡å­—é¢œè‰² -->
                                    <div class="color-section">
                                        <label class="section-label">ç”¨æˆ·æ¶ˆæ¯æ–‡å­—é¢œè‰²</label>
                                        <div class="color-picker-container">
                                            <div class="flex-gap-15">
                                                <div class="flex-1">
                                                    <label class="label-small">æ™®é€šæ–‡å­—</label>
                                                    <input type="color" id="offline-user-normal-text-color" class="color-input" value="#ffffff">
                                                    <div class="saved-colors" id="offline-user-normal-saved-colors"></div>
                                                </div>
                                                <div class="flex-1">
                                                    <label class="label-small">æ–œä½“æ–‡å­—</label>
                                                    <input type="color" id="offline-user-italic-text-color" class="color-input" value="#f0f0f0">
                                                    <div class="saved-colors" id="offline-user-italic-saved-colors"></div>
                                                </div>
                                                <div class="flex-1">
                                                    <label class="label-small">åŠ ç²—æ–‡å­—</label>
                                                    <input type="color" id="offline-user-bold-text-color" class="color-input" value="#ffffff">
                                                    <div class="saved-colors" id="offline-user-bold-saved-colors"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- è§’è‰²æ¶ˆæ¯æ–‡å­—é¢œè‰² -->
                                    <div class="color-section">
                                        <label class="section-label">è§’è‰²æ¶ˆæ¯æ–‡å­—é¢œè‰²</label>
                                        <div class="color-picker-container">
                                            <div class="flex-gap-15">
                                                <div class="flex-1">
                                                    <label class="label-small">æ™®é€šæ–‡å­—</label>
                                                    <input type="color" id="offline-ai-normal-text-color" class="color-input" value="#000000">
                                                    <div class="saved-colors" id="offline-ai-normal-saved-colors"></div>
                                                </div>
                                                <div class="flex-1">
                                                    <label class="label-small">æ–œä½“æ–‡å­—</label>
                                                    <input type="color" id="offline-ai-italic-text-color" class="color-input" value="#666666">
                                                    <div class="saved-colors" id="offline-ai-italic-saved-colors"></div>
                                                </div>
                                                <div class="flex-1">
                                                    <label class="label-small">åŠ ç²—æ–‡å­—</label>
                                                    <input type="color" id="offline-ai-bold-text-color" class="color-input" value="#333333">
                                                    <div class="saved-colors" id="offline-ai-bold-saved-colors"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- é¢„å­˜é¢œè‰²åŠŸèƒ½ -->
                            <div class="form-group">
                                <label>é¢œè‰²ç®¡ç†</label>
                                <div class="color-management">
                                    <button type="button" class="theme-button theme-button-secondary" onclick="saveCurrentOfflineColors()">ä¿å­˜å½“å‰é¢œè‰²</button>
                                    <button type="button" class="theme-button theme-button-secondary" onclick="resetOfflineColors()">é‡ç½®ä¸ºé»˜è®¤</button>
                                </div>
                            </div>

                            <!-- å¤´åƒè®¾ç½® -->
                            <div class="form-group">
                                <label>å¤´åƒè®¾ç½®</label>
                                <div class="avatar-setting">
                                    <div class="setting-row">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="offline-show-user-avatar" checked>
                                            æ˜¾ç¤ºç”¨æˆ·å¤´åƒ
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="offline-show-ai-avatar" checked>
                                            æ˜¾ç¤ºè§’è‰²å¤´åƒ
                                        </label>
                                    </div>
                                    <div class="setting-row">
                                        <label class="radio-label">å¤´åƒä½ç½®ï¼š</label>
                                        <div class="radio-options">
                                            <div class="radio-option-button selected" onclick="selectAvatarPosition('side', this)">
                                                <div class="radio-indicator"></div>
                                                ä¾§è¾¹æ˜¾ç¤º
                                            </div>
                                            <div class="radio-option-button" onclick="selectAvatarPosition('custom', this)">
                                                <div class="radio-indicator"></div>
                                                è‡ªå®šä¹‰CSSæ§åˆ¶
                                            </div>
                                            <input type="radio" name="offline-avatar-position" value="side" checked style="display: none;">
                                            <input type="radio" name="offline-avatar-position" value="custom" style="display: none;">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- æ°”æ³¡æ ·å¼è®¾ç½® -->
                            <div class="form-group">
                                <label>æ°”æ³¡æ ·å¼è®¾ç½®</label>
                                <div class="bubble-style-setting">
                                    <div class="setting-row">
                                        <label class="radio-label">æ°”æ³¡å®½åº¦ï¼š</label>
                                        <div class="radio-options">
                                            <div class="radio-option-button selected" onclick="selectBubbleWidth('default', this)">
                                                <div class="radio-indicator"></div>
                                                æ™ºèƒ½å®½åº¦
                                            </div>
                                            <div class="radio-option-button" onclick="selectBubbleWidth('custom', this)">
                                                <div class="radio-indicator"></div>
                                                è‡ªå®šä¹‰CSSæ§åˆ¶
                                            </div>
                                            <input type="radio" name="offline-bubble-width" value="default" checked style="display: none;">
                                            <input type="radio" name="offline-bubble-width" value="custom" style="display: none;">
                                        </div>
                                    </div>
                                    <div class="setting-row">
                                        <label class="radio-label">æ°”æ³¡æ ·å¼ï¼š</label>
                                        <div class="radio-options">
                                            <div class="radio-option-button selected" onclick="selectBubbleStyle('default', this)">
                                                <div class="radio-indicator"></div>
                                                é»˜è®¤æ ·å¼
                                            </div>
                                            <div class="radio-option-button" onclick="selectBubbleStyle('custom', this)">
                                                <div class="radio-indicator"></div>
                                                è‡ªå®šä¹‰CSSæ§åˆ¶
                                            </div>
                                            <input type="radio" name="offline-bubble-style" value="default" checked style="display: none;">
                                            <input type="radio" name="offline-bubble-style" value="custom" style="display: none;">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- è‡ªå®šä¹‰CSSè®¾ç½® -->
                            <div class="form-group">
                                <label>è‡ªå®šä¹‰CSSä»£ç </label>
                                <div class="custom-css-setting">
                                    <div class="css-help-text" style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 10px; font-size: 12px; color: #666;">
                                        <strong>ğŸ“ CSSä½¿ç”¨è¯´æ˜ï¼š</strong><br>
                                        â€¢ ä½¿ç”¨ <code>.offline-message-content</code> æ§åˆ¶æ°”æ³¡æ ·å¼<br>
                                        â€¢ ä½¿ç”¨ <code>.offline-avatar</code> æ§åˆ¶å¤´åƒä½ç½®<br>
                                        â€¢ ä½¿ç”¨ <code>.offline-message.user</code> æ§åˆ¶ç”¨æˆ·æ¶ˆæ¯<br>
                                        â€¢ ä½¿ç”¨ <code>.offline-message.ai</code> æ§åˆ¶AIæ¶ˆæ¯<br>
                                        â€¢ å…ˆç‚¹å‡»"é¢„è§ˆCSS"æµ‹è¯•æ•ˆæœï¼Œå†ä¿å­˜è®¾ç½®
                                    </div>
                                    <textarea id="offline-custom-css" rows="8" class="form-input" placeholder="åœ¨è¿™é‡Œè¾“å…¥è‡ªå®šä¹‰CSSä»£ç æ¥æ§åˆ¶å¤´åƒä½ç½®ã€æ°”æ³¡æ ·å¼ã€æ°”æ³¡å¤§å°ç­‰...&#10;&#10;ğŸ”¥ åŸåˆ›ç¤ºä¾‹ï¼š&#10;/* ç®€å•åœ†è§’æ°”æ³¡ */&#10;#offline-mode-overlay .offline-message-content {&#10;    border-radius: 15px !important;&#10;    padding: 10px 15px !important;&#10;}&#10;&#10;/* å°å·§å¤´åƒ */&#10;#offline-mode-overlay .offline-avatar {&#10;    width: 30px !important;&#10;    height: 30px !important;&#10;}&#10;&#10;/* è‡ªå®šä¹‰é¢œè‰² */&#10;#offline-mode-overlay .offline-message.user .offline-message-content {&#10;    background: #ffeb3b !important;&#10;    color: #333 !important;&#10;}" oninput="realtimePreviewOfflineCSS()"></textarea>
                                    <div class="css-buttons">
                                        <button type="button" class="theme-button theme-button-secondary" onclick="previewOfflineCSS()">é¢„è§ˆCSS</button>
                                        <button type="button" class="theme-button theme-button-secondary" onclick="clearOfflineCSS()">æ¸…é™¤CSS</button>
                                        <button type="button" class="theme-button theme-button-secondary" onclick="showCSSExamples()">å¸¸ç”¨ç¤ºä¾‹</button>
                                    </div>
                                </div>
                            </div>

                            <!-- é¢„è§ˆåŒºåŸŸ -->
                            <div class="form-group">
                                <label>æ•ˆæœé¢„è§ˆ</label>
                                <div class="offline-preview-area" id="offline-preview-area">
                                    <div class="offline-message user">
                                        <div class="offline-avatar user-avatar" id="preview-user-avatar">
                                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%2378A8E8'/%3E%3Ccircle cx='50' cy='35' r='15' fill='white'/%3E%3Cpath d='M25 75 Q25 60 50 60 Q75 60 75 75 Z' fill='white'/%3E%3C/svg%3E" alt="ç”¨æˆ·å¤´åƒ" style="width: 100%; height: 100%; border-radius: 50%;">
                                        </div>
                                        <div class="offline-message-content">
                                            è¿™æ˜¯ç”¨æˆ·æ¶ˆæ¯çš„é¢„è§ˆæ•ˆæœï¼ŒåŒ…å«<em>æ–œä½“æ–‡å­—</em>å’Œ<strong>åŠ ç²—æ–‡å­—</strong>
                                        </div>
                                    </div>
                                    <div class="offline-message ai">
                                        <div class="offline-avatar ai-avatar" id="preview-ai-avatar">
                                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%236C7B7F'/%3E%3Ccircle cx='38' cy='42' r='4' fill='white'/%3E%3Ccircle cx='62' cy='42' r='4' fill='white'/%3E%3Cpath d='M35 60 Q50 70 65 60' stroke='white' stroke-width='3' fill='none' stroke-linecap='round'/%3E%3C/svg%3E" alt="AIå¤´åƒ" style="width: 100%; height: 100%; border-radius: 50%;">
                                        </div>
                                        <div class="offline-message-content">
                                            è¿™æ˜¯è§’è‰²å›å¤çš„é¢„è§ˆæ•ˆæœï¼ŒåŒ…å«<em>æ–œä½“æ–‡å­—</em>å’Œ<strong>åŠ ç²—æ–‡å­—</strong>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeOfflineUISettings()">å–æ¶ˆ</button>
                            <button class="btn btn-secondary" onclick="resetOfflineUISettings()">é‡ç½®</button>
                            <button class="btn btn-primary" onclick="saveOfflineUISettings()">ä¿å­˜è®¾ç½®</button>
                        </div>
                    </div>
                </div>





                <!-- è®°å¿†æŸ¥çœ‹å™¨ç•Œé¢ -->
                <div id="memory-viewer-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                                <div class="app-battery-container">
                                    <div class="app-battery-icon">
                                        <div class="app-battery-level"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="app-header">
                            <button class="back-button" onclick="hideApp('memory-viewer-screen')">â€¹</button>
                            <div class="app-title">è®°å¿†æŸ¥çœ‹å™¨</div>
                            <div class="memory-header-actions">
                                <div class="add-core-memory-btn" onclick="showAddCoreMemoryForm()" title="æ·»åŠ æ ¸å¿ƒè®°å¿†">
                                    <i class="fas fa-plus"></i>
                                </div>
                                <div class="memory-settings-btn" onclick="showMemorySettings()" title="è®°å¿†è®¾ç½®">
                                    <i class="fas fa-cog"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="app-content">
                        <!-- è§’è‰²é€‰æ‹©å™¨ -->
                        <div class="memory-character-selector">
                            <label for="memory-character-select">é€‰æ‹©è§’è‰²ï¼š</label>
                            <select id="memory-character-select" onchange="loadCharacterMemories()">
                                <option value="">è¯·é€‰æ‹©è§’è‰²</option>
                            </select>
                        </div>

                        <!-- æœç´¢å’Œè¿‡æ»¤ -->
                        <div class="memory-search-section">
                            <div class="memory-search-bar">
                                <input type="text" id="memory-search-input" placeholder="æœç´¢è®°å¿†å†…å®¹..." oninput="filterMemories()">
                                <button class="search-btn" onclick="filterMemories()">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                            <div class="memory-filter-tabs">
                                <button class="memory-filter-tab active" data-type="all" onclick="switchMemoryFilter('all')">å…¨éƒ¨</button>
                                <button class="memory-filter-tab" data-type="core" onclick="switchMemoryFilter('core')">æ ¸å¿ƒè®°å¿†</button>
                                <button class="memory-filter-tab" data-type="episodic" onclick="switchMemoryFilter('episodic')">æƒ…æ™¯è®°å¿†</button>
                                <button class="memory-filter-tab" data-type="storyline" onclick="switchMemoryFilter('storyline')">å‰§æƒ…æ€»ç»“</button>
                                <button class="memory-filter-tab" data-type="timeline" onclick="switchMemoryFilter('timeline')">æ—¶é—´çº¿</button>
                            </div>
                        </div>

                        <!-- è®°å¿†å†…å®¹æ˜¾ç¤ºåŒºåŸŸ -->
                        <div class="memory-content-area">
                            <div id="memory-list" class="memory-list">
                                <div class="memory-empty-state">
                                    <i class="fas fa-brain"></i>
                                    <p>è¯·é€‰æ‹©è§’è‰²æŸ¥çœ‹è®°å¿†</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ä¸–ç•Œä¹¦ç¼–è¾‘è¡¨å• -->
                <div id="worldbook-form-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="hideWorldbookForm()">â€¹</button>
                        <div class="app-title" id="worldbook-form-title">æ–°å»ºä¸–ç•Œä¹¦</div>
                        <button class="save-worldbook-btn save-btn-absolute" onclick="saveWorldbook()">ä¿å­˜</button>
                    </div>
                    <div class="app-content">
                        <div class="worldbook-form">
                            <div class="form-group">
                                <label class="form-label">æ ‡é¢˜</label>
                                <input type="text" id="worldbook-title" class="form-input" placeholder="è¯·è¾“å…¥ä¸–ç•Œä¹¦æ ‡é¢˜">
                            </div>
                            <div class="form-group">
                                <label class="form-label">å†…å®¹</label>
                                <textarea id="worldbook-content" class="form-textarea textarea-large" placeholder="è¯·è¾“å…¥ä¸–ç•Œä¹¦å†…å®¹ï¼Œè¿™é‡Œå¯ä»¥æè¿°è§’è‰²èƒŒæ™¯ã€ä¸–ç•Œè§‚è®¾å®šç­‰..."></textarea>
                            </div>
                            <!-- ğŸ”¥ã€æ–°å¢ã€‘æ³¨å…¥ä½ç½®è®¾ç½® -->
                            <div class="form-group">
                                <label class="form-label">æ³¨å…¥ä½ç½®</label>
                                <div class="setting-desc" style="margin-bottom: 10px; color: #666; font-size: 13px;">é€‰æ‹©ä¸–ç•Œä¹¦å†…å®¹çš„æ³¨å…¥ä½ç½®</div>
                                <select id="worldbook-insertion-position" class="form-select">
                                    <option value="before">å‰</option>
                                    <option value="middle">ä¸­</option>
                                    <option value="after">å</option>
                                </select>
                            </div>
                            <!-- ğŸ”¥ã€æ–°å¢ã€‘åˆ†ç±»é€‰æ‹© -->
                            <div class="form-group">
                                <label class="form-label">åˆ†ç±»</label>
                                <div id="worldbook-form-categories" class="categories-checkboxes">
                                    <!-- åˆ†ç±»å¤é€‰æ¡†å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>



                <!-- èŠå¤©è®¾ç½®ç•Œé¢ -->
                <div id="api-chat-settings-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="hideChatSettings()">â€¹</button>
                        <div class="app-title">èŠå¤©è®¾ç½®</div>
                    </div>
                    <div class="app-content padding-none-flex overflow-auto">
                        <div class="settings-container">

                            <!-- ç¾¤èŠä¸“ç”¨è®¾ç½® - ä»¿QQ/å¾®ä¿¡ç¾¤èŠç•Œé¢ -->
                            <div class="settings-section" id="group-chat-settings" style="display: none;">
                                <!-- ç¾¤èŠä¿¡æ¯å¡ç‰‡ -->
                                <div class="group-info-card">
                                    <div class="group-avatar-section" onclick="changeGroupAvatar()">
                                        <img id="group-avatar-preview" src="" class="group-avatar-large" alt="ç¾¤å¤´åƒ">
                                        <div class="group-avatar-edit-hint">ç‚¹å‡»ä¿®æ”¹</div>
                                    </div>
                                    <div class="group-basic-info">
                                        <div class="group-name" onclick="changeGroupName()" id="group-name-display">ç¾¤èŠåç§°</div>
                                        <div class="group-member-count" id="group-member-count-display">0åæˆå‘˜</div>
                                        <div class="group-description" onclick="editGroupDescription()" id="group-description-display">ç¾¤å…¬å‘Šï¼šç‚¹å‡»è®¾ç½®ç¾¤å…¬å‘Š</div>
                                    </div>
                                </div>

                                <!-- ç¾¤æˆå‘˜å±•ç¤ºåŒºåŸŸ -->
                                <div class="group-members-section">
                                    <div class="section-title">ç¾¤æˆå‘˜</div>
                                    <div class="group-members-grid" id="group-members-grid">
                                        <!-- ç¾¤æˆå‘˜å¤´åƒå°†åŠ¨æ€ç”Ÿæˆ -->
                                        <div class="member-item add-member" onclick="addGroupMember()">
                                            <div class="member-avatar">
                                                <i class="fas fa-plus"></i>
                                            </div>
                                            <div class="member-name">é‚€è¯·</div>
                                        </div>
                                        <div class="member-item remove-member" onclick="removeGroupMember()">
                                            <div class="member-avatar">
                                                <i class="fas fa-minus"></i>
                                            </div>
                                            <div class="member-name">ç§»é™¤</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- ç¾¤åŠŸèƒ½è®¾ç½® -->
                                <div class="setting-card">
                                    <!-- ğŸ”¥ã€æ–°å¢ã€‘ç¾¤èŠé¢å…·åˆ‡æ¢è®¾ç½® -->
                                    <div class="setting-item" onclick="showPersonaSwitchModal()">
                                        <div class="setting-left">
                                            <div class="setting-label">é¢å…·åˆ‡æ¢</div>
                                            <div class="setting-desc">é€‰æ‹©åœ¨æ­¤ç¾¤èŠä¸­ä½¿ç”¨çš„ç”¨æˆ·é¢å…·</div>
                                        </div>
                                        <div class="setting-right">
                                            <div class="current-persona-avatar" id="current-persona-avatar-group">
                                                <img src="" alt="å½“å‰é¢å…·" id="current-persona-avatar-img-group">
                                            </div>
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                    <div class="setting-item" onclick="changeMyGroupNickname()">
                                        <div class="setting-left">
                                            <div class="setting-label">æˆ‘åœ¨æœ¬ç¾¤çš„æ˜µç§°</div>
                                        </div>
                                        <div class="setting-right">
                                            <span class="setting-value" id="current-my-group-nickname">æœªé€‰æ‹©</span>
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                    <div class="setting-item" onclick="showGroupNotice()">
                                        <div class="setting-left">
                                            <div class="setting-label">ç¾¤å…¬å‘Š</div>
                                        </div>
                                        <div class="setting-right">
                                            <span class="setting-value">æŸ¥çœ‹è¯¦æƒ…</span>
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- èŠå¤©çª—å£è®¾ç½® -->
                            <div class="settings-section">
                                <div class="section-header">
                                    <i class="fas fa-user-edit section-icon"></i>
                                    <span class="section-title">èŠå¤©çª—å£è®¾ç½®</span>
                                </div>
                                <div class="setting-card">
                                    <!-- èº«ä»½é€‰æ‹©åŠŸèƒ½å·²ç§»é™¤ï¼Œèº«ä»½åœ¨åˆ›å»ºå¯¹è¯æ—¶é€‰æ‹© -->
                                    <!-- å•èŠæ—¶æ˜¾ç¤ºåŒæ–¹è®¾ç½®ï¼Œç¾¤èŠæ—¶éšè— -->
                                    <div class="setting-item single-chat-only" onclick="showAvatarSettings()">
                                        <div class="setting-left">
                                            <div class="setting-label">åŒæ–¹å¤´åƒè®¾ç½®</div>
                                            <div class="setting-desc">è®¾ç½®åœ¨æ­¤èŠå¤©çª—å£ä¸­æ˜¾ç¤ºçš„å¤´åƒ</div>
                                        </div>
                                        <div class="setting-right">
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                    <div class="setting-item single-chat-only" onclick="showNicknameSettings()">
                                        <div class="setting-left">
                                            <div class="setting-label">åŒæ–¹å¤‡æ³¨è®¾ç½®</div>
                                            <div class="setting-desc">è®¾ç½®åœ¨æ­¤èŠå¤©çª—å£ä¸­æ˜¾ç¤ºçš„æ˜µç§°</div>
                                        </div>
                                        <div class="setting-right">
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                    <!-- ğŸ”¥ã€æ–°å¢ã€‘é¡¶æ é¢œè‰²è®¾ç½® -->
                                    <div class="setting-item" onclick="showTopBarColorSettings()">
                                        <div class="setting-left">
                                            <div class="setting-label">ç•Œé¢å­—ä½“é¢œè‰²è®¾ç½®</div>
                                            <div class="setting-desc">è‡ªå®šä¹‰èŠå¤©ç•Œé¢æ–‡å­—é¢œè‰²</div>
                                        </div>
                                        <div class="setting-right">
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                    <div class="setting-item" onclick="showBackgroundSettings()">
                                        <div class="setting-left">
                                            <div class="setting-label">èŠå¤©èƒŒæ™¯è®¾ç½®</div>
                                            <div class="setting-desc">è‡ªå®šä¹‰èŠå¤©ç•Œé¢çš„èƒŒæ™¯å›¾ç‰‡</div>
                                        </div>
                                        <div class="setting-right">
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                    <div class="setting-item" onclick="showBubbleStyleSettings()">
                                        <div class="setting-left">
                                            <div class="setting-label">æ°”æ³¡æ ·å¼è®¾ç½®åŠcssä»£ç å¡«å…¥</div>
                                            <div class="setting-desc">é€‰æ‹©æ°”æ³¡å¤–è§‚æ ·å¼å’Œé¢œè‰²</div>
                                        </div>
                                        <div class="setting-right">
                                            <span class="setting-value" id="current-bubble-style">é»˜è®¤æ ·å¼</span>
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>

                                    <!-- ğŸ”¥ã€æ–°å¢ã€‘æˆ‘çš„çŠ¶æ€è®¾ç½® -->
                                    <div class="setting-item">
                                        <div class="setting-left">
                                            <div class="setting-label">æˆ‘çš„çŠ¶æ€</div>
                                            <div class="setting-desc">å¼€å¯åè§’è‰²å¯ä»¥æ„ŸçŸ¥æ‚¨çš„å½“å‰çŠ¶æ€</div>
                                        </div>
                                        <div class="setting-right">
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="user-status-enabled">
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- ğŸ”¥ã€æ–°å¢ã€‘çŠ¶æ€é€‰æ‹©å’Œè‡ªå®šä¹‰å†…å®¹ - ä»…åœ¨å¼€å¯çŠ¶æ€æ—¶æ˜¾ç¤º -->
                                    <div class="setting-item" id="user-status-detail-setting" style="display: none;">
                                        <div class="setting-left">
                                            <div class="setting-label">å½“å‰çŠ¶æ€</div>
                                            <div class="setting-desc">é€‰æ‹©æ‚¨çš„åœ¨çº¿çŠ¶æ€</div>
                                        </div>
                                        <div class="setting-right">
                                            <select class="setting-select" id="user-status-type">
                                                <option value="online">åœ¨çº¿</option>
                                                <option value="busy">å¿™ç¢Œ</option>
                                                <option value="offline">ç¦»çº¿</option>
                                                <option value="custom">è‡ªå®šä¹‰</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- ğŸ”¥ã€æ–°å¢ã€‘è‡ªå®šä¹‰çŠ¶æ€å†…å®¹è¾“å…¥ - ä»…åœ¨é€‰æ‹©è‡ªå®šä¹‰æ—¶æ˜¾ç¤º -->
                                    <div class="setting-item" id="user-status-custom-setting" style="display: none;">
                                        <div class="setting-left">
                                            <div class="setting-label">è‡ªå®šä¹‰çŠ¶æ€</div>
                                            <div class="setting-desc">è¾“å…¥æ‚¨çš„è‡ªå®šä¹‰çŠ¶æ€å†…å®¹</div>
                                        </div>
                                        <div class="setting-right" style="flex: 1; max-width: 200px;">
                                            <input type="text" id="user-status-custom-content" class="form-input" placeholder="ä¾‹å¦‚ï¼šå¼€ä¼šä¸­..." maxlength="50" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                                        </div>
                                    </div>

                                    <div class="setting-item single-chat-only">
                                        <div class="setting-left">
                                            <div class="setting-label">æ˜¾ç¤ºè§’è‰²çŠ¶æ€</div>
                                            <div class="setting-desc">åœ¨èŠå¤©ç•Œé¢æ˜¾ç¤ºè§’è‰²çš„åœ¨çº¿çŠ¶æ€å’Œæ´»åŠ¨ï¼Œå¼€å¯åä¼šæŒ‰ç…§è®¾ç½®çš„é¢‘ç‡å•ç‹¬è°ƒç”¨apiç”Ÿæˆï¼Œæ³¨æ„apiæ¶ˆè€—</div>
                                        </div>
                                        <div class="setting-right">
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="character-status-enabled">
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- ğŸ”¥ã€è°ƒæ•´ä½ç½®ã€‘çŠ¶æ€æ›´æ–°é¢‘ç‡è®¾ç½® - ç´§è·Ÿåœ¨æ˜¾ç¤ºè§’è‰²çŠ¶æ€å¼€å…³åé¢ -->
                                    <div class="setting-item single-chat-only" id="status-frequency-setting" style="display: none;">
                                        <div class="setting-left">
                                            <div class="setting-label">çŠ¶æ€æ›´æ–°é¢‘ç‡</div>
                                            <div class="setting-desc">æ§åˆ¶è§’è‰²çŠ¶æ€çš„æ£€æŸ¥å’Œæ›´æ–°é¢‘ç‡</div>
                                        </div>
                                        <div class="setting-right">
                                            <select class="setting-select" id="status-update-frequency">
                                                <option value="high">é«˜é¢‘ (30ç§’)</option>
                                                <option value="medium-high">ä¸­é«˜é¢‘ (1åˆ†é’Ÿ)</option>
                                                <option value="medium">ä¸­é¢‘ (3åˆ†é’Ÿ)</option>
                                                <option value="medium-low">ä¸­ä½é¢‘ (5åˆ†é’Ÿ)</option>
                                                <option value="low">ä½é¢‘ (10åˆ†é’Ÿ)</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- ğŸ”¥ã€æ–°å¢ã€‘çº¿ä¸‹å‰§æƒ…è®°å½•æ˜¾ç¤ºè®¾ç½® -->
                                    <div class="setting-item single-chat-only">
                                        <div class="setting-left">
                                            <div class="setting-label">çº¿ä¸Šæ˜¾ç¤ºçº¿ä¸‹å‰§æƒ…</div>
                                            <div class="setting-desc">åœ¨çº¿ä¸ŠèŠå¤©ä¸­ç›´æ¥æ˜¾ç¤ºçº¿ä¸‹å‰§æƒ…æ¨¡å¼çš„å¯¹è¯è®°å½•</div>
                                        </div>
                                        <div class="setting-right">
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="show-offline-in-online-enabled">
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- ğŸ”¥ã€æ–°å¢ã€‘MiniMax è¯­éŸ³å¼€å…³ -->
                                    <div class="setting-item single-chat-only">
                                        <div class="setting-left">
                                            <div class="setting-label">
                                                <i class="fas fa-microphone"></i> MiniMax è¯­éŸ³
                                            </div>
                                            <div class="setting-desc">å¯ç”¨åï¼Œè¯­éŸ³æ¡ã€é€šè¯ã€é™ªä¼´æ¨¡å¼å°†æ’­æ”¾çœŸå®è¯­éŸ³</div>
                                        </div>
                                        <div class="setting-right">
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="minimax-voice-enabled">
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- ğŸ”¥ã€æ–°å¢ã€‘èŠå¤©æ ‡å¿—ç«è‹—å¼€å…³ -->
                                    <div class="setting-item single-chat-only">
                                        <div class="setting-left">
                                            <div class="setting-label">
                                                <i class="fas fa-fire"></i> èŠå¤©æ ‡å¿—
                                            </div>
                                            <div class="setting-desc">è®°å½•æŒç»­èŠå¤©å¤©æ•°</div>
                                        </div>
                                        <div class="setting-right">
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="chat-streak-enabled">
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- ğŸ”¥ã€æ–°å¢ã€‘é¢å…·åˆ‡æ¢è®¾ç½® -->
                                    <div class="setting-item single-chat-only" onclick="showPersonaSwitchModal()">
                                        <div class="setting-left">
                                            <div class="setting-label">é¢å…·åˆ‡æ¢</div>
                                            <div class="setting-desc">é€‰æ‹©åœ¨æ­¤å¯¹è¯ä¸­ä½¿ç”¨çš„ç”¨æˆ·é¢å…·</div>
                                        </div>
                                        <div class="setting-right">
                                            <div class="current-persona-avatar" id="current-persona-avatar">
                                                <img src="" alt="å½“å‰é¢å…·" id="current-persona-avatar-img">
                                            </div>
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- æˆ³ä¸€æˆ³åŠŸèƒ½è®¾ç½® - å•èŠç‰¹æœ‰ -->
                            <div class="settings-section" id="poke-settings-section">
                                <div class="section-header">
                                    <i class="fas fa-hand-paper section-icon"></i>
                                    <span class="section-title">æˆ³ä¸€æˆ³åŠŸèƒ½</span>
                                </div>
                                <div class="setting-card">
                                    <div class="setting-item" id="poke-suffix-settings" onclick="showPokeSuffixSettings()">
                                        <div class="setting-left">
                                            <div class="setting-label">æˆ³ä¸€æˆ³åç¼€è®¾ç½®</div>
                                            <div class="setting-desc">è‡ªå®šä¹‰åŒæ–¹çš„æˆ³ä¸€æˆ³åŠ¨ä½œåç¼€</div>
                                        </div>
                                        <div class="setting-right">
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- è®°å¿†è®¾ç½® -->
                            <div class="settings-section">
                                <div class="section-header">
                                    <i class="fas fa-brain section-icon"></i>
                                    <span class="section-title">è®°å¿†è®¾ç½®</span>
                                </div>
                                <div class="setting-card">
                                    <div class="setting-item" onclick="showHistorySettings()">
                                        <div class="setting-left">
                                            <div class="setting-label">é™„å¸¦å†å²æ¶ˆæ¯æ•°</div>
                                            <div class="setting-desc">è‡ªå®šä¹‰è§’è‰²å›å¤æ—¶å‚è€ƒçš„å†å²å¯¹è¯æ•°é‡</div>
                                        </div>
                                        <div class="setting-right">
                                            <span class="setting-value" id="current-history-count">5å›åˆ</span>
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>

                                    <div class="setting-item single-chat-only" onclick="showGlobalMemorySettings()">
                                        <div class="setting-left">
                                            <div class="setting-label">å…¨å±€è®°å¿†ç³»ç»Ÿ</div>
                                            <div class="setting-desc">æ™ºèƒ½è®°å¿†ç®¡ç†ï¼Œè®©è§’è‰²è®°ä½é‡è¦çš„èŠå¤©å†…å®¹</div>
                                        </div>
                                        <div class="setting-right">
                                            <span class="setting-value" id="global-memory-status">7å¤©è®°å¿†</span>
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                    <div class="setting-item single-chat-only" onclick="showMemoryShareSettings()">
                                        <div class="setting-left">
                                            <div class="setting-label">ä¸ç¾¤èŠå…±äº«è®°å¿†</div>
                                            <div class="setting-desc">è®©è§’è‰²åœ¨ç¾¤èŠä¸­æ‹¥æœ‰å•èŠè®°å¿†</div>
                                        </div>
                                        <div class="setting-right">
                                            <span class="setting-value" id="memory-share-status">å·²å…³é—­</span>
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                    <div class="setting-item" onclick="showWorldbookMountSettings()">
                                        <div class="setting-left">
                                            <div class="setting-label">æŒ‚è½½ä¸–ç•Œä¹¦</div>
                                            <div class="setting-desc">è®©è§’è‰²å‚è€ƒé€‰å®šçš„ä¸–ç•Œä¹¦å†…å®¹ä½œä¸ºèƒŒæ™¯çŸ¥è¯†</div>
                                        </div>
                                        <div class="setting-right">
                                            <span class="setting-value" id="current-worldbook-mount">æœªæŒ‚è½½</span>
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                    <div class="setting-item" onclick="showEmojiLibraryMountSettings()">
                                        <div class="setting-left">
                                            <div class="setting-label">æŒ‚è½½è¡¨æƒ…åŒ…åº“</div>
                                            <div class="setting-desc">é€‰æ‹©å¯ä½¿ç”¨çš„è¡¨æƒ…åŒ…åº“ï¼ˆç”¨æˆ·ä¸è§’è‰²éƒ½å¯ä½¿ç”¨ï¼ŒæŒ‚è½½åå°†æ˜¾ç¤ºåœ¨è¡¨æƒ…åŒ…çš„"å…¨éƒ¨"æ ‡ç­¾é¡µä¸­ï¼‰</div>
                                        </div>
                                        <div class="setting-right">
                                            <span class="setting-value" id="current-emoji-library-mount">æœªæŒ‚è½½</span>
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ç°å®æ„ŸçŸ¥è®¾ç½® -->
                            <div class="settings-section">
                                <div class="section-header">
                                    <i class="fas fa-globe-asia section-icon"></i>
                                    <span class="section-title">ç°å®æ„ŸçŸ¥</span>
                                </div>
                                <div class="setting-card">
                                    <!-- æ—¶é—´æ„ŸçŸ¥å¼€å…³ -->
                                    <div class="setting-item">
                                        <div class="setting-left">
                                            <div class="setting-label">æ—¶é—´æ„ŸçŸ¥</div>
                                            <div class="setting-desc">è§’è‰²ä¼šæ„ŸçŸ¥å½“å‰æ—¶é—´å¹¶è°ƒæ•´å›å¤</div>
                                        </div>
                                        <div class="setting-right">
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="time-awareness-enabled">
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- åœ°ç‚¹æ„ŸçŸ¥å¼€å…³ - ä»…å•èŠæ˜¾ç¤º -->
                                    <div class="setting-item single-chat-only">
                                        <div class="setting-left">
                                            <div class="setting-label">åœ°ç‚¹ä¸å¤©æ°”æ„ŸçŸ¥</div>
                                            <div class="setting-desc">è§’è‰²ä¼šæ„ŸçŸ¥æ‰€åœ¨åŸå¸‚ã€å¤©æ°”å’ŒèŠ‚å‡æ—¥ä¿¡æ¯ï¼ˆéœ€è¦è”ç½‘APIï¼‰</div>
                                        </div>
                                        <div class="setting-right">
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="location-awareness-enabled">
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- åœ°ç‚¹è®¾ç½®æŒ‰é’® - ä»…å•èŠæ˜¾ç¤º -->
                                    <div class="setting-item single-chat-only" id="location-settings-container" style="display: none;">
                                        <div class="setting-left">
                                            <div class="setting-label">é…ç½®åœ°ç‚¹ä¿¡æ¯</div>
                                            <div class="setting-desc">è®¾ç½®ç”¨æˆ·å’Œè§’è‰²çš„åŸå¸‚ä½ç½®</div>
                                        </div>
                                        <div class="setting-right">
                                            <button class="btn btn-secondary btn-sm" onclick="openLocationSettingsModal()">
                                                <i class="fas fa-map-marker-alt"></i> è®¾ç½®åœ°ç‚¹
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- é€šè¯è®¾ç½® - ä»…åœ¨å•èŠæ—¶æ˜¾ç¤º -->
                            <div class="settings-section single-chat-only">
                                <div class="section-header">
                                    <i class="fas fa-phone section-icon"></i>
                                    <span class="section-title">é€šè¯è®¾ç½®</span>
                                </div>
                                <div class="setting-card">
                                    <div class="setting-item">
                                        <div class="setting-left">
                                            <div class="setting-label">è§’è‰²ä¸»åŠ¨æ‹¨æ‰“ç”µè¯</div>
                                            <div class="setting-desc">å…è®¸è§’è‰²ä¸»åŠ¨å‘èµ·é€šè¯</div>
                                        </div>
                                        <div class="setting-right">
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="ai-call-enabled" class="ai-call-enabled-checkbox">
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <!-- ğŸ”¥ã€æ–°å¢ã€‘é€šè¯å½¢è±¡è®¾ç½® - ä»…åœ¨å•èŠæ—¶æ˜¾ç¤º -->
                                    <div class="setting-item single-chat-only" id="video-avatar-setting" style="display: none;" onclick="showVideoAvatarModal()">
                                        <div class="setting-left">
                                            <div class="setting-label">é€šè¯å½¢è±¡è®¾ç½®</div>
                                            <div class="setting-desc">è®¾ç½®åŒæ–¹è§†é¢‘é€šè¯æ—¶ä½¿ç”¨çš„å½¢è±¡</div>
                                        </div>
                                        <div class="setting-right">
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- AIå¿ƒç‡ç›‘æµ‹ - ä»…å•èŠæ”¯æŒ -->
                            <div class="settings-section single-chat-only">
                                <div class="section-header">
                                    <i class="fas fa-heartbeat section-icon"></i>
                                    <span class="section-title">è§’è‰²å¿ƒç‡ç›‘æµ‹</span>
                                </div>
                                <div class="setting-card">
                                    <div class="setting-item">
                                        <div class="setting-left">
                                            <div class="setting-label">å¿ƒç‡ç›‘æµ‹æ˜¾ç¤º</div>
                                            <div class="setting-desc">åœ¨çŠ¶æ€æ æ˜¾ç¤ºè§’è‰²çš„æƒ…æ„Ÿå¿ƒç‡</div>
                                        </div>
                                        <div class="setting-right">
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="ai-heartrate-enabled">
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>

                                    <div class="setting-item" id="heartrate-position-setting" style="display: none;">
                                        <div class="setting-left">
                                            <div class="setting-label">å¿ƒç‡æ˜¾ç¤ºä½ç½®</div>
                                            <div class="setting-desc">é€‰æ‹©å¿ƒç‡åœ¨çŠ¶æ€æ ä¸­çš„æ˜¾ç¤ºä½ç½®</div>
                                        </div>
                                        <div class="setting-right">
                                            <select id="heartrate-position-select" class="form-select">
                                                <option value="center">é¡¶éƒ¨ä¸­é—´</option>
                                                <option value="right">ä¾§æ–¹</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>





                            <!-- åå°äº’åŠ¨è®¾ç½® -->
                            <div class="settings-section">
                                <div class="section-header">
                                    <i class="fas fa-robot section-icon"></i>
                                    <span class="section-title">åå°äº’åŠ¨</span>
                                </div>
                                <div class="setting-card">
                                    <div class="setting-item">
                                        <div class="setting-left">
                                            <div class="setting-label">åå°äº’åŠ¨å¼€å…³</div>
                                            <div class="setting-desc">è§’è‰²å¯åœ¨åå°ä¸»åŠ¨æ´»åŠ¨å¹¶å‘é€æ¨é€</div>
                                        </div>
                                        <div class="setting-right">
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="background-interaction-enabled">
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="background-interaction-details hide" id="background-interaction-settings">
                                        <div class="setting-item">
                                        <div class="setting-left">
                                                <div class="setting-label">ä¸»åŠ¨èŠå¤©</div>
                                                <div class="setting-desc">è§’è‰²åœ¨ä½ 10åˆ†é’Ÿæœªå›å¤æ—¶ä¸»åŠ¨å‘æ¶ˆæ¯</div>
                                        </div>
                                        <div class="setting-right">
                                                <label class="toggle-switch">
                                                    <input type="checkbox" id="background-chat-enabled">
                                                    <span class="toggle-slider"></span>
                                                </label>
                                        </div>
                                    </div>

                                        <div class="setting-item" id="chat-frequency-setting" style="display: none;">
                                        <div class="setting-left">
                                                <div class="setting-label">ä¸»åŠ¨èŠå¤©é¢‘ç‡</div>
                                                <div class="setting-desc">è§’è‰²ä¸»åŠ¨å‘èµ·å¯¹è¯çš„é¢‘ç‡</div>
                                        </div>
                                        <div class="setting-right">
                                                <select id="background-chat-frequency" class="setting-select">
                                                    <option value="low">ä½ (1-2å°æ—¶/æ¬¡)</option>
                                                    <option value="medium">ä¸­ (30-60åˆ†é’Ÿ/æ¬¡)</option>
                                                    <option value="high">é«˜ (10-30åˆ†é’Ÿ/æ¬¡)</option>
                                                </select>
                                </div>
                            </div>

                                    <div class="setting-item single-chat-only">
                                        <div class="setting-left">
                                                <div class="setting-label">ä¸»åŠ¨å‘åŠ¨æ€</div>
                                                <div class="setting-desc">è§’è‰²æ ¹æ®äººè®¾ä¸»åŠ¨å‘å¸ƒåŠ¨æ€</div>
                                        </div>
                                        <div class="setting-right">
                                            <label class="toggle-switch">
                                                    <input type="checkbox" id="background-moments-enabled">
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>

                                        <div class="setting-item single-chat-only" id="moments-frequency-setting" style="display: none; justify-content: space-between !important; align-items: center !important;">
                                            <div class="setting-left" style="flex: 1 !important;">
                                                <div class="setting-label">ä¸»åŠ¨å‘åŠ¨æ€é¢‘ç‡</div>
                                                <div class="setting-desc">è§’è‰²ä¸»åŠ¨å‘å¸ƒç¤¾äº¤åŠ¨æ€çš„é¢‘ç‡</div>
                                            </div>
                                            <div class="setting-right" style="display: flex !important; align-items: center !important; flex-shrink: 0 !important;">
                                                <select id="background-moments-frequency" class="setting-select">
                                                    <option value="low">ä½ (4-8å°æ—¶/æ¬¡)</option>
                                                    <option value="medium">ä¸­ (2-4å°æ—¶/æ¬¡)</option>
                                                    <option value="high">é«˜ (1-2å°æ—¶/æ¬¡)</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="setting-item single-chat-only" id="scheduled-moments-setting" style="display: none; justify-content: space-between !important; align-items: center !important;">
                                            <div class="setting-left" style="flex: 1 !important;">
                                                <div class="setting-label">å®šæ—¶å‘å¸ƒåŠ¨æ€</div>
                                                <div class="setting-desc">è®¾ç½®å›ºå®šæ—¶é—´ç‚¹è‡ªåŠ¨å‘å¸ƒåŠ¨æ€</div>
                                            </div>
                                            <div class="setting-right" style="display: flex !important; align-items: center !important; gap: 8px !important; flex-shrink: 0 !important;">
                                                <button onclick="showScheduleTimesModal()" style="background-color: #4a84c1; color: white; border: none; padding: 6px 12px; border-radius: 15px; font-size: 12px;">
                                                    <span id="schedule-times-display">æœªè®¾ç½®</span>
                                                </button>
                                                <label class="toggle-switch">
                                                    <input type="checkbox" id="scheduled-moments-enabled">
                                                    <span class="toggle-slider"></span>
                                                </label>
                                            </div>
                                        </div>

                                        <div class="setting-item single-chat-only" id="test-publish-setting" style="display: none; justify-content: space-between !important; align-items: center !important;">
                                            <div class="setting-left" style="flex: 1 !important;">
                                                <div class="setting-label">ç«‹åˆ»å‘å¸ƒ</div>
                                                <div class="setting-desc">è®©è§’è‰²ç«‹å³å‘å¸ƒä¸€æ¡åŠ¨æ€</div>
                                            </div>
                                            <div class="setting-right" style="display: flex !important; align-items: center !important; flex-shrink: 0 !important; gap: 8px;">
                                                <button onclick="testPublishMoment()" style="background-color: #4a84c1; color: white; border: none; padding: 6px 12px; border-radius: 15px; font-size: 12px;">
                                                    å‘å¸ƒ
                                                </button>
                                                <button onclick="fixAvatarData()" style="background-color: #ff6b6b; color: white; border: none; padding: 6px 12px; border-radius: 15px; font-size: 12px;">
                                                    ä¿®å¤å¤´åƒ
                                                </button>
                                            </div>
                                        </div>

                                        <!-- ğŸ”¥ã€æ–°å¢ã€‘åå°å†™æ—¥è®°è®¾ç½® - ä»…å•èŠæ”¯æŒ -->
                                        <div class="setting-item single-chat-only">
                                            <div class="setting-left">
                                                <div class="setting-label">åå°å†™æ—¥è®°</div>
                                                <div class="setting-desc">è§’è‰²å¯åœ¨æŒ‡å®šæ—¶é—´è‡ªåŠ¨å†™æ—¥è®°</div>
                                            </div>
                                            <div class="setting-right">
                                                <label class="toggle-switch">
                                                    <input type="checkbox" id="background-diary-enabled">
                                                    <span class="toggle-slider"></span>
                                                </label>
                                            </div>
                                        </div>

                                        <div class="setting-item single-chat-only" id="diary-time-setting" style="display: none; justify-content: space-between !important; align-items: flex-start !important;">
                                            <div class="setting-left" style="flex: 1 !important;">
                                                <div class="setting-label">å†™æ—¥è®°æ—¶é—´</div>
                                                <div class="setting-desc">è®¾ç½®è§’è‰²æ¯å¤©å†™æ—¥è®°çš„æ—¶é—´ç‚¹ï¼ˆæ”¯æŒÂ±5åˆ†é’Ÿæ³¢åŠ¨ï¼‰</div>
                                            </div>
                                            <div class="setting-right" style="display: flex !important; flex-direction: column !important; align-items: flex-end !important; gap: 8px !important; flex-shrink: 0 !important;">
                                                <input type="time" id="diary-time-input" style="padding: 6px 8px; border: 1px solid #ddd; border-radius: 8px; font-size: 12px;">
                                                <button onclick="saveDiaryTime()" style="background-color: #4a84c1; color: white; border: none; padding: 6px 12px; border-radius: 15px; font-size: 12px;">
                                                    ä¿å­˜æ—¶é—´
                                                </button>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <!-- å…¶ä»–è®¾ç½® -->
                            <div class="settings-section">
                                <div class="section-header">
                                    <i class="fas fa-cog section-icon"></i>
                                    <span class="section-title">å…¶ä»–è®¾ç½®</span>
                                </div>
                                <div class="setting-card">
                                    <!-- ğŸ”¥ã€æ–°å¢ã€‘æ ¼å¼ä¼˜åŒ–å¼€å…³ -->
                                    <div class="setting-item">
                                        <div class="setting-left">
                                            <div class="setting-label">æ ¼å¼ä¼˜åŒ–</div>
                                            <div class="setting-desc">æé†’AIéµå¾ªæ ¼å¼è¦æ±‚ï¼Œå¼€å¯åä¼šå¤šæ¶ˆè€—ä¸€äº›token</div>
                                        </div>
                                        <div class="setting-right">
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="format-optimization-enabled">
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="setting-item">
                                        <div class="setting-left">
                                            <div class="setting-label">æ˜¾ç¤ºæ—¶é—´æˆ³</div>
                                            <div class="setting-desc">åœ¨èŠå¤©æ¶ˆæ¯ä¸­æ˜¾ç¤ºæ—¶é—´ä¿¡æ¯</div>
                                        </div>
                                        <div class="setting-right">
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="timestamp-enabled" checked>
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="setting-item" onclick="showTimestampSettings()">
                                        <div class="setting-left">
                                            <div class="setting-label">æ—¶é—´æˆ³è®¾ç½®</div>
                                            <div class="setting-desc">è®¾ç½®æ—¶é—´æˆ³æ˜¾ç¤ºä½ç½®å’Œæ ¼å¼</div>
                                        </div>
                                        <div class="setting-right">
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                    <div class="setting-item" onclick="searchChatContent()">
                                        <div class="setting-left">
                                            <div class="setting-label">æŸ¥æ‰¾èŠå¤©å†…å®¹</div>
                                            <div class="setting-desc">æœç´¢å†å²æ¶ˆæ¯ä¸­çš„å…³é”®è¯</div>
                                        </div>
                                        <div class="setting-right">
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                    <div class="setting-item" onclick="showExportOptions()">
                                        <div class="setting-left">
                                            <div class="setting-label">å¯¼å‡ºèŠå¤©è®°å½•</div>
                                            <div class="setting-desc">å¯¼å‡ºå½“å‰è§’è‰²çš„å®Œæ•´æ•°æ®</div>
                                        </div>
                                        <div class="setting-right">
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                    <div class="setting-item" onclick="showImportOptions()">
                                        <div class="setting-left">
                                            <div class="setting-label">å¯¼å…¥èŠå¤©è®°å½•</div>
                                            <div class="setting-desc">å¯¼å…¥è§’è‰²çš„å®Œæ•´æ•°æ®</div>
                                        </div>
                                        <div class="setting-right">
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <!-- ğŸ”¥ã€æ–°å¢ã€‘è§’è‰²ä¸“å±éŸ³æ•ˆè®¾ç½® -->
                            <div class="settings-section" id="character-sound-settings" style="display: none;">
                                <div class="section-header">
                                    <i class="fas fa-volume-up section-icon"></i>
                                    <span class="section-title">ä¸“å±éŸ³æ•ˆ</span>
                                </div>
                                <div class="setting-card">
                                    <div class="setting-item">
                                        <div class="setting-left">
                                            <div class="setting-label">å¯ç”¨ä¸“å±éŸ³æ•ˆ</div>
                                            <div class="setting-desc">ä¸ºè¯¥è§’è‰²è®¾ç½®ç‹¬ç‰¹çš„éŸ³æ•ˆ</div>
                                        </div>
                                        <div class="setting-right">
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="character-sound-enabled" onchange="toggleCharacterSounds()">
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>

                                    <div id="character-sound-list" style="display: none;">
                                        <!-- æ¥æ”¶æ¶ˆæ¯éŸ³æ•ˆ -->
                                        <div class="character-sound-item">
                                            <div class="character-sound-header">
                                                <h4>æ¥æ”¶æ¶ˆæ¯éŸ³æ•ˆ</h4>
                                                <p>è¯¥è§’è‰²å‘æ¶ˆæ¯æ—¶æ’­æ”¾çš„éŸ³æ•ˆ</p>
                                            </div>
                                            <div class="character-sound-controls">
                                                <input type="url" class="sound-url-input" id="character-messageReceived-url" placeholder="è¾“å…¥éŸ³æ•ˆé“¾æ¥">
                                                <input type="file" id="character-messageReceived-file" accept="audio/*,.mp3,.m4a,.wav,.aac,.ogg,.flac" style="display: none;" onchange="handleCharacterSoundFileUpload(this, 'messageReceived')">
                                                <button onclick="document.getElementById('character-messageReceived-file').click()" class="sound-file-btn">
                                                    <i class="fas fa-upload"></i> æœ¬åœ°æ–‡ä»¶
                                                </button>
                                                <button onclick="testCharacterSound('messageReceived')" class="sound-test-btn">
                                                    <i class="fas fa-play"></i> è¯•å¬
                                                </button>
                                                <button onclick="clearCharacterSound('messageReceived')" class="sound-clear-btn">
                                                    <i class="fas fa-trash"></i> æ¸…é™¤
                                                </button>
                                            </div>
                                        </div>

                                        <!-- æ¥ç”µéŸ³æ•ˆ -->
                                        <div class="character-sound-item">
                                            <div class="character-sound-header">
                                                <h4>æ¥ç”µéŸ³æ•ˆ</h4>
                                                <p>è¯¥è§’è‰²æ‹¨æ‰“è¯­éŸ³/è§†é¢‘é€šè¯æ—¶æ’­æ”¾çš„éŸ³æ•ˆ</p>
                                            </div>
                                            <div class="character-sound-controls">
                                                <input type="url" class="sound-url-input" id="character-incomingCall-url" placeholder="è¾“å…¥éŸ³æ•ˆé“¾æ¥">
                                                <input type="file" id="character-incomingCall-file" accept="audio/*,.mp3,.m4a,.wav,.aac,.ogg,.flac" style="display: none;" onchange="handleCharacterSoundFileUpload(this, 'incomingCall')">
                                                <button onclick="document.getElementById('character-incomingCall-file').click()" class="sound-file-btn">
                                                    <i class="fas fa-upload"></i> æœ¬åœ°æ–‡ä»¶
                                                </button>
                                                <button onclick="testCharacterSound('incomingCall')" class="sound-test-btn">
                                                    <i class="fas fa-play"></i> è¯•å¬
                                                </button>
                                                <button onclick="clearCharacterSound('incomingCall')" class="sound-clear-btn">
                                                    <i class="fas fa-trash"></i> æ¸…é™¤
                                                </button>
                                            </div>
                                        </div>

                                        <!-- æ¨é€é€šçŸ¥éŸ³æ•ˆ -->
                                        <div class="character-sound-item">
                                            <div class="character-sound-header">
                                                <h4>æ¨é€é€šçŸ¥éŸ³æ•ˆ</h4>
                                                <p>æ”¶åˆ°è¯¥è§’è‰²æ¨é€é€šçŸ¥æ—¶æ’­æ”¾çš„éŸ³æ•ˆ</p>
                                            </div>
                                            <div class="character-sound-controls">
                                                <input type="url" class="sound-url-input" id="character-notification-url" placeholder="è¾“å…¥éŸ³æ•ˆé“¾æ¥">
                                                <input type="file" id="character-notification-file" accept="audio/*,.mp3,.m4a,.wav,.aac,.ogg,.flac" style="display: none;" onchange="handleCharacterSoundFileUpload(this, 'notification')">
                                                <button onclick="document.getElementById('character-notification-file').click()" class="sound-file-btn">
                                                    <i class="fas fa-upload"></i> æœ¬åœ°æ–‡ä»¶
                                                </button>
                                                <button onclick="testCharacterSound('notification')" class="sound-test-btn">
                                                    <i class="fas fa-play"></i> è¯•å¬
                                                </button>
                                                <button onclick="clearCharacterSound('notification')" class="sound-clear-btn">
                                                    <i class="fas fa-trash"></i> æ¸…é™¤
                                                </button>
                                            </div>
                                        </div>

                                        <!-- é™éŸ³é€‰é¡¹ -->
                                        <div class="setting-item">
                                            <div class="setting-left">
                                                <div class="setting-label">é™éŸ³æ¨¡å¼</div>
                                                <div class="setting-desc">è¯¥è§’è‰²çš„æ‰€æœ‰éŸ³æ•ˆéƒ½é™éŸ³</div>
                                            </div>
                                            <div class="setting-right">
                                                <label class="toggle-switch">
                                                    <input type="checkbox" id="character-silent-mode" onchange="toggleCharacterSilentMode()">
                                                    <span class="toggle-slider"></span>
                                                </label>
                                            </div>
                                        </div>

                                        <div class="character-sound-note">
                                            <p><i class="fas fa-info-circle"></i> <strong>éŸ³æ•ˆä¼˜å…ˆçº§ï¼š</strong>é™éŸ³æ¨¡å¼ > ä¸“å±éŸ³æ•ˆ > å…¨å±€éŸ³æ•ˆ</p>
                                            <p><i class="fas fa-info-circle"></i> æ”¯æŒåœ¨çº¿é“¾æ¥å’Œæœ¬åœ°æ–‡ä»¶ï¼ˆæœ€å¤§3MBï¼‰</p>
                                            <p><i class="fas fa-info-circle"></i> æ”¯æŒå¸¸è§éŸ³é¢‘æ ¼å¼ï¼šMP3ã€WAVã€OGGç­‰</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- å±é™©æ“ä½œ -->
                            <div class="settings-section">
                                <div class="section-header">
                                                    <i class="fas fa-exclamation-triangle section-icon danger-section-icon"></i>
                <span class="section-title danger-section-title">å±é™©æ“ä½œ</span>
                                </div>
                                <div class="setting-card">
                                    <div class="setting-item" onclick="showBlacklistSettings()">
                                        <div class="setting-left">
                                            <div class="setting-label" id="block-manage-label">æ‹‰é»‘ç®¡ç†</div>
                                            <div class="setting-desc" id="block-manage-desc">æ‹‰é»‘/è§£é™¤æ‹‰é»‘ç®¡ç†</div>
                                        </div>
                                        <div class="setting-right">
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                    <div class="setting-item" onclick="clearChatHistory()">
                                        <div class="setting-left">
                                            <div class="setting-label">æ¸…ç©ºèŠå¤©è®°å½•</div>
                                            <div class="setting-desc">åˆ é™¤æ‰€æœ‰å†å²æ¶ˆæ¯ï¼Œä¸å¯æ¢å¤</div>
                                        </div>
                                        <div class="setting-right">
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- äººç‰©ç¼–è¾‘è¡¨å• -->
                <div id="character-form-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="hideCharacterForm()">â€¹</button>
                        <div class="app-title" id="character-form-title">æ–°å»ºäººç‰©</div>
                    </div>
                    <div class="app-content">
                        <div class="character-form">
                            <div class="form-group avatar-upload">
                                <label class="form-label">å¤´åƒ</label>
                                <div class="avatar-preview" id="avatar-preview">
                                    <div class="avatar-preview-text" id="avatar-preview-text">A</div>
                                </div>
                                <button class="upload-button" onclick="handleAvatarUploadClick()">ä¸Šä¼ å¤´åƒ</button>
                            </div>

                            <div class="form-group">
                                <label class="form-label">å§“å <span style="color: #999; font-size: 12px; font-weight: normal; margin-left: 8px;">ç¦æ­¢ä½¿ç”¨é…’é¦†Sillytavernè§’è‰²å¡</span></label>
                                <input type="text" class="form-input" id="character-name" placeholder="è¾“å…¥å§“å">
                            </div>
                            <div class="form-group">
                                <label class="form-label">äººè®¾</label>
                                <textarea class="form-textarea" id="character-bio" placeholder="è¾“å…¥äººç‰©è®¾å®š"></textarea>
                            </div>

                            <!-- ğŸ”¥ã€æ–°å¢ã€‘å¼€åœºç™½ç®¡ç†åŒºåŸŸ -->
                            <div class="form-group">
                                <label class="form-label">å¼€åœºç™½ï¼ˆå¯é€‰ï¼‰</label>
                                <div class="form-hint">åˆ›å»ºå¯¹è¯æ—¶å¯é€‰æ‹©ä½¿ç”¨å¼€åœºç™½ï¼Œè§’è‰²ä¼šæŒ‰é¡ºåºå‘é€æ¯æ¡æ¶ˆæ¯</div>

                                <div id="greetings-list" class="greetings-list">
                                    <!-- å¼€åœºç™½åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                </div>

                                <button type="button" class="add-greeting-btn" onclick="addGreetingGroup()">
                                    <i class="fas fa-plus"></i> æ·»åŠ å¼€åœºç™½
                                </button>
                            </div>

                            <!-- ğŸ”¥ã€æ–°å¢ã€‘MiniMax è¯­éŸ³é…ç½®åŒºåŸŸ -->
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-microphone"></i> MiniMax è¯­éŸ³ IDï¼ˆå¯é€‰ï¼‰
                                </label>
                                <div class="form-hint">å¡«å†™ MiniMax å…‹éš†è¯­éŸ³çš„ voice_idï¼Œç”¨äºè¯­éŸ³æ¡ã€é€šè¯ã€é™ªä¼´æ¨¡å¼</div>

                                <!-- Voice ID è¾“å…¥ -->
                                <input type="text" class="form-input" id="character-voice-id" placeholder="è¾“å…¥ MiniMax voice_idï¼ˆä¾‹å¦‚ï¼šyour_voice_id_hereï¼‰">

                                <div class="form-hint" style="margin-top: 8px; font-size: 12px; color: #999;">
                                    ğŸ’¡ åœ¨ <a href="https://www.minimaxi.com" target="_blank" style="color: #4a84c1;">MiniMax å¹³å°</a> å…‹éš†å£°éŸ³åè·å– voice_id
                                </div>

                                <!-- ğŸ”¥ã€æ–°å¢ã€‘è¯­é€Ÿè®¾ç½® -->
                                <div style="margin-top: 15px;">
                                    <label class="form-label" style="display: block; margin-bottom: 8px;">
                                        <i class="fas fa-tachometer-alt"></i> è¯­éŸ³è¯­é€Ÿ: <span id="character-voice-speed-value">1.0</span>x
                                    </label>
                                    <input type="range" id="character-voice-speed" min="0.5" max="2.0" value="1.0" step="0.1"
                                           style="width: 100%; cursor: pointer;"
                                           oninput="document.getElementById('character-voice-speed-value').textContent = this.value">
                                    <div class="form-hint">è°ƒæ•´è§’è‰²è¯­éŸ³æ’­æ”¾çš„è¯­é€Ÿï¼ˆ0.5å€ - 2.0å€ï¼‰</div>
                                </div>

                                <!-- ğŸ”¥ã€æ–°å¢ã€‘è¯­è¨€å¢å¼ºè®¾ç½® -->
                                <div style="margin-top: 15px;">
                                    <label class="form-label" style="display: block; margin-bottom: 8px;">
                                        <i class="fas fa-language"></i> è¯­è¨€è®¾ç½®ï¼ˆå¯é€‰ï¼‰
                                    </label>
                                    <select class="form-input" id="character-language-boost">
                                        <option value="">ä¸è®¾ç½®ï¼ˆé»˜è®¤ï¼‰</option>
                                        <option value="Chinese">ä¸­æ–‡ï¼ˆæ™®é€šè¯ï¼‰</option>
                                        <option value="Chinese,Yue">ç²¤è¯­</option>
                                        <option value="English">è‹±è¯­</option>
                                        <option value="Japanese">æ—¥è¯­</option>
                                        <option value="Korean">éŸ©è¯­</option>
                                        <option value="French">æ³•è¯­</option>
                                        <option value="German">å¾·è¯­</option>
                                        <option value="Spanish">è¥¿ç­ç‰™è¯­</option>
                                        <option value="Russian">ä¿„è¯­</option>
                                        <option value="Italian">æ„å¤§åˆ©è¯­</option>
                                        <option value="Portuguese">è‘¡è„ç‰™è¯­</option>
                                        <option value="Arabic">é˜¿æ‹‰ä¼¯è¯­</option>
                                        <option value="Thai">æ³°è¯­</option>
                                        <option value="Vietnamese">è¶Šå—è¯­</option>
                                        <option value="Indonesian">å°å°¼è¯­</option>
                                        <option value="Hindi">å°åœ°è¯­</option>
                                    </select>
                                    <div class="form-hint">é»˜è®¤ä½¿ç”¨ä¸­æ–‡ï¼ˆæ™®é€šè¯ï¼‰ï¼Œå¦‚éœ€è°ƒç”¨å…¶ä»–è¯­è¨€ï¼Œè¯·é€‰æ‹©å¯¹åº”è¯­è¨€ä»¥ç¡®ä¿æ­£ç¡®å‘éŸ³åŠæ›´å¥½çš„è¯­éŸ³ä½“éªŒã€‚</div>
                                </div>
                            </div>

                            <div class="form-actions form-actions-flex">
                                <button class="form-submit form-submit-flex">ä¿å­˜</button>
                                <button class="form-delete form-delete-red hidden" id="character-delete-btn" onclick="deleteCurrentCharacter()">åˆ é™¤</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å»ºäººç‰©ç•Œé¢æ–‡ä»¶è¾“å…¥æ¡†ã€‘æ”¾åœ¨ç•Œé¢å¤–é¢ï¼Œé¿å…åœ¨æŸäº›è®¾å¤‡ä¸Šæ˜¾ç¤º -->
                <input type="file" id="avatar-upload" accept="image/*" style="display: none;">
                <input type="file" id="character-card-upload" accept="*/*" style="display: none;">

                <!-- é¢å…·åˆ›å»ºè¡¨å• -->
                <div id="persona-form-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="hidePersonaForm()">â€¹</button>
                        <div class="app-title" id="persona-form-title">æ–°å»ºé¢å…·</div>
                    </div>
                    <div class="app-content">
                        <div class="character-form">
                            <div class="form-group avatar-upload">
                                <label class="form-label">å¤´åƒ</label>
                                <div class="avatar-preview" id="persona-avatar-preview">
                                    <div class="avatar-preview-text" id="persona-avatar-preview-text">æˆ‘</div>
                                </div>
                                <button class="upload-button" onclick="handlePersonaAvatarUploadClick()">ä¸Šä¼ å¤´åƒ</button>
                            </div>

                            <div class="form-group">
                                <label class="form-label">æˆ‘çš„åç§°</label>
                                <input type="text" class="form-input" id="persona-name" placeholder="ä¾‹å¦‚ï¼šå°æ˜ã€å­¦ç”Ÿã€å·¥ä½œè€…">
                            </div>

                            <div class="form-group">
                                <label class="form-label">æˆ‘çš„æè¿°</label>
                                <textarea class="form-textarea" id="persona-description" placeholder="ä»‹ç»ä¸€ä¸‹è‡ªå·±..."></textarea>
                            </div>

                            <!-- ğŸ”¥ã€æ–°å¢ã€‘MiniMax è¯­éŸ³è®¾ç½® -->
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-microphone"></i> MiniMax è¯­éŸ³ IDï¼ˆå¯é€‰ï¼‰
                                </label>
                                <input type="text" class="form-input" id="persona-voice-id" placeholder="è¾“å…¥ MiniMax voice_id">
                                <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                                    <i class="fas fa-lightbulb" style="color: #f39c12;"></i> åœ¨ MiniMax å¹³å°å…‹éš†è¯­éŸ³åè·å– voice_idï¼Œç”¨äºè¯­éŸ³æ¡æ’­æ”¾
                                </small>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-volume-up"></i> è¯­éŸ³è¯­é€Ÿ: <span id="persona-voice-speed-value">1x</span>
                                </label>
                                <input type="range" class="form-range" id="persona-voice-speed" min="0.5" max="2" step="0.1" value="1" oninput="updatePersonaVoiceSpeedDisplay(this.value)">
                                <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                                    è°ƒæ•´è§’è‰²è¯­éŸ³æ’­æ”¾çš„è¯­é€Ÿï¼ˆ0.5å€ - 2.0å€ï¼‰
                                </small>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-cog"></i> è¯­éŸ³è¯­è¨€å¢å¼ºï¼ˆå¯é€‰ï¼‰
                                </label>
                                <select class="form-select" id="persona-voice-setting">
                                    <option value="">ä¸è®¾ç½®ï¼ˆé»˜è®¤ï¼‰</option>
                                    <option value="Chinese">ä¸­æ–‡ï¼ˆæ™®é€šè¯ï¼‰</option>
                                    <option value="Chinese,Yue">ä¸­æ–‡ï¼ˆç²¤è¯­ï¼‰</option>
                                    <option value="English">è‹±è¯­</option>
                                    <option value="Japanese">æ—¥è¯­</option>
                                    <option value="Korean">éŸ©è¯­</option>
                                    <option value="French">æ³•è¯­</option>
                                    <option value="German">å¾·è¯­</option>
                                    <option value="Spanish">è¥¿ç­ç‰™è¯­</option>
                                    <option value="Russian">ä¿„è¯­</option>
                                    <option value="Italian">æ„å¤§åˆ©è¯­</option>
                                    <option value="Portuguese">è‘¡è„ç‰™è¯­</option>
                                    <option value="Arabic">é˜¿æ‹‰ä¼¯è¯­</option>
                                    <option value="Thai">æ³°è¯­</option>
                                    <option value="Vietnamese">è¶Šå—è¯­</option>
                                    <option value="Indonesian">å°å°¼è¯­</option>
                                    <option value="Hindi">å°åœ°è¯­</option>
                                </select>
                                <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                                    <i class="fas fa-info-circle"></i> é€‰æ‹©è¯­è¨€å¯æå‡è¯¥è¯­è¨€çš„å‘éŸ³å‡†ç¡®åº¦ï¼ˆéœ€é…åˆ voice_id ä½¿ç”¨ï¼‰
                                </small>
                            </div>

                            <button class="form-submit" onclick="savePersona()">ä¿å­˜é¢å…·</button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å»ºé¢å…·ç•Œé¢æ–‡ä»¶è¾“å…¥æ¡†ã€‘æ”¾åœ¨ç•Œé¢å¤–é¢ï¼Œé¿å…åœ¨æŸäº›è®¾å¤‡ä¸Šæ˜¾ç¤º -->
                <input type="file" id="persona-avatar-upload" accept="image/*" style="display: none;">

                <!-- è¡¨æƒ…åŒ…åº“ä¸Šä¼ æ–‡ä»¶è¾“å…¥æ¡† -->
                <input type="file" id="emoji-library-upload" accept="image/*" multiple style="display: none;">

                <!-- è¡¨æƒ…åŒ…åº“å¯¼å…¥æ–‡ä»¶è¾“å…¥æ¡† -->
                <input type="file" id="emoji-library-import" accept="*/*" style="display: none;">

                <!-- è¡¨æƒ…åŒ…åº“ç®¡ç†ç•Œé¢ -->
                <div id="emoji-library-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="hideEmojiLibraryScreen()">â€¹</button>
                        <div class="app-title" id="emoji-library-title">è¡¨æƒ…åŒ…åº“</div>
                        <div class="emoji-library-delete-btn" onclick="startEmojiSelection()" title="æ‰¹é‡åˆ é™¤è¡¨æƒ…åŒ…" id="start-selection-btn">
                            <i class="fas fa-trash"></i>
                        </div>
                        <div class="emoji-selection-buttons" id="selection-buttons" style="display: none;">
                            <button onclick="selectAllEmojis()" title="å…¨é€‰">å…¨é€‰</button>
                            <button onclick="deleteSelectedEmojis()" title="åˆ é™¤é€‰ä¸­">åˆ é™¤</button>
                            <button onclick="cancelSelection()" title="å–æ¶ˆ">å–æ¶ˆ</button>
                        </div>
                    </div>
                    <div class="app-content emoji-library-content-area">
                        <!-- ä¸Šä¼ åŒºåŸŸ -->
                        <div class="emoji-library-upload-area-small" id="emoji-library-upload-area" onclick="triggerEmojiUpload()">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 20px; color: #6B9BD2; margin-bottom: 5px;"></i>
                            <p style="margin: 0; font-size: 14px; color: #333;">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ è¡¨æƒ…åŒ…</p>
                            <p style="margin: 2px 0 0 0; font-size: 11px; color: #666;">æ”¯æŒ JPGã€PNGã€GIF æ ¼å¼</p>
                        </div>

                        <!-- ğŸ”¥ã€æ–°å¢ã€‘URLå›¾åºŠè¾“å…¥åŒºåŸŸ -->
                        <div class="emoji-url-input-area">
                            <div class="url-input-header">
                                <i class="fas fa-link" style="color: #6B9BD2; margin-right: 5px;"></i>
                                <span>ä»å›¾åºŠURLæ·»åŠ è¡¨æƒ…åŒ…</span>
                                <div class="url-input-mode-toggle">
                                    <button id="single-mode-btn" class="mode-btn active" onclick="switchUrlInputMode('single')">å•ä¸ª</button>
                                    <button id="batch-mode-btn" class="mode-btn" onclick="switchUrlInputMode('batch')">æ‰¹é‡</button>
                                </div>
                            </div>

                            <!-- å•ä¸ªURLè¾“å…¥æ¨¡å¼ -->
                            <div id="single-url-input" class="url-input-mode">
                                <div class="emoji-url-input-container">
                                    <input type="url" id="emoji-url-input" placeholder="ç²˜è´´å›¾ç‰‡URLåœ°å€..." class="url-input">
                                    <button onclick="addEmojiFromUrl()" class="url-add-btn">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <p class="url-input-tip">æ”¯æŒç›´é“¾å›¾ç‰‡URLï¼Œå¦‚ï¼šhttps://example.com/image.jpg</p>
                            </div>

                            <!-- æ‰¹é‡URLè¾“å…¥æ¨¡å¼ -->
                            <div id="batch-url-input" class="url-input-mode" style="display: none;">
                                <div class="batch-input-container">
                                    <textarea id="batch-emoji-input" placeholder="æ‰¹é‡å¯¼å…¥æ ¼å¼ç¤ºä¾‹ï¼š&#10;https://i.postimg.cc/è¡¥å……æè¿°&#10;å¼€å¿ƒï¼šxxx/IMG-xxx.jpg&#10;ä¼¤å¿ƒï¼šxxx/xxx.jpg&#10;æ”¯æŒæ ¼å¼ï¼š&#10;1. æè¿°ï¼šURLè·¯å¾„&#10;2. æè¿° URLè·¯å¾„&#10;3. å®Œæ•´URLï¼ˆè‡ªåŠ¨æå–æ–‡ä»¶åä½œä¸ºæè¿°ï¼‰" class="batch-textarea"></textarea>
                                    <div class="batch-input-actions">
                                        <button onclick="previewBatchEmojis()" class="batch-preview-btn">
                                            <i class="fas fa-eye"></i> é¢„è§ˆ
                                        </button>
                                        <button onclick="importBatchEmojis()" class="batch-import-btn">
                                            <i class="fas fa-download"></i> å¯¼å…¥
                                        </button>
                                    </div>
                                </div>
                                <p class="url-input-tip">æ”¯æŒå¤šç§æ ¼å¼ï¼Œè‡ªåŠ¨è¯†åˆ«URLå‰ç¼€å’Œæè¿°</p>
                            </div>
                        </div>

                        <!-- è¡¨æƒ…åŒ…åº“ç»Ÿè®¡ä¿¡æ¯ -->
                        <div class="emoji-library-stats" id="emoji-library-stats" style="display: none;">
                            <div class="stats-item">
                                <span class="stats-label">æ€»æ•°ï¼š</span>
                                <span class="stats-value" id="total-emojis">0</span>
                            </div>
                            <div class="stats-item">
                                <span class="stats-label">å·²è®¾ç½®æè¿°ï¼š</span>
                                <span class="stats-value" id="described-emojis">0</span>
                            </div>
                            <div class="stats-item warning" id="undescribed-warning" style="display: none;">
                                <span class="stats-label">âš ï¸ æœªè®¾ç½®æè¿°ï¼š</span>
                                <span class="stats-value" id="undescribed-emojis">0</span>
                            </div>
                        </div>

                        <div class="emoji-library-grid" id="emoji-library-grid">
                            <!-- è¡¨æƒ…åŒ…ç½‘æ ¼å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>

                        <div class="emoji-library-empty" id="emoji-library-empty" style="display: none;">
                            <i class="fas fa-smile"></i>
                            <p>è¿™ä¸ªè¡¨æƒ…åŒ…åº“è¿˜æ˜¯ç©ºçš„</p>
                            <p>ç‚¹å‡»ä¸Šæ–¹åŒºåŸŸä¸Šä¼ è¡¨æƒ…åŒ…</p>
                        </div>
                    </div>
                </div>

                <!-- è¡¨æƒ…åŒ…åº“åˆ›å»º/ç¼–è¾‘è¡¨å• -->
                <div id="emoji-library-form-modal" class="modal-overlay" style="display: none;" onclick="hideEmojiLibraryForm(event)">
                    <div class="modal-content emoji-library-form-modal" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3 id="emoji-library-form-title">æ–°å»ºè¡¨æƒ…åŒ…åº“</h3>
                            <button class="modal-close-btn" onclick="hideEmojiLibraryForm()">Ã—</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">åº“åç§°</label>
                                <input type="text" class="form-input" id="emoji-library-name-input" placeholder="ä¾‹å¦‚ï¼šå¯çˆ±åŠ¨ç‰©ã€æç¬‘è¡¨æƒ…ã€æ—¥å¸¸èŠå¤©">
                            </div>
                            <div class="form-group">
                                <label class="form-label">æè¿°ï¼ˆå¯é€‰ï¼‰</label>
                                <textarea class="form-textarea" id="emoji-library-description-input" placeholder="æè¿°è¿™ä¸ªè¡¨æƒ…åŒ…åº“çš„ç”¨é€”å’Œç‰¹ç‚¹..." rows="3"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-btn cancel-btn" onclick="hideEmojiLibraryForm()">å–æ¶ˆ</button>
                            <button class="modal-btn confirm-btn" id="emoji-library-save-btn" onclick="saveEmojiLibrary()">ä¿å­˜</button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘ä¹¦æ¶ç®¡ç†ç•Œé¢ -->
                <div id="bookshelf-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="hideBookshelfScreen()">â€¹</button>
                        <div class="app-title">æˆ‘çš„ä¹¦æ¶</div>
                        <div class="bookshelf-upload-btn" onclick="triggerBookUpload()" title="ä¸Šä¼ ä¹¦ç±">
                            <i class="fas fa-upload"></i>
                        </div>
                        <div class="bookshelf-delete-btn" onclick="startBookSelection()" title="æ‰¹é‡åˆ é™¤ä¹¦ç±" id="start-book-selection-btn">
                            <i class="fas fa-trash"></i>
                        </div>
                        <div class="book-selection-buttons" id="book-selection-buttons" style="display: none;">
                            <button onclick="selectAllBooks()" title="å…¨é€‰">å…¨é€‰</button>
                            <button onclick="deleteSelectedBooks()" title="åˆ é™¤é€‰ä¸­">åˆ é™¤</button>
                            <button onclick="cancelBookSelection()" title="å–æ¶ˆ">å–æ¶ˆ</button>
                        </div>
                    </div>
                    <div class="app-content bookshelf-content-area">

                        <!-- ä¹¦ç±ç½‘æ ¼ -->
                        <div class="bookshelf-grid" id="bookshelf-grid">
                            <!-- ä¹¦ç±å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>

                        <!-- ç©ºçŠ¶æ€ -->
                        <div class="bookshelf-empty" id="bookshelf-empty">
                            <i class="fas fa-book"></i>
                            <p>ä¹¦æ¶è¿˜æ˜¯ç©ºçš„</p>
                            <p>ç‚¹å‡»å³ä¸Šè§’å¯¼å…¥æŒ‰é’®ä¸Šä¼ ä¹¦ç±</p>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘ä¹¦ç±ä¸Šä¼ æ–‡ä»¶è¾“å…¥æ¡† -->
                <input type="file" id="book-upload-input" accept=".txt" style="display: none;">

                <!-- ğŸ”¥ã€æ–°å¢ã€‘æˆ‘çš„æ”¶è—ç•Œé¢ -->
                <!-- ğŸ”¥ã€ä¿®å¤ã€‘æˆ‘çš„æ”¶è—ç•Œé¢ - æ·»åŠ app-top-containerä¿æŒå¸ƒå±€ä¸€è‡´ -->
                <div id="favorites-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                                <div class="app-battery-container">
                                    <div class="app-battery-icon">
                                        <div class="app-battery-level"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="app-header">
                            <button class="back-button" onclick="hideFavoritesScreen()">â€¹</button>
                            <div class="app-title">æˆ‘çš„æ”¶è—</div>
                            <!-- ğŸ”¥ã€ä¿®å¤ã€‘åƒåœ¾æ¡¶æŒ‰é’®å’Œé€‰æ‹©æŒ‰é’®ç»„ - ä½¿ç”¨ç»å¯¹å®šä½ -->
                            <div class="favorites-delete-btn" onclick="startFavoriteSelection()" title="æ‰¹é‡åˆ é™¤" id="start-favorite-selection-btn">
                                <i class="fas fa-trash"></i>
                            </div>
                            <div class="favorite-selection-buttons" id="favorite-selection-buttons" style="display: none;">
                                <button onclick="selectAllFavorites()" title="å…¨é€‰">å…¨é€‰</button>
                                <button onclick="deleteSelectedFavorites()" title="åˆ é™¤é€‰ä¸­">åˆ é™¤</button>
                                <button onclick="cancelFavoriteSelection()" title="å–æ¶ˆ">å–æ¶ˆ</button>
                            </div>
                        </div>
                    </div>
                    <div class="app-content favorites-content-area">
                        <!-- æ”¶è—åˆ—è¡¨ -->
                        <div class="favorites-list" id="favorites-list">
                            <!-- æ”¶è—æ¶ˆæ¯å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>

                        <!-- ç©ºçŠ¶æ€ -->
                        <div class="favorites-empty" id="favorites-empty">
                            <i class="fas fa-star"></i>
                            <p>è¿˜æ²¡æœ‰æ”¶è—ä»»ä½•æ¶ˆæ¯</p>
                            <p>é•¿æŒ‰èŠå¤©æ¶ˆæ¯å³å¯æ”¶è—</p>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€ä¿®å¤ã€‘æˆ‘çš„é’±åŒ…ç•Œé¢ - æ·»åŠ app-top-containerå¹¶ä¿®å¤æ˜ç»†æŒ‰é’®å®šä½ -->
                <div id="wallet-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                                <div class="app-battery-container">
                                    <div class="app-battery-icon">
                                        <div class="app-battery-level"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="app-header">
                            <button class="back-button" onclick="hideWalletScreen()">â€¹</button>
                            <div class="app-title">æˆ‘çš„é’±åŒ…</div>
                            <!-- ğŸ”¥ã€ä¿®å¤ã€‘æ˜ç»†æŒ‰é’® - ä½¿ç”¨ç»å¯¹å®šä½ï¼Œé»‘è‰²æ— èƒŒæ™¯ -->
                            <button class="wallet-detail-btn" onclick="showWalletDetails()">æ˜ç»†</button>
                        </div>
                    </div>
                    <div class="app-content wallet-content-area">
                        <!-- ğŸ”¥ã€ä¿®å¤ã€‘é’±åŒ…ä½™é¢æ˜¾ç¤º - å»æ‰ç¼–è¾‘æŒ‰é’® -->
                        <div class="wallet-balance-section">
                            <div class="wallet-icon">
                                <i class="fas fa-yen-sign"></i>
                            </div>
                            <div class="wallet-balance-label">æˆ‘çš„é›¶é’±</div>
                            <div class="wallet-balance-amount">
                                <span id="wallet-balance">Â¥ 0.00</span>
                            </div>
                        </div>

                        <!-- å……å€¼å’Œæç°æŒ‰é’® -->
                        <div class="wallet-actions">
                            <button class="wallet-action-btn recharge-btn" onclick="showRechargeDialog()">
                                å……å€¼
                            </button>
                            <button class="wallet-action-btn withdraw-btn" onclick="showWithdrawDialog()">
                                æç°
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€ä¿®å¤ã€‘é’±åŒ…æ˜ç»†ç•Œé¢ - æ·»åŠ app-top-container -->
                <div id="wallet-details-screen" class="app-screen" style="display: none;">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                                <div class="app-battery-container">
                                    <div class="app-battery-icon">
                                        <div class="app-battery-level"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="app-header">
                            <button class="back-button" onclick="hideWalletDetails()">â€¹</button>
                            <div class="app-title">é›¶é’±æ˜ç»†</div>
                        </div>
                    </div>
                    <div class="app-content wallet-details-content">
                        <!-- äº¤æ˜“è®°å½•åˆ—è¡¨ -->
                        <div class="wallet-transactions-list" id="wallet-transactions-list">
                            <!-- äº¤æ˜“è®°å½•å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>

                        <!-- ç©ºçŠ¶æ€ -->
                        <div class="wallet-transactions-empty" id="wallet-transactions-empty">
                            <i class="fas fa-receipt"></i>
                            <p>æš‚æ— äº¤æ˜“è®°å½•</p>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘Taçš„é™ªä¼´ç•Œé¢ - æ—¥å†è§†å›¾ -->
                <div id="companion-stats-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                                <div class="app-battery-container">
                                    <div class="app-battery-icon">
                                        <div class="app-battery-level"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="app-header">
                            <button class="back-button" onclick="hideCompanionStats()">â€¹</button>
                            <div class="app-title">Taçš„é™ªä¼´</div>
                        </div>
                    </div>
                    <div class="app-content companion-stats-content">
                        <!-- å¹´æœˆé€‰æ‹©å™¨ -->
                        <div class="companion-calendar-controls">
                            <button class="calendar-prev-btn" onclick="prevCompanionMonth()">â€¹</button>
                            <div class="calendar-month-year" id="companion-calendar-month-year">2024å¹´10æœˆ</div>
                            <button class="calendar-next-btn" onclick="nextCompanionMonth()">â€º</button>
                        </div>

                        <!-- æ—¥å†è§†å›¾ -->
                        <div class="companion-calendar" id="companion-calendar">
                            <!-- æ—¥å†å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>

                        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                        <div class="companion-stats-info">
                            <div class="companion-stats-item">
                                <div class="companion-stats-label">æœ¬æœˆé™ªä¼´</div>
                                <div class="companion-stats-value" id="companion-stats-month">0å°æ—¶</div>
                            </div>
                            <div class="companion-stats-item">
                                <div class="companion-stats-label">ä»Šå¹´é™ªä¼´</div>
                                <div class="companion-stats-value" id="companion-stats-year">0å°æ—¶</div>
                            </div>
                            <div class="companion-stats-item">
                                <div class="companion-stats-label">ç´¯è®¡é™ªä¼´</div>
                                <div class="companion-stats-value" id="companion-stats-total">0å°æ—¶</div>
                            </div>
                        </div>

                        <!-- ç©ºçŠ¶æ€ -->
                        <div class="companion-stats-empty" id="companion-stats-empty" style="display: none;">
                            <i class="fas fa-heart"></i>
                            <p>æš‚æ— é™ªä¼´è®°å½•</p>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘é™ªä¼´è¯¦æƒ…æ¨¡æ€æ¡† -->
                <div id="companion-detail-modal" class="modal" style="display: none;">
                    <div class="modal-content companion-detail-modal">
                        <div class="modal-header">
                            <h2 id="companion-detail-date">2024å¹´10æœˆ19æ—¥</h2>
                            <button class="modal-close" onclick="closeCompanionDetailModal()">Ã—</button>
                        </div>
                        <div class="modal-body" id="companion-detail-list">
                            <!-- é™ªä¼´è¯¦æƒ…å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <!-- APIèŠå¤©ç•Œé¢ -->
                <div id="api-chat-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div id="ai-heartrate-display-center" class="ai-heartrate-display" style="display: none;">â™¥ï¸ 72 bpm</div>
                            <div class="app-status-right">
                                <div id="ai-heartrate-display-right" class="ai-heartrate-display" style="display: none;">â™¥ï¸ 72 bpm</div>
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                                <div class="app-battery-container">
                                    <div class="app-battery-icon">
                                        <div class="app-battery-level"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="header">
                        <div class="default-controls">
                            <button class="back-btn" onclick="backToChatApp().catch(e => console.error('è¿”å›èŠå¤©åº”ç”¨å¤±è´¥:', e))">â€¹</button>
                            <span class="header-title" id="api-chat-title">è§’è‰²èŠå¤©</span>
                            <div class="header-actions">
                                <span class="action-btn" onclick="toggleOfflineMode()" id="offline-mode-btn" title="åˆ‡æ¢çº¿ä¸‹å‰§æƒ…æ¨¡å¼">
                                    <i class="fas fa-door-open" id="offline-mode-icon"></i>
                                </span>
                                <span class="action-btn" onclick="showChatSettings()">
                                <i class="fas fa-ellipsis-v"></i>
                                </span>
                            </div>
                        </div>
                        <div class="selection-controls">
                            <span id="selection-cancel-btn">å–æ¶ˆ</span>
                            <span id="selection-count"></span>
                            <span id="selection-delete-btn">åˆ é™¤</span>
                        </div>
                        <span id="selection-forward-btn" onclick="showForwardTargetModal()" title="è½¬å‘">
                            <i class="fas fa-share"></i>
                        </span>
                        </div>
                    </div>
                    <div class="app-content padding-none-flex">

                        <div class="chat-dialog">
                            <div class="chat-messages" id="api-chat-messages">
                                <!-- èŠå¤©æ¶ˆæ¯å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            </div>


                            <div class="chat-input-area">
                                <!-- å±•å¼€çš„å·¥å…·é¢æ¿ -->
                                <div class="tools-panel" id="tools-panel" style="display: none;">
                                    <div class="tools-grid">
                                        <div class="tool-item" id="regenerate-tool-item" onclick="regenerateLastResponse(); hideToolsPanel();" style="display: none;">
                                            <div class="tool-icon">
                                        <i class="fas fa-redo-alt"></i>
                                            </div>
                                            <span class="tool-label">é‡å›</span>
                                        </div>
                                        <div class="tool-item" onclick="handleVoiceRecording(); hideToolsPanel();">
                                            <div class="tool-icon">
                                        <i class="fas fa-microphone"></i>
                                            </div>
                                            <span class="tool-label">è¯­éŸ³</span>
                                        </div>
                                        <div class="tool-item" onclick="showCustomEmojiPanel(); hideToolsPanel();">
                                            <div class="tool-icon">
                                                <i class="fas fa-smile"></i>
                                            </div>
                                            <span class="tool-label">è¡¨æƒ…</span>
                                        </div>
                                        <div class="tool-item" onclick="openCamera(); hideToolsPanel();">
                                            <div class="tool-icon">
                                        <i class="fas fa-camera"></i>
                                            </div>
                                            <span class="tool-label">æ‹ç…§</span>
                                        </div>
                                        <div class="tool-item" onclick="uploadImage(); hideToolsPanel();">
                                            <div class="tool-icon">
                                        <i class="fas fa-image"></i>
                                            </div>
                                            <span class="tool-label">å›¾ç‰‡</span>
                                        </div>
                                        <div class="tool-item" onclick="openTransfer(); hideToolsPanel();">
                                            <div class="tool-icon">
                                        <i class="fas fa-exchange-alt"></i>
                                            </div>
                                            <span class="tool-label">è½¬è´¦</span>
                                        </div>
                                        <div class="tool-item single-chat-only" onclick="makeCall(); hideToolsPanel();">
                                            <div class="tool-icon">
                                        <i class="fas fa-phone"></i>
                                            </div>
                                            <span class="tool-label">ç”µè¯</span>
                                        </div>
                                        <div class="tool-item single-chat-only" onclick="openVideoCall(); hideToolsPanel();">
                                            <div class="tool-icon">
                                        <i class="fas fa-video"></i>
                                            </div>
                                            <span class="tool-label">è§†é¢‘</span>
                                        </div>
                                        <div class="tool-item" onclick="shareLocation(); hideToolsPanel();">
                                            <div class="tool-icon">
                                        <i class="fas fa-map-marker-alt"></i>
                                            </div>
                                            <span class="tool-label">ä½ç½®</span>
                                        </div>
                                        <div class="tool-item diary-tool" onclick="showDiaryMenu(); hideToolsPanel();">
                                            <div class="tool-icon">
                                        <i class="fas fa-book"></i>
                                            </div>
                                            <span class="tool-label">æ—¥è®°</span>
                                        </div>
                                        <div class="tool-item game-tool single-chat-only" onclick="showGameMenu(); hideToolsPanel();">
                                            <div class="tool-icon">
                                        <i class="fas fa-gamepad"></i>
                                            </div>
                                            <span class="tool-label">æ¸¸æˆ</span>
                                        </div>
                                        <div class="tool-item" onclick="openMusicPlayer(); hideToolsPanel();">
                                            <div class="tool-icon">
                                        <i class="fas fa-headphones"></i>
                                            </div>
                                            <span class="tool-label">å¬æ­Œ</span>
                                        </div>
                                        <div class="tool-item single-chat-only" onclick="openShoppingScreen(); hideToolsPanel();">
                                            <div class="tool-icon">
                                        <i class="fas fa-shopping-cart"></i>
                                            </div>
                                            <span class="tool-label">è´­ç‰©</span>
                                        </div>
                                        <div class="tool-item single-chat-only" onclick="showCharacterFootprints(); hideToolsPanel();">
                                            <div class="tool-icon">
                                        <i class="fas fa-map-marked-alt"></i>
                                            </div>
                                            <span class="tool-label">è¶³è¿¹</span>
                                        </div>
                                        <div class="tool-item single-chat-only" onclick="showCharacterPhone(); hideToolsPanel();">
                                            <div class="tool-icon">
                                        <i class="fas fa-mobile-alt"></i>
                                            </div>
                                            <span class="tool-label">æŸ¥çœ‹</span>
                                        </div>
                                        <div class="tool-item single-chat-only" onclick="showBookshelfForReading(); hideToolsPanel();">
                                            <div class="tool-icon">
                                        <i class="fas fa-book"></i>
                                            </div>
                                            <span class="tool-label">ä¹¦æ¶</span>
                                        </div>
                                        <div class="tool-item single-chat-only" onclick="openCompanionMode(); hideToolsPanel();">
                                            <div class="tool-icon">
                                        <i class="fas fa-heart"></i>
                                            </div>
                                            <span class="tool-label">é™ªä¼´</span>
                                        </div>

                                    </div>
                                </div>

                                <!-- è¾“å…¥åŒºåŸŸ -->
                                <div class="input-controls">
                                <button class="chat-action-btn toggle-tools-btn" onclick="toggleToolsPanel()" title="åŠŸèƒ½èœå•" id="toggle-tools-btn">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <div style="position: relative; flex: 1; min-width: 0;">
                                    <textarea class="chat-input" id="api-chat-input" rows="1" placeholder="è¾“å…¥æ¶ˆæ¯..." maxlength="100000"></textarea>
                                    <!-- @ç¾¤æˆå‘˜ä¸‹æ‹‰é€‰æ‹©æ¡† -->
                                    <div class="mention-dropdown" id="mention-dropdown">
                                        <!-- åŠ¨æ€ç”Ÿæˆç¾¤æˆå‘˜åˆ—è¡¨ -->
                                    </div>
                                </div>
                                    <button class="chat-action-btn" onclick="triggerSmartReply()" title="è·å–AIå›å¤">
                                        <i class="fas fa-comment-dots"></i>
                                </button>
                                <button class="send-button" onclick="handleSendButtonClick()">
                                    å‘é€
                                </button>
                                </div>
                            </div>
                        </div>

                        <!-- è‡ªå®šä¹‰è¡¨æƒ…åŒ…é¢æ¿ -->
                        <div class="custom-emoji-panel" id="custom-emoji-panel">
                            <div class="emoji-tabs">
                                <div class="emoji-tab active" data-tab="recent">æœ€è¿‘</div>
                                <div class="emoji-tab" data-tab="custom">å…¨éƒ¨</div>
                            </div>
                            <div class="emoji-content">
                                <div class="emoji-grid" id="emoji-grid">
                                    <!-- è¡¨æƒ…åŒ…ç½‘æ ¼å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- çº¿ä¸‹å‰§æƒ…æ¨¡å¼è¦†ç›–å±‚ -->
                    <div id="offline-mode-overlay" class="offline-mode-overlay" style="display: none;">
                        <div class="offline-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                                <div class="app-battery-container">
                                    <div class="app-battery-icon">
                                        <div class="app-battery-level"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="offline-mode-header">
                            <button class="back-btn" onclick="exitOfflineMode()">â€¹</button>
                            <!-- ğŸ”¥ã€æ–°å¢ã€‘é»˜è®¤æ§åˆ¶æŒ‰é’® -->
                            <div class="offline-default-controls">
                                <span class="header-title" id="offline-mode-title">çº¿ä¸‹å‰§æƒ…æ¨¡å¼</span>
                            </div>
                            <!-- ğŸ”¥ã€æ–°å¢ã€‘å¤šé€‰æ¨¡å¼æ§åˆ¶æŒ‰é’® -->
                            <div class="offline-selection-controls" style="display: none;">
                                <span id="offline-selection-cancel-btn" onclick="cancelOfflineMultiSelect()">å–æ¶ˆ</span>
                                <span id="offline-selection-count">å·²é€‰ 0 æ¡</span>
                                <span id="offline-selection-delete-btn" onclick="confirmOfflineMultiDelete()">åˆ é™¤</span>
                            </div>
                            <div class="header-actions">
                                <span class="action-btn" onclick="showOfflineHistoryModal()" title="æŸ¥çœ‹èŠå¤©è®°å½•">
                                    <i class="fas fa-history"></i>
                                </span>
                                <span class="action-btn" onclick="showOfflineUISettings()" title="ç•Œé¢è®¾ç½®">
                                    <i class="fas fa-cog"></i>
                                </span>
                                <span class="action-btn" onclick="showOfflinePresetSettings()" title="æ·»åŠ é¢„è®¾">
                                    <i class="fas fa-plus"></i>
                                </span>
                            </div>
                        </div>

                        <div class="offline-mode-content">
                            <div class="offline-chat-messages" id="offline-chat-messages">
                                <!-- çº¿ä¸‹æ¨¡å¼çš„èŠå¤©æ¶ˆæ¯ -->
                            </div>

                            <div class="offline-input-area">
                                <div class="offline-input-container">
                                    <textarea id="offline-input" placeholder="åœ¨çº¿ä¸‹å‰§æƒ…æ¨¡å¼ä¸­è¾“å…¥..." rows="3" maxlength="50000"></textarea>
                                    <div class="offline-button-group">
                                        <button class="offline-continue-btn" onclick="continueOfflineStory()" title="è®©AIç»§ç»­å‰§æƒ…">
                                            <i class="fas fa-feather-alt"></i>
                                            <span>ç»­</span>
                                        </button>
                                        <button class="offline-send-btn" onclick="sendOfflineMessage()">
                                            <i class="fas fa-paper-plane"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€èŠå¤©ç•Œé¢æ–‡ä»¶è¾“å…¥æ¡†ã€‘æ”¾åœ¨ç•Œé¢å¤–é¢ï¼Œé¿å…åœ¨æŸäº›è®¾å¤‡ä¸Šæ˜¾ç¤º -->
                <input type="file" id="image-upload" accept="image/*" style="display: none;">
                <input type="file" id="emoji-upload" accept="image/*" style="display: none;" multiple>

                <!-- ä¸ªäººè¡¨æƒ…åŒ…æè¿°æ·»åŠ æ¨¡æ€æ¡† -->
                <div id="personal-emoji-description-modal" class="modal-overlay" style="display: none;" onclick="hidePersonalEmojiDescriptionModal(event)">
                    <div class="modal-content personal-emoji-description-modal" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3>æ·»åŠ è¡¨æƒ…åŒ…æè¿°</h3>
                            <button class="modal-close-btn" onclick="hidePersonalEmojiDescriptionModal()">Ã—</button>
                        </div>
                        <div class="modal-body">
                            <div class="emoji-preview-container">
                                <img id="personal-emoji-preview-image" src="" alt="è¡¨æƒ…åŒ…é¢„è§ˆ" style="max-width: 100px; max-height: 100px; border-radius: 8px; margin-bottom: 15px;">
                            </div>
                            <div class="form-group">
                                <label class="form-label">è¡¨æƒ…åŒ…æè¿°</label>
                                <textarea class="form-textarea" id="personal-emoji-description-input" placeholder="è¯·ä¸ºè¿™ä¸ªè¡¨æƒ…åŒ…æ·»åŠ æè¿°ï¼Œå¸®åŠ©AIæ›´å¥½åœ°ç†è§£è¡¨æƒ…åŒ…å†…å®¹" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-btn cancel-btn" onclick="hidePersonalEmojiDescriptionModal()">å–æ¶ˆ</button>
                            <button class="modal-btn confirm-btn" onclick="confirmPersonalEmojiDescription()">ç¡®å®š</button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘è§’è‰²è¶³è¿¹æ¨¡æ€æ¡† -->
                <div id="character-footprints-modal" class="modal-overlay" style="display: none;" onclick="hideCharacterFootprints(event)">
                    <div class="modal-content footprints-modal" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <div class="footprints-header-info">
                                <div class="footprints-character-avatar" id="footprints-character-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="footprints-character-info">
                                    <h3 id="footprints-character-name">è§’è‰²è¶³è¿¹</h3>
                                    <p class="footprints-subtitle">æŸ¥çœ‹Taçš„è¡Œä¸ºè½¨è¿¹</p>
                                </div>
                            </div>
                            <div class="footprints-header-actions">
                                <button class="footprints-refresh-btn" onclick="refreshCharacterFootprints()" title="åˆ·æ–°è¶³è¿¹">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="modal-close-btn" onclick="hideCharacterFootprints()">Ã—</button>
                            </div>
                        </div>
                        <div class="modal-body footprints-body">
                            <div class="footprints-settings">
                                <div class="footprints-setting-item">
                                    <label>è‡ªåŠ¨æ›´æ–°é¢‘ç‡</label>
                                    <select id="footprints-update-frequency" onchange="updateFootprintsFrequency()">
                                        <option value="manual" selected>æ‰‹åŠ¨åˆ·æ–°</option>
                                        <option value="30">æ¯30åˆ†é’Ÿ</option>
                                        <option value="60">æ¯å°æ—¶</option>
                                        <option value="120">æ¯2å°æ—¶</option>
                                        <option value="180">æ¯3å°æ—¶</option>
                                    </select>
                                </div>
                            </div>
                            <div class="footprints-timeline" id="footprints-timeline">
                                <!-- è¶³è¿¹æ—¶é—´çº¿å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                <div class="footprints-empty-state">
                                    <i class="fas fa-map-marked-alt"></i>
                                    <p>æš‚æ— è¶³è¿¹è®°å½•</p>
                                    <p>ç‚¹å‡»åˆ·æ–°æŒ‰é’®è·å–æœ€æ–°è¶³è¿¹</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘ä¹¦ç±é˜…è¯»å™¨æ¨¡æ€æ¡† -->
                <div id="book-reader-modal" class="modal-overlay" style="display: none;" onclick="minimizeBookReader(event)">
                    <div class="modal-content book-reader-modal" onclick="event.stopPropagation()">
                        <div class="book-reader-header">
                            <div class="book-reader-title" id="book-reader-title">ä¹¦å</div>
                            <div class="book-reader-controls">
                                <button class="book-reader-btn" onclick="showBookReaderSettings()" title="è®¾ç½®">
                                    <i class="fas fa-cog"></i>
                                </button>
                                <button class="book-reader-btn" onclick="minimizeBookReader()" title="æœ€å°åŒ–">
                                    <i class="fas fa-minus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="book-reader-content" id="book-reader-content">
                            <!-- ä¹¦ç±å†…å®¹å°†é€šè¿‡JSåŠ¨æ€åŠ è½½ -->
                        </div>
                        <div class="book-reader-footer">
                            <button class="book-nav-btn" onclick="previousPage()">
                                <i class="fas fa-chevron-left"></i> ä¸Šä¸€é¡µ
                            </button>
                            <div class="book-progress" onclick="showPageJumpModal()">
                                <span id="current-page">1</span> / <span id="total-pages">1</span>
                                <span class="progress-percent" id="progress-percent">0%</span>
                                <i class="fas fa-external-link-alt" style="font-size: 10px; margin-left: 5px; opacity: 0.6;"></i>
                            </div>
                            <button class="book-nav-btn" onclick="nextPage()">
                                ä¸‹ä¸€é¡µ <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘é˜…è¯»å™¨è®¾ç½®æ¨¡æ€æ¡† -->
                <div id="book-reader-settings-modal" class="modal-overlay" style="display: none;" onclick="hideBookReaderSettings(event)">
                    <div class="modal-content book-settings-modal" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <div class="modal-title">é˜…è¯»è®¾ç½®</div>
                            <button class="modal-close" onclick="hideBookReaderSettings()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="setting-group">
                                <label class="setting-label">ä¹¦å</label>
                                <input type="text" id="book-title-input" class="book-info-input" placeholder="è¯·è¾“å…¥ä¹¦å">
                            </div>
                            <div class="setting-group">
                                <label class="setting-label">ä½œè€…</label>
                                <input type="text" id="book-author-input" class="book-info-input" placeholder="è¯·è¾“å…¥ä½œè€…">
                            </div>
                            <!-- ğŸ”¥ã€æ–°å¢ã€‘å°é¢URLè¾“å…¥æ¡† -->
                            <div class="setting-group">
                                <label class="setting-label">å°é¢URL</label>
                                <input type="text" id="book-cover-input" class="book-info-input" placeholder="è¯·è¾“å…¥å°é¢å›¾ç‰‡é“¾æ¥">
                            </div>
                            <!-- ğŸ”¥ã€æ–°å¢ã€‘ç¼–ç æ ¼å¼é€‰æ‹©å™¨ -->
                            <div class="setting-group">
                                <label class="setting-label">æ–‡ä»¶ç¼–ç æ ¼å¼</label>
                                <select id="book-encoding-select" class="book-info-input" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                                    <option value="auto">è‡ªåŠ¨æ£€æµ‹</option>
                                    <option value="utf-8">UTF-8</option>
                                    <option value="utf-16le">UTF-16 LE</option>
                                    <option value="utf-16be">UTF-16 BE</option>
                                    <option value="gbk">GBK</option>
                                    <option value="gb2312">GB2312</option>
                                    <option value="gb18030">GB18030</option>
                                    <option value="big5">Big5</option>
                                    <option value="shift-jis">Shift-JIS</option>
                                    <option value="euc-kr">EUC-KR</option>
                                    <option value="iso-8859-1">ISO-8859-1</option>
                                </select>
                                <p class="setting-hint" style="font-size: 12px; color: #999; margin-top: 5px;">å¦‚æœä¹¦ç±å‡ºç°ä¹±ç ï¼Œè¯·å°è¯•æ›´æ¢ç¼–ç æ ¼å¼åé‡æ–°æ‰“å¼€</p>
                            </div>
                            <div class="setting-group">
                                <label class="setting-label">èƒŒæ™¯é¢œè‰²</label>
                                <div class="color-presets">
                                    <div class="color-preset" data-color="#F7EADE" style="background: #F7EADE;" title="æŠ¤çœ¼ç±³é»„"></div>
                                    <div class="color-preset" data-color="#E3EDCD" style="background: #E3EDCD;" title="æŠ¤çœ¼ç»¿"></div>
                                    <div class="color-preset" data-color="#FFFFFF" style="background: #FFFFFF; border: 1px solid #ddd;" title="çº¯ç™½"></div>
                                    <div class="color-preset" data-color="#F5F5F5" style="background: #F5F5F5;" title="æµ…ç°"></div>
                                    <div class="color-preset" data-color="#1E1E1E" style="background: #1E1E1E;" title="æ·±è‰²"></div>
                                </div>
                            </div>
                            <div class="setting-group">
                                <label class="setting-label">æ–‡å­—é¢œè‰²</label>
                                <div class="color-presets">
                                    <div class="color-preset" data-text-color="#333333" style="background: #333333;" title="æ·±ç°"></div>
                                    <div class="color-preset" data-text-color="#000000" style="background: #000000;" title="çº¯é»‘"></div>
                                    <div class="color-preset" data-text-color="#666666" style="background: #666666;" title="ä¸­ç°"></div>
                                    <div class="color-preset" data-text-color="#E0E0E0" style="background: #E0E0E0;" title="æµ…ç°"></div>
                                </div>
                            </div>
                            <div class="setting-group">
                                <label class="setting-label">å­—ä½“å¤§å°: <span id="book-font-size-value">16px</span></label>
                                <input type="range" id="book-font-size-slider" min="12" max="24" value="16" step="1">
                            </div>
                            <div class="setting-group">
                                <label class="setting-label">è¡Œè·: <span id="book-line-height-value">1.8</span></label>
                                <input type="range" id="book-line-height-slider" min="1.2" max="2.5" value="1.8" step="0.1">
                            </div>
                            <div class="setting-group">
                                <label class="setting-label">æ¯é¡µå­—æ•°: <span id="book-chars-per-page-value">1000</span></label>
                                <input type="range" id="book-chars-per-page-slider" min="500" max="2000" value="1000" step="100">
                                <p class="setting-hint">è°ƒæ•´æ¯é¡µæ˜¾ç¤ºçš„å­—æ•°ï¼Œå½±å“ç¿»é¡µé¢‘ç‡å’ŒAIç†è§£å†…å®¹çš„å®Œæ•´æ€§</p>
                            </div>

                            <!-- ğŸ”¥ã€æ–°å¢ã€‘å¬ä¹¦æ¨¡å¼è®¾ç½® -->
                            <div id="listening-mode-settings" style="display: none;">
                                <hr style="margin: 20px 0; border: none; border-top: 1px solid #e0e0e0;">
                                <h4 style="margin: 0 0 15px 0; font-size: 14px; color: #666;">ğŸ§ å¬ä¹¦è®¾ç½®</h4>

                                <!-- æœ—è¯»è¯­é€Ÿ -->
                                <div class="setting-group">
                                    <label class="setting-label">æœ—è¯»è¯­é€Ÿ: <span id="listening-speed-value">1.0</span>x</label>
                                    <input type="range" id="listening-speed-slider" min="0.5" max="2.0" value="1.0" step="0.1" oninput="updateListeningSpeed(this.value)">
                                    <p class="setting-hint">è°ƒæ•´è§’è‰²æœ—è¯»çš„è¯­é€Ÿï¼ˆ0.5å€ - 2.0å€ï¼‰</p>
                                </div>

                                <!-- å®šæ—¶å…³é—­ -->
                                <div class="setting-group">
                                    <label class="setting-label">
                                        <input type="checkbox" id="listening-auto-close-enabled" onchange="toggleListeningAutoClose()" style="margin-right: 8px;">
                                        å®šæ—¶å…³é—­
                                    </label>
                                    <div id="listening-auto-close-options" style="display: none; margin-top: 10px;">
                                        <select id="listening-auto-close-time" class="book-info-input" style="width: 100%;">
                                            <option value="15">15åˆ†é’Ÿåå…³é—­</option>
                                            <option value="30">30åˆ†é’Ÿåå…³é—­</option>
                                            <option value="60">60åˆ†é’Ÿåå…³é—­</option>
                                            <option value="90">90åˆ†é’Ÿåå…³é—­</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary modal-button-small" onclick="resetBookReaderSettings()">æ¢å¤é»˜è®¤</button>
                            <button class="modal-button modal-primary modal-button-small" onclick="saveBookReaderSettings()">å®Œæˆ</button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘ä¹¦ç±é€‰æ‹©æ¨¡æ€æ¡†ï¼ˆç”¨äº"ä¸€èµ·è¯»"å’Œ"å¬Taè¯»"ï¼‰ -->
                <div id="book-selection-modal" class="modal-overlay" style="display: none;" onclick="hideBookSelection(event)">
                    <div class="modal-content book-selection-modal" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3>é€‰æ‹©ä¹¦ç±</h3>
                            <button class="modal-close" onclick="hideBookSelection()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="book-selection-grid" id="book-selection-grid">
                                <!-- ä¹¦ç±åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                            <div class="book-selection-empty" id="book-selection-empty" style="display: none;">
                                <i class="fas fa-book"></i>
                                <p>è¿˜æ²¡æœ‰å¯¼å…¥ä»»ä½•ä¹¦ç±</p>
                                <p>è¯·å…ˆåœ¨"æˆ‘çš„ä¹¦æ¶"ä¸­æ·»åŠ ä¹¦ç±</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘é¡µç è·³è½¬æ¨¡æ€æ¡† -->
                <div id="page-jump-modal" class="modal-overlay" style="display: none;" onclick="hidePageJumpModal(event)">
                    <div class="modal-content page-jump-modal" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <div class="modal-title">è·³è½¬åˆ°æŒ‡å®šé¡µ</div>
                            <button class="modal-close" onclick="hidePageJumpModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="page-jump-info">
                                <p>å½“å‰ï¼šç¬¬ <span id="jump-current-page">1</span> é¡µ</p>
                                <p>æ€»å…±ï¼š<span id="jump-total-pages">1</span> é¡µ</p>
                            </div>
                            <div class="page-jump-input-group">
                                <label>è·³è½¬åˆ°ç¬¬</label>
                                <input type="number" id="page-jump-input" min="1" placeholder="è¾“å…¥é¡µç ">
                                <label>é¡µ</label>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary modal-button-small" onclick="hidePageJumpModal()">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary modal-button-small" onclick="jumpToPage()">è·³è½¬</button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘é˜…è¯»æ¨¡å¼é€‰æ‹©æ¨¡æ€æ¡† -->
                <div id="reading-mode-modal" class="modal-overlay" style="display: none;" onclick="hideReadingModeSelection(event)">
                    <div class="modal-content reading-mode-modal" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3>é€‰æ‹©é˜…è¯»æ¨¡å¼</h3>
                            <button class="modal-close" onclick="hideReadingModeSelection()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="reading-mode-options">
                                <div class="reading-mode-option" onclick="startReadingTogether()">
                                    <div class="mode-icon">
                                        <i class="fas fa-book-reader"></i>
                                    </div>
                                    <div class="mode-info">
                                        <h4>ä¸€èµ·è¯»</h4>
                                        <p>å’Œè§’è‰²ä¸€èµ·é˜…è¯»ï¼ŒTaèƒ½æ„ŸçŸ¥åˆ°ä½ ä»¬æ­£åœ¨è¯»çš„å†…å®¹</p>
                                    </div>
                                </div>
                                <div class="reading-mode-option" onclick="startListeningMode()">
                                    <div class="mode-icon">
                                        <i class="fas fa-headphones"></i>
                                    </div>
                                    <div class="mode-info">
                                        <h4>å¬Taè¯»</h4>
                                        <p>è®©è§’è‰²ç”¨è¯­éŸ³ä¸ºä½ æœ—è¯»ä¹¦ç±å†…å®¹</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æµè§ˆå™¨ç•Œé¢ -->
                <div id="browser-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('browser-screen')">â€¹</button>
                        <div class="app-title">æµè§ˆå™¨</div>
                    </div>
                    <div class="app-content padding-none-flex">
                        <div class="browser-toolbar">
                            <input type="text" class="browser-url-bar" id="browser-url" placeholder="è¾“å…¥ç½‘å€">
                            <button onclick="loadUrl()">å‰å¾€</button>
                        </div>
                        <iframe class="browser-content" id="browser-frame"></iframe>
                    </div>
                </div>



                <!-- è®¾ç½®åº”ç”¨ -->
                <div id="settings-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                                <div class="app-battery-container">
                                    <div class="app-battery-icon">
                                        <div class="app-battery-level"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="app-header">
                            <button class="back-button" onclick="hideApp('settings-screen')">â€¹</button>
                            <div class="app-title">è®¾ç½®</div>
                        </div>
                    </div>
                    <div class="app-content">
                        <div class="settings-item" onclick="showApp('api-settings-screen')">
                            <div class="settings-item-left">
                                <div class="settings-icon wifi">
                                    <i class="fas fa-wifi"></i>
                                </div>
                                <div>APIè®¾ç½®</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="settings-item" onclick="showApp('theme-screen')">
                            <div class="settings-item-left">
                                <div class="settings-icon settings-icon-custom">
                                    <i class="fas fa-palette"></i>
                                </div>
                                <div>ä¸»é¢˜è®¾ç½®</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="settings-item" onclick="showApp('wallpaper-screen')">
                            <div class="settings-item-left">
                                <div class="settings-icon wallpaper">
                                    <i class="fas fa-image"></i>
                                </div>
                                <div>å£çº¸è®¾ç½®</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="settings-item" onclick="showApp('appearance-screen')">
                            <div class="settings-item-left">
                                <div class="settings-icon display">
                                    <i class="fas fa-mobile-alt"></i>
                                </div>
                                <div>å¤–è§‚è®¾ç½®</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="settings-item" onclick="showApp('display-screen')">
                            <div class="settings-item-left">
                                <div class="settings-icon display">
                                    <i class="fas fa-font"></i>
                                </div>
                                <div>å­—ä½“ä¸å­—å·</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="settings-item" onclick="showApp('sound-settings-screen')">
                            <div class="settings-item-left">
                                <div class="settings-icon sound">
                                    <i class="fas fa-volume-up"></i>
                                </div>
                                <div>éŸ³æ•ˆè®¾ç½®</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="settings-item" onclick="showApp('data-management-screen')">
                            <div class="settings-item-left">
                                <div class="settings-icon data-management">
                                    <i class="fas fa-database"></i>
                                </div>
                                <div>æ•°æ®ç®¡ç†</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="settings-item" onclick="showApp('float-ball-screen')">
                            <div class="settings-item-left">
                                <div class="settings-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                    <i class="fas fa-rocket"></i>
                                </div>
                                <div>æ‚¬æµ®çƒå¼€å…³</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="settings-item" onclick="showApp('emergency-recovery-screen')">
                            <div class="settings-item-left">
                                <div class="settings-icon" style="background: #ff4444; color: white;">
                                    <i class="fas fa-life-ring"></i>
                                </div>
                                <div>ç´§æ€¥æ¢å¤</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="settings-item" onclick="showApp('about-screen')">
                            <div class="settings-item-left">
                                <div class="settings-icon about">
                                    <i class="fas fa-info-circle"></i>
                                </div>
                                <div>å…è´£å£°æ˜</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>



                <!-- æ•°æ®ç®¡ç† -->
                <div id="data-management-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                        <div class="app-header">
                            <button class="back-button" onclick="backToSettings('data-management-screen')">â€¹</button>
                            <div class="app-title">æ•°æ®ç®¡ç†</div>
                        </div>
                    </div>
                    <div class="app-content">
                        <!-- å­˜å‚¨ç©ºé—´ä½¿ç”¨æƒ…å†µ -->
                        <div class="data-section">
                            <div class="data-section-title">å­˜å‚¨ç©ºé—´ä½¿ç”¨æƒ…å†µ</div>
                            <div class="storage-usage" id="storage-usage">
                                <div class="storage-item">
                                    <div class="storage-label">èŠå¤©è®°å½•</div>
                                    <div class="storage-size" id="chat-storage-size">è®¡ç®—ä¸­...</div>
                                </div>
                                <div class="storage-item">
                                    <div class="storage-label">è§’è‰²æ•°æ®</div>
                                    <div class="storage-size" id="character-storage-size">è®¡ç®—ä¸­...</div>
                                </div>
                                <div class="storage-item">
                                    <div class="storage-label">èŠå¤©è®¾ç½®</div>
                                    <div class="storage-size" id="settings-storage-size">è®¡ç®—ä¸­...</div>
                                </div>
                                <div class="storage-item">
                                    <div class="storage-label">è¡¨æƒ…åŒ…</div>
                                    <div class="storage-size" id="emoji-storage-size">è®¡ç®—ä¸­...</div>
                                </div>
                                <div class="storage-item">
                                    <div class="storage-label">åŠ¨æ€æ•°æ®</div>
                                    <div class="storage-size" id="moments-storage-size">è®¡ç®—ä¸­...</div>
                                </div>
                                <div class="storage-item">
                                    <div class="storage-label">è®ºå›æ•°æ®</div>
                                    <div class="storage-size" id="forum-storage-size">è®¡ç®—ä¸­...</div>
                                </div>
                                <div class="storage-item">
                                    <div class="storage-label">è®°å¿†æ•°æ®</div>
                                    <div class="storage-size" id="memory-storage-size">è®¡ç®—ä¸­...</div>
                                </div>
                                <div class="storage-item">
                                    <div class="storage-label">ä¸–ç•Œä¹¦</div>
                                    <div class="storage-size" id="worldbook-storage-size">è®¡ç®—ä¸­...</div>
                                </div>
                                <div class="storage-item">
                                    <div class="storage-label">èº«ä»½é¢å…·</div>
                                    <div class="storage-size" id="persona-storage-size">è®¡ç®—ä¸­...</div>
                                </div>
                                <div class="storage-item">
                                    <div class="storage-label">éŸ³æ•ˆè®¾ç½®</div>
                                    <div class="storage-size" id="sound-storage-size">è®¡ç®—ä¸­...</div>
                                </div>
                                <div class="storage-item">
                                    <div class="storage-label">å…¶ä»–æ•°æ®</div>
                                    <div class="storage-size" id="other-storage-size">è®¡ç®—ä¸­...</div>
                                </div>
                                <div class="storage-total">
                                    <div class="storage-label">æ€»è®¡</div>
                                    <div class="storage-size" id="total-storage-size">è®¡ç®—ä¸­...</div>
                                </div>
                            </div>
                        </div>

                        <!-- æ•°æ®å¯¼å…¥å¯¼å‡º -->
                        <div class="data-section">
                            <div class="data-section-title">æ•°æ®å¤‡ä»½ä¸æ¢å¤</div>

                            <div class="settings-item" onclick="exportAllData()">
                                <div class="settings-item-left">
                                    <div class="settings-icon export">
                                        <i class="fas fa-download"></i>
                                    </div>
                                    <div>
                                        <div class="setting-label">å¯¼å‡ºæ‰€æœ‰æ•°æ®</div>
                                        <div class="setting-desc">å¯¼å‡ºæ‰€æœ‰è®°å½•ä¸ºJSONæ–‡ä»¶</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                            <div class="settings-item" onclick="exportLightweightData()">
                                <div class="settings-item-left">
                                    <div class="settings-icon export">
                                        <i class="fas fa-file-export"></i>
                                    </div>
                                    <div>
                                        <div class="setting-label">è½»é‡çº§å¯¼å‡º</div>
                                        <div class="setting-desc">å¯¼å‡ºæ ¸å¿ƒæ•°æ®ï¼Œé€‚åˆå¤§æ•°æ®é‡æ—¶ä½¿ç”¨</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                            <div class="settings-item" onclick="importDataFromFile()">
                                <div class="settings-item-left">
                                    <div class="settings-icon import">
                                        <i class="fas fa-upload"></i>
                                    </div>
                                    <div>
                                        <div class="setting-label">å¯¼å…¥æ•°æ®</div>
                                        <div class="setting-desc">ä»JSONæ–‡ä»¶æ¢å¤èŠå¤©è®°å½•å’Œè®¾ç½®</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>

                        <!-- æ•°æ®æ£€æŸ¥ä¸ä¿®å¤ -->
                        <div class="data-section">
                            <div class="data-section-title">æ•°æ®æ£€æŸ¥ä¸ä¿®å¤</div>
                            <div class="settings-item" onclick="checkAndFixChatHistory()">
                                <div class="settings-item-left">
                                    <div class="settings-icon import">
                                        <i class="fas fa-search"></i>
                                    </div>
                                    <div>
                                        <div class="setting-label">æ£€æŸ¥èŠå¤©å†å²</div>
                                        <div class="setting-desc">æ£€æŸ¥å¹¶ä¿®å¤èŠå¤©è®°å½•æ•°æ®ï¼Œæ¢å¤ä¸¢å¤±çš„æ¶ˆæ¯</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>

                            <div class="settings-item" onclick="debugChatMessagesFormat()">
                                <div class="settings-item-left">
                                    <div class="settings-icon debug">
                                        <i class="fas fa-bug"></i>
                                    </div>
                                    <div>
                                        <div class="setting-label">è°ƒè¯•èŠå¤©è®°å½•æ ¼å¼</div>
                                        <div class="setting-desc">åˆ†æèŠå¤©è®°å½•çš„æ•°æ®æ ¼å¼ï¼Œå¸®åŠ©è¯Šæ–­å¯¼å…¥é—®é¢˜</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>

                            <div class="settings-item" onclick="fixDataSyncIssues()">
                                <div class="settings-item-left">
                                    <div class="settings-icon import">
                                        <i class="fas fa-sync-alt"></i>
                                    </div>
                                    <div>
                                        <div class="setting-label">ä¿®å¤æ•°æ®åŒæ­¥é—®é¢˜</div>
                                        <div class="setting-desc">ä¿®å¤æ•°æ®åº“ä¸å†…å­˜ä¸ä¸€è‡´ï¼Œè§£å†³è§’è‰²è®°å¿†é”™ä¹±</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>

                        <!-- é€‰æ‹©æ€§æ¸…ç† -->
                        <div class="data-section">
                            <div class="data-section-title">å­˜å‚¨æ¸…ç†</div>
                            <div class="settings-item" onclick="showCleanupOptions()">
                                <div class="settings-item-left">
                                    <div class="settings-icon cleanup">
                                        <i class="fas fa-broom"></i>
                                    </div>
                                    <div>
                                        <div class="setting-label">é€‰æ‹©æ€§æ¸…ç†</div>
                                        <div class="setting-desc">æ¸…ç†ç‰¹å®šç±»å‹çš„æ•°æ®ä»¥é‡Šæ”¾ç©ºé—´</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                            <div class="settings-item" onclick="compressAllImages()">
                                <div class="settings-item-left">
                                    <div class="settings-icon compress">
                                        <i class="fas fa-compress-arrows-alt"></i>
                                    </div>
                                    <div>
                                        <div class="setting-label">å‹ç¼©å›¾ç‰‡</div>
                                        <div class="setting-desc">å‹ç¼©æ‰€æœ‰å¤´åƒå’ŒèƒŒæ™¯å›¾ç‰‡ä»¥èŠ‚çœç©ºé—´</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>

                            <div class="settings-item" onclick="optimizeMomentsStorage()">
                                <div class="settings-item-left">
                                    <div class="settings-icon optimize">
                                        <i class="fas fa-magic"></i>
                                    </div>
                                    <div>
                                        <div class="setting-label">ä¼˜åŒ–åŠ¨æ€å­˜å‚¨</div>
                                        <div class="setting-desc">æ¸…ç†åŠ¨æ€ä¸­çš„å†—ä½™å¤´åƒæ•°æ®</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>

                            <div class="settings-item" onclick="optimizeForumStorage()">
                                <div class="settings-item-left">
                                    <div class="settings-icon optimize">
                                        <i class="fas fa-compress-alt"></i>
                                    </div>
                                    <div>
                                        <div class="setting-label">ä¼˜åŒ–è®ºå›å­˜å‚¨</div>
                                        <div class="setting-desc">æ¸…ç†è®ºå›å¸–å­å’Œå›å¤ä¸­çš„å†—ä½™å¤´åƒæ•°æ®</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>

                            <div class="settings-item" onclick="cleanupLocalMusic()">
                                <div class="settings-item-left">
                                    <div class="settings-icon cleanup">
                                        <i class="fas fa-music"></i>
                                    </div>
                                    <div>
                                        <div class="setting-label">æ¸…ç†æœ¬åœ°éŸ³ä¹</div>
                                        <div class="setting-desc">åˆ é™¤æ‰€æœ‰æœ¬åœ°ä¸Šä¼ çš„éŸ³ä¹æ–‡ä»¶ä»¥é‡Šæ”¾ç©ºé—´</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>

                        <!-- å±é™©æ“ä½œ -->
                        <div class="data-section danger-section">
                            <div class="data-section-title">å±é™©æ“ä½œ</div>
                            <div class="settings-item danger-item" onclick="clearAllData()">
                                <div class="settings-item-left">
                                    <div class="settings-icon danger">
                                        <i class="fas fa-trash-alt"></i>
                                    </div>
                                    <div>
                                        <div class="setting-label">æ¸…ç©ºæ‰€æœ‰æ•°æ®</div>
                                        <div class="setting-desc">åˆ é™¤æ‰€æœ‰æ•°æ®ï¼Œä¸å¯æ¢å¤ï¼</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ‚¬æµ®çƒå¼€å…³ -->
                <div id="float-ball-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                                <div class="app-battery-container">
                                    <div class="app-battery-icon">
                                        <div class="app-battery-level"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="app-header">
                            <button class="back-button" onclick="backToSettings('float-ball-screen')">â€¹</button>
                            <div class="app-title">æ‚¬æµ®çƒå¼€å…³</div>
                        </div>
                    </div>
                    <div class="app-content">
                        <div class="data-section">
                            <div class="data-section-title">å¿«æ·æ“ä½œæ‚¬æµ®çƒ</div>

                            <!-- å¿«æ·æ“ä½œæ‚¬æµ®çƒå¼€å…³ -->
                            <div class="settings-item">
                                <div class="settings-item-left">
                                    <div class="settings-icon export">
                                        <i class="fas fa-rocket"></i>
                                    </div>
                                    <div>
                                        <div class="setting-label">å¿«æ·æ“ä½œæ‚¬æµ®çƒ</div>
                                        <div class="setting-desc">æ”¯æŒå¿«æ·å¯¼å‡ºå’ŒAPIåˆ‡æ¢</div>
                                    </div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="quick-backup-toggle" onchange="toggleQuickBackupFloat()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div style="padding: 20px; color: #666; font-size: 14px; line-height: 1.6;">
                                <p style="margin: 0 0 10px 0;"><strong>åŠŸèƒ½è¯´æ˜ï¼š</strong></p>
                                <ul style="margin: 0; padding-left: 20px;">
                                    <li>å¿«æ·å¯¼å‡ºæ‰€æœ‰æ•°æ®</li>
                                    <li>å¿«é€Ÿåˆ‡æ¢APIé…ç½®</li>
                                </ul>
                                <p style="margin: 15px 0 0 0; color: #999; font-size: 13px;">
                                    ğŸ’¡ å¦‚ä»å­˜åœ¨æ•°æ®é‡è¿‡å¤§å¯¼è‡´æ•°æ®ç®¡ç†é¡µé¢å´©æºƒçš„ç°è±¡ï¼Œå¯ä»¥ä½¿ç”¨æ‚¬æµ®çƒå¿«é€Ÿå¯¼å‡ºæ•°æ®
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ğŸš¨ ç´§æ€¥æ¢å¤ç•Œé¢ -->
                <div class="app-screen" id="emergency-recovery-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                        <div class="app-header">
                            <button class="back-button" onclick="backToSettings('emergency-recovery-screen')">â€¹</button>
                            <div class="app-title" style="color: #ff4444;">ğŸš¨ ç´§æ€¥æ¢å¤</div>
                        </div>
                    </div>
                    <div class="app-content">
                        <div style="padding: 20px; color: #333;">
                            <!-- è­¦å‘Šå¡ç‰‡ - æ¯›ç»ç’ƒé£æ ¼ -->
                            <div style="background: linear-gradient(135deg, rgba(255, 68, 68, 0.15) 0%, rgba(255, 68, 68, 0.08) 100%); border: 2px solid rgba(255, 68, 68, 0.3); border-radius: 16px; padding: 20px; margin-bottom: 25px; backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); box-shadow: 0 8px 32px rgba(255, 68, 68, 0.1);">
                                <h3 style="color: #ff4444; margin: 0 0 12px 0; font-size: 18px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                                    <span>âš ï¸</span> æ•°æ®ä¸¢å¤±æ£€æµ‹
                                </h3>
                                <p style="margin: 0; font-size: 15px; color: #666; line-height: 1.5;">å¦‚æœæ‚¨çš„è§’è‰²çªç„¶æ¶ˆå¤±ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹åŠŸèƒ½æ¢å¤æ•°æ®ã€‚</p>
                            </div>

                            <!-- ç¬¬ä¸€æ­¥ -->
                            <div class="recovery-section" style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border-radius: 20px; padding: 25px; margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08); border: 1px solid rgba(255, 255, 255, 0.2);">
                                <h4 style="margin: 0 0 15px 0; color: #333; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                                    <span>ğŸ”</span> ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥æ•°æ®çŠ¶æ€
                                </h4>
                                <button onclick="checkDataStatus()" style="width: 100%; padding: 14px 20px; background: var(--theme-button-bg, rgba(74, 132, 193, 0.9)); color: var(--theme-button-color, white); border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; backdrop-filter: blur(10px); box-shadow: var(--theme-button-shadow, 0 4px 15px rgba(74, 132, 193, 0.3)); transition: all 0.3s ease; margin-bottom: 15px;">
                                    æ£€æŸ¥å½“å‰æ•°æ®çŠ¶æ€
                                </button>
                                <div id="data-status-result" style="background: rgba(248, 249, 250, 0.9); border-radius: 12px; padding: 15px; margin-bottom: 20px; display: none; backdrop-filter: blur(10px); border: 1px solid rgba(0,0,0,0.05);">
                                    <pre id="data-status-text" style="font-size: 12px; margin: 0; white-space: pre-wrap; color: #333; font-family: 'SF Mono', Monaco, monospace;"></pre>
                                </div>
                            </div>

                            <!-- ç¬¬äºŒæ­¥ -->
                            <div class="recovery-section" style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border-radius: 20px; padding: 25px; margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08); border: 1px solid rgba(255, 255, 255, 0.2);">
                                <h4 style="margin: 0 0 15px 0; color: #333; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                                    <span>ğŸ”</span> ç¬¬äºŒæ­¥ï¼šæ·±åº¦æ•°æ®æŒ–æ˜
                                </h4>
                                <p style="font-size: 14px; color: #666; margin-bottom: 15px; line-height: 1.5;">æœç´¢æµè§ˆå™¨ä¸­å¯èƒ½æ®‹ç•™çš„è§’è‰²æ•°æ®ï¼š</p>
                                <div style="display: flex; flex-direction: column; gap: 12px;">
                                    <button onclick="deepDataSearch()" style="width: 100%; padding: 14px 20px; background: var(--theme-button-bg, rgba(74, 132, 193, 0.9)); color: var(--theme-button-color, white); border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; backdrop-filter: blur(10px); box-shadow: var(--theme-button-shadow, 0 4px 15px rgba(74, 132, 193, 0.3)); transition: all 0.3s ease;">
                                        ğŸ” æ·±åº¦æœç´¢æ®‹ç•™æ•°æ®
                                    </button>
                                    <button onclick="searchChatHistory()" style="width: 100%; padding: 14px 20px; background: var(--theme-button-secondary-bg, rgba(255, 255, 255, 0.8)); color: var(--theme-button-secondary-color, #666); border: 2px solid var(--theme-button-secondary-border, rgba(0, 0, 0, 0.1)); border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; backdrop-filter: blur(10px); transition: all 0.3s ease;">
                                        ğŸ’¬ ä»èŠå¤©è®°å½•æ¨æ–­è§’è‰²
                                    </button>
                                </div>
                                <div id="deep-search-result" style="background: rgba(248, 249, 250, 0.9); border-radius: 12px; padding: 15px; margin-top: 15px; display: none; backdrop-filter: blur(10px); border: 1px solid rgba(0,0,0,0.05);">
                                    <pre id="deep-search-text" style="font-size: 12px; margin: 0; white-space: pre-wrap; color: #333; font-family: 'SF Mono', Monaco, monospace;"></pre>
                                </div>
                            </div>

                            <!-- ç¬¬ä¸‰æ­¥ -->
                            <div class="recovery-section" style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border-radius: 20px; padding: 25px; margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08); border: 1px solid rgba(255, 255, 255, 0.2);">
                                <h4 style="margin: 0 0 15px 0; color: #333; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                                    <span>ğŸ“¥</span> ç¬¬ä¸‰æ­¥ï¼šæ–‡ä»¶å¯¼å…¥æ¢å¤
                                </h4>
                                <p style="font-size: 14px; color: #666; margin-bottom: 15px; line-height: 1.5;">å¦‚æœæ‚¨æœ‰å¤‡ä»½æ–‡ä»¶ï¼š</p>
                                <input type="file" id="recovery-file-input" accept="*/*" style="width: 100%; padding: 12px 15px; border: 2px solid rgba(0, 0, 0, 0.08); border-radius: 12px; font-size: 16px; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); transition: all 0.3s ease; color: #333; box-sizing: border-box; margin-bottom: 15px;">
                                <button onclick="recoverFromFile()" style="width: 100%; padding: 14px 20px; background: var(--theme-button-bg, rgba(74, 132, 193, 0.9)); color: var(--theme-button-color, white); border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; backdrop-filter: blur(10px); box-shadow: var(--theme-button-shadow, 0 4px 15px rgba(74, 132, 193, 0.3)); transition: all 0.3s ease;">
                                    ä»æ–‡ä»¶æ¢å¤æ•°æ®
                                </button>
                            </div>

                            <!-- ç¬¬å››æ­¥ -->
                            <div class="recovery-section" style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border-radius: 20px; padding: 25px; margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08); border: 1px solid rgba(255, 255, 255, 0.2);">
                                <h4 style="margin: 0 0 15px 0; color: #333; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                                    <span>ğŸ”§</span> ç¬¬å››æ­¥ï¼šé‡å»ºè§’è‰²å¡
                                </h4>
                                <p style="font-size: 14px; color: #666; margin-bottom: 15px; line-height: 1.5;">ä»èŠå¤©è®°å½•é‡å»ºä¸¢å¤±çš„è§’è‰²ï¼š</p>
                                <div style="display: flex; flex-direction: column; gap: 12px;">
                                    <button onclick="rebuildCharactersFromChat()" style="width: 100%; padding: 14px 20px; background: var(--theme-button-bg, rgba(74, 132, 193, 0.9)); color: var(--theme-button-color, white); border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; backdrop-filter: blur(10px); box-shadow: var(--theme-button-shadow, 0 4px 15px rgba(74, 132, 193, 0.3)); transition: all 0.3s ease;">
                                        ğŸ”§ è‡ªåŠ¨é‡å»ºæ‰€æœ‰è§’è‰²
                                    </button>
                                    <button onclick="showManualRebuild()" style="width: 100%; padding: 14px 20px; background: var(--theme-button-secondary-bg, rgba(255, 255, 255, 0.8)); color: var(--theme-button-secondary-color, #666); border: 2px solid var(--theme-button-secondary-border, rgba(0, 0, 0, 0.1)); border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; backdrop-filter: blur(10px); transition: all 0.3s ease;">
                                        âœï¸ æ‰‹åŠ¨é‡å»ºè§’è‰²
                                    </button>
                                </div>
                            </div>

                            <!-- è°ƒè¯•å·¥å…· -->
                            <div class="recovery-section" style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border-radius: 20px; padding: 25px; margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08); border: 1px solid rgba(255, 255, 255, 0.2);">
                                <h4 style="margin: 0 0 15px 0; color: #333; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                                    <span>ğŸ”</span> è°ƒè¯•ï¼šæ£€æŸ¥å½“å‰çŠ¶æ€
                                </h4>
                                <div style="display: flex; flex-direction: column; gap: 12px;">
                                    <button onclick="debugCurrentState()" style="width: 100%; padding: 14px 20px; background: var(--theme-button-secondary-bg, rgba(255, 255, 255, 0.8)); color: var(--theme-button-secondary-color, #666); border: 2px solid var(--theme-button-secondary-border, rgba(0, 0, 0, 0.1)); border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; backdrop-filter: blur(10px); transition: all 0.3s ease;">
                                        ğŸ” æ£€æŸ¥å½“å‰æ•°æ®çŠ¶æ€
                                    </button>
                                    <button onclick="forceRefreshAll()" style="width: 100%; padding: 14px 20px; background: var(--theme-button-bg, rgba(74, 132, 193, 0.9)); color: var(--theme-button-color, white); border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; backdrop-filter: blur(10px); box-shadow: var(--theme-button-shadow, 0 4px 15px rgba(74, 132, 193, 0.3)); transition: all 0.3s ease;">
                                        ğŸ”„ å¼ºåˆ¶åˆ·æ–°æ‰€æœ‰ç•Œé¢
                                    </button>
                                </div>
                            </div>

                            <!-- ç¬¬äº”æ­¥ -->
                            <div class="recovery-section" style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border-radius: 20px; padding: 25px; margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08); border: 1px solid rgba(255, 255, 255, 0.2);">
                                <h4 style="margin: 0 0 15px 0; color: #333; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                                    <span>ğŸ§¹</span> ç¬¬äº”æ­¥ï¼šæ¸…ç†å¼‚å¸¸æ•°æ®
                                </h4>
                                <div style="display: flex; flex-direction: column; gap: 12px;">
                                    <button onclick="cleanupBadData()" style="width: 100%; padding: 14px 20px; background: var(--theme-button-secondary-bg, rgba(255, 255, 255, 0.8)); color: var(--theme-button-secondary-color, #666); border: 2px solid var(--theme-button-secondary-border, rgba(0, 0, 0, 0.1)); border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; backdrop-filter: blur(10px); transition: all 0.3s ease;">
                                        æ¸…é™¤å¼ ä¸‰æå››ç­‰å¼‚å¸¸è§’è‰²
                                    </button>
                                    <button onclick="forceReload()" style="width: 100%; padding: 14px 20px; background: #FF3B30; color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; backdrop-filter: blur(10px); box-shadow: 0 4px 15px rgba(255, 59, 48, 0.3); transition: all 0.3s ease;">
                                        å¼ºåˆ¶é‡æ–°åŠ è½½æ•°æ®
                                    </button>
                                </div>
                            </div>

                            <!-- æ¢å¤æ—¥å¿— -->
                            <div id="recovery-log" style="background: rgba(248, 249, 250, 0.9); border-radius: 16px; padding: 20px; margin-top: 20px; max-height: 200px; overflow-y: auto; display: none; backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border: 1px solid rgba(0,0,0,0.05); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);">
                                <h5 style="margin: 0 0 15px 0; color: #333; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                                    <span>ğŸ“‹</span> æ¢å¤æ—¥å¿—ï¼š
                                </h5>
                                <div id="recovery-log-content" style="font-size: 13px; font-family: 'SF Mono', Monaco, monospace; color: #555; line-height: 1.4;"></div>
                            </div>
                        </div>
                    </div>
                </div>

        <!-- å…³äºæˆ‘ä»¬ -->
                <div id="about-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                        <div class="app-header">
                            <button class="back-button" onclick="backToSettings('about-screen')">â€¹</button>
                            <div class="app-title">å…è´£å£°æ˜</div>
                        </div>
                    </div>
                    <div class="app-content" style="padding: 20px; text-align: left; color: #333; line-height: 1.8;">
                        <h2 style="text-align: center; margin-bottom: 20px;">å…è´£å£°æ˜</h2>
                        <p style="margin-bottom: 15px;">æœ¬åº”ç”¨ï¼ˆâ€œEVEChatAIèŠå¤©è½¯ä»¶â€ï¼‰ä»…ä¾›å¨±ä¹ï¼Œä¸æ„æˆä»»ä½•ä¸“ä¸šå»ºè®®ï¼ˆå¦‚åŒ»ç–—ã€æ³•å¾‹ã€é‡‘èç­‰ï¼‰ã€‚</p>
                        <p style="margin-bottom: 15px;">æœ¬åº”ç”¨ä¸­çš„è™šæ‹Ÿè§’è‰²å’Œå¯¹è¯å†…å®¹å‡ä¸ºAIç”Ÿæˆï¼Œä¸ä»£è¡¨ä»»ä½•çœŸå®äººç‰©ã€å®ä½“æˆ–ç»„ç»‡çš„è§‚ç‚¹ã€‚</p>
                        <p style="margin-bottom: 15px;">ç”¨æˆ·ç”Ÿæˆå’Œä½¿ç”¨çš„æ‰€æœ‰Alè§’è‰²è®¾å®šã€å¯¹è¯ã€å›¾ç‰‡ç­‰å†…å®¹çš„è´£ä»»ç”±ç”¨æˆ·è‡ªè¡Œæ‰¿æ‹…ã€‚</p>
                        <p style="margin-bottom: 15px;">ç”¨æˆ·åœ¨ä¸å…¶ä»–ç”¨æˆ·äº’åŠ¨æ—¶ï¼Œåº”è‡ªè¡Œæ‰¿æ‹…é£é™©ã€‚å¼€å‘è€…ä¸å¯¹ç”¨æˆ·ä¹‹é—´çš„ä»»ä½•è¡Œä¸ºè´Ÿè´£ã€‚</p>
                        <p style="margin-bottom: 15px;">ç”¨æˆ·ä½¿ç”¨æœŸé—´äº§ç”Ÿçš„æ•°æ®çš†ä¸ºæœ¬åœ°å­˜å‚¨ã€‚</p>
                        <p style="margin-bottom: 15px;">è¯·å‹¿å°†æœ¬åº”ç”¨ç”¨äºä»»ä½•éæ³•æˆ–ä¾µçŠ¯ä»–äººæƒç›Šçš„ç”¨é€”ã€‚å¼€å‘è€…ä¸å¯¹å› ä½¿ç”¨æœ¬åº”ç”¨è€Œäº§ç”Ÿçš„ä»»ä½•ç›´æ¥æˆ–é—´æ¥åæœè´Ÿè´£ã€‚</p>
                        <p style="margin-bottom: 25px; font-weight: bold;">ç»§ç»­ä½¿ç”¨æœ¬åº”ç”¨å³è¡¨ç¤ºæ‚¨å·²é˜…è¯»ã€ç†è§£å¹¶åŒæ„æœ¬å…è´£å£°æ˜ã€‚</p>
                        <div class="disclaimer-footer" style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 15px; color: #888; font-size: 14px;">
                            <p><strong>ä½œè€…ï¼š</strong>EVE</p>
                            <p><strong>è½¯ä»¶åï¼š</strong>EVEChatAIèŠå¤©è½¯ä»¶</p>
                            <p><strong>EVEChatAIèŠå¤©è½¯ä»¶å·²ç”³è¯·ç‰ˆæƒï¼Œç¦æ­¢ä»»ä½•å½¢å¼çš„äºŒä¼ äºŒæ”¹åŠäºŒæ¬¡å”®å–</strong></p>
                            <hr style="margin: 15px 0; border: none; border-top: 1px solid #eee;">
                            <p>ç‰ˆæœ¬ï¼šV1.0</p>
                            <p>æœ€åæ›´æ–°ï¼š2025å¹´10æœˆ27æ—¥</p>
                        </div>
                    </div>
                </div>

                <!-- ç”µè¯é€šè¯ç•Œé¢ -->
                <div id="phone-call-screen" class="app-screen">
                    <div class="call-background"></div>
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="call-content">
                        <div class="call-header">
                            <div class="call-avatar">
                                <img id="call-avatar-img" src="" alt="é€šè¯å¤´åƒ">
                            </div>
                            <div class="call-name" id="call-name">è§’è‰²åç§°</div>
                            <div class="call-status" id="call-status">æ­£åœ¨é€šè¯ä¸­...</div>
                            <div class="call-time" id="call-timer">00:00</div>
                        </div>

                        <div class="call-message-container" id="call-message-container">
                            <!-- é€šè¯ä¸­çš„æ¶ˆæ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>

                        <div class="call-input-area">
                            <input type="text" id="call-input" placeholder="è¾“å…¥æ¶ˆæ¯..." class="call-text-input" onkeypress="if(event.key === 'Enter') { event.preventDefault(); sendCallMessage(); }">
                            <button class="call-send-btn" onclick="sendCallMessage()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>

                        <div class="call-controls">
                            <button class="call-control-btn end-call-btn" onclick="endCall()">
                                <i class="fas fa-phone" style="transform: rotate(135deg);"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- æ¥ç”µæ˜¾ç¤ºç•Œé¢ -->
                <div id="incoming-call-screen" class="app-screen">
                    <div class="call-background incoming"></div>
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="incoming-call-content">
                        <div class="call-header">
                            <div class="call-avatar large-avatar">
                                <img id="incoming-call-avatar" src="" alt="æ¥ç”µå¤´åƒ">
                            </div>
                            <div class="call-name" id="incoming-call-name">è§’è‰²åç§°</div>
                            <div class="call-status">æ¥ç”µ</div>
                            <div class="call-text" id="incoming-call-text">æƒ³å’Œä½ é€šè¯...</div>
                        </div>

                        <div class="incoming-call-controls">
                            <button class="incoming-call-btn reject-btn" onclick="rejectCall()">
                                <div class="call-btn-icon">
                                    <i class="fas fa-phone" style="transform: rotate(135deg);"></i>
                                </div>
                                <div class="call-btn-text">æ‹’ç»</div>
                            </button>
                            <button class="incoming-call-btn accept-btn" onclick="acceptCall()">
                                <div class="call-btn-icon">
                                    <i class="fas fa-phone"></i>
                                </div>
                                <div class="call-btn-text">æ¥å¬</div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘è§†é¢‘æ¥ç”µæ˜¾ç¤ºç•Œé¢ -->
                <div id="incoming-video-call-screen" class="app-screen">
                    <div class="video-call-background"></div>
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="incoming-call-content">
                        <div class="call-header">
                            <div class="call-avatar large-avatar">
                                <img id="incoming-video-call-avatar" src="" alt="è§†é¢‘æ¥ç”µå¤´åƒ">
                            </div>
                            <div class="call-name" id="incoming-video-call-name">è§’è‰²åç§°</div>
                            <div class="call-status">è§†é¢‘æ¥ç”µ</div>
                            <div class="call-text" id="incoming-video-call-text">æƒ³å’Œä½ è§†é¢‘èŠèŠ...</div>
                        </div>

                        <div class="incoming-call-controls">
                            <button class="incoming-call-btn reject-btn" onclick="rejectVideoCall()">
                                <div class="call-btn-icon">
                                    <i class="fas fa-phone" style="transform: rotate(135deg);"></i>
                                </div>
                                <div class="call-btn-text">æ‹’ç»</div>
                            </button>
                            <button class="incoming-call-btn accept-btn" onclick="acceptVideoCall()">
                                <div class="call-btn-icon">
                                    <i class="fas fa-video"></i>
                                </div>
                                <div class="call-btn-text">æ¥å¬</div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘è§†é¢‘é€šè¯ç•Œé¢ -->
                <div id="video-call-screen" class="app-screen">
                    <div class="video-call-background"></div>
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ä¸»ç”»é¢ï¼šè§’è‰²é€šè¯å½¢è±¡ -->
                    <div class="video-call-main-view">
                        <img id="video-call-character-avatar" src="" alt="è§’è‰²é€šè¯å½¢è±¡" class="character-video-avatar">

                        <!-- å³ä¸Šè§’å°çª—å£ï¼šç”¨æˆ·é€šè¯å½¢è±¡ -->
                        <div class="video-call-user-window">
                            <img id="video-call-user-avatar" src="" alt="ç”¨æˆ·é€šè¯å½¢è±¡" class="user-video-avatar">
                        </div>

                        <!-- é€šè¯ä¿¡æ¯è¦†ç›–å±‚ -->
                        <div class="video-call-overlay">
                            <div class="video-call-info">
                                <div class="video-call-name" id="video-call-name">è§’è‰²åç§°</div>
                                <div class="video-call-status" id="video-call-status">è§†é¢‘é€šè¯ä¸­...</div>
                                <div class="video-call-time" id="video-call-timer">00:00</div>
                            </div>
                        </div>


                    </div>

                    <!-- æ¶ˆæ¯æµ®ç°åŒºåŸŸ -->
                    <div class="video-call-floating-messages" id="video-call-floating-messages">
                        <!-- è§†é¢‘é€šè¯ä¸­çš„æ¶ˆæ¯å°†ä»¥æµ®ç°æ°”æ³¡å½¢å¼åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>

                    <!-- è¾“å…¥å’Œæ§åˆ¶åŒºåŸŸ -->
                    <div class="video-call-bottom-area">
                        <div class="video-call-input-area">
                            <input type="text" id="video-call-input" placeholder="è¾“å…¥æ¶ˆæ¯..." class="video-call-text-input" onkeypress="if(event.key === 'Enter') { event.preventDefault(); sendVideoCallMessage(); }">
                            <button class="video-call-send-btn" onclick="sendVideoCallMessage()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>

                        <div class="video-call-controls">
                            <button class="video-call-control-btn mute-btn" onclick="toggleVideoMute()" id="video-mute-btn">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <button class="video-call-control-btn end-call-btn" onclick="endVideoCall()">
                                <i class="fas fa-phone" style="transform: rotate(135deg);"></i>
                            </button>
                            <button class="video-call-control-btn camera-btn" onclick="toggleVideoCamera()" id="video-camera-btn">
                                <i class="fas fa-video"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘é™ªä¼´åŠŸèƒ½ - æ´»åŠ¨é€‰æ‹©æ¨¡æ€æ¡† -->
                <div id="companion-activity-modal" class="modal-overlay" style="display: none;" onclick="hideCompanionActivityModal(event)">
                    <div class="modal-content companion-modal" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3>ä½ æƒ³é‚€Taé™ªä½ â€¦</h3>
                            <button class="modal-close" onclick="hideCompanionActivityModal()">Ã—</button>
                        </div>
                        <div class="modal-body">
                            <div class="companion-activity-options" id="companion-activity-options">
                                <!-- é¢„è®¾æ´»åŠ¨æŒ‰é’® -->
                                <button class="companion-option-btn" onclick="selectCompanionActivity('å­¦ä¹ ')">å­¦ä¹ </button>
                                <button class="companion-option-btn" onclick="selectCompanionActivity('è¿åŠ¨')">è¿åŠ¨</button>
                                <button class="companion-option-btn" onclick="selectCompanionActivity('å·¥ä½œ')">å·¥ä½œ</button>
                                <button class="companion-option-btn" onclick="selectCompanionActivity('ä¼‘æ¯')">ä¼‘æ¯</button>
                                <!-- è‡ªå®šä¹‰æ´»åŠ¨æŒ‰é’®å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                            </div>
                            <button class="add-custom-btn" onclick="showCustomActivityInput()">+ æ·»åŠ è‡ªå®šä¹‰æ´»åŠ¨</button>
                            <!-- è‡ªå®šä¹‰æ´»åŠ¨è¾“å…¥æ¡†ï¼ˆåˆå§‹éšè—ï¼‰ -->
                            <div id="custom-activity-input-container" class="custom-input-container" style="display: none;">
                                <input type="text" id="custom-activity-input" class="custom-input" placeholder="è¾“å…¥æ´»åŠ¨åç§°..." maxlength="10">
                                <div class="custom-input-buttons">
                                    <button class="custom-cancel-btn" onclick="cancelCustomActivity()">å–æ¶ˆ</button>
                                    <button class="custom-confirm-btn" onclick="confirmCustomActivity()">ç¡®è®¤</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘é™ªä¼´åŠŸèƒ½ - æ—¶é•¿é€‰æ‹©æ¨¡æ€æ¡† -->
                <div id="companion-duration-modal" class="modal-overlay" style="display: none;" onclick="hideCompanionDurationModal(event)">
                    <div class="modal-content companion-modal" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3>æƒ³è¦Taé™ªä¼´å¤šä¹…ï¼Ÿ</h3>
                            <button class="modal-close" onclick="hideCompanionDurationModal()">Ã—</button>
                        </div>
                        <div class="modal-body">
                            <div class="companion-duration-options" id="companion-duration-options">
                                <!-- é¢„è®¾æ—¶é•¿æŒ‰é’® -->
                                <button class="companion-option-btn" onclick="selectCompanionDuration(15, 'åäº”åˆ†é’Ÿ')">åäº”åˆ†é’Ÿ</button>
                                <button class="companion-option-btn" onclick="selectCompanionDuration(30, 'åŠå°æ—¶')">åŠå°æ—¶</button>
                                <button class="companion-option-btn" onclick="selectCompanionDuration(60, 'ä¸€å°æ—¶')">ä¸€å°æ—¶</button>
                                <button class="companion-option-btn" onclick="selectCompanionDuration(0, 'ä¸é™æ—¶')">ä¸é™æ—¶</button>
                                <!-- è‡ªå®šä¹‰æ—¶é•¿æŒ‰é’®å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                            </div>
                            <button class="add-custom-btn" onclick="showCustomDurationInput()">+ è‡ªå®šä¹‰æ—¶é•¿</button>
                            <!-- è‡ªå®šä¹‰æ—¶é•¿è¾“å…¥æ¡†ï¼ˆåˆå§‹éšè—ï¼‰ -->
                            <div id="custom-duration-input-container" class="custom-input-container" style="display: none;">
                                <input type="number" id="custom-duration-input" class="custom-input" placeholder="è¾“å…¥åˆ†é’Ÿæ•°..." min="1" max="999">
                                <div class="custom-input-buttons">
                                    <button class="custom-cancel-btn" onclick="cancelCustomDuration()">å–æ¶ˆ</button>
                                    <button class="custom-confirm-btn" onclick="confirmCustomDuration()">ç¡®è®¤</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘é™ªä¼´æ¨¡å¼ç•Œé¢ -->
                <div id="companion-mode-screen" class="app-screen" style="display: none;">
                    <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
                    <div class="app-status-bar">
                        <div class="app-time-container">
                            <span class="app-time" id="companion-app-time">12:00</span>
                        </div>
                        <div class="app-status-icons">
                            <div class="app-signal-container">
                                <div class="signal-bars">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ä¸»ç”»é¢ï¼šé™ªä¼´å½¢è±¡ -->
                    <div class="companion-main-view">
                        <img id="companion-character-image" src="" alt="é™ªä¼´å½¢è±¡" class="companion-character-image">
                        <video id="companion-character-video" class="companion-character-video" style="display: none;" loop muted playsinline></video>

                        <!-- å·¦ä¸Šè§’è¿”å›æŒ‰é’® -->
                        <button class="companion-back-btn" onclick="confirmEndCompanion()">
                            <span class="companion-btn-bracket">â€¹</span>
                        </button>

                        <!-- å³ä¸Šè§’è®¾ç½®æŒ‰é’® -->
                        <button class="companion-settings-btn" onclick="openCompanionSettings()">
                            <i class="fas fa-cog"></i>
                        </button>

                        <!-- å·¦ä¸‹è§’è®¡æ—¶å™¨ - ç£¨ç ‚çƒä½“æ ·å¼ -->
                        <div class="companion-timer-display">
                            <div class="companion-timer-orb">
                                <div class="companion-timer-text" id="companion-timer">00:00</div>
                                <span class="companion-timer-ring"></span>
                                <span class="companion-timer-pointer"></span>
                            </div>
                        </div>

                        <!-- AIæ¶ˆæ¯æµ®ç°åŒºåŸŸ - ä¸‹åŠå±æ˜¾ç¤º -->
                        <div class="companion-floating-messages" id="companion-floating-messages">
                            <!-- AIä¸»åŠ¨å‘è¨€çš„æ¶ˆæ¯å°†åœ¨è¿™é‡Œæµ®ç°æ˜¾ç¤º -->
                        </div>
                    </div>

                    <!-- èƒŒæ™¯éŸ³ä¹æ’­æ”¾å™¨ï¼ˆéšè—ï¼‰ -->
                    <div id="companion-music-players" style="display: none;"></div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘é™ªä¼´è®¾ç½®é¡µé¢ -->
                <div id="companion-settings-screen" class="app-screen" style="display: none;">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-icon battery-icon">
                                <div class="battery-level"></div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="hideCompanionSettings()">â€¹</button>
                        <div class="app-title">é™ªä¼´è®¾ç½®</div>
                    </div>
                    <div class="app-content padding-none-flex overflow-auto">
                        <div class="settings-container">
                            <!-- è®¾ç½®å†…å®¹åŒºåŸŸ -->
                            <div class="companion-settings-content-area" id="companion-settings-content">
                                <!-- é™ªä¼´å½¢è±¡è®¾ç½® -->
                                <div class="settings-section">
                                    <div class="settings-section-header">
                                        <i class="fas fa-image"></i>
                                        <span>é™ªä¼´å½¢è±¡</span>
                                        <span style="font-size: 12px; color: #999; margin-left: 8px;">ï¼ˆç‚¹å‡» + å¯æ·»åŠ å¤šä¸ªå½¢è±¡ï¼‰</span>
                                    </div>
                                    <div class="settings-section-content">
                                        <div class="companion-category-list" id="companion-images-category-list">
                                            <!-- åŠ¨æ€ç”Ÿæˆåˆ†ç±»å½¢è±¡åˆ—è¡¨ -->
                                        </div>
                                    </div>
                                </div>

                                <!-- èƒŒæ™¯éŸ³ä¹è®¾ç½® -->
                                <div class="settings-section">
                                    <div class="settings-section-header">
                                        <i class="fas fa-music"></i>
                                        <span>èƒŒæ™¯éŸ³ä¹</span>
                                        <span style="font-size: 12px; color: #999; margin-left: 8px;">ï¼ˆç‚¹å‡» + å¯æ·»åŠ å¤šé¦–éŸ³ä¹ï¼‰</span>
                                    </div>
                                    <div class="settings-section-content">
                                        <div class="companion-category-list" id="companion-music-category-list">
                                            <!-- åŠ¨æ€ç”Ÿæˆåˆ†ç±»éŸ³ä¹åˆ—è¡¨ -->
                                        </div>
                                    </div>
                                </div>

                                <!-- å½¢è±¡è½®æ¢è®¾ç½® -->
                                <div class="settings-section">
                                    <div class="settings-section-header">
                                        <i class="fas fa-sync-alt"></i>
                                        <span>å½¢è±¡è½®æ¢è®¾ç½®</span>
                                    </div>
                                    <div class="settings-section-content">
                                        <div class="companion-frequency-input-group">
                                            <label for="companion-image-rotation-interval">æ¯éš”</label>
                                            <input type="number" id="companion-image-rotation-interval" class="companion-interval-input" min="5" max="1800" value="10" placeholder="10">
                                            <label>ç§’åˆ‡æ¢å½¢è±¡</label>
                                        </div>
                                        <div class="companion-frequency-input-group" style="margin-top: 10px;">
                                            <label>è½®æ¢æ–¹å¼ï¼š</label>
                                            <label style="margin-left: 10px;">
                                                <input type="radio" name="image-rotation-mode" value="sequential" checked>
                                                <span>é¡ºåº</span>
                                            </label>
                                            <label style="margin-left: 10px;">
                                                <input type="radio" name="image-rotation-mode" value="random">
                                                <span>éšæœº</span>
                                            </label>
                                        </div>
                                        <div class="companion-frequency-hint">
                                            ä»…åœ¨åŒä¸€æ´»åŠ¨æœ‰å¤šä¸ªå½¢è±¡æ—¶ç”Ÿæ•ˆï¼ŒèŒƒå›´5-1800ç§’
                                        </div>
                                    </div>
                                </div>

                                <!-- ä¸»åŠ¨å‘è¨€é¢‘ç‡è®¾ç½® -->
                                <div class="settings-section">
                                    <div class="settings-section-header">
                                        <i class="fas fa-comment-dots"></i>
                                        <span>ä¸»åŠ¨å‘è¨€é¢‘ç‡</span>
                                    </div>
                                    <div class="settings-section-content">
                                        <div class="companion-frequency-input-group">
                                            <label for="companion-speak-interval">è§’è‰²æ¯éš”</label>
                                            <input type="number" id="companion-speak-interval" class="companion-interval-input" min="10" max="7200" value="60" placeholder="60">
                                            <label>ç§’å‘è¨€ä¸€æ¬¡</label>
                                        </div>
                                        <div class="companion-frequency-hint">
                                            å»ºè®®è®¾ç½®åœ¨30-180ç§’ä¹‹é—´ï¼ŒèŒƒå›´10-7200ç§’ï¼ˆ2å°æ—¶ï¼‰
                                        </div>
                                    </div>
                                </div>

                                <!-- è¡¥å……ç³»ç»Ÿæç¤ºè¯è®¾ç½® -->
                                <div class="settings-section">
                                    <div class="settings-section-header">
                                        <i class="fas fa-edit"></i>
                                        <span>è¡¥å……ç³»ç»Ÿæç¤ºè¯</span>
                                    </div>
                                    <div class="settings-section-content">
                                        <textarea id="companion-system-prompt" class="companion-prompt-textarea" placeholder="åœ¨è¿™é‡Œè¾“å…¥è¡¥å……çš„ç³»ç»Ÿæç¤ºè¯ï¼Œå°†ä¸é»˜è®¤æç¤ºè¯ä¸€èµ·ä½¿ç”¨..."></textarea>
                                    </div>
                                </div>

                                <!-- ä¿å­˜æŒ‰é’® -->
                                <div class="settings-section">
                                    <div class="settings-section-content">
                                        <button class="companion-save-btn" onclick="saveCompanionSettings()">ä¿å­˜è®¾ç½®</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å­—ä½“ä¸å­—å·è®¾ç½® -->
                <div id="display-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                        <div class="app-header">
                            <button class="back-button" onclick="backToSettings('display-screen')">â€¹</button>
                            <div class="app-title">å­—ä½“ä¸å­—å·</div>
                        </div>
                    </div>
                    <div class="app-content">
                        <div class="font-size-preview">
                            <div class="font-size-preview-text" id="font-size-preview">
                                è¿™æ˜¯ä¸€æ®µç¤ºä¾‹æ–‡å­—ï¼Œç”¨äºé¢„è§ˆå­—ä½“å¤§å°æ•ˆæœã€‚è°ƒèŠ‚ä¸‹æ–¹æ»‘å—å¯ä»¥æ”¹å˜å­—ä½“å¤§å°ã€‚
                            </div>
                        </div>

                        <div class="settings-item">
                            <div class="settings-item-left">
                                <div>
                                    <div class="setting-label">å­—ä½“ä¸å­—å·</div>
                                    <div class="setting-desc">é€‰æ‹©å­—ä½“æ–‡ä»¶å¹¶è°ƒèŠ‚å…¨å±€å­—ä½“å¤§å°</div>
                                </div>
                            </div>
                        </div>

                        <div class="font-size-slider-container">
                            <div class="font-size-labels">
                                <span>å°</span>
                                <span>æ ‡å‡†</span>
                                <span>å¤§</span>
                            </div>
                            <input type="range" class="font-size-slider" id="font-size-slider"
                                   min="12" max="20" step="1" value="15"
                                   onchange="changeFontSize(this.value)">
                            <div class="font-size-value">
                                å½“å‰å­—å·ï¼š<span id="font-size-value">15px</span>
                            </div>
                        </div>

                        <div class="settings-item">
                            <div class="settings-item-left">
                                <div>
                                    <div class="setting-label">å­—è·è®¾ç½®</div>
                                    <div class="setting-desc">è°ƒèŠ‚æ–‡å­—ä¹‹é—´çš„é—´è·</div>
                                </div>
                            </div>
                        </div>

                        <div class="font-size-slider-container">
                            <div class="font-size-labels">
                                <span>ç´§å‡‘</span>
                                <span>æ ‡å‡†</span>
                                <span>å®½æ¾</span>
                            </div>
                            <input type="range" class="font-size-slider" id="letter-spacing-slider"
                                   min="-0.5" max="2" step="0.1" value="0"
                                   onchange="changeLetterSpacing(this.value)">
                            <div class="font-size-value">
                                å½“å‰å­—è·ï¼š<span id="letter-spacing-value">æ ‡å‡†</span>
                            </div>
                        </div>

                        <div class="settings-item">
                            <div class="settings-item-left">
                                <div>
                                    <div class="setting-label">è‡ªåŠ¨ç¼©æ”¾</div>
                                    <div class="setting-desc">æ ¹æ®å±å¹•å°ºå¯¸è‡ªåŠ¨è°ƒæ•´å­—ä½“å¤§å°</div>
                                </div>
                            </div>
                            <label class="settings-toggle">
                                <input type="checkbox" id="auto-scale-toggle" onchange="toggleAutoScale()">
                                <span class="settings-slider"></span>
                            </label>
                        </div>

                        <!-- ğŸ”¥ã€æ–°å¢ã€‘è‡ªå®šä¹‰å­—ä½“è®¾ç½® -->
                        <div class="settings-item">
                            <div class="settings-item-left">
                                <div>
                                    <div class="setting-label">è‡ªå®šä¹‰å­—ä½“</div>
                                    <div class="setting-desc">ä½¿ç”¨åœ¨çº¿å­—ä½“é“¾æ¥è‡ªå®šä¹‰å…¨å±€å­—ä½“</div>
                                </div>
                            </div>
                        </div>

                        <div class="custom-font-container">
                            <div class="form-group">
                                <label>å­—ä½“é“¾æ¥</label>
                                <input type="url" id="global-font-url" placeholder="æ”¯æŒCSSé“¾æ¥æˆ–TTF/OTF/WOFFå­—ä½“æ–‡ä»¶é“¾æ¥" class="form-input">
                                <div class="font-url-hint">
                                    <div>æ”¯æŒæ ¼å¼ï¼š</div>
                                    <div>â€¢ CSSé“¾æ¥ï¼šhttps://fontsapi.zeoseven.com/5/main/result.css</div>
                                    <div>â€¢ å­—ä½“æ–‡ä»¶ï¼šhttps://files.catbox.moe/fp15b6.ttf</div>
                                </div>
                            </div>

                            <div class="font-action-buttons">
                                <button type="button" class="font-button font-button-preview" onclick="previewGlobalFont()">
                                    <i class="fas fa-eye"></i> é¢„è§ˆå­—ä½“
                                </button>
                                <button type="button" class="font-button font-button-apply" onclick="applyGlobalFont()">
                                    <i class="fas fa-check"></i> åº”ç”¨å­—ä½“
                                </button>
                                <button type="button" class="font-button font-button-reset" onclick="resetGlobalFont()">
                                    <i class="fas fa-undo"></i> é‡ç½®å­—ä½“
                                </button>
                            </div>

                            <div id="global-font-status" class="font-status" style="display: none;">
                                <div class="font-status-text"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å±å¹•å°ºå¯¸è®¾ç½® -->
                <div id="screen-size-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="backToSettings('screen-size-screen')">â€¹</button>
                        <div class="app-title">å±å¹•å°ºå¯¸</div>
                    </div>
                    <div class="app-content">
                        <div class="size-option" onclick="changeScreenSize(350, 740, 'é€‚ä¸­å°ºå¯¸')" id="size-350-740">
                            <div class="size-option-left">
                                <div class="size-name">é€‚ä¸­å°ºå¯¸</div>
                                <div class="size-desc">350Ã—740 (æ¨è)</div>
                            </div>
                            <div class="size-preview">
                                <div class="size-preview-rect size-preview-rect-s"></div>
                            </div>
                            <i class="fas fa-check check-icon"></i>
                        </div>

                        <div class="size-option" onclick="changeScreenSize(425, 860, 'iPhone 15')">
                            <div class="size-option-left">
                                <div class="size-name">iPhone 15</div>
                                <div class="size-desc">425Ã—860 (é€‚é…æ‰‹æœº)</div>
                            </div>
                            <div class="size-preview">
                                <div class="size-preview-rect size-preview-rect-l"></div>
                            </div>
                        </div>

                        <div class="size-option" onclick="changeScreenSize(450, 950, 'iPhone 15 Plus')">
                            <div class="size-option-left">
                                <div class="size-name">iPhone 15 Plus</div>
                                <div class="size-desc">450Ã—950 (å¤§å±)</div>
                            </div>
                            <div class="size-preview">
                                <div class="size-preview-rect size-preview-rect-xl"></div>
                            </div>
                        </div>

                        <!-- ğŸ”¥ã€æ–°å¢ã€‘è‡ªå®šä¹‰å°ºå¯¸é€‰é¡¹ -->
                        <div class="size-option" onclick="showCustomSizeModal()" id="custom-size-option">
                            <div class="size-option-left">
                                <div class="size-name">è‡ªå®šä¹‰å°ºå¯¸</div>
                                <div class="size-desc" id="custom-size-desc">ç‚¹å‡»è®¾ç½®è‡ªå®šä¹‰å°ºå¯¸</div>
                            </div>
                            <div class="size-preview">
                                <div class="size-preview-rect size-preview-rect-custom" style="background: linear-gradient(45deg, #007AFF, #34C759); border-radius: 3px;"></div>
                            </div>
                            <i class="fas fa-check check-icon"></i>
                        </div>
                    </div>
                </div>

                <!-- å¤–è§‚è®¾ç½® -->
                <div id="appearance-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                        <div class="app-header">
                            <button class="back-button" onclick="backToSettings('appearance-screen')">â€¹</button>
                            <div class="app-title">å¤–è§‚è®¾ç½®</div>
                        </div>
                    </div>
                    <div class="app-content">
                        <div class="settings-item">
                            <div class="settings-item-left">
                                <div>
                                    <div class="setting-label">å…¨å±æ˜¾ç¤º</div>
                                    <div class="setting-desc">è‡ªåŠ¨é€‚åº”æµè§ˆå™¨å±å¹•ï¼Œæ— è¾¹æ¡†å…¨å±æ•ˆæœ</div>
                                </div>
                            </div>
                            <label class="settings-toggle">
                                <input type="checkbox" id="phone-border-toggle" onchange="togglePhoneBorder()">
                                <span class="settings-slider"></span>
                            </label>
                        </div>
                         <div class="settings-item">
                            <div class="settings-item-left">
                                <div>
                                    <div class="setting-label">éšè—çŠ¶æ€æ </div>
                                    <div class="setting-desc">éšè—é¡¶éƒ¨æ—¶é—´ã€ä¿¡å·å’Œç”µæ± æ˜¾ç¤º</div>
                                </div>
                            </div>
                            <label class="settings-toggle">
                                <input type="checkbox" id="hide-status-bar-toggle" onchange="toggleStatusBarVisibility()">
                                <span class="settings-slider"></span>
                            </label>
                        </div>        
                        <div class="settings-item" onclick="showScreenSizeOptions()">
                            <div class="settings-item-left">
                                <div>
                                    <div class="setting-label">å±å¹•å°ºå¯¸</div>
                                    <div class="setting-desc" id="current-screen-size">å½“å‰ï¼š350Ã—740 (é€‚ä¸­å°ºå¯¸)</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <!-- ğŸ”¥ã€ä¿®æ”¹ã€‘ä¸»å±å¹•å­—ä½“è®¾ç½® - æ”¹ä¸ºä¸‹æ‹‰èœå• -->
                        <div class="settings-item" style="position: relative;">
                            <div class="settings-item-left">
                                <div>
                                    <div class="setting-label">ä¸»å±å¹•å­—ä½“</div>
                                    <div class="setting-desc">è®¾ç½®ä¸»å±å¹•å­—ä½“åŠç”µæ± çš„é¢œè‰²</div>
                                </div>
                            </div>
                            <div class="home-font-selector" onclick="toggleHomeFontDropdown()">
                                <span id="current-home-font-text">é»‘è‰²</span>
                                <i class="fas fa-chevron-down" id="home-font-arrow"></i>
                            </div>

                            <!-- ğŸ”¥ã€æ–°å¢ã€‘ä¸»å±å¹•å­—ä½“ä¸‹æ‹‰é€‰æ‹©èœå• -->
                            <div id="home-font-dropdown" class="home-font-dropdown" style="display: none;">
                                <div class="home-font-option selected" onclick="selectHomeFont('black')">
                                    <i class="fas fa-check"></i>
                                    <span>é»‘è‰²</span>
                                    <small>é€‚åˆæµ…è‰²å£çº¸</small>
                                </div>
                                <div class="home-font-option" onclick="selectHomeFont('white')">
                                    <i class="fas fa-check"></i>
                                    <span>ç™½è‰²</span>
                                    <small>é€‚åˆæ·±è‰²å£çº¸</small>
                                </div>
                            </div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-item-left">
                                <div>
                                    <div class="setting-label">çŠ¶æ€æ å›¾æ ‡</div>
                                    <div class="setting-desc">è‡ªå®šä¹‰æ—¶é—´å³ä¾§æ˜¾ç¤ºçš„å›¾æ ‡æˆ–æ–‡å­—</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="text" id="status-icon-input" placeholder="è¾“å…¥" maxlength="5"
                                       style="width: 50px; padding: 6px 8px; border: 1px solid var(--theme-input-border, rgba(0, 0, 0, 0.08));
                                              border-radius: var(--theme-input-radius, 15px); background: var(--theme-form-bg, rgba(255, 255, 255, 0.8));
                                              font-size: 14px; text-align: center;"
                                       onchange="updateStatusIcon()">
                                <button onclick="resetStatusIcon()"
                                        style="padding: 6px 10px; background: var(--theme-button-secondary-bg, rgba(255, 255, 255, 0.8));
                                               border: 1px solid var(--theme-button-secondary-border, rgba(0, 0, 0, 0.1));
                                               border-radius: var(--theme-input-radius, 15px); color: var(--theme-button-secondary-color, #555);
                                               font-size: 12px; cursor: pointer; flex-shrink: 0;">
                                    é‡ç½®
                                </button>
                            </div>
                        </div>

                        <!-- ğŸ”¥ã€æ–°å¢ã€‘æ—¶é—´æ—¥æœŸæ ·å¼è®¾ç½® -->
                        <div class="settings-item" style="position: relative;">
                            <div class="settings-item-left">
                                <div>
                                    <div class="setting-label">æ—¶é—´æ—¥æœŸæ ·å¼</div>
                                    <div class="setting-desc">é€‰æ‹©ä¸»å±å¹•æ—¶é—´æ—¥æœŸçš„æ˜¾ç¤ºé£æ ¼</div>
                                </div>
                            </div>
                            <div class="clock-style-selector" onclick="toggleClockStyleDropdown()">
                                <span id="current-clock-style-text">é»˜è®¤</span>
                                <i class="fas fa-chevron-down" id="clock-style-arrow"></i>
                            </div>

                            <!-- ğŸ”¥ã€æ–°å¢ã€‘ä¸‹æ‹‰é€‰æ‹©èœå• -->
                            <div id="clock-style-dropdown" class="clock-style-dropdown" style="display: none;">
                                <div class="clock-style-option selected" onclick="selectClockStyle('default')">
                                    <i class="fas fa-check"></i>
                                    <span>é»˜è®¤æ ·å¼</span>
                                    <small>ç»å…¸ç®€æ´çš„æ—¶é—´æ˜¾ç¤º</small>
                                </div>
                                <div class="clock-style-option" onclick="selectClockStyle('bold')">
                                    <i class="fas fa-check"></i>
                                    <span>ç²—ä½“æ ·å¼</span>
                                    <small>ç±»ä¼¼iPhoneé”å±çš„ç²—ä½“æ˜¾ç¤º</small>
                                </div>
                                <div class="clock-style-option" onclick="selectClockStyle('compact')">
                                    <i class="fas fa-check"></i>
                                    <span>ç´§å‡‘æ ·å¼</span>
                                    <small>ç±»ä¼¼Androidçš„ç®€æ´æ˜¾ç¤º</small>
                                </div>
                                <div class="clock-style-option" onclick="selectClockStyle('modern')">
                                    <i class="fas fa-check"></i>
                                    <span>ç°ä»£æ ·å¼</span>
                                    <small>ç±»ä¼¼å°ç±³MIUIçš„ç°ä»£è®¾è®¡</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- éŸ³æ•ˆè®¾ç½®ç•Œé¢ -->
                <div id="sound-settings-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                        <div class="app-header">
                            <button class="back-button" onclick="backToSettings('sound-settings-screen')">â€¹</button>
                            <div class="app-title">éŸ³æ•ˆè®¾ç½®</div>
                        </div>
                    </div>
                    <div class="app-content">
                        <div class="form-container">
                            <!-- éŸ³æ•ˆå¼€å…³ -->
                            <div class="form-group">
                                <label class="switch-label">
                                    <span>å¯ç”¨éŸ³æ•ˆ</span>
                                    <input type="checkbox" id="sound-enabled" checked onchange="toggleSoundSystem()">
                                    <span class="switch-slider"></span>
                                </label>
                            </div>

                            <!-- éŸ³æ•ˆè®¾ç½®åˆ—è¡¨ -->
                            <div id="sound-settings-list">
                                <!-- æ¥æ”¶æ¶ˆæ¯éŸ³æ•ˆ -->
                                <div class="sound-setting-item">
                                    <div class="sound-setting-header">
                                        <h3>æ¥æ”¶æ¶ˆæ¯éŸ³æ•ˆ</h3>
                                        <p>è§’è‰²å‘æ¶ˆæ¯æ—¶æ’­æ”¾</p>
                                    </div>
                                    <div class="sound-setting-controls">
                                        <input type="url" placeholder="è¾“å…¥éŸ³æ•ˆé“¾æ¥" id="sound-messageReceived-url" class="sound-url-input">
                                        <input type="file" accept="audio/*,.mp3,.m4a,.wav,.aac,.ogg,.flac" id="sound-messageReceived-file" style="display: none;" onchange="handleSoundFileUpload(this, 'messageReceived')">
                                        <button onclick="document.getElementById('sound-messageReceived-file').click()" class="sound-file-btn">
                                            <i class="fas fa-upload"></i> æœ¬åœ°æ–‡ä»¶
                                        </button>
                                        <button onclick="testSound('messageReceived')" class="sound-test-btn">
                                            <i class="fas fa-play"></i> è¯•å¬
                                        </button>
                                        <button onclick="clearSound('messageReceived')" class="sound-clear-btn">
                                            <i class="fas fa-trash"></i> æ¸…é™¤
                                        </button>
                                    </div>
                                </div>

                                <!-- å‘é€æ¶ˆæ¯éŸ³æ•ˆ -->
                                <div class="sound-setting-item">
                                    <div class="sound-setting-header">
                                        <h3>å‘é€æ¶ˆæ¯éŸ³æ•ˆ</h3>
                                        <p>ç”¨æˆ·å‘æ¶ˆæ¯æ—¶æ’­æ”¾</p>
                                    </div>
                                    <div class="sound-setting-controls">
                                        <input type="url" placeholder="è¾“å…¥éŸ³æ•ˆé“¾æ¥" id="sound-messageSent-url" class="sound-url-input">
                                        <input type="file" accept="audio/*,.mp3,.m4a,.wav,.aac,.ogg,.flac" id="sound-messageSent-file" style="display: none;" onchange="handleSoundFileUpload(this, 'messageSent')">
                                        <button onclick="document.getElementById('sound-messageSent-file').click()" class="sound-file-btn">
                                            <i class="fas fa-upload"></i> æœ¬åœ°æ–‡ä»¶
                                        </button>
                                        <button onclick="testSound('messageSent')" class="sound-test-btn">
                                            <i class="fas fa-play"></i> è¯•å¬
                                        </button>
                                        <button onclick="clearSound('messageSent')" class="sound-clear-btn">
                                            <i class="fas fa-trash"></i> æ¸…é™¤
                                        </button>
                                    </div>
                                </div>

                                <!-- æ¶ˆæ¯æ¨é€éŸ³æ•ˆ -->
                                <div class="sound-setting-item">
                                    <div class="sound-setting-header">
                                        <h3>æ¶ˆæ¯æ¨é€éŸ³æ•ˆ</h3>
                                        <p>æ”¶åˆ°æ¨é€é€šçŸ¥æ—¶æ’­æ”¾</p>
                                    </div>
                                    <div class="sound-setting-controls">
                                        <input type="url" placeholder="è¾“å…¥éŸ³æ•ˆé“¾æ¥" id="sound-notification-url" class="sound-url-input">
                                        <input type="file" accept="audio/*,.mp3,.m4a,.wav,.aac,.ogg,.flac" id="sound-notification-file" style="display: none;" onchange="handleSoundFileUpload(this, 'notification')">
                                        <button onclick="document.getElementById('sound-notification-file').click()" class="sound-file-btn">
                                            <i class="fas fa-upload"></i> æœ¬åœ°æ–‡ä»¶
                                        </button>
                                        <button onclick="testSound('notification')" class="sound-test-btn">
                                            <i class="fas fa-play"></i> è¯•å¬
                                        </button>
                                        <button onclick="clearSound('notification')" class="sound-clear-btn">
                                            <i class="fas fa-trash"></i> æ¸…é™¤
                                        </button>
                                    </div>
                                </div>

                                <!-- æ‹¨å‡ºé€šè¯éŸ³æ•ˆ -->
                                <div class="sound-setting-item">
                                    <div class="sound-setting-header">
                                        <h3>æ‹¨å‡ºé€šè¯éŸ³æ•ˆ</h3>
                                        <p>ç”¨æˆ·æ‹¨æ‰“è¯­éŸ³/è§†é¢‘é€šè¯æ—¶æ’­æ”¾</p>
                                    </div>
                                    <div class="sound-setting-controls">
                                        <input type="url" placeholder="è¾“å…¥éŸ³æ•ˆé“¾æ¥" id="sound-outgoingCall-url" class="sound-url-input">
                                        <input type="file" accept="audio/*,.mp3,.m4a,.wav,.aac,.ogg,.flac" id="sound-outgoingCall-file" style="display: none;" onchange="handleSoundFileUpload(this, 'outgoingCall')">
                                        <button onclick="document.getElementById('sound-outgoingCall-file').click()" class="sound-file-btn">
                                            <i class="fas fa-upload"></i> æœ¬åœ°æ–‡ä»¶
                                        </button>
                                        <button onclick="testSound('outgoingCall')" class="sound-test-btn">
                                            <i class="fas fa-play"></i> è¯•å¬
                                        </button>
                                        <button onclick="clearSound('outgoingCall')" class="sound-clear-btn">
                                            <i class="fas fa-trash"></i> æ¸…é™¤
                                        </button>
                                    </div>
                                </div>

                                <!-- æ¥ç”µéŸ³æ•ˆ -->
                                <div class="sound-setting-item">
                                    <div class="sound-setting-header">
                                        <h3>æ¥ç”µéŸ³æ•ˆ</h3>
                                        <p>è§’è‰²æ‹¨æ‰“è¯­éŸ³/è§†é¢‘é€šè¯æ—¶æ’­æ”¾</p>
                                    </div>
                                    <div class="sound-setting-controls">
                                        <input type="url" placeholder="è¾“å…¥éŸ³æ•ˆé“¾æ¥" id="sound-incomingCall-url" class="sound-url-input">
                                        <input type="file" accept="audio/*,.mp3,.m4a,.wav,.aac,.ogg,.flac" id="sound-incomingCall-file" style="display: none;" onchange="handleSoundFileUpload(this, 'incomingCall')">
                                        <button onclick="document.getElementById('sound-incomingCall-file').click()" class="sound-file-btn">
                                            <i class="fas fa-upload"></i> æœ¬åœ°æ–‡ä»¶
                                        </button>
                                        <button onclick="testSound('incomingCall')" class="sound-test-btn">
                                            <i class="fas fa-play"></i> è¯•å¬
                                        </button>
                                        <button onclick="clearSound('incomingCall')" class="sound-clear-btn">
                                            <i class="fas fa-trash"></i> æ¸…é™¤
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- è¯´æ˜æ–‡å­— -->
                            <div class="sound-settings-note">
                                <p><i class="fas fa-info-circle"></i> æ”¯æŒåœ¨çº¿é“¾æ¥å’Œæœ¬åœ°æ–‡ä»¶ï¼ˆæœ€å¤§3MBï¼‰</p>
                                <p><i class="fas fa-info-circle"></i> æ”¯æŒå¸¸è§éŸ³é¢‘æ ¼å¼ï¼šMP3ã€WAVã€OGGç­‰</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ä¸»é¢˜è®¾ç½®ç•Œé¢ -->
                <div id="theme-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                                <div class="app-battery-container">
                                    <div class="app-battery-icon">
                                        <div class="app-battery-level"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="app-header">
                            <button class="back-button" onclick="backToSettings('theme-screen')">â€¹</button>
                            <div class="app-title">ä¸»é¢˜è®¾ç½®</div>
                        </div>
                    </div>
                    <div class="app-content">
                        <div class="theme-option" onclick="changeTheme('default').catch(e => console.error('åˆ‡æ¢ä¸»é¢˜å¤±è´¥:', e))">
                            <div class="theme-preview theme-preview-simple">
                                <div class="theme-preview-header"></div>
                                <div class="theme-preview-content"></div>
                            </div>
                            <div class="theme-info">
                                <div class="theme-name">ç®€çº¦é£æ ¼</div>
                                <div class="theme-description">æ¸…æ–°ç®€æ´çš„é»˜è®¤ä¸»é¢˜</div>
                            </div>
                        </div>

                        <div class="theme-option" onclick="changeTheme('cute').catch(e => console.error('åˆ‡æ¢ä¸»é¢˜å¤±è´¥:', e))">
                            <div class="theme-preview theme-preview-cute">
                                <div class="theme-preview-header"></div>
                                <div class="theme-preview-content"></div>
                            </div>
                            <div class="theme-info">
                                <div class="theme-name">å¯çˆ±é£æ ¼</div>
                                <div class="theme-description">æ¸©é¦¨å¯çˆ±çš„ç²‰è‰²ä¸»é¢˜</div>
                            </div>
                        </div>

                        <div class="theme-option" onclick="changeTheme('dark').catch(e => console.error('åˆ‡æ¢ä¸»é¢˜å¤±è´¥:', e))">
                            <div class="theme-preview theme-preview-dark">
                                <div class="theme-preview-header"></div>
                                <div class="theme-preview-content"></div>
                            </div>
                            <div class="theme-info">
                                <div class="theme-name">å¤œé—´æ¨¡å¼</div>
                                <div class="theme-description">æŠ¤çœ¼çš„æ·±è‰²ä¸»é¢˜</div>
                            </div>
                        </div>

                        <div class="theme-option" onclick="showApp('custom-theme-screen')">
                            <div class="theme-preview theme-preview-custom">
                                <div class="theme-preview-header"></div>
                                <div class="theme-preview-content">
                                    <i class="fas fa-paint-brush"></i>
                                </div>
                            </div>
                            <div class="theme-info">
                                <div class="theme-name">è‡ªå®šä¹‰ä¸»é¢˜</div>
                                <div class="theme-description">æ‰“é€ ä¸“å±çš„ä¸ªæ€§åŒ–ç•Œé¢</div>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>

                <!-- è‡ªå®šä¹‰ä¸»é¢˜ç•Œé¢ -->
                <div id="custom-theme-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                        <div class="app-header">
                            <button class="back-button" onclick="backToSettings('custom-theme-screen')">â€¹</button>
                            <div class="app-title">è‡ªå®šä¹‰ä¸»é¢˜</div>
                        </div>
                    </div>
                    <div class="app-content custom-theme-content">
                        <!-- ä¸»é¢˜åˆ†ç±»é€‰é¡¹å¡ -->
                        <div class="custom-theme-tabs">
                            <div class="custom-theme-tab active" onclick="switchCustomThemeTab('chat')">
                                <i class="fas fa-comment-dots"></i>
                                <span>èŠå¤©ç•Œé¢</span>
                            </div>
                            <div class="custom-theme-tab" onclick="switchCustomThemeTab('global')">
                                <i class="fas fa-mobile-alt"></i>
                                <span>å…¨å±€ç•Œé¢</span>
                            </div>
                        </div>

                        <!-- èŠå¤©ç•Œé¢è‡ªå®šä¹‰ -->
                        <div id="chat-theme-content" class="custom-theme-content-pane">
                            <!-- èŠå¤©ç•Œé¢èƒŒæ™¯è®¾ç½® -->
                            <div class="custom-theme-section">
                                <div class="section-title">
                                    <i class="fas fa-image"></i>
                                    <span>ç•Œé¢èƒŒæ™¯</span>
                                </div>

                                <div class="custom-theme-item" onclick="uploadChatTopBackground()" id="chat-top-bg-item">
                                    <div class="theme-item-left">
                                        <div class="theme-item-icon">
                                            <i class="fas fa-window-maximize"></i>
                                        </div>
                                        <div class="theme-item-info">
                                            <div class="theme-item-title">é¡¶éƒ¨åº”ç”¨æ èƒŒæ™¯</div>
                                            <div class="theme-item-desc">åŒ…å«çŠ¶æ€æ å’Œæ ‡é¢˜æ </div>
                                        </div>
                                    </div>
                                    <div class="theme-item-preview" id="chat-top-bg-preview">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                    <div class="theme-item-status" id="chat-top-bg-status" style="display: none;">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                </div>

                                <div class="custom-theme-item" onclick="uploadChatBottomBackground()" id="chat-bottom-bg-item">
                                    <div class="theme-item-left">
                                        <div class="theme-item-icon">
                                            <i class="fas fa-keyboard"></i>
                                        </div>
                                        <div class="theme-item-info">
                                            <div class="theme-item-title">åº•éƒ¨è¾“å…¥æ èƒŒæ™¯</div>
                                            <div class="theme-item-desc">è¾“å…¥æ¡†å’ŒæŒ‰é’®åŒºåŸŸ</div>
                                        </div>
                                    </div>
                                    <div class="theme-item-preview" id="chat-bottom-bg-preview">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                    <div class="theme-item-status" id="chat-bottom-bg-status" style="display: none;">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                </div>
                            </div>

                            <!-- æŒ‰é’®è‡ªå®šä¹‰è®¾ç½® -->
                            <div class="custom-theme-section">
                                <div class="section-title">
                                    <i class="fas fa-mouse-pointer"></i>
                                    <span>æŒ‰é’®æ ·å¼</span>
                                </div>

                                <div class="custom-theme-item" onclick="uploadButtonIcon('back')" id="back-btn-item">
                                    <div class="theme-item-left">
                                        <div class="theme-item-icon">
                                            <i class="fas fa-arrow-left"></i>
                                        </div>
                                        <div class="theme-item-info">
                                            <div class="theme-item-title">è¿”å›æŒ‰é’®</div>
                                            <div class="theme-item-desc">èŠå¤©ç•Œé¢å·¦ä¸Šè§’è¿”å›æŒ‰é’®</div>
                                        </div>
                                    </div>
                                    <div class="theme-item-preview" id="back-btn-preview">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                    <div class="theme-item-status" id="back-btn-status" style="display: none;">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                </div>

                                <div class="custom-theme-item" onclick="uploadButtonIcon('offline')" id="offline-btn-item">
                                    <div class="theme-item-left">
                                        <div class="theme-item-icon">
                                            <i class="fas fa-door-open"></i>
                                        </div>
                                        <div class="theme-item-info">
                                            <div class="theme-item-title">çº¿ä¸‹æ¨¡å¼æŒ‰é’®</div>
                                            <div class="theme-item-desc">èŠå¤©ç•Œé¢çº¿ä¸‹æ¨¡å¼åˆ‡æ¢</div>
                                        </div>
                                    </div>
                                    <div class="theme-item-preview" id="offline-btn-preview">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                    <div class="theme-item-status" id="offline-btn-status" style="display: none;">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                </div>

                                <div class="custom-theme-item" onclick="uploadButtonIcon('settings')" id="settings-btn-item">
                                    <div class="theme-item-left">
                                        <div class="theme-item-icon">
                                            <i class="fas fa-cog"></i>
                                        </div>
                                        <div class="theme-item-info">
                                            <div class="theme-item-title">èŠå¤©è®¾ç½®æŒ‰é’®</div>
                                            <div class="theme-item-desc">èŠå¤©ç•Œé¢å³ä¸Šè§’è®¾ç½®æŒ‰é’®</div>
                                        </div>
                                    </div>
                                    <div class="theme-item-preview" id="settings-btn-preview">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                    <div class="theme-item-status" id="settings-btn-status" style="display: none;">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                </div>

                                <div class="custom-theme-item" onclick="uploadButtonIcon('expand')" id="expand-btn-item">
                                    <div class="theme-item-left">
                                        <div class="theme-item-icon">
                                            <i class="fas fa-plus"></i>
                                        </div>
                                        <div class="theme-item-info">
                                            <div class="theme-item-title">åŠŸèƒ½åŒºå±•å¼€æŒ‰é’®</div>
                                            <div class="theme-item-desc">åº•éƒ¨è¾“å…¥æ å·¦ä¾§å±•å¼€æŒ‰é’®</div>
                                        </div>
                                    </div>
                                    <div class="theme-item-preview" id="expand-btn-preview">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                    <div class="theme-item-status" id="expand-btn-status" style="display: none;">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                </div>

                                <div class="custom-theme-item" onclick="uploadButtonIcon('continue')" id="continue-btn-item">
                                    <div class="theme-item-left">
                                        <div class="theme-item-icon">
                                            <i class="fas fa-comment-dots"></i>
                                        </div>
                                        <div class="theme-item-info">
                                            <div class="theme-item-title">ç»­å†™æŒ‰é’®</div>
                                            <div class="theme-item-desc">è·å–AIå›å¤æŒ‰é’®</div>
                                        </div>
                                    </div>
                                    <div class="theme-item-preview" id="continue-btn-preview">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                    <div class="theme-item-status" id="continue-btn-status" style="display: none;">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                </div>

                                <div class="custom-theme-item" onclick="uploadButtonIcon('send')" id="send-btn-item">
                                    <div class="theme-item-left">
                                        <div class="theme-item-icon">
                                            <i class="fas fa-paper-plane"></i>
                                        </div>
                                        <div class="theme-item-info">
                                            <div class="theme-item-title">å‘é€æ¶ˆæ¯æŒ‰é’®</div>
                                            <div class="theme-item-desc">åº•éƒ¨è¾“å…¥æ å‘é€æŒ‰é’®</div>
                                        </div>
                                    </div>
                                    <div class="theme-item-preview" id="send-btn-preview">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                    <div class="theme-item-status" id="send-btn-status" style="display: none;">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                </div>
                            </div>

                            <!-- åº”ç”¨èŒƒå›´è®¾ç½® -->
                            <div class="custom-theme-section">
                                <div class="section-title">
                                    <i class="fas fa-layer-group"></i>
                                    <span>åº”ç”¨èŒƒå›´</span>
                                </div>

                                <div class="theme-scope-options">
                                    <div class="theme-scope-option active" data-scope="selected">
                                        <i class="fas fa-users"></i>
                                        <span>é€‰æ‹©èŠå¤©çª—å£</span>
                                    </div>
                                    <div class="theme-scope-option" data-scope="all">
                                        <i class="fas fa-globe"></i>
                                        <span>æ‰€æœ‰èŠå¤©çª—å£</span>
                                    </div>
                                </div>

                                <!-- é€‰æ‹©èŠå¤©çª—å£åˆ—è¡¨ï¼ˆå½“é€‰æ‹©"é€‰æ‹©èŠå¤©çª—å£"æ—¶æ˜¾ç¤ºï¼‰ -->
                                <div id="chat-selection-list" class="chat-selection-list">
                                    <!-- èŠå¤©çª—å£åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>
                        </div>

                        <!-- å…¨å±€ç•Œé¢è‡ªå®šä¹‰ -->
                        <div id="global-theme-content" class="custom-theme-content-pane" style="display: none;">
                            <!-- å…¨å±€åº”ç”¨æ è®¾ç½® -->
                            <div class="custom-theme-section">
                                <div class="section-title">
                                    <i class="fas fa-window-maximize"></i>
                                    <span>åº”ç”¨æ æ ·å¼ï¼ˆæ’é™¤èŠå¤©ç•Œé¢ï¼‰</span>
                                </div>

                                <div class="custom-theme-item" onclick="uploadGlobalTopAppBar()" id="global-top-app-bar-item">
                                    <div class="theme-item-left">
                                        <div class="theme-item-icon">
                                            <i class="fas fa-window-maximize"></i>
                                        </div>
                                        <div class="theme-item-info">
                                            <div class="theme-item-title">é¡¶éƒ¨åº”ç”¨æ </div>
                                            <div class="theme-item-desc">åº”ç”¨åˆ°é™¤APIèŠå¤©å’ŒçŸ­ä¿¡èŠå¤©ä»¥å¤–çš„æ‰€æœ‰åº”ç”¨é¡µé¡¶éƒ¨</div>
                                        </div>
                                    </div>
                                    <div class="theme-item-preview" id="global-top-app-bar-preview">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                    <div class="theme-item-status" id="global-top-app-bar-status" style="display: none;">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                </div>

                                <div class="custom-theme-item" onclick="uploadGlobalBottomAppBar()" id="global-bottom-app-bar-item">
                                    <div class="theme-item-left">
                                        <div class="theme-item-icon">
                                            <i class="fas fa-window-minimize"></i>
                                        </div>
                                        <div class="theme-item-info">
                                            <div class="theme-item-title">åº•éƒ¨åº”ç”¨æ </div>
                                            <div class="theme-item-desc">åº”ç”¨åˆ°é™¤APIèŠå¤©å’ŒçŸ­ä¿¡èŠå¤©ä»¥å¤–çš„æ‰€æœ‰åº”ç”¨é¡µåº•éƒ¨</div>
                                        </div>
                                    </div>
                                    <div class="theme-item-preview" id="global-bottom-app-bar-preview">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                    <div class="theme-item-status" id="global-bottom-app-bar-status" style="display: none;">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                </div>
                            </div>

                            <!-- æ ‡é¢˜æ æŒ‰é’®è®¾ç½® -->
                            <div class="custom-theme-section">
                                <div class="section-title">
                                    <i class="fas fa-mouse-pointer"></i>
                                    <span>æ ‡é¢˜æ æŒ‰é’®ï¼ˆæ’é™¤èŠå¤©ç•Œé¢ï¼‰</span>
                                </div>

                                <div class="custom-theme-item" onclick="uploadGlobalBackButton()" id="global-back-button-item">
                                    <div class="theme-item-left">
                                        <div class="theme-item-icon">
                                            <i class="fas fa-arrow-left"></i>
                                        </div>
                                        <div class="theme-item-info">
                                            <div class="theme-item-title">è¿”å›æŒ‰é’®</div>
                                            <div class="theme-item-desc">åº”ç”¨åˆ°é™¤APIèŠå¤©å’ŒçŸ­ä¿¡èŠå¤©ä»¥å¤–çš„è¿”å›æŒ‰é’®</div>
                                        </div>
                                    </div>
                                    <div class="theme-item-preview" id="global-back-button-preview">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                    <div class="theme-item-status" id="global-back-button-status" style="display: none;">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                </div>

                                <div class="custom-theme-item" onclick="uploadGlobalAddButton()">
                                    <div class="theme-item-left">
                                        <div class="theme-item-icon">
                                            <i class="fas fa-plus"></i>
                                        </div>
                                        <div class="theme-item-info">
                                            <div class="theme-item-title">æ·»åŠ æŒ‰é’®</div>
                                            <div class="theme-item-desc">åº”ç”¨åˆ°é™¤APIèŠå¤©å’ŒçŸ­ä¿¡èŠå¤©ä»¥å¤–çš„æ·»åŠ æŒ‰é’®</div>
                                        </div>
                                    </div>
                                    <div class="theme-item-preview" id="global-add-button-preview">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                </div>
                            </div>

                            <!-- å…¨å±€èƒŒæ™¯è®¾ç½® -->
                            <div class="custom-theme-section">
                                <div class="section-title">
                                    <i class="fas fa-image"></i>
                                    <span>åº”ç”¨èƒŒæ™¯ï¼ˆæ’é™¤èŠå¤©ç•Œé¢ï¼‰</span>
                                </div>

                                <div class="custom-theme-item" onclick="uploadGlobalBackground()">
                                    <div class="theme-item-left">
                                        <div class="theme-item-icon">
                                            <i class="fas fa-desktop"></i>
                                        </div>
                                        <div class="theme-item-info">
                                            <div class="theme-item-title">å…¨å±€åº”ç”¨èƒŒæ™¯</div>
                                            <div class="theme-item-desc">åº”ç”¨åˆ°é™¤APIèŠå¤©å’ŒçŸ­ä¿¡èŠå¤©ä»¥å¤–çš„æ‰€æœ‰åº”ç”¨ç•Œé¢</div>
                                        </div>
                                    </div>
                                    <div class="theme-item-preview" id="global-bg-preview">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                </div>
                            </div>


                        </div>

                        <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
                        <div class="custom-theme-actions">
                            <button class="theme-action-btn manage-btn" onclick="showThemeManagement().catch(e => console.error('æ˜¾ç¤ºä¸»é¢˜ç®¡ç†å¤±è´¥:', e))">
                                <i class="fas fa-cog"></i>
                                <span>ç®¡ç†</span>
                            </button>
                            <button class="theme-action-btn reset-btn" onclick="resetCustomTheme().catch(e => console.error('é‡ç½®ä¸»é¢˜å¤±è´¥:', e))">
                                <i class="fas fa-undo"></i>
                                <span>é‡ç½®</span>
                            </button>
                            <button class="theme-action-btn preview-btn" onclick="previewCustomTheme()">
                                <i class="fas fa-eye"></i>
                                <span>é¢„è§ˆ</span>
                            </button>
                            <button class="theme-action-btn apply-btn" onclick="applyCustomTheme().catch(e => console.error('åº”ç”¨ä¸»é¢˜å¤±è´¥:', e))">
                                <i class="fas fa-check"></i>
                                <span>åº”ç”¨</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- å£çº¸è®¾ç½® -->
                <div id="wallpaper-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                        <div class="app-header">
                            <button class="back-button" onclick="backToSettings('wallpaper-screen')">â€¹</button>
                            <div class="app-title">å£çº¸</div>
                        </div>
                    </div>
                    <div class="app-content">
                        <div class="settings-item" onclick="showWallpaperPicker()">
                            <div class="settings-item-left">
                                <div>é€‰æ‹©æ–°å£çº¸</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="settings-item" onclick="showIconPicker()">
                            <div class="settings-item-left">
                                <div>æ›´æ”¹åº”ç”¨å›¾æ ‡</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>

                <!-- æ— çº¿å±€åŸŸç½‘è®¾ç½® -->
                <div id="wifi-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('wifi-screen')">â€¹</button>
                        <div class="app-title">æ— çº¿å±€åŸŸç½‘</div>
                    </div>
                    <div class="app-content">
                        <div class="wifi-settings">
                            <div class="settings-item">
                                <div class="settings-item-left">
                                    <div>æ— çº¿å±€åŸŸç½‘</div>
                                </div>
                                <label class="settings-toggle">
                                    <input type="checkbox" checked>
                                    <span class="settings-slider"></span>
                                </label>
                            </div>

                            <div class="wifi-network">
                                <div class="wifi-network-left">
                                    <div class="wifi-icon">
                                        <i class="fas fa-lock"></i>
                                    </div>
                                    <div>
                                        <div>HomeWiFi</div>
                                        <div class="wifi-strength">
                                            <div class="wifi-strength-bar active"></div>
                                            <div class="wifi-strength-bar active"></div>
                                            <div class="wifi-strength-bar active"></div>
                                            <div class="wifi-strength-bar active"></div>
                                        </div>
                                    </div>
                                </div>
                                <i class="fas fa-check check-icon"></i>
                            </div>

                            <div class="settings-item settings-item-margin" onclick="showApp('api-settings-screen')">
                                <div class="settings-item-left">
                                    <div>APIè®¾ç½®</div>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- APIè®¾ç½®ç•Œé¢ -->
                <div id="api-settings-screen" class="app-screen">
                    <div class="app-top-container">
                        <div class="app-status-bar">
                            <div class="app-status-time"></div>
                            <div class="app-status-right">
                                <div class="app-signal-icon signal-icon">
                                    <div class="signal-row">
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                        <div class="signal-bar"></div>
                                    </div>
                                </div>
                                <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                        <div class="app-header">
                            <button class="back-button" onclick="backToSettings('api-settings-screen')">â€¹</button>
                            <div class="app-title">APIè®¾ç½®</div>
                        </div>
                    </div>
                    <div class="app-content">
                        <div class="form-container" style="color: #000000;">



                            <!-- å¿«é€Ÿè®¾ç½®å¡ç‰‡ -->
                            <div class="form-group" style="margin-bottom: 30px;">
                                <label style="color: #333; margin-bottom: 15px; display: block; font-size: 16px; font-weight: 600;">ğŸš€ å¿«é€Ÿè®¾ç½®</label>

                                <!-- Geminiç›´è¿å¡ç‰‡ -->
                                <div style="margin-bottom: 12px; padding: 18px; background: linear-gradient(135deg, rgba(74, 132, 193, 0.1) 0%, rgba(74, 132, 193, 0.05) 100%); border: 2px solid rgba(74, 132, 193, 0.2); border-radius: 16px; color: #333; cursor: pointer; transition: all 0.3s ease; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);" onclick="setGeminiDirect()">
                                    <div style="display: flex; align-items: center; justify-content: space-between;">
                                        <div>
                                            <div style="font-size: 16px; font-weight: 600; margin-bottom: 4px; color: var(--theme-button-bg, #4a84c1);">ğŸŒŸ Gemini ç›´è¿</div>
                                            <div style="font-size: 13px; color: #666;">è‡ªåŠ¨é…ç½®Googleå®˜æ–¹URLï¼Œå¦‚éœ€å®˜æ–¹apiè¯·è‡³å®˜ç½‘ç”³è¯·</div>
                                        </div>
                                        <div style="background: var(--theme-button-bg, rgba(74, 132, 193, 0.9)); color: white; padding: 8px 14px; border-radius: 20px; font-size: 13px; font-weight: 500; box-shadow: 0 2px 8px rgba(74, 132, 193, 0.3);">ç‚¹å‡»é…ç½®</div>
                                    </div>
                            </div>

                                <!-- HuggingFaceåä»£å¡ç‰‡ -->
                                <div style="margin-bottom: 15px; padding: 18px; background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 193, 7, 0.05) 100%); border: 2px solid rgba(255, 193, 7, 0.2); border-radius: 16px; color: #333; cursor: pointer; transition: all 0.3s ease; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);" onclick="setHuggingFaceProxy()">
                                    <div style="display: flex; align-items: center; justify-content: space-between;">
                                        <div>
                                            <div style="font-size: 16px; font-weight: 600; margin-bottom: 4px; color: #f39c12;">ğŸ¤— HuggingFace åä»£</div>
                                            <div style="font-size: 13px; color: #666;">æ”¯æŒGeminiåä»£</div>
                                        </div>
                                        <div style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); color: white; padding: 8px 14px; border-radius: 20px; font-size: 13px; font-weight: 500; box-shadow: 0 2px 8px rgba(243, 156, 18, 0.3);">ç‚¹å‡»é…ç½®</div>
                                    </div>
                            </div>

                                <div style="font-size: 12px; color: #666; text-align: center; margin-top: 10px;">
                                    âš ï¸ ä½¿ç”¨å‰è¯·ç¡®ä¿æœ‰å¯¹åº”çš„APIå¯†é’¥
                                </div>
                            </div>

                            <!-- APIé…ç½®è¡¨å• - ç¾åŒ–ç‰ˆ -->
                            <div style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border-radius: 20px; padding: 25px; margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); border: 1px solid rgba(255, 255, 255, 0.2);">

                                <!-- APIåœ°å€ -->
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--theme-text-primary, #333); font-size: 15px;">APIåœ°å€</label>
                                    <input type="text" id="api-base" placeholder="ä¾‹å¦‚: https://api.openai.com æˆ– @https://xxx-xxx.hf.space/v1" style="width: 100%; padding: 12px 15px; border: 2px solid var(--theme-input-border, rgba(0, 0, 0, 0.08)); border-radius: 12px; font-size: 16px; background: var(--theme-form-bg, rgba(255, 255, 255, 0.9)); backdrop-filter: blur(10px); transition: all 0.3s ease; color: var(--theme-text-primary, #333); box-sizing: border-box;">
                                    <div style="font-size: 12px; color: #666; margin-top: 5px;">æ”¯æŒæ ‡å‡†APIå’ŒHuggingFaceç­‰åä»£ï¼ˆéœ€è¦å¡«å…¥/v1åç¼€ï¼‰ï¼Œæ‹‰å–å¤±è´¥æ—¶å°è¯•æ”¹ä¸ºhttp:æˆ–å»æ‰/v1åç¼€</div>
                            </div>

                                <!-- APIå¯†é’¥ -->
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--theme-text-primary, #333); font-size: 15px;">APIå¯†é’¥</label>
                                    <input type="password" id="api-key" placeholder="sk-... æˆ– Google AI Studio API Key" style="width: 100%; padding: 12px 15px; border: 2px solid var(--theme-input-border, rgba(0, 0, 0, 0.08)); border-radius: 12px; font-size: 16px; background: var(--theme-form-bg, rgba(255, 255, 255, 0.9)); backdrop-filter: blur(10px); transition: all 0.3s ease; color: var(--theme-text-primary, #333); box-sizing: border-box;">
                                </div>

                                <!-- æ¨¡å‹é€‰æ‹© -->
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--theme-text-primary, #333); font-size: 15px;">æ¨¡å‹</label>
                                    <div style="display: flex; gap: 10px; align-items: center; width: 100%; overflow: hidden;">
                                        <select id="model-select" style="flex: 1; min-width: 0; padding: 12px 15px; border: 2px solid var(--theme-input-border, rgba(0, 0, 0, 0.08)); border-radius: 12px; font-size: 16px; background: var(--theme-form-bg, rgba(255, 255, 255, 0.9)); backdrop-filter: blur(10px); transition: all 0.3s ease; color: var(--theme-text-primary, #333); max-height: 200px; overflow-y: auto;">
                                            <!-- æ¨¡å‹é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€å¡«å…… -->
                                    </select>
                                        <button id="fetch-models-btn" onclick="fetchModels()" style="padding: 10px 16px; background: var(--theme-button-secondary-bg, rgba(255, 255, 255, 0.8)); color: var(--theme-button-secondary-color, #666); border: 2px solid var(--theme-button-secondary-border, rgba(0, 0, 0, 0.1)); border-radius: 10px; cursor: pointer; font-size: 14px; font-weight: 500; backdrop-filter: blur(10px); transition: all 0.3s ease; white-space: nowrap;">æ‹‰å–æ¨¡å‹</button>
                                </div>
                            </div>

                                <!-- æ¸©åº¦å‚æ•° -->
                                <div style="margin-bottom: 25px;">
                                    <label style="display: block; margin-bottom: 12px; font-weight: 600; color: var(--theme-text-primary, #333); font-size: 15px;">æ¸©åº¦å‚æ•° (<span id="temperature-value" style="color: var(--theme-button-bg, #4a84c1); font-weight: 700;">0.75</span>)</label>
                                    <div style="background: rgba(255, 255, 255, 0.8); padding: 15px; border-radius: 12px; border: 2px solid var(--theme-input-border, rgba(0, 0, 0, 0.08));">
                                        <input type="range" id="temperature-slider" min="0" max="2" step="0.05" value="0.75" oninput="document.getElementById('temperature-value').textContent = parseFloat(this.value).toFixed(2);" style="width: 100%; height: 6px; border-radius: 3px; background: linear-gradient(to right, rgba(74, 132, 193, 0.2) 0%, rgba(74, 132, 193, 0.4) 100%); outline: none; -webkit-appearance: none; appearance: none;">
                                        <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 12px; color: #666;">
                                            <span>0.00 (ä¿å®ˆ)</span>
                                            <span>1.00 (å¹³è¡¡)</span>
                                            <span>2.00 (åˆ›æ–°)</span>
                                        </div>
                                        <div style="font-size: 12px; color: #666; margin-top: 8px; text-align: center;">æ¸©åº¦è¶Šä½ï¼Œå›ç­”è¶Šä¿å®ˆç¨³å®šï¼›æ¸©åº¦è¶Šé«˜ï¼Œå›ç­”è¶Šæœ‰åˆ›æ„å¤šæ ·ï¼Œä½†æœ‰åç¦»äººè®¾çš„å¯èƒ½</div>
                                    </div>
                            </div>

                                <!-- è¡¨æƒ…åŒ…è¯†åˆ«è®¾ç½® -->
                                <div style="margin-bottom: 25px;">
                                    <label style="display: block; margin-bottom: 12px; font-weight: 600; color: var(--theme-text-primary, #333); font-size: 15px;">è¡¨æƒ…åŒ…è¯†åˆ«</label>
                                    <div style="background: rgba(255, 255, 255, 0.8); padding: 15px; border-radius: 12px; border: 2px solid var(--theme-input-border, rgba(0, 0, 0, 0.08));">
                                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                                            <input type="checkbox" id="emoji-recognition-enabled" style="width: 18px; height: 18px; accent-color: var(--theme-button-bg, #4a84c1);">
                                            <span style="font-size: 14px; color: var(--theme-text-primary, #333);">å¯ç”¨AIè¯†åˆ«è¡¨æƒ…åŒ…å›¾ç‰‡</span>
                                        </label>
                                        <div style="font-size: 12px; color: #666; margin-top: 8px; line-height: 1.4;">
                                            å…³é—­åï¼ŒAIå°†æ— æ³•è¯†åˆ«è¡¨æƒ…åŒ…å…·ä½“å›¾ç‰‡å†…å®¹ï¼Œä½†ä»å¯è¯†åˆ«æ™®é€šå›¾ç‰‡ã€‚è¿™å¯ä»¥èŠ‚çœtokenæ¶ˆè€—ã€‚
                                        </div>
                                    </div>
                                </div>

                                <!-- æ“ä½œæŒ‰é’® -->
                                <div style="display: flex; gap: 12px; margin-top: 25px;">
                                    <button id="test-api-connection-btn" onclick="testApiConnection()" style="flex: 1; padding: 14px 20px; background: linear-gradient(135deg, #34c759 0%, #30d158 100%); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; backdrop-filter: blur(10px); box-shadow: 0 4px 15px rgba(52, 199, 89, 0.3); transition: all 0.3s ease;">æµ‹è¯•è¿æ¥</button>
                                    <button id="save-api-settings-btn" onclick="saveApiSettings()" style="flex: 1; padding: 14px 20px; background: var(--theme-button-bg, rgba(74, 132, 193, 0.9)); color: var(--theme-button-color, white); border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; backdrop-filter: blur(10px); box-shadow: var(--theme-button-shadow, 0 4px 15px rgba(74, 132, 193, 0.3)); transition: all 0.3s ease;">ä¿å­˜è®¾ç½®</button>
                                </div>
                            </div>

                            <!-- ğŸ”¥ã€æ–°å¢ã€‘é«˜çº§APIè®¾ç½® - çŠ¶æ€æ›´æ–°å’Œè®°å¿†æ€»ç»“ -->
                            <hr style="margin: 30px 0; border: none; border-top: 1px solid #eaeaea;">
                            <div style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border-radius: 20px; padding: 25px; margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); border: 1px solid rgba(255, 255, 255, 0.2);">
                                <h4 style="margin: 0 0 15px 0; color: #333; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                                    <span>é«˜çº§APIè®¾ç½®</span> 
                                </h4>
                                <p style="font-size: 13px; color: #666; margin: 0 0 20px 0; line-height: 1.5;">
                                    ä¸ºçŠ¶æ€æ›´æ–°å’Œè®°å¿†æ€»ç»“é…ç½®ç‹¬ç«‹çš„APIï¼Œå¯ä½¿ç”¨æ›´ç»æµçš„æ¨¡å‹ã€‚å¦‚ä¸é…ç½®ï¼Œå°†ä½¿ç”¨ä¸Šæ–¹çš„ä¸»èŠå¤©APIã€‚
                                </p>

                                <!-- çŠ¶æ€æ›´æ–°APIè®¾ç½® -->
                                <div style="margin-bottom: 25px;">
                                    <label style="display: flex; align-items: center; gap: 12px; cursor: pointer; padding: 15px; background: rgba(255, 255, 255, 0.8); border-radius: 12px; border: 2px solid var(--theme-input-border, rgba(0, 0, 0, 0.08)); margin-bottom: 15px;">
                                        <input type="checkbox" id="status-api-enabled" style="width: 18px; height: 18px; accent-color: var(--theme-button-bg, #4a84c1);" onchange="toggleStatusAPI()">
                                        <div>
                                            <div style="font-size: 14px; color: var(--theme-text-primary, #333); font-weight: 500;">å¯ç”¨ç‹¬ç«‹çš„çŠ¶æ€æ›´æ–°API</div>
                                            <div style="font-size: 12px; color: #666; margin-top: 4px;">ç”¨äºè§’è‰²çŠ¶æ€çš„æ›´æ–°</div>
                                        </div>
                                    </label>

                                    <div id="status-api-config" style="display: none; padding: 20px; background: rgba(248, 249, 250, 0.8); border-radius: 12px; border: 2px solid rgba(0, 0, 0, 0.05);">
                                        <div style="margin-bottom: 15px;">
                                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 14px;">APIåœ°å€</label>
                                            <input type="text" id="status-api-base" placeholder="ä¾‹å¦‚: https://api.openai.com" style="width: 100%; padding: 10px 12px; border: 2px solid rgba(0, 0, 0, 0.08); border-radius: 10px; font-size: 14px; background: rgba(255, 255, 255, 0.9); color: #333; box-sizing: border-box;">
                                        </div>
                                        <div style="margin-bottom: 15px;">
                                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 14px;">APIå¯†é’¥</label>
                                            <input type="password" id="status-api-key" placeholder="sk-..." style="width: 100%; padding: 10px 12px; border: 2px solid rgba(0, 0, 0, 0.08); border-radius: 10px; font-size: 14px; background: rgba(255, 255, 255, 0.9); color: #333; box-sizing: border-box;">
                                        </div>
                                        <div style="margin-bottom: 15px;">
                                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 14px;">æ¨¡å‹</label>
                                            <div style="display: flex; gap: 8px;">
                                                <input type="text" id="status-api-model" placeholder="ä¾‹å¦‚: gpt-3.5-turbo" style="flex: 1; max-width: 50%; padding: 10px 12px; border: 2px solid rgba(0, 0, 0, 0.08); border-radius: 10px; font-size: 14px; background: rgba(255, 255, 255, 0.9); color: #333; box-sizing: border-box;">
                                                <button onclick="fetchStatusAPIModels()" style="padding: 10px 16px; background: var(--theme-button-bg, rgba(74, 132, 193, 0.9)); color: white; border: none; border-radius: 10px; font-size: 13px; cursor: pointer; white-space: nowrap; transition: all 0.2s ease;">
                                                    <i class="fas fa-download"></i> æ‹‰å–
                                                </button>
                                            </div>
                                        </div>
                                        <div style="margin-bottom: 0;">
                                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 14px;">æ¸©åº¦å‚æ•°: <span id="status-temperature-value" style="color: #4a84c1;">0.70</span></label>
                                            <input type="range" id="status-temperature-slider" min="0" max="2" step="0.05" value="0.70" oninput="document.getElementById('status-temperature-value').textContent = parseFloat(this.value).toFixed(2);" style="width: 100%; height: 6px; border-radius: 3px; background: linear-gradient(to right, rgba(74, 132, 193, 0.2) 0%, rgba(74, 132, 193, 0.4) 100%); outline: none; -webkit-appearance: none; appearance: none;">
                                        </div>
                                    </div>
                                </div>

                                <!-- è®°å¿†æ€»ç»“APIè®¾ç½® -->
                                <div style="margin-bottom: 0;">
                                    <label style="display: flex; align-items: center; gap: 12px; cursor: pointer; padding: 15px; background: rgba(255, 255, 255, 0.8); border-radius: 12px; border: 2px solid var(--theme-input-border, rgba(0, 0, 0, 0.08)); margin-bottom: 15px;">
                                        <input type="checkbox" id="memory-api-enabled" style="width: 18px; height: 18px; accent-color: var(--theme-button-bg, #4a84c1);" onchange="toggleMemoryAPI()">
                                        <div>
                                            <div style="font-size: 14px; color: var(--theme-text-primary, #333); font-weight: 500;">å¯ç”¨ç‹¬ç«‹çš„è®°å¿†æ€»ç»“API</div>
                                            <div style="font-size: 12px; color: #666; margin-top: 4px;">ç”¨äºæƒ…æ™¯è®°å¿†ã€æ ¸å¿ƒè®°å¿†ç­‰çš„æ€»ç»“ç”Ÿæˆ</div>
                                        </div>
                                    </label>

                                    <div id="memory-api-config" style="display: none; padding: 20px; background: rgba(248, 249, 250, 0.8); border-radius: 12px; border: 2px solid rgba(0, 0, 0, 0.05);">
                                        <div style="margin-bottom: 15px;">
                                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 14px;">APIåœ°å€</label>
                                            <input type="text" id="memory-api-base" placeholder="ä¾‹å¦‚: https://api.openai.com" style="width: 100%; padding: 10px 12px; border: 2px solid rgba(0, 0, 0, 0.08); border-radius: 10px; font-size: 14px; background: rgba(255, 255, 255, 0.9); color: #333; box-sizing: border-box;">
                                        </div>
                                        <div style="margin-bottom: 15px;">
                                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 14px;">APIå¯†é’¥</label>
                                            <input type="password" id="memory-api-key" placeholder="sk-..." style="width: 100%; padding: 10px 12px; border: 2px solid rgba(0, 0, 0, 0.08); border-radius: 10px; font-size: 14px; background: rgba(255, 255, 255, 0.9); color: #333; box-sizing: border-box;">
                                        </div>
                                        <div style="margin-bottom: 15px;">
                                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 14px;">æ¨¡å‹</label>
                                            <div style="display: flex; gap: 8px;">
                                                <input type="text" id="memory-api-model" placeholder="ä¾‹å¦‚: gpt-3.5-turbo" style="flex: 1; max-width: 50%; padding: 10px 12px; border: 2px solid rgba(0, 0, 0, 0.08); border-radius: 10px; font-size: 14px; background: rgba(255, 255, 255, 0.9); color: #333; box-sizing: border-box;">
                                                <button onclick="fetchMemoryAPIModels()" style="padding: 10px 16px; background: var(--theme-button-bg, rgba(74, 132, 193, 0.9)); color: white; border: none; border-radius: 10px; font-size: 13px; cursor: pointer; white-space: nowrap; transition: all 0.2s ease;">
                                                    <i class="fas fa-download"></i> æ‹‰å–
                                                </button>
                                            </div>
                                        </div>
                                        <div style="margin-bottom: 0;">
                                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 14px;">æ¸©åº¦å‚æ•°: <span id="memory-temperature-value" style="color: #4a84c1;">0.30</span></label>
                                            <input type="range" id="memory-temperature-slider" min="0" max="2" step="0.05" value="0.30" oninput="document.getElementById('memory-temperature-value').textContent = parseFloat(this.value).toFixed(2);" style="width: 100%; height: 6px; border-radius: 3px; background: linear-gradient(to right, rgba(74, 132, 193, 0.2) 0%, rgba(74, 132, 193, 0.4) 100%); outline: none; -webkit-appearance: none; appearance: none;">
                                            <div style="font-size: 12px; color: #666; margin-top: 5px;">è®°å¿†æ€»ç»“å»ºè®®ä½¿ç”¨è¾ƒä½æ¸©åº¦ä»¥ä¿æŒå®¢è§‚æ€§</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- ä¿å­˜é«˜çº§è®¾ç½®æŒ‰é’® -->
                                <div style="margin-top: 20px;">
                                    <button onclick="saveAdvancedApiSettings()" style="width: 100%; padding: 14px 20px; background: var(--theme-button-bg, rgba(74, 132, 193, 0.9)); color: var(--theme-button-color, white); border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; backdrop-filter: blur(10px); box-shadow: var(--theme-button-shadow, 0 4px 15px rgba(74, 132, 193, 0.3)); transition: all 0.3s ease;">ä¿å­˜é«˜çº§è®¾ç½®</button>
                                </div>
                            </div>

                            <!-- ğŸ”¥ã€æ–°å¢ã€‘MiniMax è¯­éŸ³åˆæˆè®¾ç½® -->
                            <hr style="margin: 30px 0; border: none; border-top: 1px solid #eaeaea;">
                            <div style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border-radius: 20px; padding: 25px; margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); border: 1px solid rgba(255, 255, 255, 0.2);">
                                <h4 style="margin: 0 0 15px 0; color: #333; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                                    <span>ğŸ™ï¸</span> MiniMax è¯­éŸ³åˆæˆ (TTS)
                                </h4>
                                <p style="font-size: 13px; color: #666; margin: 0 0 20px 0; line-height: 1.5;">é…ç½® MiniMax è¯­éŸ³åˆæˆæœåŠ¡ï¼Œä¸ºè§’è‰²æ¶ˆæ¯æ·»åŠ è¯­éŸ³æ’­æ”¾åŠŸèƒ½</p>

                                <!-- TTS å¼€å…³ -->
                                <div style="margin-bottom: 20px;">
                                    <label style="display: flex; align-items: center; gap: 12px; cursor: pointer; padding: 15px; background: rgba(255, 255, 255, 0.8); border-radius: 12px; border: 2px solid var(--theme-input-border, rgba(0, 0, 0, 0.08));">
                                        <input type="checkbox" id="minimax-tts-enabled" style="width: 18px; height: 18px; accent-color: var(--theme-button-bg, #4a84c1);" onchange="toggleMinimaxTTS()">
                                        <span style="font-size: 14px; color: var(--theme-text-primary, #333); font-weight: 500;">å¯ç”¨ MiniMax è¯­éŸ³åˆæˆ</span>
                                    </label>
                                </div>

                                <!-- TTS é…ç½®è¡¨å• -->
                                <div id="minimax-tts-config" style="display: none;">
                                    <!-- ğŸ”¥ã€æ–°å¢ã€‘API ç‰ˆæœ¬é€‰æ‹© -->
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--theme-text-primary, #333); font-size: 15px;">API ç‰ˆæœ¬</label>
                                        <select id="minimax-api-version" style="width: 100%; padding: 12px 15px; border: 2px solid var(--theme-input-border, rgba(0, 0, 0, 0.08)); border-radius: 12px; font-size: 16px; background: var(--theme-form-bg, rgba(255, 255, 255, 0.9)); backdrop-filter: blur(10px); transition: all 0.3s ease; color: var(--theme-text-primary, #333);">
                                            <option value="official">å®˜æ–¹ç‰ˆ</option>
                                            <option value="international">å›½é™…ç‰ˆ</option>
                                            <option value="china">å¤§é™†ç‰ˆ</option>
                                        </select>
                                        <div style="font-size: 12px; color: #666; margin-top: 5px;">é€‰æ‹©é€‚åˆæ‚¨æ‰€åœ¨åœ°åŒºçš„ API åœ°å€ï¼Œæµ·å¤–ç”¨æˆ·è¯·é€‰æ‹©å›½é™…ç‰ˆï¼Œå›½å†…ç”¨æˆ·å¯é€‰å®˜æ–¹/å¤§é™†ç‰ˆï¼Œå¤§é™†ç‰ˆä¼šæœ‰æ›´å¿«çš„å“åº”åŒæ—¶ä¼šæœ‰ç›¸åº”çš„å†…å®¹å®¡æ ¸ç®¡ç†</div>
                                    </div>

                                    <!-- API Key -->
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--theme-text-primary, #333); font-size: 15px;">MiniMax API Key</label>
                                        <input type="password" id="minimax-tts-key" placeholder="è¾“å…¥ MiniMax API Key" style="width: 100%; padding: 12px 15px; border: 2px solid var(--theme-input-border, rgba(0, 0, 0, 0.08)); border-radius: 12px; font-size: 16px; background: var(--theme-form-bg, rgba(255, 255, 255, 0.9)); backdrop-filter: blur(10px); transition: all 0.3s ease; color: var(--theme-text-primary, #333); box-sizing: border-box;">
                                        <div style="font-size: 12px; color: #666; margin-top: 5px;">ä» <a href="https://www.minimaxi.com" target="_blank" style="color: #4a84c1;">MiniMax å¼€æ”¾å¹³å°</a> è·å–</div>
                                    </div>

                                    <!-- Group ID -->
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--theme-text-primary, #333); font-size: 15px;">Group ID</label>
                                        <input type="text" id="minimax-tts-group-id" placeholder="è¾“å…¥ Group ID" style="width: 100%; padding: 12px 15px; border: 2px solid var(--theme-input-border, rgba(0, 0, 0, 0.08)); border-radius: 12px; font-size: 16px; background: var(--theme-form-bg, rgba(255, 255, 255, 0.9)); backdrop-filter: blur(10px); transition: all 0.3s ease; color: var(--theme-text-primary, #333); box-sizing: border-box;">
                                    </div>

                                    <!-- æ¨¡å‹é€‰æ‹© -->
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--theme-text-primary, #333); font-size: 15px;">TTS æ¨¡å‹</label>
                                        <select id="minimax-tts-model" style="width: 100%; padding: 12px 15px; border: 2px solid var(--theme-input-border, rgba(0, 0, 0, 0.08)); border-radius: 12px; font-size: 16px; background: var(--theme-form-bg, rgba(255, 255, 255, 0.9)); backdrop-filter: blur(10px); transition: all 0.3s ease; color: var(--theme-text-primary, #333);">
                                            <option value="speech-01">speech-01 (æ ‡å‡†ç‰ˆ)</option>
                                            <option value="speech-02">speech-02 (é«˜çº§ç‰ˆ)</option>
                                        </select>
                                        <div style="font-size: 12px; color: #666; margin-top: 5px;">éŸ³è‰²ã€è¯­è¨€ã€è¯­é€Ÿè¯·åœ¨è§’è‰²å¡ä¸­å•ç‹¬é…ç½®</div>
                                    </div>

                                    <!-- ä¿å­˜æŒ‰é’® -->
                                    <button onclick="saveMinimaxTTSSettings()" style="width: 100%; padding: 14px 20px; background: var(--theme-button-bg, rgba(74, 132, 193, 0.9)); color: var(--theme-button-color, white); border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; backdrop-filter: blur(10px); box-shadow: var(--theme-button-shadow, 0 4px 15px rgba(74, 132, 193, 0.3)); transition: all 0.3s ease;">
                                        <i class="fas fa-save"></i> ä¿å­˜ TTS è®¾ç½®
                                    </button>
                                </div>
                            </div>

                            <!-- APIé…ç½®ç®¡ç† -->
                            <hr style="margin: 30px 0; border: none; border-top: 1px solid #eaeaea;">
                            <div class="api-config-manager" style="background: rgba(248, 249, 250, 0.8); border-radius: 16px; padding: 20px; margin: 15px 0; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(0,0,0,0.05);">
                                <h4 style="margin: 0 0 15px 0; color: #333; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                                    <span>ğŸ’¾</span> APIé…ç½®ç®¡ç†
                                </h4>
                                <p style="font-size: 13px; color: #666; margin: 0 0 15px 0; line-height: 1.5;">ä¿å­˜å½“å‰é…ç½®ä¸ºé¢„è®¾ï¼Œæ–¹ä¾¿å¿«é€Ÿåˆ‡æ¢ä¸åŒçš„APIæœåŠ¡</p>

                                <div class="save-config-section" style="margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.6); border-radius: 12px; border: 1px solid rgba(0,0,0,0.05);">
                                    <div style="display: flex; gap: 10px; margin-bottom: 12px;">
                                        <input type="text" id="config-name-input" placeholder="è¾“å…¥é…ç½®åç§° (å¦‚: OpenAIã€Geminiã€Claudeç­‰)" style="flex: 1; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; background: rgba(255,255,255,0.9);">
                                        <button id="save-current-config-btn" onclick="saveCurrentConfig()" style="padding: 8px 16px; background: #e8ebf7; color: #5a6acf; border: none; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.3s ease; white-space: nowrap;">ä¿å­˜</button>
                        </div>
                                    <div style="font-size: 12px; color: #888;">å½“å‰é…ç½®å°†ä¿å­˜ä¸º: <span style="color: #333; font-weight: 500;">URL + æ¨¡å‹ + æ¸©åº¦è®¾ç½®</span></div>
                                </div>

                                <div class="saved-configs-section">
                                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                                        <label style="font-size: 14px; font-weight: 500; color: #333;">å·²ä¿å­˜çš„é…ç½®</label>
                                        <button id="clear-all-configs-btn" onclick="clearAllConfigs()" style="padding: 6px 12px; background: rgba(255, 107, 107, 0.1); color: #ff6b6b; border: 1px solid rgba(255, 107, 107, 0.3); border-radius: 6px; font-size: 12px; cursor: pointer; transition: all 0.2s ease;">ğŸ—‘ï¸ æ¸…ç©ºå…¨éƒ¨</button>
                                    </div>
                                    <div id="saved-configs-container" style="display: grid; gap: 10px; max-height: 300px; overflow-y: auto;">
                                        <!-- ä¿å­˜çš„é…ç½®å¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                                    </div>
                                    <div id="no-configs-message" style="text-align: center; color: #999; padding: 30px 20px; font-size: 14px; display: none;">
                                        <div style="font-size: 24px; margin-bottom: 8px;">ğŸ“</div>
                                        <div>è¿˜æ²¡æœ‰ä¿å­˜ä»»ä½•é…ç½®</div>
                                        <div style="font-size: 12px; margin-top: 4px;">åœ¨ä¸Šæ–¹è¾“å…¥é…ç½®åç§°å¹¶ç‚¹å‡»"ä¿å­˜é…ç½®"</div>
                                    </div>
                                </div>
                            </div>



                        </div>
                    </div>
                </div>

                <!-- è§’è‰²æ‰‹æœºç•Œé¢ -->
                <div id="character-phone-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('character-phone-screen'); showApp('api-chat-screen');">â€¹</button>
                        <div class="app-title" id="character-phone-title">è§’è‰²æ‰‹æœº</div>
                        <button class="phone-refresh-btn" onclick="showPhoneRefreshConfirm()" title="åˆ·æ–°æ‰‹æœºå†…å®¹">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>

                    <div class="app-content character-phone-content">
                        <!-- æ‰‹æœºå†…å®¹åŒºåŸŸ -->
                        <div class="phone-content-area">
                            <!-- æ¶ˆæ¯å†…å®¹ -->
                            <div class="phone-tab-content" id="phone-messages-content">
                                <div class="phone-messages-list">
                                    <div class="phone-message-item">
                                        <div class="phone-message-avatar">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        <div class="phone-message-info">
                                            <div class="phone-message-name">å°çº¢</div>
                                            <div class="phone-message-preview">ä»Šå¤©å¤©æ°”çœŸå¥½å‘¢~</div>
                                            <div class="phone-message-time">10:30</div>
                                        </div>
                                    </div>
                                    <div class="phone-message-item">
                                        <div class="phone-message-avatar">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        <div class="phone-message-info">
                                            <div class="phone-message-name">å°æ˜</div>
                                            <div class="phone-message-preview">å‘¨æœ«ä¸€èµ·å‡ºå»ç©å§</div>
                                            <div class="phone-message-time">æ˜¨å¤©</div>
                                        </div>
                                    </div>
                                    <div class="phone-message-item">
                                        <div class="phone-message-avatar">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        <div class="phone-message-info">
                                            <div class="phone-message-name">å¦ˆå¦ˆ</div>
                                            <div class="phone-message-preview">è®°å¾—æŒ‰æ—¶åƒé¥­å“¦</div>
                                            <div class="phone-message-time">æ˜¨å¤©</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- å¤‡å¿˜å½•å†…å®¹ -->
                            <div class="phone-tab-content" id="phone-notes-content" style="display: none;">
                                <div class="phone-notes-list">
                                    <div class="phone-note-item" onclick="openPhoneNote('è´­ç‰©æ¸…å•')">
                                        <div class="phone-note-title">è´­ç‰©æ¸…å•</div>
                                        <div class="phone-note-preview">ç‰›å¥¶ã€é¢åŒ…ã€é¸¡è›‹...</div>
                                        <div class="phone-note-time">ä»Šå¤© 14:20</div>
                                    </div>
                                    <div class="phone-note-item" onclick="openPhoneNote('å·¥ä½œè®¡åˆ’')">
                                        <div class="phone-note-title">å·¥ä½œè®¡åˆ’</div>
                                        <div class="phone-note-preview">å®Œæˆé¡¹ç›®æŠ¥å‘Šï¼Œå‡†å¤‡ä¼šè®®...</div>
                                        <div class="phone-note-time">æ˜¨å¤© 16:45</div>
                                    </div>
                                    <div class="phone-note-item" onclick="openPhoneNote('è¯»ä¹¦ç¬”è®°')">
                                        <div class="phone-note-title">è¯»ä¹¦ç¬”è®°</div>
                                        <div class="phone-note-preview">ä»Šå¤©è¯»äº†ä¸€æœ¬å¾ˆæœ‰è¶£çš„ä¹¦...</div>
                                        <div class="phone-note-time">2å¤©å‰</div>
                                    </div>
                                </div>
                            </div>

                            <!-- ç›¸å†Œå†…å®¹ -->
                            <div class="phone-tab-content" id="phone-photos-content" style="display: none;">
                                <div class="phone-photos-grid">
                                    <div class="phone-photo-item" onclick="openPhonePhoto('æ˜¥æ—¥æ¨±èŠ±')">
                                        <div class="phone-photo-placeholder">
                                            <i class="fas fa-image"></i>
                                        </div>
                                    </div>
                                    <div class="phone-photo-item" onclick="openPhonePhoto('å’–å•¡æ—¶å…‰')">
                                        <div class="phone-photo-placeholder">
                                            <i class="fas fa-image"></i>
                                        </div>
                                    </div>
                                    <div class="phone-photo-item" onclick="openPhonePhoto('å¤•é˜³è¥¿ä¸‹')">
                                        <div class="phone-photo-placeholder">
                                            <i class="fas fa-image"></i>
                                        </div>
                                    </div>
                                    <div class="phone-photo-item" onclick="openPhonePhoto('åŸå¸‚å¤œæ™¯')">
                                        <div class="phone-photo-placeholder">
                                            <i class="fas fa-image"></i>
                                        </div>
                                    </div>
                                    <div class="phone-photo-item" onclick="openPhonePhoto('ç¾é£Ÿè®°å½•')">
                                        <div class="phone-photo-placeholder">
                                            <i class="fas fa-image"></i>
                                        </div>
                                    </div>
                                    <div class="phone-photo-item" onclick="openPhonePhoto('æ—…è¡Œå›å¿†')">
                                        <div class="phone-photo-placeholder">
                                            <i class="fas fa-image"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ğŸ”¥ã€æ–°å¢ã€‘è´­ç‰©è®°å½•å†…å®¹ -->
                            <div class="phone-tab-content" id="phone-shopping-content" style="display: none;">
                                <div class="phone-shopping-list">
                                    <div class="phone-shopping-item">
                                        <div class="phone-shopping-icon">
                                            <i class="fas fa-shopping-bag"></i>
                                        </div>
                                        <div class="phone-shopping-info">
                                            <div class="phone-shopping-title">åŠ è½½ä¸­...</div>
                                            <div class="phone-shopping-detail">æ­£åœ¨è·å–è´­ç‰©è®°å½•</div>
                                        </div>
                                        <div class="phone-shopping-time">--</div>
                                    </div>
                                </div>
                            </div>

                            <!-- ğŸ”¥ã€æ–°å¢ã€‘æœç´¢è®°å½•å†…å®¹ -->
                            <div class="phone-tab-content" id="phone-search-content" style="display: none;">
                                <div class="phone-search-list">
                                    <div class="phone-search-item">
                                        <div class="phone-search-icon">
                                            <i class="fas fa-search"></i>
                                        </div>
                                        <div class="phone-search-info">
                                            <div class="phone-search-keyword">åŠ è½½ä¸­...</div>
                                            <div class="phone-search-time">æ­£åœ¨è·å–æœç´¢è®°å½•</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- åº•éƒ¨æ ‡ç­¾é¡µ -->
                        <div class="phone-tabs">
                            <div class="phone-tab active" onclick="switchPhoneTab('messages')">
                                <i class="fas fa-comment"></i>
                                <span>æ¶ˆæ¯</span>
                            </div>
                            <div class="phone-tab" onclick="switchPhoneTab('notes')">
                                <i class="fas fa-sticky-note"></i>
                                <span>å¤‡å¿˜å½•</span>
                            </div>
                            <div class="phone-tab" onclick="switchPhoneTab('photos')">
                                <i class="fas fa-images"></i>
                                <span>ç›¸å†Œ</span>
                            </div>
                            <div class="phone-tab" onclick="switchPhoneTab('shopping')">
                                <i class="fas fa-shopping-cart"></i>
                                <span>è´­ç‰©</span>
                            </div>
                            <div class="phone-tab" onclick="switchPhoneTab('search')">
                                <i class="fas fa-search"></i>
                                <span>æœç´¢</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è§’è‰²æ‰‹æœºå¯¹è¯è¯¦æƒ…ç•Œé¢ -->
                <div id="character-phone-chat-screen" class="app-screen" style="display: none;">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('character-phone-chat-screen'); showApp('character-phone-screen');">â€¹</button>
                        <div class="app-title" id="phone-chat-contact-name">è”ç³»äºº</div>
                    </div>

                    <div class="app-content phone-chat-content">
                        <!-- å¯¹è¯æ¶ˆæ¯åŒºåŸŸ -->
                        <div class="phone-chat-messages" id="phone-chat-messages">
                            <!-- æ¶ˆæ¯å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>

                        <!-- è¾“å…¥åŒºåŸŸ -->
                        <div class="phone-chat-input-area">
                            <div class="phone-chat-input-container">
                                <input type="text" class="phone-chat-input" placeholder="è¾“å…¥æ¶ˆæ¯..." readonly>
                                <button class="phone-chat-send-btn" disabled>
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è§’è‰²æ‰‹æœºå¤‡å¿˜å½•è¯¦æƒ…ç•Œé¢ -->
                <div id="character-phone-note-screen" class="app-screen" style="display: none;">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('character-phone-note-screen'); showApp('character-phone-screen');">â€¹</button>
                        <div class="app-title" id="phone-note-title">å¤‡å¿˜å½•</div>
                    </div>

                    <div class="app-content phone-note-detail-content">
                        <div class="phone-note-detail">
                            <div class="phone-note-detail-header">
                                <h2 id="phone-note-detail-title">å¤‡å¿˜å½•æ ‡é¢˜</h2>
                                <div class="phone-note-detail-time" id="phone-note-detail-time">æ—¶é—´</div>
                            </div>
                            <div class="phone-note-detail-body" id="phone-note-detail-body">
                                å¤‡å¿˜å½•å†…å®¹...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è§’è‰²æ‰‹æœºç…§ç‰‡è¯¦æƒ…ç•Œé¢ -->
                <div id="character-phone-photo-screen" class="app-screen" style="display: none;">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-status-right">
                            <div class="app-signal-icon signal-icon">
                                <div class="signal-row">
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                    <div class="signal-bar"></div>
                                </div>
                            </div>
                            <div class="app-battery-container">
                                <div class="app-battery-icon">
                                    <div class="app-battery-level"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('character-phone-photo-screen'); showApp('character-phone-screen');">â€¹</button>
                        <div class="app-title">ç…§ç‰‡</div>
                    </div>

                    <div class="app-content phone-photo-detail-content">
                        <div class="phone-photo-detail">
                            <div class="phone-photo-detail-image" id="phone-photo-detail-image">
                                <div class="phone-photo-placeholder-large">
                                    <i class="fas fa-image"></i>
                                    <p>ç…§ç‰‡é¢„è§ˆ</p>
                                </div>
                            </div>
                            <div class="phone-photo-detail-info">
                                <div class="phone-photo-detail-title" id="phone-photo-detail-title">ç…§ç‰‡æ ‡é¢˜</div>
                                <div class="phone-photo-detail-time" id="phone-photo-detail-time">æ‹æ‘„æ—¶é—´</div>
                                <div class="phone-photo-detail-description" id="phone-photo-detail-description">ç…§ç‰‡æè¿°</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€ä¼˜åŒ–ã€‘æ‰‹æœºåˆ·æ–°é€‰æ‹©å¯¹è¯æ¡† -->
                <div class="phone-refresh-confirm-overlay" id="phone-refresh-confirm-overlay">
                    <div class="phone-refresh-confirm-dialog">
                        <div class="phone-refresh-confirm-title">é€‰æ‹©åˆ·æ–°å†…å®¹</div>
                        <div class="phone-refresh-confirm-message">
                            è¯·é€‰æ‹©è¦åˆ·æ–°çš„å†…å®¹ï¼Œæ—§å†…å®¹å°†è¢«æ›¿æ¢ï¼š
                        </div>
                        <div class="phone-refresh-options">
                            <label class="phone-refresh-option">
                                <input type="checkbox" id="refresh-all" onchange="toggleRefreshAll(this)">
                                <span class="option-text">å…¨é€‰</span>
                            </label>
                            <label class="phone-refresh-option">
                                <input type="checkbox" class="refresh-item" value="messages" checked onchange="updateRefreshAllState()">
                                <span class="option-text">ğŸ“± äººé™…åœˆå¯¹è¯</span>
                            </label>
                            <label class="phone-refresh-option">
                                <input type="checkbox" class="refresh-item" value="notes" checked onchange="updateRefreshAllState()">
                                <span class="option-text">ğŸ“ å¤‡å¿˜å½•</span>
                            </label>
                            <label class="phone-refresh-option">
                                <input type="checkbox" class="refresh-item" value="photos" checked onchange="updateRefreshAllState()">
                                <span class="option-text">ğŸ“· ç›¸å†Œ</span>
                            </label>
                            <label class="phone-refresh-option">
                                <input type="checkbox" class="refresh-item" value="shopping" checked onchange="updateRefreshAllState()">
                                <span class="option-text">ğŸ›’ è´­ç‰©è®°å½•</span>
                            </label>
                            <label class="phone-refresh-option">
                                <input type="checkbox" class="refresh-item" value="search" checked onchange="updateRefreshAllState()">
                                <span class="option-text">ğŸ” æœç´¢è®°å½•</span>
                            </label>
                        </div>
                        <div class="phone-refresh-confirm-buttons">
                            <button class="phone-refresh-confirm-btn cancel" onclick="hidePhoneRefreshConfirm()">å–æ¶ˆ</button>
                            <button class="phone-refresh-confirm-btn confirm" onclick="confirmPhoneRefresh()">ç¡®è®¤åˆ·æ–°</button>
                        </div>
                    </div>
                </div>

                <!-- é¢œè‰²é€‰æ‹©å™¨æ¨¡æ€æ¡† -->
                <div class="modal" id="color-picker-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title" id="color-picker-title">é€‰æ‹©é¢œè‰²</div>
                            <button class="modal-close" onclick="hideModal('color-picker-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="color-picker" id="color-picker">
                                <div class="color-option color-red" onclick="selectColor('#FF3B30')"></div>
                                <div class="color-option color-orange" onclick="selectColor('#FF9500')"></div>
                                <div class="color-option color-yellow" onclick="selectColor('#FFCC00')"></div>
                                <div class="color-option color-green" onclick="selectColor('#34C759')"></div>
                                <div class="color-option color-light-blue" onclick="selectColor('#5AC8FA')"></div>
                                <div class="color-option color-blue" onclick="selectColor('#007AFF')"></div>
                                <div class="color-option color-purple" onclick="selectColor('#5856D6')"></div>
                                <div class="color-option color-pink" onclick="selectColor('#AF52DE')"></div>
                                <div class="color-option color-red-alt" onclick="selectColor('#FF2D55')"></div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">é€æ˜åº¦</label>
                                <input type="range" class="opacity-slider" id="opacity-slider" min="0" max="1" step="0.1" value="1">
                                <span id="opacity-value">100%</span>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('color-picker-modal')">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="applyColorSelection()">åº”ç”¨</button>
                        </div>
                    </div>
                </div>

                <!-- å£çº¸é€‰æ‹©å™¨æ¨¡æ€æ¡† -->
                <div class="modal" id="wallpaper-picker-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">é€‰æ‹©å£çº¸</div>
                            <button class="modal-close" onclick="hideModal('wallpaper-picker-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="wallpaper-preview-container" id="wallpaper-preview-container">
                                <div class="wallpaper-preview-placeholder">
                                    <i class="fas fa-image"></i>
                                    <div>é€‰æ‹©æœ¬åœ°å›¾ç‰‡åå¯åœ¨æ­¤é¢„è§ˆ</div>
                                </div>
                            </div>
                            <div class="settings-item upload-custom-item" onclick="uploadCustomWallpaper()">
                                <div class="settings-item-left">
                                    <div>ä»ç›¸å†Œé€‰æ‹©</div>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                            <input type="file" id="custom-wallpaper-upload" accept="image/*" class="file-input-hidden">
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('wallpaper-picker-modal')">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="applyWallpaperSelection()">åº”ç”¨</button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘è‡ªå®šä¹‰å±å¹•å°ºå¯¸æ¨¡æ€æ¡† -->
                <div class="modal" id="custom-screen-size-modal">
                    <div class="modal-content" style="max-width: 90vw; width: 400px; max-height: 90vh; overflow-y: auto;">
                        <div class="modal-header">
                            <div class="modal-title">è‡ªå®šä¹‰å±å¹•å°ºå¯¸</div>
                            <button class="modal-close" onclick="hideModal('custom-screen-size-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="custom-size-form" style="padding: 5px 0;">
                                <div class="form-group" style="margin-bottom: 15px;">
                                    <label for="custom-width" style="display: block; margin-bottom: 5px; font-weight: 500; color: #333; font-size: 14px;">å®½åº¦ (px)</label>
                                    <input type="number" id="custom-width" min="200" max="800" value="350" placeholder="è¾“å…¥å®½åº¦"
                                           style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box;">
                                    <small style="color: #666; font-size: 11px;">å»ºè®®èŒƒå›´ï¼š200-800px</small>
                                </div>
                                <div class="form-group" style="margin-bottom: 15px;">
                                    <label for="custom-height" style="display: block; margin-bottom: 5px; font-weight: 500; color: #333; font-size: 14px;">é«˜åº¦ (px)</label>
                                    <input type="number" id="custom-height" min="400" max="1200" value="740" placeholder="è¾“å…¥é«˜åº¦"
                                           style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box;">
                                    <small style="color: #666; font-size: 11px;">å»ºè®®èŒƒå›´ï¼š400-1200px</small>
                                </div>
                                <div class="form-group" style="margin-bottom: 15px;">
                                    <label for="custom-name" style="display: block; margin-bottom: 5px; font-weight: 500; color: #333; font-size: 14px;">å°ºå¯¸åç§°</label>
                                    <input type="text" id="custom-name" value="è‡ªå®šä¹‰å°ºå¯¸" placeholder="ä¸ºè¿™ä¸ªå°ºå¯¸èµ·ä¸ªåå­—"
                                           style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box;">
                                </div>
                                <div class="size-preview-container" style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 6px; margin-top: 10px;">
                                    <div class="size-preview-label" style="margin-bottom: 10px; font-weight: 500; color: #333; font-size: 13px;">é¢„è§ˆæ•ˆæœï¼š</div>
                                    <div class="custom-size-preview" id="custom-size-preview" style="display: flex; justify-content: center; align-items: center; min-height: 60px;">
                                        <div class="preview-phone" style="background: #333; border-radius: 6px; border: 2px solid #666; position: relative;">
                                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 8px; text-align: center;">ğŸ“±</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('custom-screen-size-modal')">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="applyCustomScreenSize()">åº”ç”¨å°ºå¯¸</button>
                        </div>
                    </div>
                </div>

                <!-- å›¾ç‰‡ä¸Šä¼ é€‰æ‹©æ¨¡æ€æ¡† -->
                <div class="modal" id="image-upload-choice-modal">
                    <div class="modal-content" style="max-width: 400px;">
                        <div class="modal-header">
                            <div class="modal-title" id="image-upload-choice-title">é€‰æ‹©å›¾ç‰‡æ¥æº</div>
                            <button class="modal-close" onclick="hideModal('image-upload-choice-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="upload-choice-container">
                                <div class="upload-choice-option" onclick="chooseLocalUpload()">
                                    <div class="upload-choice-icon">
                                        <i class="fas fa-upload"></i>
                                    </div>
                                    <div class="upload-choice-text">
                                        <div class="upload-choice-title">æœ¬åœ°ä¸Šä¼ </div>
                                        <div class="upload-choice-desc">ä»è®¾å¤‡é€‰æ‹©å›¾ç‰‡æ–‡ä»¶</div>
                                    </div>
                                </div>
                                <div class="upload-choice-option" onclick="chooseUrlUpload()">
                                    <div class="upload-choice-icon">
                                        <i class="fas fa-link"></i>
                                    </div>
                                    <div class="upload-choice-text">
                                        <div class="upload-choice-title">åœ¨çº¿å›¾åºŠ</div>
                                        <div class="upload-choice-desc">è¾“å…¥å›¾ç‰‡URLåœ°å€</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- URLè¾“å…¥æ¨¡æ€æ¡† -->
                <div class="modal" id="url-input-modal">
                    <div class="modal-content" style="max-width: 500px;">
                        <div class="modal-header">
                            <div class="modal-title" id="url-input-title">è¾“å…¥å›¾ç‰‡URL</div>
                            <button class="modal-close" onclick="hideModal('url-input-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="url-input-container">
                                <label for="image-url-input">å›¾ç‰‡URLåœ°å€ï¼š</label>
                                <input type="url" id="image-url-input" placeholder="https://example.com/image.jpg" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px;">
                                <div class="url-tips">
                                    <p><strong>æ”¯æŒçš„å›¾åºŠï¼š</strong></p>
                                    <ul>
                                        <li>PostImg: https://i.postimg.cc/...</li>
                                        <li>Catbox: https://files.catbox.moe/...</li>
                                        <li>ImgBB: https://i.ibb.co/...</li>
                                        <li>Imgur: https://i.imgur.com/...</li>
                                        <li>å…¶ä»–æ”¯æŒç›´é“¾çš„å›¾åºŠ</li>
                                    </ul>
                                </div>
                                <div class="url-preview" id="url-preview" style="display: none;">
                                    <img id="url-preview-img" style="max-width: 100%; max-height: 200px; border-radius: 5px;">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('url-input-modal')">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="confirmUrlUpload()">ç¡®è®¤</button>
                        </div>
                    </div>
                </div>

                <!-- å›¾æ ‡é€‰æ‹©å™¨æ¨¡æ€æ¡† -->
                <div class="modal" id="icon-picker-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">æ›´æ”¹åº”ç”¨å›¾æ ‡</div>
                            <button class="modal-close" onclick="hideModal('icon-picker-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <!-- åº”ç”¨åˆ—è¡¨ -->
                            <div class="app-list-section">
                                <h4 style="margin: 0 0 15px 0; color: #333; font-size: 16px;">é€‰æ‹©è¦ä¿®æ”¹çš„åº”ç”¨ é€‰ä¸­åä¸‹æ‹‰</h4>
                                <div id="app-list-container" class="app-list-grid">
                                    <!-- åŠ¨æ€ç”Ÿæˆåº”ç”¨åˆ—è¡¨ -->
                                </div>
                            </div>

                            <!-- å›¾æ ‡ä¸Šä¼ åŒºåŸŸ -->
                            <div class="icon-upload-section" id="icon-upload-section" style="display: none;">
                                <h4 style="margin: 20px 0 15px 0; color: #333; font-size: 16px;">ä¸Šä¼ æ–°å›¾æ ‡</h4>
                                <div class="upload-area" onclick="triggerIconUpload()">
                                    <div class="upload-placeholder" id="upload-placeholder">
                                        <i class="fas fa-cloud-upload-alt" style="font-size: 32px; color: #999; margin-bottom: 10px;"></i>
                                        <div style="color: #666;">ç‚¹å‡»é€‰æ‹©å›¾ç‰‡</div>
                                        <div style="color: #999; font-size: 12px; margin-top: 5px;">æ”¯æŒ JPGã€PNG æ ¼å¼</div>
                                    </div>
                                    <img id="icon-preview-img" class="icon-preview-img" style="display: none;">
                                </div>
                                <input type="file" id="custom-icon-upload" accept="image/*" class="file-input-hidden">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button" onclick="resetAllAppIcons()" style="background: var(--theme-button-bg, #4a84c1); color: white; margin-right: auto;">é‡ç½®</button>
                            <button class="modal-button modal-secondary" onclick="hideModal('icon-picker-modal')">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" id="apply-icon-btn" onclick="applyIconChange()" style="display: none;">åº”ç”¨</button>
                        </div>
                    </div>
                </div>

                <!-- ç…§ç‰‡æ‹æ‘„æ¨¡æ€æ¡† -->






                <!-- èŠå¤©é€‰é¡¹æ¨¡æ€æ¡† -->
                <div class="modal" id="chat-options-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">é€‰æ‹©èŠå¤©ç±»å‹</div>
                            <button class="modal-close" onclick="hideModal('chat-options-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="chat-option-item" onclick="showSingleChatSelector()">
                                <div class="chat-option-icon">
                                    <i class="fas fa-user icon-user-blue"></i>
                                </div>
                                <div class="chat-option-text">
                                    <div class="chat-option-title">å•èŠ</div>
                                    <div class="chat-option-desc">ä¸å•ä¸ªè§’è‰²è¿›è¡Œå¯¹è¯</div>
                                </div>
                            </div>
                            <div class="chat-option-item" onclick="showGroupChatSelector()">
                                <div class="chat-option-icon">
                                    <i class="fas fa-users icon-users-green"></i>
                                </div>
                                <div class="chat-option-text">
                                    <div class="chat-option-title">ç¾¤èŠ</div>
                                    <div class="chat-option-desc">ä¸å¤šä¸ªè§’è‰²åŒæ—¶èŠå¤©</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å•èŠè§’è‰²é€‰æ‹©æ¨¡æ€æ¡† -->
                <div class="modal" id="single-chat-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">é€‰æ‹©èŠå¤©è§’è‰²</div>
                            <button class="modal-close" onclick="hideModal('single-chat-modal')">&times;</button>
                        </div>
                        <div class="modal-body" id="single-chat-body">
                            <!-- è§’è‰²åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <!-- ç¾¤èŠè§’è‰²é€‰æ‹©æ¨¡æ€æ¡† -->
                <div class="modal" id="group-chat-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">åˆ›å»ºç¾¤èŠ</div>
                            <button class="modal-close" onclick="hideModal('group-chat-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">ğŸ’¡ ç¾¤èŠåç§°</label>
                                <input type="text" class="form-input" id="group-chat-name" placeholder="ä¾‹å¦‚ï¼šç­çº§ç¾¤ã€å·¥ä½œç¾¤">
                            </div>
                            <div class="form-group">
                                <label class="form-label">é€‰æ‹©æˆå‘˜ (è‡³å°‘2äººï¼Œæœ€å¤š20äºº)</label>
                                <div id="group-chat-members">
                                    <!-- ç¾¤èŠæˆå‘˜é€‰æ‹©å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('group-chat-modal')">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="createGroupChat()">åˆ›å»ºç¾¤èŠ</button>
                        </div>
                    </div>
                </div>

                <!-- å†å²æ¶ˆæ¯è®¾ç½®æ¨¡æ€æ¡† -->
                <div class="modal" id="history-settings-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">å†å²æ¶ˆæ¯è®¾ç½®</div>
                            <button class="modal-close" onclick="hideModal('history-settings-modal')">&times;</button>
                        </div>
                        <div class="modal-body" style="padding: 20px;">
                            <div class="setting-card" style="margin-bottom: 20px;">
                                <div class="setting-item" style="margin-bottom: 15px;">
                                    <div class="setting-left">
                                        <div class="setting-label" style="font-size: 16px; margin-bottom: 8px;">é™„å¸¦å†å²æ¶ˆæ¯æ•° (å›åˆæ•°)</div>
                                        <div class="setting-desc" style="font-size: 14px; line-height: 1.4;">AIå›å¤æ—¶å‚è€ƒçš„å†å²å¯¹è¯å›åˆæ•°</div>
                                    </div>
                                    <div class="setting-right">
                                        <span class="setting-value" id="history-count-display" style="font-size: 16px; font-weight: 600;">5å›åˆ</span>
                                    </div>
                                </div>
                                <div class="setting-range-container" style="margin-bottom: 15px;">
                                    <input type="range" class="theme-range" id="history-messages-count" min="0" max="100" step="1" value="5">
                                    <div class="range-labels">
                                        <span>0å›åˆ</span>
                                        <span>100å›åˆ</span>
                                    </div>
                                </div>
                                <div class="custom-input-container" style="margin-bottom: 15px;">
                                    <span class="input-label">è‡ªå®šä¹‰æ•°å€¼ï¼š</span>
                                    <input type="number" class="theme-input" id="custom-history-count" min="0" max="500" value="5" style="width: 80px; margin: 0 8px;">
                                    <span class="input-unit">å›åˆ (æœ€å¤§500)</span>
                                </div>
                                <div class="setting-explanation">
                                    <div class="explanation-text">
                                        <strong>è¯´æ˜ï¼š</strong><br>
                                        â€¢ è®¾ç½®ä¸º5è¡¨ç¤ºAIå›å¤æ—¶ä¼šå‚è€ƒæœ€è¿‘5å›åˆå¯¹è¯<br>
                                        â€¢ æ³¨æ„ï¼šæ•°å€¼è¿‡å¤§å¯èƒ½å½±å“APIå“åº”é€Ÿåº¦
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer" style="display: flex; justify-content: space-between; padding: 20px; gap: 0;">
                            <button class="theme-button theme-button-secondary" onclick="hideModal('history-settings-modal')" style="margin: 0; padding: 12px 20px;">å–æ¶ˆ</button>
                            <button class="theme-button theme-button-primary" onclick="saveHistorySettings()" style="margin: 0; padding: 12px 20px;">ä¿å­˜</button>
                        </div>
                    </div>
                </div>

                <!-- è®°å¿†æŒ‚è½½è®¾ç½®æ¨¡æ€æ¡† -->
                <div class="modal" id="memory-mount-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">è®°å¿†æŒ‚è½½è®¾ç½®</div>
                            <button class="modal-close" onclick="hideModal('memory-mount-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="memory-mount-enabled" class="checkbox-with-margin">
                                    å¯ç”¨è®°å¿†æŒ‚è½½
                                </label>
                                <p class="small-text margin-top-5">
                                    å¼€å¯åï¼ŒAIä¼šå‚è€ƒå…¶ä»–èŠå¤©çª—å£çš„å¯¹è¯å†…å®¹ä½œä¸ºèƒŒæ™¯è®°å¿†
                                </p>
                            </div>
                            <div class="form-group hide" id="memory-mount-details">
                                <label class="form-label">æ¯ä¸ªèŠå¤©æŒ‚è½½æ¡æ•°</label>
                                <input type="range" class="api-form-range" id="memory-mount-count" min="1" max="20" step="1" value="3">
                                <div class="flex-space-between">
                                    <span>1æ¡</span>
                                    <span id="memory-mount-display">3æ¡</span>
                                    <span>20æ¡</span>
                                </div>
                            </div>
                            <div class="form-group hide" id="memory-mount-chats">
                                <label class="form-label">é€‰æ‹©è¦æŒ‚è½½çš„èŠå¤©</label>
                                <div id="memory-mount-list" class="max-height-200-auto">
                                    <!-- èŠå¤©åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                                <p class="small-text margin-top-8">
                                    é€‰æ‹©çš„èŠå¤©è®°å½•ä¼šä½œä¸ºèƒŒæ™¯ä¿¡æ¯æä¾›ç»™AIå‚è€ƒ
                                </p>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('memory-mount-modal')">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="saveMemoryMountSettings()">ä¿å­˜</button>
                        </div>
                    </div>
                </div>

                <!-- å¤´åƒè®¾ç½®æ¨¡æ€æ¡† -->
                <div class="modal" id="avatar-settings-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">åŒæ–¹å¤´åƒè®¾ç½®</div>
                            <button class="modal-close" onclick="hideModal('avatar-settings-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="avatar-setting-group">
                                <label class="form-label">æˆ‘çš„å¤´åƒ (ä»…åœ¨æ­¤èŠå¤©çª—å£ç”Ÿæ•ˆ)</label>
                                <div class="avatar-preview-container">
                                    <div class="avatar-preview" id="my-chat-avatar-preview">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <input type="file" id="my-chat-avatar-upload" accept="image/*" class="file-input-hidden">
                                    <button class="upload-button" onclick="document.getElementById('my-chat-avatar-upload').click()">ä¸Šä¼ å¤´åƒ</button>
                                </div>
                            </div>
                            <div class="avatar-setting-group">
                                <label class="form-label">å¯¹æ–¹å¤´åƒ (ä»…åœ¨æ­¤èŠå¤©çª—å£ç”Ÿæ•ˆ)</label>
                                <div class="avatar-preview-container">
                                    <div class="avatar-preview" id="ai-chat-avatar-preview">
                                        <i class="fas fa-robot"></i>
                                    </div>
                                    <input type="file" id="ai-chat-avatar-upload" accept="image/*" class="file-input-hidden">
                                    <button class="upload-button" onclick="document.getElementById('ai-chat-avatar-upload').click()">ä¸Šä¼ å¤´åƒ</button>
                                    <button class="upload-button clear-avatar-btn" onclick="clearAiChatAvatar()">æ¸…é™¤èŠå¤©å¤´åƒ</button>
                                </div>
                                <p class="small-text margin-top-5">
                                    æ³¨æ„ï¼šå¦‚æœè§’è‰²åœ¨èŠå¤©ä¸­æ›´æ¢äº†å¤´åƒï¼Œä¼šè¦†ç›–æ­¤è®¾ç½®ï¼Œç‚¹å‡»"æ¸…é™¤èŠå¤©å¤´åƒ"å¯é‡ç½®ä¸ºè§’è‰²å¡é»˜è®¤å¤´åƒ
                                </p>
                            </div>
                            <div class="form-group margin-top-20">
                                <label class="form-label">å¤´åƒå½¢çŠ¶</label>
                                <div class="avatar-shape-options">
                                    <label class="shape-radio-option">
                                        <input type="radio" name="avatar-shape" value="circle" checked>
                                        <span class="shape-radio-text">åœ†å½¢</span>
                                    </label>
                                    <label class="shape-radio-option">
                                        <input type="radio" name="avatar-shape" value="rounded-square">
                                        <span class="shape-radio-text">æ–¹å½¢</span>
                                    </label>
                                </div>
                                <p class="small-text margin-top-5">
                                    é€‰æ‹©å¤´åƒåœ¨èŠå¤©ä¸­çš„æ˜¾ç¤ºå½¢çŠ¶
                                </p>
                            </div>
                            <div class="form-group margin-top-20">
                                <label class="form-label">å¤´åƒæ˜¾ç¤ºè®¾ç½®</label>
                                <div style="margin-top: 10px;">
                                    <label class="form-label">
                                        <input type="checkbox" id="hide-avatars" class="checkbox-with-margin">
                                        éšè—åŒæ–¹å¤´åƒ
                                    </label>
                                    <p class="small-text margin-top-5">
                                        å¼€å¯åï¼ŒèŠå¤©ç•Œé¢å°†ä¸æ˜¾ç¤ºä»»ä½•å¤´åƒ
                                    </p>
                                </div>
                                <div style="margin-top: 15px;">
                                    <label class="form-label">
                                        <input type="checkbox" id="hide-user-avatar" class="checkbox-with-margin">
                                        ä»…éšè—æˆ‘çš„å¤´åƒ
                                    </label>
                                </div>
                                <div style="margin-top: 10px;">
                                    <label class="form-label">
                                        <input type="checkbox" id="hide-character-avatar" class="checkbox-with-margin">
                                        ä»…éšè—å¯¹æ–¹å¤´åƒ
                                    </label>
                                </div>
                            </div>
                            <div class="form-group margin-top-20">
                                <label class="form-label">å¤´åƒå¤§å°</label>
                                <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                                    <input type="range" id="avatar-size" min="30" max="60" value="40" step="2" style="flex: 1;">
                                    <span id="avatar-size-value" style="min-width: 50px; text-align: center;">40px</span>
                                </div>
                                <p class="small-text margin-top-5">
                                    è°ƒèŠ‚èŠå¤©ç•Œé¢ä¸­å¤´åƒçš„æ˜¾ç¤ºå¤§å°
                                </p>
                            </div>
                            <p class="small-text margin-top-15">
                                æ³¨æ„ï¼šæ­¤è®¾ç½®ä»…å½±å“å½“å‰èŠå¤©çª—å£æ˜¾ç¤ºï¼Œä¸ä¼šåŒæ­¥ä¿®æ”¹è§’è‰²å¡æˆ–é¢å…·è®¾ç½®
                            </p>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('avatar-settings-modal')">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="saveChatAvatarSettings()">ä¿å­˜</button>
                        </div>
                    </div>
                </div>

                <!-- æ˜µç§°è®¾ç½®æ¨¡æ€æ¡† -->
                <div class="modal" id="nickname-settings-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">åŒæ–¹å¤‡æ³¨è®¾ç½®</div>
                            <button class="modal-close" onclick="hideModal('nickname-settings-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">æˆ‘çš„æ˜µç§° (ä»…åœ¨æ­¤èŠå¤©ä¸­æ˜¾ç¤º)</label>
                                <input type="text" class="form-input" id="my-chat-nickname" placeholder="è¾“å…¥ä½ åœ¨æ­¤èŠå¤©ä¸­çš„æ˜µç§°">
                            </div>
                            <div class="form-group">
                                <label class="form-label">å¯¹æ–¹æ˜µç§° (ä»…åœ¨æ­¤èŠå¤©ä¸­æ˜¾ç¤º)</label>
                                <input type="text" class="form-input" id="ai-chat-nickname" placeholder="è¾“å…¥å¯¹æ–¹åœ¨æ­¤èŠå¤©ä¸­çš„æ˜µç§°">
                            </div>
                            <p class="small-text margin-top-10">
                                æ³¨æ„ï¼šæ­¤è®¾ç½®ä»…å½±å“å½“å‰èŠå¤©çª—å£æ˜¾ç¤ºï¼Œä¸ä¼šåŒæ­¥ä¿®æ”¹è§’è‰²å¡æˆ–é¢å…·è®¾ç½®ã€‚è§’è‰²ä¹Ÿå¯èƒ½æ ¹æ®å¿ƒæƒ…å’ŒèŠå¤©å†…å®¹è‡ªä¸»ä¿®æ”¹è‡ªå·±çš„æ˜µç§°ã€‚
                            </p>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('nickname-settings-modal')">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="saveChatNicknameSettings()">ä¿å­˜</button>
                        </div>
                    </div>
                </div>

                <!-- æˆ³ä¸€æˆ³åç¼€è®¾ç½®æ¨¡æ€æ¡† -->
                <div class="modal" id="poke-suffix-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">æˆ³ä¸€æˆ³åç¼€è®¾ç½®</div>
                            <button class="modal-close" onclick="hideModal('poke-suffix-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">æˆ‘çš„æˆ³ä¸€æˆ³åç¼€</label>
                                <input type="text" class="form-input" id="my-poke-suffix" placeholder="ç•™ç©ºä¸ºæ— åç¼€ï¼ˆä¾‹å¦‚ï¼šçš„å°è„¸è›‹ï¼‰">
                                <p class="tiny-text margin-top-5">æ˜¾ç¤ºä¸ºï¼š[è§’è‰²å]æˆ³äº†æˆ³ä½ [åç¼€]ï¼Œç•™ç©ºåˆ™æ˜¾ç¤ºï¼š[è§’è‰²å]æˆ³äº†æˆ³ä½ </p>
                            </div>
                            <div class="form-group">
                                <label class="form-label">å¯¹æ–¹æˆ³ä¸€æˆ³åç¼€</label>
                                <input type="text" class="form-input" id="ai-poke-suffix" placeholder="ç•™ç©ºä¸ºæ— åç¼€ï¼ˆä¾‹å¦‚ï¼šçš„å°æ‰‹ï¼‰">
                                <p class="tiny-text margin-top-5">æ˜¾ç¤ºä¸ºï¼šä½ æˆ³äº†æˆ³[è§’è‰²å][åç¼€]ï¼Œç•™ç©ºåˆ™æ˜¾ç¤ºï¼šä½ æˆ³äº†æˆ³[è§’è‰²å]</p>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('poke-suffix-modal')">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="savePokeSuffixSettings()">ä¿å­˜</button>
                        </div>
                    </div>
                </div>

                <!-- èŠå¤©èƒŒæ™¯è®¾ç½®æ¨¡æ€æ¡† -->
                <div class="modal" id="background-settings-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">èŠå¤©èƒŒæ™¯è®¾ç½®</div>
                            <button class="modal-close" onclick="hideModal('background-settings-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="background-preview-container">
                                <div class="background-preview" id="chat-background-preview">
                                    <div class="preview-text">èƒŒæ™¯é¢„è§ˆ</div>
                                </div>
                            </div>
                            <div class="form-group">
                                <input type="file" id="background-upload" accept="image/*" class="file-input-hidden">
                                <button class="form-button" onclick="document.getElementById('background-upload').click()">é€‰æ‹©èƒŒæ™¯å›¾ç‰‡</button>
                                <button class="form-button form-button-secondary" onclick="removeBackground()">ç§»é™¤èƒŒæ™¯</button>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('background-settings-modal')">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="saveChatBackgroundSettings()">ä¿å­˜</button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘é¡¶æ é¢œè‰²è®¾ç½®æ¨¡æ€æ¡† -->
                <div class="modal" id="top-bar-color-modal">
                    <div class="modal-content" style="max-width: 380px;">
                        <div class="modal-header">
                            <div class="modal-title">ç•Œé¢å­—ä½“é¢œè‰²è®¾ç½®</div>
                            <button class="modal-close" onclick="hideModal('top-bar-color-modal')">&times;</button>
                        </div>
                        <div class="modal-body" style="max-height: 45vh; overflow-y: auto; padding: 12px 16px;">
                            <div class="setting-explanation" style="margin-bottom: 10px;">
                                <div class="explanation-text" style="font-size: 11px;">è‡ªå®šä¹‰èŠå¤©ç•Œé¢å„å…ƒç´ çš„æ–‡å­—é¢œè‰²å’Œæ¶ˆæ¯å­—ä½“é¢œè‰²ã€‚</div>
                            </div>

                            <!-- ğŸ”¥ã€æ–°å¢ã€‘è§’è‰²æ¶ˆæ¯å­—ä½“é¢œè‰² -->
                            <div class="color-setting-item">
                                <label class="color-label">è§’è‰²æ¶ˆæ¯å­—ä½“</label>
                                <div class="color-control-group">
                                    <input type="color" id="characterMsg-color-picker" class="color-input" value="#000000">
                                    <button class="color-reset-btn" onclick="resetColor('characterMsg', '')" title="é‡ç½®">â†º</button>
                                </div>
                            </div>

                            <!-- ğŸ”¥ã€æ–°å¢ã€‘ç”¨æˆ·æ¶ˆæ¯å­—ä½“é¢œè‰² -->
                            <div class="color-setting-item">
                                <label class="color-label">ç”¨æˆ·æ¶ˆæ¯å­—ä½“</label>
                                <div class="color-control-group">
                                    <input type="color" id="userMsg-color-picker" class="color-input" value="#FFFFFF">
                                    <button class="color-reset-btn" onclick="resetColor('userMsg', '')" title="é‡ç½®">â†º</button>
                                </div>
                            </div>

                            <!-- æ—¶é—´é¢œè‰² -->
                            <div class="color-setting-item">
                                <label class="color-label">æ—¶é—´</label>
                                <div class="color-control-group">
                                    <input type="color" id="time-color-picker" class="color-input" value="#000000">
                                    <button class="color-reset-btn" onclick="resetColor('time', '#000000')" title="é‡ç½®">â†º</button>
                                </div>
                            </div>

                            <!-- ä¿¡å·é¢œè‰² -->
                            <div class="color-setting-item">
                                <label class="color-label">ä¿¡å·</label>
                                <div class="color-control-group">
                                    <input type="color" id="signal-color-picker" class="color-input" value="#000000">
                                    <button class="color-reset-btn" onclick="resetColor('signal', '#000000')" title="é‡ç½®">â†º</button>
                                </div>
                            </div>

                            <!-- ç”µæ± é¢œè‰² -->
                            <div class="color-setting-item">
                                <label class="color-label">ç”µæ± </label>
                                <div class="color-control-group">
                                    <input type="color" id="battery-color-picker" class="color-input" value="#000000">
                                    <button class="color-reset-btn" onclick="resetColor('battery', '#000000')" title="é‡ç½®">â†º</button>
                                </div>
                            </div>

                            <!-- è¿”å›æŒ‰é’®é¢œè‰² -->
                            <div class="color-setting-item">
                                <label class="color-label">è¿”å›æŒ‰é’®</label>
                                <div class="color-control-group">
                                    <input type="color" id="backBtn-color-picker" class="color-input" value="#000000">
                                    <button class="color-reset-btn" onclick="resetColor('backBtn', '#000000')" title="é‡ç½®">â†º</button>
                                </div>
                            </div>

                            <!-- æ ‡é¢˜é¢œè‰² -->
                            <div class="color-setting-item">
                                <label class="color-label">å¤‡æ³¨å</label>
                                <div class="color-control-group">
                                    <input type="color" id="title-color-picker" class="color-input" value="#000000">
                                    <button class="color-reset-btn" onclick="resetColor('title', '#000000')" title="é‡ç½®">â†º</button>
                                </div>
                            </div>

                            <!-- è®¾ç½®æŒ‰é’®é¢œè‰² -->
                            <div class="color-setting-item">
                                <label class="color-label">è®¾ç½®æŒ‰é’®</label>
                                <div class="color-control-group">
                                    <input type="color" id="settingsBtn-color-picker" class="color-input" value="#000000">
                                    <button class="color-reset-btn" onclick="resetColor('settingsBtn', '#000000')" title="é‡ç½®">â†º</button>
                                </div>
                            </div>

                            <!-- çº¿ä¸‹å‰§æƒ…æŒ‰é’®é¢œè‰² -->
                            <div class="color-setting-item">
                                <label class="color-label">çº¿ä¸‹å‰§æƒ…</label>
                                <div class="color-control-group">
                                    <input type="color" id="offlineBtn-color-picker" class="color-input" value="#000000">
                                    <button class="color-reset-btn" onclick="resetColor('offlineBtn', '#000000')" title="é‡ç½®">â†º</button>
                                </div>
                            </div>

                            <!-- ç³»ç»Ÿæç¤ºé¢œè‰² -->
                            <div class="color-setting-item">
                                <label class="color-label">ç³»ç»Ÿæç¤º</label>
                                <div class="color-control-group">
                                    <input type="color" id="systemMsg-color-picker" class="color-input" value="#999999">
                                    <button class="color-reset-btn" onclick="resetColor('systemMsg', '#999999')" title="é‡ç½®">â†º</button>
                                </div>
                            </div>

                            <!-- çŠ¶æ€æ é¢œè‰² -->
                            <div class="color-setting-item">
                                <label class="color-label">çŠ¶æ€æ </label>
                                <div class="color-control-group">
                                    <input type="color" id="statusBar-color-picker" class="color-input" value="#888888">
                                    <button class="color-reset-btn" onclick="resetColor('statusBar', '#888888')" title="é‡ç½®">â†º</button>
                                </div>
                            </div>

                            <div class="color-hint" style="margin-top: 12px; padding: 8px 10px; background: #f0f8ff; border-radius: 6px; font-size: 11px; color: #666;">
                                <i class="fas fa-info-circle"></i> ç‚¹å‡»é¢œè‰²é€‰æ‹©å™¨å¯å¿«é€Ÿé€‰æ‹©é¢œè‰²
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('top-bar-color-modal')">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="saveTopBarColorSettings()">ä¿å­˜</button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘ç¾¤æˆå‘˜æ°”æ³¡é¢œè‰²è®¾ç½®æ¨¡æ€æ¡† -->
                <div class="modal" id="group-member-colors-modal" style="z-index: 10001;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">ç¾¤æˆå‘˜æ°”æ³¡é¢œè‰²è®¾ç½®</div>
                            <button class="modal-close" onclick="hideModal('group-member-colors-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="setting-explanation">
                                <div class="explanation-text">ä¸ºæ¯ä¸ªç¾¤æˆå‘˜è®¾ç½®ç‹¬ç‰¹çš„æ°”æ³¡é¢œè‰²ï¼Œè®©ç¾¤èŠæ›´åŠ ç”ŸåŠ¨æœ‰è¶£ã€‚</div>
                            </div>
                            <div id="group-member-colors-list">
                                <!-- åŠ¨æ€ç”Ÿæˆç¾¤æˆå‘˜é¢œè‰²è®¾ç½®é¡¹ -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('group-member-colors-modal')">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="saveGroupMemberColors()">ä¿å­˜</button>
                        </div>
                    </div>
                </div>

                <!-- æ°”æ³¡æ ·å¼è®¾ç½®æ¨¡æ€æ¡† -->
                <div class="modal" id="bubble-style-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">æ°”æ³¡æ ·å¼è®¾ç½®</div>
                            <button class="modal-close" onclick="hideModal('bubble-style-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="bubble-style-section">
                                <label class="form-label">é€‰æ‹©æ°”æ³¡æ ·å¼</label>
                                <div class="bubble-style-grid">
                                    <div class="bubble-style-option" data-style="default">
                                        <div class="style-preview">
                                            <div class="preview-bubble sent-preview">é»˜è®¤æ ·å¼</div>
                                            <div class="preview-bubble received-preview">ç»å…¸åœ†è§’</div>
                                        </div>
                                        <div class="style-name">é»˜è®¤æ ·å¼</div>
                                    </div>

                                    <div class="bubble-style-option" data-style="shadow">
                                        <div class="style-preview bubble-style-shadow">
                                            <div class="preview-bubble sent-preview">ç»å…¸é˜´å½±</div>
                                            <div class="preview-bubble received-preview">ç«‹ä½“æ„Ÿ</div>
                                        </div>
                                        <div class="style-name">ç»å…¸é˜´å½±</div>
                                    </div>

                                    <div class="bubble-style-option" data-style="tail">
                                        <div class="style-preview bubble-style-tail">
                                            <div class="preview-bubble sent-preview">å¸¦å°–è§’</div>
                                            <div class="preview-bubble received-preview">æ°”æ³¡æˆ³</div>
                                        </div>
                                        <div class="style-name">ç»å…¸æ°”æ³¡</div>
                                    </div>

                                    <div class="bubble-style-option" data-style="paper">
                                        <div class="style-preview bubble-style-paper">
                                            <div class="preview-bubble sent-preview">çº¸å¼ å¡ç‰‡</div>
                                            <div class="preview-bubble received-preview">è´¨æ„Ÿ</div>
                                        </div>
                                        <div class="style-name">çº¸å¼ æ ·å¼</div>
                                    </div>
                                </div>
                            </div>

                            <div class="color-setting-group">
                                <label class="form-label">è‡ªå®šä¹‰é¢œè‰²</label>
                                <div class="color-picker-container">
                                    <div class="flex-gap-15">
                                        <div class="flex-1">
                                            <label class="label-small">æˆ‘çš„æ°”æ³¡</label>
                                            <input type="color" id="my-bubble-color" class="color-input" value="#007AFF">
                                        </div>
                                        <div class="flex-1">
                                            <label class="label-small">å¯¹æ–¹æ°”æ³¡</label>
                                            <input type="color" id="ai-bubble-color" class="color-input" value="#f0f0f0">
                                            <!-- ğŸ”¥ã€æ–°å¢ã€‘ç¾¤èŠè§’è‰²å•ç‹¬è®¾ç½®æŒ‰é’® -->
                                            <div id="group-member-colors-btn" style="display: none; margin-top: 8px;">
                                                <button type="button" class="theme-button theme-button-secondary" style="font-size: 12px; padding: 6px 12px;" onclick="showGroupMemberColorSettings()">
                                                    ä¸ºç¾¤æˆå‘˜å•ç‹¬è®¾ç½®
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="opacity-setting">
                                    <div class="flex-gap-15-mb-15">
                                        <div class="flex-1">
                                            <label class="label-small">æˆ‘çš„æ°”æ³¡é€æ˜åº¦ï¼š<span id="my-bubble-opacity-value">100%</span></label>
                                            <input type="range" id="my-bubble-opacity" min="0.1" max="1" step="0.1" value="1" class="width-100">
                                        </div>
                                        <div class="flex-1">
                                            <label class="label-small">å¯¹æ–¹æ°”æ³¡é€æ˜åº¦ï¼š<span id="ai-bubble-opacity-value">100%</span></label>
                                            <input type="range" id="ai-bubble-opacity" min="0.1" max="1" step="0.1" value="1" class="width-100">
                                        </div>
                                    </div>
                                </div>

                                <div class="padding-setting">
                                    <label class="form-label">æ°”æ³¡å¤§å°è°ƒèŠ‚</label>
                                    <div class="flex-gap-15-mb-10">
                                        <div class="flex-1">
                                            <label class="label-small">å†…è¾¹è·ï¼š<span id="bubble-padding-value">ä¸­ç­‰</span></label>
                                            <input type="range" id="bubble-padding" min="4" max="16" step="2" value="12" class="width-100">
                                        </div>
                                    </div>
                                    <p class="tiny-text-gray margin-top-5">
                                        è°ƒæ•´æ°”æ³¡å†…æ–‡å­—ä¸è¾¹ç¼˜çš„è·ç¦»ï¼Œæ•°å€¼è¶Šå¤§æ°”æ³¡è¶Šå¤§
                                    </p>
                                </div>
                            </div>

                            <!-- ğŸ”¥ã€æ–°å¢ã€‘CSSé¢„è®¾ç®¡ç† -->
                            <div class="css-presets-section">
                                <label class="form-label">CSSæ ·å¼é¢„è®¾</label>
                                <div class="presets-controls">
                                    <select id="css-presets-select" class="form-select" onchange="loadCSSPreset()">
                                        <option value="">é€‰æ‹©é¢„è®¾æ ·å¼...</option>
                                    </select>
                                    <div class="preset-buttons">
                                        <button type="button" class="modal-button modal-secondary" onclick="saveCSSPreset()">ä¿å­˜ä¸ºé¢„è®¾</button>
                                        <button type="button" class="modal-button modal-secondary" onclick="deleteCSSPreset()">åˆ é™¤é¢„è®¾</button>
                                    </div>
                                </div>
                            </div>

                            <!-- è‡ªå®šä¹‰CSS -->
                            <div class="custom-css-section">
                                <label class="form-label">è‡ªå®šä¹‰CSSæ ·å¼ æ”¯æŒé€šè¿‡CSSä¿®æ”¹æ°”æ³¡æ ·å¼ä¸ç•Œé¢ç¾åŒ–</label>
                                <textarea id="custom-bubble-css" placeholder="è¾“å…¥è‡ªå®šä¹‰CSSä»£ç ...

ç¤ºä¾‹ï¼ˆä½¿ç”¨æ ‡å‡†é€‰æ‹©å™¨ï¼‰ï¼š
/* ç”¨æˆ·æ¶ˆæ¯æ°”æ³¡ */
.message-container.sent .message-bubble {
    background: linear-gradient(45deg, #007AFF, #5AC8FA) !important;
    border-radius: 20px !important;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2) !important;
}

/* AIæ¶ˆæ¯æ°”æ³¡ */
.message-container.received .message-bubble {
    background: #f0f0f0 !important;
    border-radius: 20px !important;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
}

/* æ¶ˆæ¯å®¹å™¨ */
.message-container {
    margin-bottom: 10px !important;
}

/* ä¿®æ”¹è½¬è´¦å¡ç‰‡èƒŒæ™¯å›¾ç‰‡ */
.transfer-card {
    background-image: url('https://example.com/your-image.jpg') !important;
    background-size: cover !important;
    background-position: center !important;
}

/* ä¸ºè½¬è´¦å¡ç‰‡æ·»åŠ åŠé€æ˜å åŠ å±‚ */
.transfer-card {
    background: 
        linear-gradient(rgba(255,107,157,0.7), rgba(254,207,239,0.7)),
        url('https://i.imgur.com/xxxxx.jpg') !important;
    background-size: cover !important;
}

/* ç”¨ä¼ªå…ƒç´ ä¸ºè½¬è´¦å¡ç‰‡æ·»åŠ è£…é¥°å›¾ç‰‡ */
.transfer-card {
    position: relative !important;
    overflow: hidden !important;
}

.transfer-card::before {
    content: '' !important;
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    background-image: url('https://i.imgur.com/xxxxx.jpg') !important;
    background-size: cover !important;
    opacity: 0.3 !important;
    z-index: 0 !important;
}

.transfer-card > * {
    position: relative !important;
    z-index: 1 !important;
}

/* æ”¹è½¬è´¦å¡ç‰‡å­—ä½“é¢œè‰²ä¸ºç™½è‰² */
.transfer-card * {
color: #FFFFFF !important;
}

/* æ”¹è½¬è´¦å¡ç‰‡å­—æ · */
.transfer-title {
font-size: 0 !important; /* éšè— */
}" rows="8" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: monospace; font-size: 12px; resize: vertical;" oninput="updatePreview()"></textarea>
                            </div>

                            <!-- å®æ—¶é¢„è§ˆ -->
                            <div class="preview-section">
                                <label class="form-label">å®æ—¶é¢„è§ˆ</label>
                                <div class="preview-container" id="bubble-preview">
                                    <div class="preview-chat">
                                        <!-- AIæ¶ˆæ¯ - ä½¿ç”¨ä¸å®é™…èŠå¤©ç•Œé¢ä¸€è‡´çš„ç»“æ„ -->
                                        <div class="message-container received">
                                            <div class="message-avatar">AI</div>
                                            <div class="message-bubble" id="preview-ai">
                                                è¿™æ˜¯è§’è‰²å‘é€çš„æ¶ˆæ¯é¢„è§ˆ
                                            </div>
                                        </div>
                                        <!-- ç”¨æˆ·æ¶ˆæ¯ - ä½¿ç”¨ä¸å®é™…èŠå¤©ç•Œé¢ä¸€è‡´çš„ç»“æ„ -->
                                        <div class="message-container sent">
                                            <div class="message-bubble" id="preview-user">
                                                è¿™æ˜¯ç”¨æˆ·å‘é€çš„æ¶ˆæ¯é¢„è§ˆ
                                            </div>
                                            <div class="message-avatar">æˆ‘</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('bubble-style-modal')">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="saveBubbleStyleSettings()">ä¿å­˜</button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘CSSé¢„è®¾åç§°è¾“å…¥æ¨¡æ€æ¡† -->
                <div class="modal" id="css-preset-name-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">ä¿å­˜CSSé¢„è®¾</div>
                            <button class="modal-close" onclick="hideModal('css-preset-name-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">é¢„è®¾åç§°</label>
                                <input type="text" id="css-preset-name-input" class="form-input" placeholder="è¯·è¾“å…¥é¢„è®¾åç§°..." maxlength="50">
                                <div class="form-help">ä¸ºæ‚¨çš„è‡ªå®šä¹‰CSSæ ·å¼èµ·ä¸€ä¸ªå®¹æ˜“è¯†åˆ«çš„åç§°</div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('css-preset-name-modal')">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="confirmSaveCSSPreset()">ä¿å­˜</button>
                        </div>
                    </div>
                </div>

                <!-- å®šæ—¶å‘å¸ƒè®¾ç½®æ¨¡æ€æ¡† -->
                <div class="modal" id="schedule-settings-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">å®šæ—¶å‘å¸ƒè®¾ç½®</div>
                            <button class="modal-close" onclick="hideModal('schedule-settings-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="schedule-enabled" class="checkbox-with-margin">
                                    å¯ç”¨å®šæ—¶å‘å¸ƒ
                                </label>
                                <p class="small-text margin-top-5">
                                    å¼€å¯åï¼Œè§’è‰²ä¼šåœ¨æŒ‡å®šæ—¶é—´ç‚¹è‡ªåŠ¨å‘å¸ƒç¤¾äº¤åŠ¨æ€
                                </p>
                            </div>
                            <div class="form-group hide" id="schedule-times-group">
                                <label class="form-label">å‘å¸ƒæ—¶é—´ç‚¹</label>
                                <div id="schedule-times-container">
                                    <!-- æ—¶é—´ç‚¹å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                                </div>
                                <button type="button" class="form-button form-button-secondary" onclick="addScheduleTime()">+ æ·»åŠ æ—¶é—´ç‚¹</button>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('schedule-settings-modal')">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="saveScheduleSettings()">ä¿å­˜</button>
                        </div>
                    </div>
                </div>

                <!-- èº«ä»½é€‰æ‹©å™¨æ¨¡æ€æ¡† -->
                <!-- èº«ä»½é€‰æ‹©æ¨¡æ€æ¡†å·²ç§»é™¤ï¼Œèº«ä»½åœ¨åˆ›å»ºå¯¹è¯æ—¶é€‰æ‹© -->

                <!-- ä¸–ç•Œä¹¦æŒ‚è½½è®¾ç½®æ¨¡æ€æ¡† -->
                <div class="modal" id="worldbook-mount-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">ä¸–ç•Œä¹¦æŒ‚è½½è®¾ç½®</div>
                            <button class="modal-close" onclick="hideModal('worldbook-mount-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="worldbook-mount-enabled" class="checkbox-with-margin">
                                    å¯ç”¨ä¸–ç•Œä¹¦æŒ‚è½½
                                </label>
                                <p class="small-text margin-top-5">
                                    å¼€å¯åï¼ŒAIä¼šå‚è€ƒé€‰å®šçš„ä¸–ç•Œä¹¦å†…å®¹ä½œä¸ºèƒŒæ™¯çŸ¥è¯†è¿›è¡Œå¯¹è¯
                                </p>
                            </div>
                            <div class="form-group hide" id="worldbook-mount-details">
                                <label class="form-label">ç­›é€‰åˆ†ç±»</label>
                                <select id="worldbook-mount-category-filter" class="form-select" onchange="filterWorldbookMountList()">
                                    <option value="">å…¨éƒ¨åˆ†ç±»</option>
                                    <!-- åˆ†ç±»é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                </select>
                                <label class="form-label margin-top-15">é€‰æ‹©è¦æŒ‚è½½çš„ä¸–ç•Œä¹¦</label>
                                <div id="worldbook-mount-list" class="max-height-300-auto">
                                    <!-- ä¸–ç•Œä¹¦åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                                <p class="small-text margin-top-8">
                                    é€‰æ‹©çš„ä¸–ç•Œä¹¦å†…å®¹ä¼šä½œä¸ºèƒŒæ™¯çŸ¥è¯†æä¾›ç»™AIå‚è€ƒï¼Œå¸®åŠ©AIæ›´å¥½åœ°ç†è§£å¯¹è¯ä¸Šä¸‹æ–‡
                                </p>
                            </div>
                            <div class="setting-explanation">
                                <div class="explanation-text">
                                    <strong>åŠŸèƒ½è¯´æ˜ï¼š</strong><br>
                                    â€¢ <strong>ä¸–ç•Œä¹¦æŒ‚è½½ï¼š</strong>å°†é€‰å®šçš„ä¸–ç•Œä¹¦å†…å®¹ä½œä¸ºAIçš„èƒŒæ™¯çŸ¥è¯†<br>
                                    â€¢ <strong>å¤šé€‰æ”¯æŒï¼š</strong>å¯ä»¥åŒæ—¶æŒ‚è½½å¤šä¸ªä¸–ç•Œä¹¦ï¼Œå†…å®¹ä¼šåˆå¹¶ä½¿ç”¨<br>
                                    â€¢ <strong>æ™ºèƒ½åº”ç”¨ï¼š</strong>AIä¼šæ ¹æ®å¯¹è¯å†…å®¹æ™ºèƒ½å¼•ç”¨ç›¸å…³çš„ä¸–ç•Œä¹¦çŸ¥è¯†<br>
                                    â€¢ <strong>ä¼˜å…ˆçº§ï¼š</strong>ä¸–ç•Œä¹¦çŸ¥è¯†ä¼˜å…ˆçº§ä½äºè§’è‰²è®¾å®šå’Œå†å²å¯¹è¯
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer" style="display: flex; justify-content: space-between; padding: 20px; gap: 0;">
                            <button class="modal-button modal-secondary" onclick="hideModal('worldbook-mount-modal')" style="margin: 0; padding: 12px 20px;">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="saveWorldbookMountSettings().catch(error => console.error('ä¿å­˜ä¸–ç•Œä¹¦è®¾ç½®å¤±è´¥:', error))" style="margin: 0; padding: 12px 20px;">ä¿å­˜</button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘ç®¡ç†ä¸–ç•Œä¹¦åˆ†ç±»æ¨¡æ€æ¡† -->
                <div class="modal" id="manage-categories-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">ç®¡ç†åˆ†ç±»</div>
                            <button class="modal-close" onclick="hideModal('manage-categories-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div id="categories-list" class="categories-list">
                                <!-- åˆ†ç±»åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                            <button class="add-category-btn" onclick="addNewCategory()">
                                <i class="fas fa-plus"></i> æ·»åŠ æ–°åˆ†ç±»
                            </button>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="cancelManageCategories()">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="saveManageCategories()">ç¡®å®š</button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘è®¾ç½®ä¸–ç•Œä¹¦åˆ†ç±»æ¨¡æ€æ¡† -->
                <div class="modal" id="set-worldbook-categories-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">è®¾ç½®åˆ†ç±»</div>
                            <button class="modal-close" onclick="hideModal('set-worldbook-categories-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div id="worldbook-categories-checkboxes" class="categories-checkboxes">
                                <!-- åˆ†ç±»å¤é€‰æ¡†å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                            <button class="add-category-btn" onclick="addNewCategoryFromSetModal()">
                                <i class="fas fa-plus"></i> æ–°å»ºåˆ†ç±»
                            </button>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('set-worldbook-categories-modal')">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="saveWorldbookCategories()">ç¡®å®š</button>
                        </div>
                    </div>
                </div>

                <!-- ğŸ”¥ã€æ–°å¢ã€‘é¢å…·åˆ‡æ¢æ¨¡æ€æ¡† -->
                <div class="modal" id="persona-switch-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">é€‰æ‹©ç”¨æˆ·é¢å…·</div>
                            <button class="modal-close" onclick="hideModal('persona-switch-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="persona-switch-container">
                                <div class="persona-switch-desc">
                                    é€‰æ‹©åœ¨æ­¤å¯¹è¯ä¸­ä½¿ç”¨çš„ç”¨æˆ·é¢å…·ï¼Œåˆ‡æ¢åå°†ä»¥è¯¥é¢å…·èº«ä»½ç»§ç»­å¯¹è¯
                                </div>
                                <div class="persona-list" id="persona-switch-list">
                                    <!-- é¢å…·åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- è¡¨æƒ…åŒ…åº“æŒ‚è½½è®¾ç½®æ¨¡æ€æ¡† -->
                <div class="modal" id="emoji-library-mount-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">è¡¨æƒ…åŒ…åº“æŒ‚è½½è®¾ç½®</div>
                            <button class="modal-close" onclick="hideModal('emoji-library-mount-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="emoji-library-mount-enabled" class="checkbox-with-margin" onchange="toggleEmojiLibraryMountDetails()">
                                    å¯ç”¨è¡¨æƒ…åŒ…åº“æŒ‚è½½
                                </label>
                                <p class="small-text margin-top-5">
                                    å¼€å¯åï¼Œç”¨æˆ·å¯ä»¥åœ¨è¡¨æƒ…åŒ…é¢æ¿çš„"å…¨éƒ¨"æ ‡ç­¾é¡µä¸­ä½¿ç”¨é€‰å®šçš„è¡¨æƒ…åŒ…åº“
                                </p>
                            </div>
                            <div id="emoji-library-mount-details" style="display: none;">
                                <div class="form-group">
                                    <label class="form-label">é€‰æ‹©è¡¨æƒ…åŒ…åº“</label>
                                    <div id="emoji-library-mount-list" class="checkbox-list">
                                        <!-- è¡¨æƒ…åŒ…åº“åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                    </div>
                                    <p class="small-text margin-top-5">
                                        å¯ä»¥é€‰æ‹©å¤šä¸ªè¡¨æƒ…åŒ…åº“ï¼Œå®ƒä»¬çš„è¡¨æƒ…åŒ…ä¼šåˆå¹¶æ˜¾ç¤ºåœ¨"å…¨éƒ¨"æ ‡ç­¾é¡µä¸­
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer" style="display: flex; justify-content: space-between; padding: 20px; gap: 0;">
                            <button class="modal-button modal-secondary" onclick="hideModal('emoji-library-mount-modal')" style="margin: 0; padding: 12px 20px;">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="saveEmojiLibraryMountSettings()" style="margin: 0; padding: 12px 20px;">ä¿å­˜</button>
                        </div>
                    </div>
                </div>

                <!-- æœç´¢èŠå¤©å†…å®¹æ¨¡æ€æ¡† -->
                <div class="modal" id="search-chat-modal">
                    <div class="modal-content" style="max-width: 500px; max-height: 80vh;">
                        <div class="modal-header">
                            <div class="modal-title">æŸ¥æ‰¾èŠå¤©å†…å®¹</div>
                            <button class="modal-close" onclick="hideModal('search-chat-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">æœç´¢å…³é”®è¯</label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="text" id="search-keyword-input" placeholder="è¾“å…¥è¦æœç´¢çš„å…³é”®è¯..." style="width: 280px; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px;">
                                    <button onclick="performChatSearch()" style="padding: 8px 16px; background: #4a84c1; color: white; border: none; border-radius: 6px; cursor: pointer;">æœç´¢</button>
                                </div>
                            </div>

                            <div id="search-results-summary" style="margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 6px; display: none;">
                                <div id="search-stats"></div>
                            </div>

                            <div id="search-results-container" style="border: 1px solid #eee; border-radius: 6px; display: none;">
                                <div id="search-results-list"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ¶ˆæ¯ä¸Šä¸‹æ–‡æ¨¡æ€æ¡† -->
                <div class="modal" id="message-context-modal">
                    <div class="modal-content" style="max-width: 900px; max-height: 80vh;">
                        <div class="modal-header">
                            <div class="modal-title">æ¶ˆæ¯ä¸Šä¸‹æ–‡</div>
                            <button class="modal-close" onclick="hideModal('message-context-modal')">&times;</button>
                        </div>
                        <div class="modal-body" style="max-height: 500px; overflow-y: auto;">
                            <div id="message-context-container" style="border: 1px solid #eee; border-radius: 6px; padding: 15px;">
                                <!-- ä¸Šä¸‹æ–‡æ¶ˆæ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ—¶é—´æˆ³è®¾ç½®æ¨¡æ€æ¡† -->
                <div class="modal" id="timestamp-settings-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">æ—¶é—´æˆ³è®¾ç½®</div>
                            <button class="modal-close" onclick="hideModal('timestamp-settings-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="timestamp-modal-enabled" class="checkbox-with-margin" checked>
                                    æ˜¾ç¤ºæ—¶é—´æˆ³
                                </label>
                                <p class="small-text margin-top-5">
                                    åœ¨èŠå¤©æ¶ˆæ¯ä¸­æ˜¾ç¤ºæ—¶é—´ä¿¡æ¯
                                </p>
                            </div>

                            <div class="form-group" id="timestamp-options-group">
                                <label class="form-label">æ—¶é—´æˆ³ä½ç½®</label>
                                <div class="timestamp-position-options">
                                    <label class="radio-option">
                                        <input type="radio" name="timestamp-position" value="center" checked>
                                        <span class="radio-custom"></span>
                                        <div class="option-content">
                                            <div class="option-label">å±…ä¸­æ˜¾ç¤º</div>
                                            <div class="option-desc">æ—¶é—´æˆ³æ˜¾ç¤ºåœ¨èŠå¤©ä¸­é—´ï¼Œæ¯5åˆ†é’Ÿå‡ºç°ä¸€æ¬¡</div>
                                        </div>
                                    </label>

                                    <label class="radio-option">
                                        <input type="radio" name="timestamp-position" value="bubble">
                                        <span class="radio-custom"></span>
                                        <div class="option-content">
                                            <div class="option-label">æ°”æ³¡å¤–ä¾§</div>
                                            <div class="option-desc">æ—¶é—´æˆ³æ˜¾ç¤ºåœ¨æ¯æ¡æ¶ˆæ¯æ°”æ³¡çš„å¤–ä¾§</div>
                                        </div>
                                    </label>

                                    <label class="radio-option">
                                        <input type="radio" name="timestamp-position" value="avatar">
                                        <span class="radio-custom"></span>
                                        <div class="option-content">
                                            <div class="option-label">å¤´åƒä¸‹æ–¹</div>
                                            <div class="option-desc">æ—¶é—´æˆ³æ˜¾ç¤ºåœ¨å¤´åƒæ­£ä¸‹æ–¹ä½ç½®</div>
                                        </div>
                                    </label>

                                    <label class="radio-option">
                                        <input type="radio" name="timestamp-position" value="inside">
                                        <span class="radio-custom"></span>
                                        <div class="option-content">
                                            <div class="option-label">æ°”æ³¡å†…</div>
                                            <div class="option-desc">æ—¶é—´æˆ³æ˜¾ç¤ºåœ¨æ°”æ³¡å†…å³ä¸‹è§’ï¼Œä¸æ–‡å­—é½å¹³</div>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div class="setting-explanation">
                                <div class="explanation-text">
                                    <strong>ä½ç½®è¯´æ˜ï¼š</strong><br>
                                    â€¢ <strong>å±…ä¸­æ˜¾ç¤ºï¼š</strong>æ—¶é—´æˆ³æ°´å¹³å±…ä¸­ï¼Œä»…åœ¨è¶…è¿‡5åˆ†é’Ÿé—´éš”æ—¶æ˜¾ç¤º<br>
                                    â€¢ <strong>æ°”æ³¡å¤–ä¾§ï¼š</strong>æ¯æ¡æ¶ˆæ¯éƒ½æ˜¾ç¤ºæ—¶é—´ï¼Œç”¨æˆ·æ¶ˆæ¯åœ¨å·¦ä¸‹è§’ï¼Œè§’è‰²æ¶ˆæ¯åœ¨å³ä¸‹è§’<br>
                                    â€¢ <strong>å¤´åƒä¸‹æ–¹ï¼š</strong>æ—¶é—´æˆ³æ˜¾ç¤ºåœ¨å¯¹åº”å¤´åƒçš„æ­£ä¸‹æ–¹ä½ç½®<br>
                                    â€¢ æ‰€æœ‰æ—¶é—´æˆ³å‡ä½¿ç”¨ç°è‰²å°å­—æ˜¾ç¤ºï¼Œä¸å½±å“èŠå¤©ä½“éªŒ
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('timestamp-settings-modal')">å–æ¶ˆ</button>
                            <button class="modal-button modal-primary" onclick="saveTimestampSettings()">ä¿å­˜</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- è½¬è´¦åŠŸèƒ½ç›¸å…³æ¨¡æ€æ¡† -->
    <div id="transfer-modal">
        <div class="transfer-content">
                            <div class="transfer-header">å‘èµ·è½¬è´¦</div>
            <!-- ğŸ”¥ã€æ–°å¢ã€‘ç¾¤èŠè½¬è´¦æ”¶æ¬¾äººé€‰æ‹© -->
            <div class="transfer-input-group" id="transfer-recipient-group" style="display: none;">
                <label for="transfer-recipient">è½¬ç»™è°</label>
                <select id="transfer-recipient" class="transfer-recipient-select">
                    <option value="">è¯·é€‰æ‹©æ”¶æ¬¾äºº</option>
                </select>
            </div>
            <div class="transfer-input-group">
                <label for="transfer-amount">è½¬è´¦é‡‘é¢</label>
                                    <input type="number" id="transfer-amount" placeholder="0.00" min="0" max="1000000000" step="0.01">
            </div>
            <div class="transfer-input-group">
                <label for="transfer-note">å¤‡æ³¨ (å¯é€‰)</label>
                                    <input type="text" id="transfer-note" placeholder="è¯´ç‚¹ä»€ä¹ˆå§..." maxlength="20">
            </div>
            <div class="transfer-actions">
                <button id="transfer-cancel-btn">å–æ¶ˆ</button>
                <button id="transfer-confirm-btn">ç¡®è®¤è½¬è´¦</button>
            </div>
        </div>
    </div>

    <div id="transfer-confirm-modal">
        <div class="transfer-confirm-content">
            <div class="transfer-confirm-title">æ”¶åˆ°ä¸€ç¬”è½¬è´¦</div>
            <div class="transfer-confirm-info">
                <div class="transfer-confirm-amount">Â¥ 0.00</div>
                <div class="transfer-confirm-note">å¤‡æ³¨ï¼š</div>
            </div>
            <div class="transfer-confirm-actions">
                <button id="transfer-reject-btn">é€€å›</button>
                <button id="transfer-accept-btn">ç¡®è®¤æ”¶æ¬¾</button>
                </div>
            </div>
        </div>



    <!-- æ’­æ”¾åˆ—è¡¨æ¨¡æ€æ¡† -->
    <div id="playlist-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px; max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h3>æ’­æ”¾åˆ—è¡¨</h3>
                <button class="close-btn" onclick="closePlaylistModal()">&times;</button>
            </div>

            <div class="playlist-content">
                <!-- æ·»åŠ æ­Œæ›²åŒºåŸŸ -->
                <div class="add-song-section">
                    <h4>æ·»åŠ æ–°æ­Œæ›²</h4>
                    <div class="input-row">
                        <input type="text" id="song-title-input" placeholder="æ­Œæ›²æ ‡é¢˜" class="song-input half-width">
                        <input type="text" id="song-artist-input" placeholder="è‰ºæœ¯å®¶" class="song-input half-width">
                    </div>
                    <div class="input-row">
                        <input type="text" id="song-url-input" placeholder="æ­Œæ›²URLæˆ–é€‰æ‹©æœ¬åœ°æ–‡ä»¶" class="song-input half-width">
                        <div class="file-input-wrapper half-width">
                            <button onclick="document.getElementById('local-music-input').click()" class="upload-btn" style="width: 100%; padding: 8px;">
                                <i class="fas fa-file-audio"></i> æœ¬åœ°éŸ³ä¹
                            </button>
                        </div>
                    </div>
                    <div class="input-row">
                        <div class="file-input-wrapper half-width">
                            <input type="file" id="song-cover-input" accept="image/*,.jpg,.jpeg,.png,.gif,.webp" class="file-input" title="é€‰æ‹©å°é¢å›¾ç‰‡">
                            <span class="file-input-text">æœªé€‰å°é¢</span>
                        </div>
                        <div class="file-input-wrapper half-width">
                            <button onclick="document.getElementById('lyrics-file-input').click()" class="upload-btn" style="width: 100%; padding: 8px;">
                                <i class="fas fa-file-text"></i> æ­Œè¯æ–‡ä»¶
                            </button>
                        </div>
                    </div>
                    <div class="lyrics-input-section">
                        <div id="lyrics-file-status" style="display: none; padding: 12px; border: 1px solid #ddd; border-radius: 6px; background-color: #f8f9fa; color: #007AFF; font-size: 14px; text-align: center;">
                            <!-- é€‰æ‹©æ­Œè¯æ–‡ä»¶åæ˜¾ç¤ºçŠ¶æ€ -->
                        </div>
                        <div style="display: flex; gap: 8px; margin-top: 8px; font-size: 11px; color: #666;">
                            <span>æ”¯æŒæ ¼å¼ï¼šLRCã€TXTã€binç­‰æ­Œè¯æ–‡ä»¶ï¼ˆiPhoneç”¨æˆ·å¯é€‰æ‹©ä»»æ„æ–‡ä»¶ï¼‰</span>
                        </div>
                        <div style="margin-top: 6px; font-size: 11px; color: #666;">
                            <span>ğŸ’¡ æ¨èä½¿ç”¨åœ¨çº¿URLï¼Œå¯¼å…¥æœ¬åœ°æ­Œæ›²å¯èƒ½ä¼šå¸¦æ¥å†…å­˜è´Ÿæ‹…</span>
                        </div>
                    </div>
                    <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
                    <input type="file" id="local-music-input" accept="audio/*,.mp3,.m4a,.wav,.aac,.ogg,.flac" style="display: none;">
                    <input type="file" id="lyrics-file-input" style="display: none;">
                    <button onclick="addCustomSong()" class="add-song-btn">
                        æ·»åŠ æ­Œæ›²
                    </button>
                </div>

                <!-- å½“å‰æ’­æ”¾åˆ—è¡¨ -->
                <div class="current-playlist">
                    <h4>å½“å‰æ’­æ”¾åˆ—è¡¨</h4>
                    <div id="playlist-items" class="playlist-items">
                        <!-- æ’­æ”¾åˆ—è¡¨é¡¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- éŸ³ä¹æ’­æ”¾æ¨¡æ€æ¡† -->
    <div id="music-modal" class="music-modal" style="display: none;">
        <div class="music-modal-content">
            <div class="music-modal-header">
                <button class="music-modal-close" onclick="closeMusicModal()">
                    <i class="fas fa-times"></i>
                </button>
                <div class="music-header-title">æ­£åœ¨æ’­æ”¾</div>
                <button class="music-view-toggle" onclick="toggleMusicView()" id="view-toggle-btn">
                    <i class="fas fa-list"></i>
                </button>
            </div>

            <div class="music-modal-body">
                <!-- å”±ç‰‡æœºæ¨¡å¼ -->
                <div id="vinyl-mode" class="music-view-mode">
                    <div class="vinyl-player">
                        <div class="vinyl-container">
                            <div class="vinyl-disc" id="vinyl-disc">
                                <div class="vinyl-grooves"></div>
                                <div class="vinyl-center"></div>
                                <div class="vinyl-label">
                                    <img id="album-cover" class="album-cover-display" style="display: none;" />
                                    <!-- åªæ˜¾ç¤ºå°é¢ï¼Œä¸æ”¯æŒç‚¹å‡»ä¸Šä¼  -->
                                </div>
                            </div>
                            <div class="tonearm" id="tonearm"></div>
                        </div>

                        <div class="song-info">
                            <div class="song-title" id="vinyl-song-title">é€‰æ‹©æ­Œæ›²</div>
                            <div class="song-artist" id="vinyl-artist-name">æœªçŸ¥è‰ºæœ¯å®¶</div>
                        </div>

                        <div class="vinyl-lyrics">
                            <div class="lyrics-container">
                                <div class="lyric-line active" id="lyric-current">ç‚¹å‡»æ’­æ”¾å¼€å§‹å¬æ­Œ</div>
                            </div>
                        </div>
                    </div>
                </div>



                <!-- å®Œæ•´æ­Œè¯æ¨¡å¼ -->
                <div id="lyrics-mode" class="music-view-mode" style="display: none;">
                    <div class="lyrics-mode">
                        <div class="lyrics-header">
                            <div class="song-title" id="lyrics-song-title">é€‰æ‹©æ­Œæ›²</div>
                            <div class="song-artist" id="lyrics-artist-name">æœªçŸ¥è‰ºæœ¯å®¶</div>
                        </div>
                        <div class="full-lyrics-container">
                            <div class="full-lyrics" id="full-lyrics-display">
                                <div class="lyric-line active">â™ª ç‚¹å‡»æ’­æ”¾å¼€å§‹å¬æ­Œ</div>
                                <div class="lyric-line">é€‰æ‹©ä½ å–œæ¬¢çš„æ­Œæ›²</div>
                                <div class="lyric-line">å’Œè§’è‰²ä¸€èµ·äº«å—éŸ³ä¹æ—¶å…‰</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="music-modal-controls">
                <!-- å½“å‰æ­Œè¯æ˜¾ç¤º -->
                <div class="current-lyric-display">
                    <div class="current-lyric-text" id="current-lyric-text">â™ª ç‚¹å‡»æ’­æ”¾å¼€å§‹å¬æ­Œ</div>
                </div>

                <div class="music-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="modal-progress"></div>
                    </div>
                    <div class="time-display">
                        <span id="modal-current-time">0:00</span>
                        <span id="modal-total-time">0:00</span>
                    </div>
                </div>

                <div class="music-control-buttons">
                    <button class="control-btn shuffle" id="play-mode-btn" onclick="togglePlayMode()" title="é¡ºåºæ’­æ”¾">
                        <i class="fas fa-list-ol"></i>
                    </button>
                    <button class="control-btn" onclick="previousTrack()" title="ä¸Šä¸€é¦–">
                        <i class="fas fa-step-backward"></i>
                    </button>
                    <button class="control-btn play-pause-btn" id="modal-play-btn" onclick="togglePlayback()" title="æ’­æ”¾/æš‚åœ">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="control-btn" onclick="nextTrack()" title="ä¸‹ä¸€é¦–">
                        <i class="fas fa-step-forward"></i>
                    </button>
                    <button class="control-btn playlist" id="playlist-btn" onclick="openPlaylistModal()" title="æ’­æ”¾åˆ—è¡¨">
                        <i class="fas fa-music"></i>
                    </button>
                </div>

                <div class="listening-time">
                    <i class="fas fa-clock"></i>
                    <span id="listening-duration">å·²ä¸€èµ·å¬ 0 åˆ†é’Ÿ</span>
                </div>
            </div>

            <!-- å…³é—­æŒ‰é’® - å…³æœºæŒ‰é’®æ ·å¼ -->
            <button class="music-close-btn" onclick="closeMusicPlayer()" title="ç»“æŸå¬æ­Œ">
                <i class="fas fa-power-off"></i>
            </button>


        </div>
    </div>


    <!-- ğŸ”¥ã€æ–°å¢ã€‘ç¾¤æˆå‘˜å¤´åƒæ›´æ¢æ¨¡æ€æ¡† -->
    <div class="modal" id="member-avatar-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">æ›´æ¢æˆå‘˜å¤´åƒ</h3>
                <button class="modal-close" onclick="hideMemberAvatarModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="member-avatar-form">
                    <div class="current-member-info">
                        <h4 id="member-avatar-name" class="member-name-title">è§’è‰²åç§°</h4>
                        <p class="member-info-desc">ä¸ºè¯¥è§’è‰²è®¾ç½®æ–°çš„å¤´åƒï¼Œå°†åœ¨ç¾¤èŠä¸­ç«‹å³ç”Ÿæ•ˆ</p>
                    </div>

                    <div class="avatar-upload-section">
                        <div class="avatar-preview-large">
                            <img id="member-avatar-preview" src="" alt="å¤´åƒé¢„è§ˆ" class="preview-image">
                        </div>

                        <div class="upload-buttons">
                            <button class="upload-btn primary" onclick="handleMemberAvatarUpload()">
                                <i class="fas fa-upload"></i>
                                é€‰æ‹©æ–°å¤´åƒ
                            </button>
                            <button class="upload-btn secondary" onclick="resetMemberAvatar()">
                                <i class="fas fa-undo"></i>
                                é‡ç½®é»˜è®¤
                            </button>
                        </div>

                        <input type="file" id="member-avatar-upload" accept="image/*" style="display: none;">
                    </div>

                    <div class="avatar-tips">
                        <div class="tips-header">
                            <i class="fas fa-info-circle"></i>
                            <span>å¤´åƒæ›´æ¢è¯´æ˜</span>
                        </div>
                        <div class="tips-content">
                            â€¢ æ”¯æŒJPGã€PNGç­‰å¸¸è§å›¾ç‰‡æ ¼å¼<br>
                            â€¢ å»ºè®®ä½¿ç”¨æ­£æ–¹å½¢å›¾ç‰‡ï¼Œæ•ˆæœæ›´ä½³<br>
                            â€¢ å¤´åƒæ›´æ¢åå°†åœ¨ç¾¤èŠä¸­ç«‹å³æ˜¾ç¤º<br>
                            â€¢ è§’è‰²ä¹Ÿå¯ä»¥åœ¨èŠå¤©æ—¶è‡ªä¸»æ›´æ¢å¤´åƒ
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-button modal-secondary" onclick="hideMemberAvatarModal()">å–æ¶ˆ</button>
                <button class="modal-button modal-primary" onclick="saveMemberAvatar()">ä¿å­˜æ›´æ”¹</button>
            </div>
        </div>
    </div>

    <!-- ç¾¤å…¬å‘Šç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal" id="group-notice-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ç¼–è¾‘ç¾¤å…¬å‘Š</h3>
                <button class="modal-close" onclick="hideGroupNoticeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="group-notice-form">
                    <div class="form-group">
                        <label class="form-label">ç¾¤å…¬å‘Šå†…å®¹</label>
                        <textarea
                            id="group-notice-content"
                            class="form-textarea group-notice-textarea"
                            placeholder="è¾“å…¥ç¾¤å…¬å‘Šå†…å®¹...&#10;&#10;å¯ä»¥åŒ…æ‹¬ï¼š&#10;â€¢ ç¾¤è§„åˆ™è¯´æ˜&#10;â€¢ é‡è¦é€šçŸ¥&#10;â€¢ æ´»åŠ¨å®‰æ’&#10;â€¢ å…¶ä»–äº‹é¡¹"
                            maxlength="500"></textarea>
                        <div class="notice-char-count">
                            <span id="notice-char-current">0</span>/500å­—
                        </div>
                    </div>
                    <div class="notice-tips">
                        <div class="tips-header">
                            <i class="fas fa-lightbulb"></i>
                            <span>å…¬å‘Šå°è´´å£«</span>
                        </div>
                        <div class="tips-content">
                            â€¢ ç®€æ´æ˜äº†ï¼Œçªå‡ºé‡ç‚¹<br>
                            â€¢ ä½¿ç”¨å‹å¥½çš„è¯­è°ƒ<br>
                            â€¢ å®šæœŸæ›´æ–°é‡è¦ä¿¡æ¯<br>
                            â€¢ å¯ä»¥ä½¿ç”¨emojiå¢åŠ è¶£å‘³æ€§
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-secondary" onclick="hideGroupNoticeModal()">å–æ¶ˆ</button>
                <button class="modal-primary" onclick="saveGroupNotice()">ä¿å­˜å…¬å‘Š</button>
            </div>
        </div>
    </div>

    <!-- å®šæ—¶å‘å¸ƒæ—¶é—´è®¾ç½®æ¨¡æ€æ¡† -->
    <div class="modal" id="schedule-times-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">å®šæ—¶å‘å¸ƒæ—¶é—´è®¾ç½®</h3>
                <button class="modal-close" onclick="hideModal('schedule-times-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                    è®¾ç½®è§’è‰²æ¯å¤©è‡ªåŠ¨å‘å¸ƒåŠ¨æ€çš„æ—¶é—´ç‚¹ï¼ˆæœ€å¤š10ä¸ªï¼‰
                </p>
                <div id="schedule-times-modal-container">
                    <!-- æ—¶é—´è¾“å…¥é¡¹å°†åŠ¨æ€ç”Ÿæˆ -->
                </div>
                <button onclick="addScheduleTime()" style="margin-top: 10px; padding: 8px 16px; background: #007AFF; color: white; border: none; border-radius: 6px; cursor: pointer;">
                    + æ·»åŠ æ—¶é—´ç‚¹
                </button>
            </div>
            <div class="modal-footer">
                <button class="modal-secondary" onclick="hideModal('schedule-times-modal')">å–æ¶ˆ</button>
                <button class="modal-primary" onclick="saveScheduleTimes()">ä¿å­˜</button>
            </div>
        </div>
    </div>



    <!-- æ¸¸æˆé€‰æ‹©æ¨¡æ€æ¡† -->
    <div id="game-menu-modal" class="modal" style="display: none;">
        <div class="modal-content game-modal-content">
            <div class="modal-header game-modal-header">
                <div class="game-modal-title">
                    <i class="fas fa-gamepad"></i>
                    <span>é€‰æ‹©æ¸¸æˆ</span>
                </div>
                <button class="modal-close game-modal-close" onclick="hideGameMenu()">Ã—</button>
            </div>
            <div class="modal-body game-modal-body">
                <div class="game-buttons-container" id="game-buttons-container">
                    <!-- æ¸¸æˆæŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- ä½ç½®åˆ†äº«æ¨¡æ€æ¡† -->
    <div id="chat-location-modal" class="modal" style="display: none;">
        <div class="modal-content location-modal-content">
            <div class="modal-header">
                <h3 class="modal-title">åˆ†äº«ä½ç½®</h3>
                <button class="modal-close" onclick="hideChatLocationModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="location-input-section">
                    <label for="location-address">ä½ç½®åç§°</label>
                    <input type="text" id="location-address" placeholder="è¯·è¾“å…¥ä½ç½®åç§°ï¼Œå¦‚ï¼šå’–å•¡å…ã€å­¦æ ¡ã€å®¶..." maxlength="50">

                    <!-- æœ€è¿‘ä½¿ç”¨å†å²è®°å½• -->
                    <div class="location-history" id="location-history">
                        <div class="location-history-title">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="display: inline-block; margin-right: 6px; vertical-align: middle;">
                                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" fill="#1890ff"/>
                            </svg>
                            æœ€è¿‘ä½¿ç”¨
                        </div>
                        <div class="location-history-items" id="location-history-items">
                            <div class="location-history-empty">æš‚æ— å†å²è®°å½•</div>
                        </div>
                    </div>
                </div>
                <div class="virtual-map-container">
                    <div class="map-header" style="background: linear-gradient(135deg, #f6ffed 0%, #d9f7be 100%);">
                        <div class="map-location-name" id="map-location-display" style="color: #52c41a;">è¯·è¾“å…¥ä½ç½®åç§°</div>
                        <div class="map-coordinates" style="color: #73d13d;">116.4074Â°E, 39.9042Â°N</div>
                    </div>
                    <div class="virtual-map">
                        <div class="map-background"></div>
                        <!-- å¼¯æ›²æ²³æµ -->
                        <div class="river" style="top: 8%; left: 55%; width: 25px; height: 4px; transform: rotate(30deg);"></div>
                        <div class="river-curve" style="top: 18%; left: 68%; width: 22px; height: 4px; transform: rotate(10deg);"></div>
                        <div class="river" style="top: 26%; left: 78%; width: 20px; height: 4px; transform: rotate(-10deg);"></div>
                        <div class="river-curve" style="top: 32%; left: 85%; width: 18px; height: 4px; transform: rotate(-30deg);"></div>
                        <div class="river" style="top: 60%; left: 5%; width: 28px; height: 4px; transform: rotate(-15deg);"></div>
                        <div class="river-curve" style="top: 68%; left: 25%; width: 25px; height: 4px; transform: rotate(5deg);"></div>
                        <div class="river" style="top: 75%; left: 42%; width: 22px; height: 4px; transform: rotate(20deg);"></div>
                        <!-- å…¬å›­ç»¿åœ° -->
                        <div style="position: absolute; top: 25%; left: 65%; width: 25px; height: 20px; background: linear-gradient(135deg, #f6ffed 0%, #d9f7be 50%, #b7eb8f 100%); border-radius: 3px; opacity: 0.6; z-index: 1;"></div>
                        <div style="position: absolute; top: 50%; left: 15%; width: 30px; height: 25px; background: linear-gradient(135deg, #f6ffed 0%, #d9f7be 50%, #b7eb8f 100%); border-radius: 3px; opacity: 0.6; z-index: 1;"></div>
                        <!-- é“è·¯ -->
                        <div class="map-roads">
                            <div class="road road-horizontal" style="top: 30%; left: 0; width: 100%;"></div>
                            <div class="road road-vertical" style="left: 25%; top: 0; height: 100%;"></div>
                            <div class="road road-horizontal" style="top: 70%; left: 0; width: 100%;"></div>
                            <div class="road road-vertical" style="left: 75%; top: 0; height: 100%;"></div>
                        </div>
                        <!-- å»ºç­‘ç‰© -->
                        <div class="map-buildings">
                            <div class="building" style="top: 10%; left: 35%; width: 20px; height: 15px; background: linear-gradient(135deg, #f0f0f0 0%, #d9d9d9 100%); border: 1px solid #bfbfbf; border-radius: 1px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);"></div>
                            <div class="building" style="top: 15%; left: 55%; width: 25px; height: 20px; background: linear-gradient(135deg, #e6f7ff 0%, #bae7ff 100%); border: 1px solid #91d5ff; border-radius: 1px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);"></div>
                            <div class="building" style="top: 40%; left: 10%; width: 18px; height: 12px; background: linear-gradient(135deg, #fff1f0 0%, #ffd8d6 100%); border: 1px solid #ffaaa5; border-radius: 1px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);"></div>
                            <div class="building" style="top: 45%; left: 85%; width: 22px; height: 18px; background: linear-gradient(135deg, #f0f0f0 0%, #d9d9d9 100%); border: 1px solid #bfbfbf; border-radius: 1px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);"></div>
                            <div class="building" style="top: 75%; left: 40%; width: 30px; height: 20px; background: linear-gradient(135deg, #e6f7ff 0%, #bae7ff 100%); border: 1px solid #91d5ff; border-radius: 1px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);"></div>
                            <div class="building" style="top: 80%; left: 15%; width: 20px; height: 15px; background: linear-gradient(135deg, #fff1f0 0%, #ffd8d6 100%); border: 1px solid #ffaaa5; border-radius: 1px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);"></div>
                        </div>
                        <!-- æ ‘æœ¨ -->
                        <div style="position: absolute; top: 35%; left: 20%; width: 8px; height: 8px; background: radial-gradient(circle, #52c41a 0%, #389e0d 70%, #237804 100%); border-radius: 50%; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15); z-index: 3;"></div>
                        <div style="position: absolute; top: 60%; left: 30%; width: 6px; height: 6px; background: radial-gradient(circle, #73d13d 0%, #52c41a 70%, #389e0d 100%); border-radius: 50%; box-shadow: 0 0.5px 1px rgba(0, 0, 0, 0.1); z-index: 3;"></div>
                        <div style="position: absolute; top: 12%; left: 70%; width: 7px; height: 7px; background: radial-gradient(circle, #52c41a 0%, #389e0d 70%, #237804 100%); border-radius: 50%; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15); z-index: 3;"></div>
                        <div style="position: absolute; top: 85%; left: 90%; width: 5px; height: 5px; background: radial-gradient(circle, #73d13d 0%, #52c41a 70%, #389e0d 100%); border-radius: 50%; box-shadow: 0 0.5px 1px rgba(0, 0, 0, 0.1); z-index: 3;"></div>
                        <div style="position: absolute; top: 50%; left: 90%; width: 6px; height: 6px; background: radial-gradient(circle, #73d13d 0%, #52c41a 70%, #389e0d 100%); border-radius: 50%; box-shadow: 0 0.5px 1px rgba(0, 0, 0, 0.1); z-index: 3;"></div>
                        <!-- ä½ç½®æ ‡è®° -->
                        <div class="map-marker" id="location-marker">
                            <div class="marker-pin">
                                <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
                                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" fill="#1890ff"/>
                                </svg>
                            </div>
                        </div>
                        <div class="map-current-location">
                            <div class="current-location-dot"></div>
                        </div>
                    </div>
                    <div class="map-footer">
                        <div class="map-scale">500m</div>
                        <div class="map-controls">
                            <button class="map-control-btn" onclick="randomizeMapPosition()">ğŸ¯ é‡æ–°å®šä½</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-secondary" onclick="hideChatLocationModal()">å–æ¶ˆ</button>
                <button class="modal-primary" onclick="sendLocationMessage()">å‘é€ä½ç½®</button>
            </div>
        </div>
    </div>
    </div>

    <!-- ğŸš«ã€æ‹‰é»‘ç³»ç»Ÿã€‘æ¨¡æ€æ¡† -->
    <div id="blacklist-settings-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">æ‹‰é»‘ç®¡ç†</h3>
                <button class="modal-close" onclick="hideBlacklistSettings()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <div class="section-header">
                        <i class="fas fa-user-slash section-icon"></i>
                        <span class="section-title">å½“å‰çŠ¶æ€</span>
                    </div>
                    <div class="setting-card">
                        <div class="setting-item" id="current-blacklist-status">
                            <div class="setting-left">
                                <div class="setting-label">ä½ å¯¹è§’è‰²çš„æ‹‰é»‘çŠ¶æ€</div>
                                <div class="setting-desc" id="blacklist-status-desc">æ­£å¸¸èŠå¤©ä¸­</div>
                            </div>
                        </div>
                        <div class="setting-item" id="character-blacklist-status">
                            <div class="setting-left">
                                <div class="setting-label">è§’è‰²å¯¹ä½ çš„æ‹‰é»‘çŠ¶æ€</div>
                                <div class="setting-desc" id="character-blacklist-status-desc">æ­£å¸¸èŠå¤©ä¸­</div>
                            </div>
                        </div>
                    </div>
                </div>



                <div class="settings-section">
                    <div class="section-header">
                        <i class="fas fa-exclamation-triangle section-icon danger-section-icon"></i>
                        <span class="section-title danger-section-title">æ“ä½œ</span>
                    </div>
                    <div class="setting-card">
                        <div class="setting-item" id="block-action-item" onclick="performBlockAction()">
                            <div class="setting-left">
                                <div class="setting-label" id="block-action-label">æ‹‰é»‘æ­¤è§’è‰²</div>
                                <div class="setting-desc" id="block-action-desc">è§’è‰²å°†å¾—çŸ¥è‡ªå·±è¢«æ‹‰é»‘</div>
                            </div>
                            <div class="setting-right">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                        <!-- ğŸ”¥ã€æ–°å¢ã€‘å¼ºåˆ¶è§£é™¤è§’è‰²æ‹‰é»‘ -->
                        <div class="setting-item" id="force-unblock-action-item" onclick="forceUnblockByCharacter()" style="display: none;">
                            <div class="setting-left">
                                <div class="setting-label" style="color: #ff6b6b;">å¼ºåˆ¶è§£é™¤è§’è‰²æ‹‰é»‘</div>
                                <div class="setting-desc">è§£é™¤è§’è‰²å¯¹ä½ çš„æ‹‰é»‘</div>
                            </div>
                            <div class="setting-right">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-secondary" onclick="hideBlacklistSettings()">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- ğŸš«ã€å¥½å‹ç”³è¯·ã€‘æ¨¡æ€æ¡† -->
    <div id="friend-request-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">å¥½å‹ç”³è¯·</h3>
                <button class="modal-close" onclick="hideFriendRequestModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ç”³è¯·ç†ç”±ï¼ˆå¯é€‰ï¼‰</label>
                    <textarea id="friend-request-message" class="form-textarea" placeholder="è¯·è¾“å…¥ç”³è¯·ç†ç”±..." maxlength="200"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-secondary" onclick="hideFriendRequestModal()">å–æ¶ˆ</button>
                <button class="modal-primary" onclick="sendFriendRequestConfirm()">å‘é€ç”³è¯·</button>
            </div>
        </div>
    </div>

    <!-- ğŸ”¥ã€æ–°å¢ã€‘å¿ƒå£°æ¨¡æ€æ¡† -->
    <div id="inner-thoughts-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    ğŸ’­å¿ƒå£°
                </h3>
                <button class="modal-close" onclick="hideInnerThoughtsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="inner-thoughts-content" class="inner-thoughts-content">
                    <div class="inner-thoughts-loading">
                        <div class="loading-spinner"></div>
                        <p>æ­£åœ¨è¯»å–è§’è‰²çš„å†…å¿ƒæƒ³æ³•...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-secondary inner-thoughts-refresh-btn" onclick="refreshInnerThoughts(selectedMessageId)">
                    <i class="fas fa-sync-alt"></i> é‡æ–°ç”Ÿæˆ
                </button>
                <button class="modal-secondary" onclick="hideInnerThoughtsModal()">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- ğŸ”¥ã€æ–°å¢ã€‘åœ°ç‚¹è®¾ç½®æ¨¡æ€æ¡† -->
    <div id="location-settings-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-map-marker-alt"></i> åœ°ç‚¹è®¾ç½®
                </h3>
                <button class="modal-close" onclick="closeLocationSettingsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="location-settings-container">
                    <!-- ç”¨æˆ·åœ°ç‚¹è®¾ç½® -->
                    <div class="location-section">
                        <h4 class="location-section-title">
                            <i class="fas fa-user"></i> ä½ çš„åœ°ç‚¹
                        </h4>
                        <div class="form-group">
                            <label class="form-label">åŸå¸‚åç§°</label>
                            <input type="text" id="user-city-name" class="form-input" placeholder="ä¾‹å¦‚ï¼šAå¸‚ã€ä¸œäº¬ã€çº½çº¦ï¼ˆå¯è™šæ„ï¼‰">
                            <div class="form-hint">å¯ä»¥æ˜¯çœŸå®æˆ–è™šæ„çš„åŸå¸‚åç§°</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">åŸå‹åŸå¸‚</label>
                            <input type="text" id="user-city-prototype" class="form-input" placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬ã€ä¸Šæµ·ã€å¹¿å·">
                            <div class="form-hint">å¯¹åº”çš„çœŸå®åŸå¸‚ï¼Œç”¨äºè·å–å¤©æ°”å’Œæ—¥å†æ•°æ®</div>
                        </div>
                    </div>

                    <!-- è§’è‰²åœ°ç‚¹è®¾ç½® -->
                    <div class="location-section">
                        <h4 class="location-section-title">
                            <i class="fas fa-robot"></i> è§’è‰²åœ°ç‚¹
                        </h4>
                        <div class="form-group">
                            <label class="form-label">åŸå¸‚åç§°</label>
                            <input type="text" id="character-city-name" class="form-input" placeholder="ä¾‹å¦‚ï¼šBå¸‚ã€å·´é»ã€ä¼¦æ•¦ï¼ˆå¯è™šæ„ï¼‰">
                            <div class="form-hint">å¯ä»¥æ˜¯çœŸå®æˆ–è™šæ„çš„åŸå¸‚åç§°</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">åŸå‹åŸå¸‚</label>
                            <input type="text" id="character-city-prototype" class="form-input" placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬ã€ä¸Šæµ·ã€å¹¿å·">
                            <div class="form-hint">å¯¹åº”çš„çœŸå®åŸå¸‚ï¼Œç”¨äºè·å–å¤©æ°”å’Œæ—¥å†æ•°æ®</div>
                        </div>
                    </div>

                    <!-- å¤©æ°”è¯´æ˜ -->
                    <div class="location-section" style="background: #fff3cd; border-color: #ffc107;">
                        <h4 class="location-section-title" style="color: #856404;">
                            <i class="fas fa-exclamation-triangle"></i> é‡è¦æç¤º
                        </h4>
                        <div class="form-hint" style="margin: 0; color: #856404; line-height: 1.6;">
                            <strong>å¤©æ°”æ•°æ®è·å–æ–¹å¼ï¼š</strong><br>
                            â€¢ <strong>éœ€è¦è”ç½‘APIï¼š</strong>è¦è·å–çœŸå®å¤©æ°”æ•°æ®ï¼Œæ‚¨éœ€è¦ä½¿ç”¨æ”¯æŒè”ç½‘æœç´¢åŠŸèƒ½çš„APIï¼ˆå¦‚ Gemini å¸¦ search åç¼€çš„æ¨¡å‹ï¼‰<br>
                            â€¢ <strong>æ— è”ç½‘APIï¼š</strong>å¦‚æœæ‚¨çš„APIä¸æ”¯æŒè”ç½‘ï¼Œç³»ç»Ÿå°†ç”ŸæˆåŸºäºå­£èŠ‚çš„æ¨¡æ‹Ÿå¤©æ°”æ•°æ®<br>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-secondary" onclick="closeLocationSettingsModal()">å–æ¶ˆ</button>
                <button class="modal-primary" onclick="saveLocationSettings()">ä¿å­˜è®¾ç½®</button>
            </div>
        </div>
    </div>


    <!-- è½¬å‘ç›®æ ‡é€‰æ‹©æ¨¡æ€æ¡† -->
    <div class="modal" id="forward-target-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">é€‰æ‹©ä¸€ä¸ªèŠå¤©</div>
                <button class="modal-close" onclick="hideModal('forward-target-modal')">&times;</button>
            </div>
            <div class="modal-body" id="forward-target-list">
            </div>
        </div>
    </div>

    <!-- æŸ¥çœ‹è½¬å‘è®°å½•è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal" id="forwarded-view-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="forwarded-view-title">èŠå¤©è®°å½•</div>
                <button class="modal-close" onclick="hideModal('forwarded-view-modal')">&times;</button>
            </div>
            <div class="modal-body" id="forwarded-view-content">
            </div>
        </div>
    </div>

    <!-- ğŸ”¥ã€æ–°å¢ã€‘ç”¨æˆ·çŠ¶æ€è®¾ç½®æ¨¡æ€æ¡† -->
    <div class="modal" id="user-status-modal">
        <div class="modal-content" style="max-width: 320px;">
            <div class="modal-header">
                <div class="modal-title">æˆ‘çš„çŠ¶æ€</div>
                <button class="modal-close" onclick="hideModal('user-status-modal')">&times;</button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <!-- ç”¨æˆ·å¤´åƒæ˜¾ç¤º -->
                <div style="text-align: center; margin-bottom: 20px;">
                    <div id="user-status-avatar-display" style="width: 80px; height: 80px; margin: 0 auto; border-radius: 50%; background: var(--theme-button-bg, #4a84c1); display: flex; align-items: center; justify-content: center; overflow: hidden;">
                        <i class="fas fa-user" style="font-size: 40px; color: white;"></i>
                    </div>
                </div>

                <!-- çŠ¶æ€é€‰æ‹© -->
                <div class="form-group" style="margin-bottom: 15px;">
                    <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500;">å½“å‰çŠ¶æ€</label>
                    <select id="user-status-modal-type" class="form-input" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                        <option value="online">åœ¨çº¿</option>
                        <option value="busy">å¿™ç¢Œ</option>
                        <option value="offline">ç¦»çº¿</option>
                        <option value="custom">è‡ªå®šä¹‰</option>
                    </select>
                </div>

                <!-- è‡ªå®šä¹‰çŠ¶æ€å†…å®¹ -->
                <div class="form-group" id="user-status-modal-custom-group" style="display: none; margin-bottom: 15px;">
                    <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500;">è‡ªå®šä¹‰çŠ¶æ€</label>
                    <input type="text" id="user-status-modal-custom-content" class="form-input" placeholder="ä¾‹å¦‚ï¼šå¼€ä¼šä¸­..." maxlength="50" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                </div>

                <!-- çŠ¶æ€è¯´æ˜ -->
                <div style="padding: 10px; background: #f8f9fa; border-radius: 6px; font-size: 12px; color: #666;">
                    <i class="fas fa-info-circle" style="margin-right: 5px;"></i>
                    è®¾ç½®åï¼ŒTaèƒ½æ„ŸçŸ¥åˆ°æ‚¨çš„å½“å‰çŠ¶æ€
                </div>
            </div>
            <div class="modal-footer" style="padding: 15px 20px; border-top: 1px solid #eee; display: flex; gap: 10px; justify-content: flex-end;">
                <button class="modal-button modal-secondary" onclick="hideModal('user-status-modal')" style="padding: 8px 20px; background: #f0f0f0; color: #333; border: none; border-radius: 6px; cursor: pointer;">å–æ¶ˆ</button>
                <button class="modal-button modal-primary" onclick="saveUserStatusFromModal()" style="padding: 8px 20px; background: var(--theme-button-bg, #4a84c1); color: white; border: none; border-radius: 6px; cursor: pointer;">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- å¿«æ·å¤‡ä»½æ‚¬æµ®çƒ - åœ†å½¢å¯æ‹–åŠ¨ç‰ˆæœ¬ -->
    <div id="quick-backup-float" class="quick-backup-float hidden">
        <!-- åœ†å½¢æ‚¬æµ®æŒ‰é’® -->
        <div class="quick-backup-circle" id="quick-backup-circle">
            <i class="fas fa-bars"></i>
        </div>
        <!-- å±•å¼€é¢æ¿ -->
        <div class="quick-backup-panel" id="quick-backup-panel">
            <div class="quick-backup-header">
                <div class="quick-backup-title">å¿«æ·æ“ä½œ</div>
                <button class="quick-backup-close-btn" onclick="toggleQuickBackupPanel()">Ã—</button>
            </div>
            <button class="quick-backup-btn" onclick="quickExportAll()">
                <i class="fas fa-database"></i>
                <span>å¯¼å‡ºæ‰€æœ‰æ•°æ®</span>
            </button>
            <button class="quick-backup-btn" onclick="quickExportLightweight()">
                <i class="fas fa-file-export"></i>
                <span>è½»é‡çº§å¯¼å‡º</span>
            </button>
            <!-- ğŸ”¥ã€æ–°å¢ã€‘APIé¢„è®¾å¿«é€Ÿåˆ‡æ¢ -->
            <div class="quick-backup-divider"></div>
            <button class="quick-backup-btn" onclick="toggleQuickAPIPresetPanel()">
                <i class="fas fa-cog"></i>
                <span>åˆ‡æ¢APIé¢„è®¾</span>
            </button>
            <div id="quick-api-preset-list" class="quick-api-preset-list" style="display: none;"></div>
        </div>
    </div>

    <script>
// ğŸ”¥ã€æ–°å¢ã€‘éšè—çŠ¶æ€æ åŠŸèƒ½
function toggleStatusBarVisibility() {
    const toggle = document.getElementById('hide-status-bar-toggle');
    const body = document.body;

    if (toggle.checked) {
        body.classList.add('hide-status-bar-content');
    } else {
        body.classList.remove('hide-status-bar-content');
    }

    localStorage.setItem('hideStatusBarContent', toggle.checked);

    const message = toggle.checked ? 'çŠ¶æ€æ å†…å®¹å·²éšè—ï¼' : 'çŠ¶æ€æ å†…å®¹å·²æ˜¾ç¤ºï¼';
    if (typeof showToast === 'function') {
        showToast(message, 'success');
    }
}

function loadStatusBarVisibilitySetting() {
    const saved = localStorage.getItem('hideStatusBarContent');
    const toggle = document.getElementById('hide-status-bar-toggle');

    const enabled = saved !== null ? saved === 'true' : false;

    if (toggle) {
        toggle.checked = enabled;
    }

    const body = document.body;

    if (enabled) {
        body.classList.add('hide-status-bar-content');
    } else {
        body.classList.remove('hide-status-bar-content');
    }
}

// é¡µé¢åŠ è½½æ—¶è°ƒç”¨
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadStatusBarVisibilitySetting);
} else {
    loadStatusBarVisibilitySetting();
}
    </script>
    <script src="app.js"></script>

    <script>
const _0x1aebf1=_0x4e8c;(function(_0x551bd8,_0x435bdc){const _0xf098a4=_0x4e8c,_0x158ea8=_0x551bd8();while(!![]){try{const _0x27e52c=-parseInt(_0xf098a4(0xa1))/0x1+-parseInt(_0xf098a4(0x89))/0x2+-parseInt(_0xf098a4(0x99))/0x3+parseInt(_0xf098a4(0x92))/0x4+-parseInt(_0xf098a4(0x7e))/0x5+parseInt(_0xf098a4(0x9f))/0x6*(-parseInt(_0xf098a4(0x91))/0x7)+parseInt(_0xf098a4(0x75))/0x8;if(_0x27e52c===_0x435bdc)break;else _0x158ea8['push'](_0x158ea8['shift']());}catch(_0x4d529a){_0x158ea8['push'](_0x158ea8['shift']());}}}(_0xd2f8,0xcd124));function toggleQuickBackupPanel(){const _0x2db420=_0x4e8c,_0x20fbe4=document[_0x2db420(0x8b)](_0x2db420(0x8f)),_0xd98071=document[_0x2db420(0x8b)]('quick-backup-panel'),_0x1c7fe6=!_0x20fbe4[_0x2db420(0xa5)][_0x2db420(0x9b)](_0x2db420(0x7b));_0x1c7fe6?(adjustPanelPosition(),setTimeout(()=>{document['addEventListener']('click',handleClickOutsidePanel);},0x64)):document[_0x2db420(0x9a)](_0x2db420(0x98),handleClickOutsidePanel),_0x20fbe4[_0x2db420(0xa5)][_0x2db420(0x7d)]('expanded');}function handleClickOutsidePanel(_0x2f09cf){const _0x1a668d=_0x4e8c,_0x47e4d9=document[_0x1a668d(0x8b)](_0x1a668d(0x8f)),_0x60ef9e=document[_0x1a668d(0x8b)](_0x1a668d(0x82)),_0x4c927e=document[_0x1a668d(0x8b)](_0x1a668d(0xa3));if(!_0x47e4d9[_0x1a668d(0xa5)]['contains']('expanded')){document[_0x1a668d(0x9a)](_0x1a668d(0x98),handleClickOutsidePanel);return;}!_0x60ef9e[_0x1a668d(0x9b)](_0x2f09cf['target'])&&!_0x4c927e[_0x1a668d(0x9b)](_0x2f09cf['target'])&&(_0x47e4d9[_0x1a668d(0xa5)]['remove'](_0x1a668d(0x7b)),document['removeEventListener'](_0x1a668d(0x98),handleClickOutsidePanel));}function _0x4e8c(_0x1d96ec,_0x1208a8){const _0xd2f89b=_0xd2f8();return _0x4e8c=function(_0x4e8cce,_0x2058ae){_0x4e8cce=_0x4e8cce-0x70;let _0xd82eaf=_0xd2f89b[_0x4e8cce];return _0xd82eaf;},_0x4e8c(_0x1d96ec,_0x1208a8);}function adjustPanelPosition(){const _0x15d924=_0x4e8c,_0x10b7b7=document[_0x15d924(0x8b)](_0x15d924(0x8f)),_0x1fa103=document[_0x15d924(0x8b)](_0x15d924(0x82));if(!_0x10b7b7||!_0x1fa103)return;const _0x1f7c58=_0x10b7b7[_0x15d924(0xa4)](),_0x1e402f=0xc8,_0x2101ef=0x12c,_0xe6b411=0x46;_0x1fa103['style'][_0x15d924(0x9c)]=_0x15d924(0x8c),_0x1fa103[_0x15d924(0x88)][_0x15d924(0x78)]=_0x15d924(0x8c),_0x1fa103[_0x15d924(0x88)][_0x15d924(0x70)]=_0x15d924(0x8c),_0x1fa103[_0x15d924(0x88)][_0x15d924(0x76)]=_0x15d924(0x8c);const _0x503839=_0x1f7c58[_0x15d924(0x9c)]>window[_0x15d924(0x93)]/0x2,_0x23cf57=_0x1f7c58[_0x15d924(0x70)]>window[_0x15d924(0x8e)]/0x2;if(_0x503839){const _0x44e989=window['innerWidth']-_0x1f7c58[_0x15d924(0x9c)];_0x44e989<_0x1e402f+_0xe6b411?_0x1fa103['style'][_0x15d924(0x78)]=_0xe6b411+'px':_0x1fa103[_0x15d924(0x88)][_0x15d924(0x78)]=_0xe6b411+'px';}else{const _0x41f7ac=_0x1f7c58[_0x15d924(0x78)];_0x41f7ac<_0x1e402f+_0xe6b411?_0x1fa103['style'][_0x15d924(0x9c)]=_0xe6b411+'px':_0x1fa103[_0x15d924(0x88)][_0x15d924(0x78)]=_0xe6b411+'px';}if(_0x23cf57){const _0x4d6eaf=window[_0x15d924(0x8e)]-_0x1f7c58[_0x15d924(0x76)];_0x4d6eaf<0x14?_0x1fa103[_0x15d924(0x88)][_0x15d924(0x76)]=Math[_0x15d924(0xa0)](0x14,_0x4d6eaf)+'px':_0x1fa103[_0x15d924(0x88)]['bottom']='0';}else _0x1fa103['style']['top']='0';}function initFloatBallDrag(){const _0x13e52f=_0x4e8c,_0x1f8f54=document[_0x13e52f(0x8b)](_0x13e52f(0x8f)),_0x3b55a1=document[_0x13e52f(0x8b)]('quick-backup-circle');if(!_0x3b55a1||_0x3b55a1[_0x13e52f(0x9d)]['dragInitialized'])return;let _0x304aff=![],_0x25a1a9,_0x418c99,_0x2b5df6,_0x3d29c0,_0x2baf2c,_0x5dbc63,_0x3b62df,_0x3c5c82=![];function _0x3f6e9d(){const _0x55d60a=_0x13e52f,_0x1eca9b=_0x1f8f54[_0x55d60a(0xa4)]();return{'x':_0x1eca9b['left'],'y':_0x1eca9b[_0x55d60a(0x70)]};}function _0xc25d3a(){const _0x4a6473=_0x13e52f,_0x4702ab=_0x3f6e9d();localStorage['setItem'](_0x4a6473(0x7f),JSON[_0x4a6473(0x72)](_0x4702ab));}function _0x3d676e(){const _0x215ddb=_0x13e52f,_0x32f9d6=localStorage[_0x215ddb(0xa6)](_0x215ddb(0x7f));if(_0x32f9d6)try{const _0x130079=JSON[_0x215ddb(0xa8)](_0x32f9d6);_0x1f8f54[_0x215ddb(0x88)]['left']=_0x130079['x']+'px',_0x1f8f54['style'][_0x215ddb(0x70)]=_0x130079['y']+'px',_0x1f8f54['style'][_0x215ddb(0x78)]=_0x215ddb(0x8c),_0x1f8f54[_0x215ddb(0x88)][_0x215ddb(0x76)]='auto';}catch(_0x58bc68){console[_0x215ddb(0x83)](_0x215ddb(0x74),_0x58bc68);}}function _0x164817(_0x196773){const _0x207d2e=_0x13e52f;_0x196773[_0x207d2e(0x85)]();const _0x3614c4=_0x196773[_0x207d2e(0xa9)][_0x207d2e(0x8a)]('touch')?_0x196773[_0x207d2e(0x79)][0x0]:_0x196773;_0x25a1a9=_0x3614c4[_0x207d2e(0x95)],_0x418c99=_0x3614c4[_0x207d2e(0x9e)];const _0xa37119=_0x3f6e9d();_0x2baf2c=_0xa37119['x'],_0x5dbc63=_0xa37119['y'],_0x304aff=!![],_0x3c5c82=![],_0x3b55a1[_0x207d2e(0xa5)]['add'](_0x207d2e(0xa2)),_0x1f8f54['classList']['add'](_0x207d2e(0x71)),_0x3b62df=setTimeout(()=>{_0x3c5c82=!![];},0xc8);}function _0x40028d(_0x2133bc){const _0x3749b9=_0x13e52f;if(!_0x304aff)return;_0x2133bc[_0x3749b9(0x85)]();const _0x3b8c76=_0x2133bc[_0x3749b9(0xa9)][_0x3749b9(0x8a)]('touch')?_0x2133bc[_0x3749b9(0x79)][0x0]:_0x2133bc;_0x2b5df6=_0x3b8c76[_0x3749b9(0x95)]-_0x25a1a9,_0x3d29c0=_0x3b8c76[_0x3749b9(0x9e)]-_0x418c99;(Math[_0x3749b9(0x94)](_0x2b5df6)>0x5||Math['abs'](_0x3d29c0)>0x5)&&(_0x3c5c82=!![],clearTimeout(_0x3b62df));const _0x4fd908=_0x2baf2c+_0x2b5df6,_0x21684b=_0x5dbc63+_0x3d29c0,_0x35d713=window[_0x3749b9(0x93)]-_0x1f8f54[_0x3749b9(0x97)],_0x497487=window[_0x3749b9(0x8e)]-_0x1f8f54[_0x3749b9(0x84)],_0x2e5296=Math[_0x3749b9(0xa0)](0x0,Math['min'](_0x4fd908,_0x35d713)),_0x27aec4=Math[_0x3749b9(0xa0)](0x0,Math[_0x3749b9(0x7c)](_0x21684b,_0x497487));_0x1f8f54[_0x3749b9(0x88)][_0x3749b9(0x9c)]=_0x2e5296+'px',_0x1f8f54['style'][_0x3749b9(0x70)]=_0x27aec4+'px',_0x1f8f54[_0x3749b9(0x88)][_0x3749b9(0x78)]=_0x3749b9(0x8c),_0x1f8f54['style'][_0x3749b9(0x76)]=_0x3749b9(0x8c);}function _0x55ba08(_0x1d9757){const _0xa490c1=_0x13e52f;if(!_0x304aff)return;_0x304aff=![],_0x3b55a1[_0xa490c1(0xa5)]['remove']('dragging'),clearTimeout(_0x3b62df),_0x3c5c82&&_0xc25d3a(),setTimeout(()=>{const _0x4c901a=_0xa490c1;_0x1f8f54[_0x4c901a(0xa5)][_0x4c901a(0x77)](_0x4c901a(0x71));},0x3e8),!_0x3c5c82&&toggleQuickBackupPanel();}_0x3b55a1[_0x13e52f(0x87)](_0x13e52f(0x96),_0x164817),document['addEventListener']('mousemove',_0x40028d),document[_0x13e52f(0x87)](_0x13e52f(0x81),_0x55ba08),_0x3b55a1['addEventListener'](_0x13e52f(0x8d),_0x164817,{'passive':![]}),document[_0x13e52f(0x87)](_0x13e52f(0xa7),_0x40028d,{'passive':![]}),document[_0x13e52f(0x87)](_0x13e52f(0x73),_0x55ba08),_0x3b55a1['dataset'][_0x13e52f(0x86)]='true',_0x3d676e(),console[_0x13e52f(0x80)](_0x13e52f(0x90));}document['readyState']===_0x1aebf1(0x7a)?document[_0x1aebf1(0x87)]('DOMContentLoaded',initFloatBallDrag):initFloatBallDrag();function _0xd2f8(){const _0x128498=['floatBallPosition','log','mouseup','quick-backup-panel','error','offsetHeight','preventDefault','dragInitialized','addEventListener','style','117888sFUknk','includes','getElementById','auto','touchstart','innerHeight','quick-backup-float','âœ…\x20æ‚¬æµ®çƒæ‹–åŠ¨åŠŸèƒ½å·²åˆå§‹åŒ–','77eVlmPH','1106996ZiXSdv','innerWidth','abs','clientX','mousedown','offsetWidth','click','4160718QGJCmz','removeEventListener','contains','left','dataset','clientY','789702KSggAJ','max','228974VTKzpZ','dragging','quick-backup-circle','getBoundingClientRect','classList','getItem','touchmove','parse','type','top','active','stringify','touchend','æ¢å¤æ‚¬æµ®çƒä½ç½®å¤±è´¥:','38612520kXescH','bottom','remove','right','touches','loading','expanded','min','toggle','5703655YijgJK'];_0xd2f8=function(){return _0x128498;};return _0xd2f8();}
    </script>
    <!-- EVEChat v1.0 - Created by EVE - 2025 -->

</body>
</html>